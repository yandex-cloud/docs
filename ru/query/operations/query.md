# Работа с запросами

В {{yq-full-name}} можно выполнять [аналитические](../concepts/batch-processing.md) и [потоковые](../concepts/stream-processing.md) запросы.

## Создать запрос {#create}

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором нужно создать запрос.
1. В списке сервисов выберите **{{ yq-full-name }}**.
1. На панели слева выберите **Запросы**.
1. На панели сверху нажмите кнопку **Новый аналитический запрос** или **Новый потоковый запрос**.

## Проверить запрос {#parse}

Чтобы проверить текст запроса без его исполнения, нажмите кнопку **Валидировать**.

## Выполнить запрос {#run}

{% list tabs %}

- Аналитический запрос

  Аналитические запросы поддерживают только сценарий запуска запросов на исполнение. Чтобы запустить запрос, введите текст запроса и нажмите кнопку ![run](../../_assets/query/run.svg) **Выполнить**.

- Потоковый запрос

  Потоковые запросы поддерживают сценарий запуска нового или продолжение выполнения текущего запроса:

  * Чтобы запустить новый запрос, нажмите кнопку ![run](../../_assets/query/run.svg) **Выполнить начиная с текущих**.
  * Чтобы продолжить выполнять потоковый запрос с последней [контрольной точки](../concepts/glossary.md#checkpoint), нажмите кнопку ![run](../../_assets/query/run.svg) **Продолжить**. Если нужно продолжить выполнять запрос после смены источника данных, нажмите кнопку ![option](../../_assets/query/option.svg) и выберите **Продолжить (принудительно)**.

  {% note info %}

  Потоковые запросы выполняются к потокам данных, которые не ограничены. В отличие от аналитического запроса, потоковый запрос может выполняться бесконечно.

  {% endnote %}

{% endlist %}

## Остановить запрос {#stop}

Чтобы остановить запрос:

{% list tabs %}

- Аналитический запрос

  Нажмите кнопку ![stop](../../_assets/query/stop.svg) **Остановить**.

- Потоковый запрос

  * Нажмите кнопку ![stop](../../_assets/query/stop.svg) **Остановить**, чтобы создать [контрольную точку](../concepts/glossary.md#checkpoint) и остановить запрос.
  * Нажмите кнопку ![stop](../../_assets/query/stop.svg) **Принудительно остановить**, чтобы остановить запрос без создания контрольной точки.

{% endlist %}

### Посмотреть результаты {#view-result}

Результат выполнения запроса отображается на вкладке **Результат** в виде таблицы или схемы.

{% note info %}

Для результатов исполнения запросов действуют ограничения:
* Просмотр результатов доступен только для последнего исполнения запроса.
* Результаты запросов удаляются спустя 24 часа.

{% endnote %}

### Ошибки {#errors}

Ошибки выполнения запросов отображаются на вкладке **Ошибки**.

### План запроса {#plan}

На вкладке **План** отображаются [этапы выполнения запроса](../concepts/request-processing.md).

### Мониторинг выполнения запроса {#monitoring}

Метрики выполнения запроса позволяют подробно диагностировать работу запросов под управлением {{yq-full-name}}. На вкладке **Мониторинг** отображается информация про:

* Входящие потоки данных.
* Используемые мощности для выполнения запроса.
* Объем использованной памяти.
* Объем выходных данных.

### Метаданные {#meta}

В разделе **Мета** находится информация о метаданных запроса:
* Идентификатор запроса.
* Статус выполнения запроса.
* Дата создания, изменения, последнего выполнения запроса.

## Посмотреть информацию о выполненных запросах {#log}

{{yq-full-name}} сохраняет [историю исполнения](../concepts/glossary.md#job) для каждого запроса.

Чтобы посмотреть историю выполнения запроса:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором нужно посмотреть историю выполнения запроса.
1. В списке сервисов выберите **{{ yq-full-name }}**.
1. На панели слева выберите **Запросы**.
1. Выберите запрос и на панели сверху нажмите кнопку ![pencil](../../_assets/query/launch.svg) **Показать запуски**.

## Переименовать запрос {#update-query-name}

Чтобы переименовать запрос:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором нужно переименовать запрос.
1. В списке сервисов выберите **{{ yq-full-name }}**.
1. На панели слева выберите **Запросы**.
1. Выберите запрос и на панели нажмите кнопку ![pencil](../../_assets/query/pensil.svg) рядом с именем запроса.
1. Введите новое имя запроса и нажмите кнопку ![check](../../_assets/query/check.svg).

## Изменить запрос {#update}

Чтобы изменить запрос, введите новый текст запроса и нажмите кнопку **Выполнить**. Если запрос уже запущен, [остановите](#stop) его для изменения текста запроса.

## Клонировать запрос {#clone}

Для удобства разработки можно клонировать запросы с сохранением текста:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором нужно клонировать запрос.
1. В списке сервисов выберите **{{ yq-full-name }}**.
1. На панели слева выберите **Запросы**.
1. Выберите запрос и нажмите кнопку **Клонировать**. Чтобы клонировать запрос с другим типом, нажмите кнопку ![option](../../_assets/query/delete.svg) **Клонировать как…**

## Удалить запрос {#delete}

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором нужно удалить запрос.
1. В списке сервисов выберите **{{ yq-full-name }}**.
1. На панели слева выберите **Запросы**.
1. Нажмите кнопку ![delete](../../_assets/query/delete.svg) напротив имени запроса, который вы хотите удалить.
1. Подтвердите удаление запроса.
