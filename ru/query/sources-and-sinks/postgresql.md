# Работа с базами данных {{ mpg-name }}

В этом разделе описана основная информация про работу с [{{ mpg-name }}](https://cloud.yandex.ru/services/managed-postgresql).

{% include [preview](../_includes/preview.md) %}


Пример чтения данных из {{ mpg-name }}:

```sql
SELECT * FROM postgresql_mdb_connection.`my_db.my_table`
```

где:
* `postgresql_mdb_connection` — название созданного подключения к БД.
* `my_db` — имя базы данных {{ PG }} в кластере.
* `my_table` — имя таблицы в базе данных.


Для работы с базой данных {{ mpg-name }} необходимо выполнить следующие шаги:
1. Создать [соединение](../concepts/glossary.md#connection), содержащее реквизиты для подключения к базе данных.
1. [Выполнить запрос](#query) к базе данных.

## Настройка соединения {#create_connection}

Чтобы создать соединение с {{ mpg-name }}:
1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором нужно создать соединение.
1. В списке сервисов выберите **{{ yq-full-name }}**.
1. На панели слева перейдите на вкладку **Соединения**.
1. Нажмите кнопку ![info](../../_assets/plus.svg) **Создать**.
1. Укажите параметры соединения:

   1. В блоке **Общие параметры**:

      * **Имя** — название соединения с {{ mpg-name }}.
      * **Тип** — `{{ mpg-name }}`.

   1. В блоке **Параметры типа соединения**:

      * **Кластер** — выберите существующий кластер {{ mpg-name }} или создайте новый.
      * **Сервисный аккаунт** — выберите существующий [сервисный аккаунт](../../iam/concepts/users/service-accounts.md) {{ mpg-name }} или создайте новый с ролью [`{{ roles.mpg.viewer }}`](../../managed-postgresql/security/index.md#mpg-viewer), от имени которого будет выполняться подключение к кластерам `{{ mpg-name }}`.
      * **Логин**  — имя пользователя, которое будет использоваться для подключения к базам данных {{ PG }}.
      * **Пароль**  — пароль пользователя, который будет использоваться для подключения к базам данных {{ PG }}.


1. Нажмите кнопку **Создать**.

Сервисный аккаунт необходим для обнаружения точек подключения к кластерам {{ mpg-name }} внутри {{ yandex-cloud }}, для работы с данными логин и пароль пользователя задаются отдельно.

{% note warning %}

Необходимо предварительно разрешить сетевой доступ от {{ yq-full-name }} до кластеров {{ mpg-name }}. Для этого в настройках базы данных, к которой осуществляется подключение, установите пункт "Доступ из Yandex Query".

{% endnote %}

## Синтаксис запросов {#query}
Для работы с {{ PG }} используется следующая форма SQL-запроса:

```sql
SELECT * FROM postgresql_mdb_connection.`<db>.<table>`
```

где:
* `postgresql_mdb_connection` — название созданного подключения к БД.
* `<db>` — имя базы данных {{ PG }} в кластере.
* `<table>` — имя таблицы в базе данных.

## Ограничения {#limits}

При работе с кластерами {{ PG }} существует ряд ограничений.

{% note warning %}

В настоящий момент независимо от указанных фильтров для чтения таблиц {{ PG }}, указанных в SQL-запросе, все данные из таблицы считываются в {{ yq-full-name }} и уже там происходит применение фильтров.

{% endnote %}

Ограничения:
1. Поддерживаются только запросы чтения данных - `SELECT`, остальные виды запросов не поддерживаются.
1. Максимальное поддерживаемое количество строк в таблице - 1000000. При превышении этого значения запрос завершается с ошибкой.
1. {% include [!](_includes/datetime_limits.md) %}
1. При чтении всегда используется [пространство имен](https://www.postgresql.org/docs/current/catalog-pg-namespace.html) `public`, указать другое нельзя.


## Поддерживаемые типы данных {#supported_types}

Ниже приведена таблица соответствия типов {{ PG }} и типов {{ yq-full-name }}.

|Тип данных {{ PG }}|Тип данных {{ yq-full-name }}|Примечания|
|---|----|------|
|`boolean`|`BOOL`||
|`smallint`|`INT16`||
|`int2`|`INT16`||
|`integer`|`INT32`||
|`int`|`INT32`||
|`int4`|`INT32`||
|`serial`|`INT32`||
|`serial4`|`INT32`||
|`bigint`|`INT64`||
|`int8`|`INT64`||
|`bigserial`|`INT64`||
|`serial8`|`INT64`||
|`real`|`FLOAT`||
|`float4`|`FLOAT`||
|`double precision`|`DOUBLE`||
|`float8`|`DOUBLE`||
|`date`|`DATE`|Допустимый диапазон дат с 1970-01-01 и до 2105-12-31|
|`timestamp`|`TIMESTAMP`|Допустимый диапазон дат с 1970-01-01 00:00 и до 2105-12-31 23:59|
|`bytea`|`STRING`||
|`character`|`UTF8`|[Правила сортировки](https://www.postgresql.org/docs/current/collation.html) по умолчанию, строка дополняется пробелами до требуемой длины|
|`character varying`|`UTF8`|[Правила сортировки](https://www.postgresql.org/docs/current/collation.html) по умолчанию|
|`text`|`UTF8`|[Правила сортировки](https://www.postgresql.org/docs/current/collation.html) по умолчанию|

Остальные типы данных не поддерживаются.

