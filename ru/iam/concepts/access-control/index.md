# Как устроено управление доступом в {{ yandex-cloud }}

На этой странице можно узнать, как управлять доступом к ресурсам, и как {{ iam-short-name }} проверяет права доступа к ним.

## Как проверяются права доступа? {#access-verifying}

Все операции в {{ yandex-cloud }} предварительно отправляются на проверку в {{ iam-short-name }}, например:

1. Пользователь просит сервис {{ compute-name }} создать новый диск в каталоге <q>default</q>.
1. Сервис спрашивает {{ iam-short-name }}, можно ли этому пользователю создать диск в этом каталоге.
1. {{ iam-short-name }} проверяет, что пользователь — участник облака с каталогом <q>default</q> и имеет необходимые разрешения для создания диска в этом каталоге.
1. Если какого-то из разрешений у пользователя нет, операция не будет выполнена, и {{ yandex-cloud }} сообщит об ошибке.
    Если все разрешения имеются, то {{ iam-short-name }} сообщает об этом сервису.
1. Сервис создает новый диск.

![checkPermissions.png](../../../_assets/checkPermissions.png)

## Как вы управляете доступом? {#how-do-i-perform-access-management}

Управление доступом в {{ yandex-cloud }} построено на политике [Role Based Access Control](https://en.wikipedia.org/wiki/Role-based_access_control) (RBAC). Чтобы предоставить доступ к ресурсу, вы указываете, кому и какие [роли](roles.md) назначены на ресурс.

Чтобы назначить роль, вы [выбираете ресурс](#resource), [выбираете роль](#role) и [описываете субъект](#subject), которому назначается роль. Таким образом вы [назначаете права доступа](#access-bindings) к ресурсу.

Вы также можете назначить роль на родительский ресурс, от которого [наследуются права доступа](#inheritance), например назначить роль на каталог или облако.

{% note warning %}

Изменение прав доступа обычно занимает до 5 секунд. Если после назначения роли все еще нет доступа, попробуйте выполнить операцию еще раз.

Например, вам разрешили создавать каталоги в облаке и вы уже создали один каталог, но не смогли создать второй. Это произошло потому, что еще не обновились права доступа на том сервере, где выполнялась вторая операция по созданию каталога. Попробуйте создать каталог еще раз.

{% endnote %}

### Ресурсы, на которые можно назначать роли {#resource}

Назначать роли можно на [облако](../../../resource-manager/operations/cloud/set-access-bindings.md), [каталог](../../../resource-manager/operations/folder/set-access-bindings.md) и другие ресурсы из [списка](resources-with-access-control.md). Если нужно предоставить доступ к ресурсу, которого нет в списке, назначьте роль на родительский ресурс, от которого [наследуются](#inheritance) права доступа. Например, у [кластеров {{ mpg-full-name }}](../../../managed-postgresql/concepts/index.md) права доступа наследуются от каталога.

### Роль {#role}

{% include [roles-assign](../../../_includes/iam/roles-assign.md) %}

Таким образом, назначать роли на ресурс могут пользователи с ролью [администратора](../../roles-reference.md#admin) на облако или организацию, а также владельцы облака или организации, к которым относится ресурс.

Каждая роль состоит из набора разрешений, описывающих допустимые операции с ресурсом. Пользователь может назначить роли только с теми разрешениями, которые имеются у него самого. Например, чтобы назначить роль [владельца облака](../../../resource-manager/security/index.md#resource-manager-clouds-owner), пользователь должен сам обладать этой ролью, а роли администратора для этого недостаточно.

О том, какие есть роли и какие разрешения в них входят, читайте в разделе [{#T}](roles.md).

### Субъект, которому назначается роль {#subject}

Роли назначаются субъектам. Существуют следующие типы субъектов:

* `userAccount` — [аккаунт на Яндексе](../users/accounts.md#passport), добавленный в {{ yandex-cloud }}, или аккаунт из [пула пользователей](../../../organization/concepts/user-pools.md):

    Идентификатор субъекта: `userAccount:<идентификатор_пользователя>`.

    Где `<идентификатор_пользователя>` — уникальный [идентификатор](../../../api-design-guide/concepts/resources-identification.md), [присвоенный](../../operations/users/get.md) пользователю. Например: `userAccount:ajecpdmpr4pr********`.

* `serviceAccount` — [сервисный аккаунт](../users/service-accounts.md), созданный в {{ yandex-cloud }}:

    Идентификатор субъекта: `serviceAccount:<идентификатор_сервисного_аккаунта>`.

    Где `<идентификатор_сервисного_аккаунта>` — уникальный идентификатор, [присвоенный](../../operations/sa/get-id.md) сервисному аккаунту. Например: `serviceAccount:ajevnu4u2q3m********`.

    {% include [include](../../../_includes/sa-assign-role-note.md) %}

* `federatedUser` — аккаунт пользователя [федерации удостоверений](../../../organization/concepts/add-federation.md), например из Active Directory:

    Идентификатор субъекта: `federatedUser:<идентификатор_пользователя>`.

    Где `<идентификатор_пользователя>` — уникальный идентификатор, [присвоенный](../../operations/users/get.md) федеративному пользователю. Например: `federatedUser:aje7b4u65nb6********`.

* `group` — группа пользователей [{{ org-full-name }}](../../../organization/):

    * [Группа пользователей](../../../organization/concepts/groups.md), созданная администратором организации:

        Идентификатор субъекта: `group:<идентификатор_пользовательской_группы>`.

        Где `<идентификатор_пользовательской_группы>` — уникальный идентификатор, присвоенный группе пользователей, созданной администратором организации. Например: `group:ajeser8mnc4c********`.

    * [Системная группа](./system-group.md#allOrganizationUsers) `All users in organization X`:

        Идентификатор субъекта: `group:organization:<идентификатор_организации>:users`.

        Где `<идентификатор_организации>` — уникальный [идентификатор](../../../organization/operations/organization-get-id.md), присвоенный [организации](../../../organization/quickstart.md) `X`. Например: `group:organization:bpfaidqca8vd********:users`.

    * [Системная группа](./system-group.md#allFederationUsers) `All users in federation N`:

        Идентификатор субъекта: `group:federation:<идентификатор_федерации>:users`.

        Где `<идентификатор_федерации>` — уникальный идентификатор, присвоенный [федерации удостоверений](../../../organization/concepts/add-federation.md) `N`. Например: `group:federation:bpf8tpgggfoi********:users`.

* `system` — [публичная группа](./public-group.md) пользователей:

    * [Публичная группа](./public-group.md#allAuthenticatedUsers) пользователей `All authenticated users`:

        Идентификатор субъекта: `system:allAuthenticatedUsers`.

    * [Публичная группа](./public-group.md#allUsers) `All users`:

        Идентификатор субъекта: `system:allUsers`.

### Назначение прав доступа {#access-bindings}

Роли на ресурс назначаются в виде списка связей _роль-субъект_. Такие связи называются — _назначенные права доступа_ (access bindings). Вы можете добавлять и удалять эти связи, таким образом контролируя права доступа к ресурсу.

![accessBindings.png](../../../_assets/accessBindings.png)

Одна привязка — одно назначение роли субъекту. Чтобы назначить пользователю несколько ролей на ресурс, задайте отдельную привязку для каждой из ролей.

### Наследование прав доступа {#inheritance}

Если у ресурса есть дочерние ресурсы, то все разрешения от родительского ресурса будут унаследованы дочерними ресурсами. Например, если вы назначите пользователю роль на каталог, в котором лежит виртуальная машина, то все разрешения этой роли будут действовать и для виртуальной машины.

Если на дочерний ресурс тоже назначены роли, то список разрешений на этот ресурс будет объединен со списком разрешений на родительский ресурс. Нельзя ограничить список разрешений, унаследованных от родительского ресурса.

### Имперсонация {#impersonation}

_Имперсонацией_ называется выполнение пользователем действий с ресурсами облака от имени сервисного аккаунта, которому назначены необходимые права. Имперсонация чаще всего применяется, чтобы временно расширить права пользователя, не прибегая к генерации статических учетных данных.

Например, когда у пользователя нет прав на просмотр каталога, но на какое-то время они ему оказались нужны. Для этого администратор может [назначить](../../operations/sa/set-access-bindings.md#impersonation) сервисному аккаунту роль на просмотр каталога, а пользователю назначить специальную роль `iam.serviceAccounts.tokenCreator`. В результате пользователь сможет от имени сервисного аккаунта просматривать ресурсы в каталоге или получить IAM-токен сервисного аккаунта. Пользователь не сможет изменить права доступа или удалить сервисный аккаунт. 

В нужный момент администратор может отозвать роль.

### Ограничения управления доступом в консоли управления {#console-restrictions}

В консоли управления [назначение ролей](../../operations/roles/grant.md) работает с ограничениями:

* Вы не можете назначить роли сразу нескольким субъектам, как в API или CLI. В консоли управления вы сначала выбираете субъект (пользователя или сервисный аккаунт), а затем назначаете ему роли.

## Управление доступом сервисов к ресурсам в облаке пользователя {#service-control}

{{ iam-full-name }} позволяет управлять [доступом сервисов](../service-control.md) к ресурсам в облаке пользователя, при необходимости [включая](../../operations/service-control/enable-disable.md#enable) или [выключая](../../operations/service-control/enable-disable.md#disable) нужные сервисы.

Доступ сервиса — это совокупность прав доступа, необходимых для создания и функционирования ресурсов этого сервиса в облаке пользователя. Такие права доступа назначаются специальным сервисным аккаунтам — [сервисным агентам](../service-control.md#service-agent), от имени которых сервис осуществляет доступ к ресурсам пользователя в облаке.

Пользователь не может напрямую создавать или удалять сервисных агентов. Сервисные агенты в необходимом количестве и с нужными правами доступа автоматически создаются при включении сервисов и автоматически удаляются при их выключении.

#### См. также {#see-also}

Вы можете найти подробную информацию об управлении доступом для конкретного сервиса {{ yandex-cloud }} в разделе <q>Управление доступом</q> в документации соответствующего сервиса.

Пошаговые инструкции и примеры:

* [{#T}](../../operations/roles/grant.md)
* [{#T}](../../operations/roles/revoke.md)
* [{#T}](../../operations/sa/assign-role-for-sa.md)
* [{#T}](../../operations/sa/set-access-bindings.md)
* [{#T}](../../../resource-manager/operations/cloud/set-access-bindings.md)
* [{#T}](../../../resource-manager/operations/folder/set-access-bindings.md)
* [{#T}](../../operations/service-control/enable-disable.md)