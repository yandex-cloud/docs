# Отзыв роли на ресурс

Если вы хотите запретить [субъекту](../../concepts/access-control/index.md#subject) доступ к ресурсу, отзовите у него соответствующие роли на этот ресурс и на ресурсы, от которых наследуются права доступа. Подробнее читайте в разделе [{#T}](../../concepts/access-control/index.md).

{% note info %}

Если вам надо временно отозвать все права доступа у пользователя с аккаунтом {% if product == "yandex-cloud" %}на Яндексе{% endif %}{% if product == "cloud-il" %}Google{% endif %}, вы можете отозвать только роль `{{ roles-cloud-member }}`. У пользователя останутся все остальные роли, но он не сможет выполнять никаких операций с ресурсами в облаке. Когда вы снова добавите пользователя в облако, права доступа для него уже будут настроены.

{% endnote %}

## Отозвать роль {#revoke-one-role}

{% list tabs %}

- Консоль управления

  В консоли управления можно отозвать роль только на облако или каталог:

  * Чтобы отозвать роль только в каталоге:

      1. В [консоли управления]({{ link-console-main }}) перейдите в нужный каталог.
      1. Перейдите на вкладку **Права доступа**.
      1. Выберите пользователя в списке и нажмите значок ![image](../../../_assets/options.svg) напротив имени пользователя.
      1. Нажмите кнопку **Изменить роли**.
      1. Нажмите значок ![image](../../../_assets/cross.svg) напротив роли, которую хотите отозвать.
      1. Нажмите кнопку **Сохранить**.

  * Чтобы отозвать роль в облаке:

      1. В [консоли управления]({{ link-console-main }}) [выберите](../../../resource-manager/operations/cloud/switch-cloud.md) облако.
      1. Перейдите на вкладку **Права доступа**.
      1. Выберите пользователя в списке и нажмите значок ![image](../../../_assets/options.svg) напротив имени пользователя.
      1. Если вы хотите отозвать все роли пользователя в облаке — нажмите кнопку **Отозвать роли** и подтвердите отзыв.
      1. Если вы хотите отозвать отдельные роли пользователя в облаке:
          1. Нажмите кнопку **Изменить роли**.
          1. В окне **Настройка прав доступа** нажмите значок ![image](../../../_assets/cross.svg) напротив каждой роли, которую хотите отозвать.
          1. Нажмите кнопку **Сохранить**.

- CLI

  {% include [cli-install](../../../_includes/cli-install.md) %}

  Чтобы отозвать роль у субъекта, удалите соответствующую привязку прав доступа для соответствующего ресурса:

  1. Посмотрите, кому и какие роли назначены на ресурс:

      {% include [include](../../../_includes/iam/list-access-bindings-via-cli.md) %}
      
  1. Чтобы удалить привязку прав доступа, выполните команду:

      ```bash
      yc <service-name> <resource> remove-access-binding <resource-name>|<resource-id> \
        --role <role-id> \
        --subject <subject-type>:<subject-id>
      ```

      Где:
      * `<role-id>` — идентификатор роли, которую надо отозвать, например `{{ roles-cloud-owner }}`.
      * `<subject-type>` — тип [субъекта](../../concepts/access-control/index.md#subject), у которого отзывается роль.
      * `<subject-id>` — идентификатор субъекта.

- API

  Чтобы отозвать роль у субъекта на ресурс, удалите соответствующую привязку прав доступа:

  1. {% include [include](../../../_includes/iam/list-access-bindings-via-api.md) %}
  1. Сформируйте тело запроса, например в файле `body.json`. В теле запроса укажите, какую привязку прав доступа необходимо удалить. Например, отзовите у пользователя `ajei8n54hmfhuk5nog0g` роль `editor`:
{% if product == "yandex-cloud" %}

      **body.json:**
      ```json
      {
          "accessBindingDeltas": [{
              "action": "REMOVE",
              "accessBinding": {
                  "roleId": "editor",
                  "subject": {
                      "id": "ajei8n54hmfhuk5nog0g",
                      "type": "userAccount"
                      }
                  }
              }
          ]
      }
      ```

{% endif %}
{% if product == "cloud-il" %}

      **body.json:**
      ```json
      {
          "accessBindingDeltas": [{
              "action": "REMOVE",
              "accessBinding": {
                  "roleId": "editor",
                  "subject": {
                      "id": "ajei8n54hmfhuk5nog0g",
                      "type": "federatedUser"
                      }
                  }
              }
          ]
      }
      ```

{% endif %}
  1. Отзовите роль, удалив указанную привязку прав доступа:

      {% include [grant-role-folder-via-curl](../../../_includes/iam/grant-role-folder-via-curl.md) %}

- Terraform

    Если у вас ещё нет Terraform, [установите его и настройте провайдер {{ yandex-cloud }}](../../../tutorials/infrastructure-management/terraform-quickstart.md#install-terraform).

    1. Чтобы отозвать роль у субъекта на ресурс, найдите в конфигурационном файле описание ресурса:
{% if product == "yandex-cloud" %}

       ```
       resource "yandex_resourcemanager_cloud_iam_binding" "admin" {
         cloud_id    = "<идентификатор облака>"
         role        = "<роль>"
         members     = [
           "serviceAccount:<идентификатор сервисного аккаунта>",
           "userAccount:<идентификатор пользователя>",
         ]
       }
       ```

{% endif %}
{% if product == "cloud-il" %}

       ```
       resource "yandex_resourcemanager_cloud_iam_binding" "admin" {
         cloud_id    = "<идентификатор облака>"
         role        = "<роль>"
         members     = [
           "serviceAccount:<идентификатор сервисного аккаунта>",
           "federatedUser:<идентификатор пользователя>",
         ]
       }
       ```

{% endif %}
    1. Удалите запись с информацией о субъекте, у которого нужно отозвать права, из перечня пользователей `members`.

       Более подробную информацию о параметрах ресурса `yandex_resourcemanager_cloud_iam_binding`, см. в [документации провайдера]({{ tf-provider-link }}/iam_service_account_iam_binding).

    1. Проверьте корректность конфигурационных файлов.

       1. В командной строке перейдите в папку, где вы создали конфигурационный файл.
       1. Выполните проверку с помощью команды:

          ```
          terraform plan
          ```

       Если конфигурация описана верно, в терминале отобразится список создаваемых ресурсов и их параметров. Если в конфигурации есть ошибки, Terraform на них укажет.

    1. Разверните облачные ресурсы.

       1. Если в конфигурации нет ошибок, выполните команду:

          ```
          terraform apply
          ```

       1. Подтвердите создание ресурсов: введите в терминал слово `yes` и нажмите **Enter**.

       После этого в указанном каталоге будут созданы все требуемые ресурсы. Проверить создание ресурса можно в [консоли управления]({{ link-console-main }}) или с помощью команды [CLI](../../../cli/quickstart.md):

       ```
       yc resource-manager cloud list-access-bindings <имя облака>|<идентификатор облака>
       ```

{% endlist %}
