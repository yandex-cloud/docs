# Сетевая безопасность

В данном разделе представлены рекомендации клиентам по настройкам безопасности в [{{ vpc-full-name }}](../../vpc/).


Подробно о том, как настроить сетевую инфраструктуру, рассказывается в вебинаре [Как работает сеть в Облаке](https://www.youtube.com/watch?v=g3cZ0o50qH0).


## Создание сегментированного защищенного контура{#protect}

Чтобы контролировать сетевой доступ к ресурсам, используйте одно из следующих решений:

* [Группы безопасности](../../vpc/concepts/security-groups.md).

  Встроенный механизм групп безопасности позволяет управлять доступом виртуальных машин к ресурсам и группам безопасности {{ yandex-cloud }} или ресурсам в интернете. Группа безопасности — это набор правил для входящего и исходящего трафика, который можно назначить на сетевой интерфейс виртуальной машины. Группы безопасности работают как stateful firewall, то есть отслеживают состояние сессий: если правило разрешает создать сессию, ответный трафик будет автоматически разрешен. Инструкцию по настройке групп безопасности см. в разделе [{#T}](../../vpc/operations/security-group-create.md). Указать группу безопасности можно в настройках ВМ.

  ![](../../_assets/overview/solution-library-icon.svg)[Решение: настройка групп безопасности (dev/stage/prod) с помощью {{ TF }}](https://github.com/yandex-cloud/yc-solution-library-for-security/tree/master/network-sec/segmentation)

* Отдельная виртуальная машина — межсетевой экран на основе образа [NGFW](/marketplace/products/usergate/ngfw) из {{ marketplace-name }}.

  ![](../../_assets/overview/solution-library-icon.svg)[Решение: установка в {{ yandex-cloud }} ВМ — межсетевого экрана (NGFW): Check Point](https://github.com/yandex-cloud/yc-solution-library-for-security/tree/master/network-sec/checkpoint-1VM)

* Схема Router-on-a-Stick на основе [Cloud Interconnect](../../interconnect/): вы можете подключить собственный файрвол к инфраструктуре {{ yandex-cloud }} по выделенному каналу и маршрутизировать трафик в облачные сети через этот файрвол.

Для доставки трафика в приложение, находящееся в облачной инфраструктуре, рекомендуется использовать сетевой балансировщик нагрузки, например [{{ alb-full-name }}](../../application-load-balancer/), который пропускает трафик только по заданным портам. Сетевой балансировщик нагрузки рекомендуется использовать совместно с группами безопасности для ограничения списка IP-адресов, имеющих доступ к приложению.

Чтобы изолировать приложения друг от друга, поместите ресурсы в разные группы безопасности, а если требуется наиболее строгая изоляция — в разные {{ vpc-short-name }}. Трафик внутри {{ vpc-short-name }} по умолчанию разрешен, между {{ vpc-short-name }} нет (только через ВМ с двумя сетевыми интерфейсами в разных сетях, VPN или Cloud Interconnect).

## Защита от DDoS

При назначении публичных IP-адресов на ресурсы облака включите встроенную [защиту от DDoS](../../vpc/ddos-protection/index.md) на уровне L4. Если необходима защита от DDoS на уровне L7, обратитесь к своему менеджеру.

## Организация удаленного доступа и каналов связи {#remote-access}

Чтобы обеспечить удаленное подключение администраторов к облачным ресурсам, используйте одно из следующих решений:

* Site-to-site VPN между удаленной площадкой (например, вашим офисом) и облаком. В качестве шлюза для удаленного доступа используйте ВМ с функцией site-to-site VPN на основе [образа](/marketplace?categories=network) из {{ marketplace-name }}.

  Варианты настройки:

  * [Создание туннеля IPSec VPN с использованием демона strongSwan](../../tutorials/routing/ipsec-vpn.md).
  * ![](../../_assets/overview/solution-library-icon.svg)[Решение: создание site-to-site VPN-соединения с {{ yandex-cloud }} с помощью {{ TF }}](https://github.com/yandex-cloud/yc-solution-library-for-security/tree/master/network-sec/vpn).

* Client VPN между удаленными устройствами и {{ yandex-cloud }}. В качестве шлюза для удаленного доступа используйте ВМ с функцией client VPN на основе [образа](/marketplace?categories=network) из {{ marketplace-name }}. См. инструкцию в разделе [Создание VPN-соединения с помощью OpenVPN](../../tutorials/routing/openvpn.md).
* Приватное выделенное соединение между удаленной площадкой и {{ yandex-cloud }} c помощью услуги [Cloud Interconnect](../../interconnect/).
{#gost-vpn}
* VPN на сертифицированных СКЗИ:

    * ГОСТ VPN. Если вам требуется защищенный канал, построенный на аппаратных сертифицированных СКЗИ, обратитесь к своему менеджеру. Услуга ГОСТ VPN включает установку аппаратного криптошлюза на стороне {{ yandex-cloud }} и, при необходимости, на стороне клиента, а также настройку и дальнейшую поддержку защищенного канала. Криптошлюзы предоставляются в аренду. Услуга оказывается совместно с партнером {{ yandex-cloud }}.
    * Виртуальный криптошлюз. Вы можете использовать сертифицированные виртуальные криптошлюзы таких российских компаний как [ИнфоТеКС](../tutorials/vipnet-to-yc.md), С-Терра СиЭсПи, КРИПТО-ПРО и др. Криптошлюз работает как обычная ВМ. Приобретение лицензии и сопровождение криптошлюза вы осуществляете самостоятельно.


Для доступа в инфраструктуру по управляющим протоколам (например, SSH, RDP) рекомендуется создать бастионную виртуальную машину. Для этого можно использовать бесплатное решение [Teleport](https://goteleport.com/). Доступ к бастионной виртуальной машине или VPN-шлюзу из интернета должен быть ограничен.

Для дополнительного контроля действий администраторов рекомендуется использовать решения PAM (Privileged Access Management) с записью сессии администратора (например, Teleport). Для доступа по SSH и VPN рекомендуется отказаться от использования паролей и вместо этого использовать открытые ключи, X.509-сертификаты и SSH-сертификаты. При настройке SSH для виртуальных машин рекомендуется использовать SSH-сертификаты в том числе и для хостовой части SSH.

Для доступа к веб-сервисам, развернутым в облаке, рекомендуется использовать TLS версий 1.2 и выше.

## Исходящий доступ в интернет {#outgoing-internet-access}

Возможные варианты организации исходящего доступа в интернет:

* [Публичный IP-адрес](../../vpc/concepts/address.md#public-addresses). Адрес назначается ВМ по принципу one-to-one NAT.
* [Egress NAT](../../vpc/operations/enable-nat.md). Включает доступ в интернет для подсети через общий пул публичных адресов {{ yandex-cloud }}. Не рекомендуется использовать Egress NAT для критичных взаимодействий, так как IP-адрес NAT-шлюза может использоваться несколькими клиентами одновременно. Следует учитывать эту особенность при моделировании угроз для инфраструктуры.
* [NAT-инстанс](../../tutorials/routing/nat-instance.md). Функцию NAT выполняет отдельная ВМ. Для создания такой ВМ можно использовать образ [NAT-инстанс](/marketplace/products/yc/nat-instance-ubuntu-18-04-lts) из {{ marketplace-name }}.

Сравнение способов доступа в интернет:

Публичный IP-адрес | Egress NAT | NAT-инстанс
----- | ----- | -----
**Плюсы:**</br>- Не требует настройки</br>- Выделенный адрес для каждой ВМ | **Плюсы:**</br>- Не требует настройки<br/>- Работает только на исходящих соединениях | **Плюсы:**</br>- Возможность фильтровать трафик на NAT-инстансе<br/>- Возможность использовать собственный файрвол<br/>- Экономия IP-адресов
**Минусы:**</br>- Выставлять ВМ напрямую в интернет может быть небезопасно<br/>- Стоимость резервирования каждого адреса | **Минусы:**</br>- Общий пул IP-адресов</br>- Функция на стадии [Preview](../../overview/concepts/launch-stages.md), поэтому не рекомендуется для продуктовых сред | **Минусы:**</br>- Требуется настройка<br/>- Стоимость использования ВМ (vCPU, RAM, диска)

Вне зависимости от выбранного варианта организации исходящего доступа в интернет, ограничивайте трафик с помощью одного из механизмов, описанных выше в подразделе [{#T}](#protect). Для построения защищенной системы необходимо использовать [статические IP-адреса](../../vpc/concepts/address.md), так как их можно внести в список исключений файрвола принимающей стороны.

## Безопасность DNS {#dns-security}

Для повышения отказоустойчивости часть трафика может передаваться в сторонние рекурсивные резолверы. Если вам необходимо избежать этого, обратитесь в [службу технической поддержки](../../support/overview.md).
