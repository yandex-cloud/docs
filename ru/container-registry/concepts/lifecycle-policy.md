# Политика автоматического удаления Docker-образов

Политика удаления [Docker-образов](docker-image.md) позволяет задать правила, в соответствии с которыми Docker-образы будут удаляться автоматически.

{% include [ограничения политики](../../_includes/container-registry/lifecycle-restrictions.md) %}

## Статусы политики удаления {#status}

{% note info %}

Политика по умолчанию создается в статусе `DISABLED`. Как активировать политику, читайте в разделе [Изменить статус политики удаления](../operations/lifecycle-policy/lifecycle-policy-update.md#update-status).

{% endnote %}

Политика удаления может находится в следующих статусах: 
* `ACTIVE` — политика активна и регулярно удаляет Docker-образы по установленным правилам.
* `DISABLED` — политика выключена и не удаляет Docker-образы в репозитории. Политики в этом статусе можно использовать для подготовки и тестирования правил.

У репозитория может быть только одна активная политика и несколько выключенных. Активную политику можно выключить в любой момент.

Как для активной, так и для выключенной политики можно делать [тестовые (dry-run) запуски](../operations/lifecycle-policy/lifecycle-policy-dry-run.md), чтобы проверить, какие Docker-образы будут удалены в соответствии с правилами.

## Правила политики удаления {#lifecycle-rules}

Для удаления Docker-образы сначала фильтруются по тегам, а затем проверяются на соответствие условиям. 

{% note warning %}

Необходимо указать хотя бы один фильтр по тегу и задать хотя бы одно условие удаления.

{% endnote %}

Чтобы сконфигурировать политику удаления, задайте следующие параметры: 
1. Фильтрация Docker-образа по тегам: 
    
    * `tag_regexp` — флаг для указания фильтра в виде регулярного выражения. 

        Примеры использования `tag_regexp`:
        * все образы с тегами — `.*`
        * образы с тегами, начинающимися на prefix — `prefix.*`

    * `untagged` — флаг для применения правила к Docker-образам без тегов.
    
2. Условия для удаления Docker-образов:
    
    * `expire_period` — период времени, который должен пройти с момента создания Docker-образа, чтобы он подходил для автоматического удаления. Период должен быть кратен 24 часам.
    
    * `retained_top` — количество Docker-образов (подпадающих под заданный фильтр по тегам), которое необходимо оставить, даже если `expire_period` уже истек.     

## Разрешение конфликтов правил {#resolve}

* Если Docker-образ, отфильтрованный по тегу, подпадает только под одно правило для удаления, то он удаляется в соответствии с настройками этого правила.
* Если Docker-образ, отфильтрованный по тегу, подпадает под несколько конфликтующих правил, он будет удален, только если этого требуют все правила. Если есть хотя бы одно правило, согласно которому Docker-образ не должен быть удален — он останется.