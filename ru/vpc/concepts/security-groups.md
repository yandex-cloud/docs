# Группы безопасности

Функция находится на [стадии Preview](../../overview/concepts/launch-stages.md).

Группы безопасности позволяют управлять доступом ВМ к ресурсам и группам безопасности {{ yandex-cloud }} или ресурсам в интернете. Группа безопасности назначается сетевому интерфейсу при создании или изменении ВМ и должна содержать правила для получения и отправки трафика. Каждой ВМ можно назначить несколько групп безопасности.

{% note warning %}

Группы безопасности не предназначены для защиты от DDoS. Для фильтрации больших объемов нежелательного трафика используйте [сервис защиты от DDoS-атак](../ddos-protection/index.md).

{% endnote %}

{% include [sg-rules](../../_includes/vpc/sg-rules.md) %}

## Правила групп безопасности {#rules}

Правила групп безопасности определяют протоколы и IP-адреса для приема и отправки трафика. Если сетевому интерфейсу ВМ назначены несколько групп безопасности, то учитываются правила из всех групп. В этом случае на ВМ сможет поступать трафик, который подпадает хотя бы под одно из правил в назначенных группах.

Правила хранят состояния сессий. Группы безопасности отслеживают состояние соединений и сопоставляют трафик ответа с уже открытой сессией, чтобы разрешить его прием.

   > Например, правило позволяет ВМ создать исходящую сессию на 80 порт какого-либо IP-адреса. Ответы от 80 порта на порт источника, откуда отправлялся запрос, будут автоматически разрешены.

### Виды правил {#rules-types}

Правила бывают двух видов:

* Для входящего трафика. Определяют диапазоны адресов и портов или другие группы безопасности, откуда виртуальные машины смогут принимать трафик.
* Для исходящего трафика. Определяют диапазоны адресов и портов или другие группы безопасности, куда виртуальные машины смогут отправлять трафик. 

Если в группе безопасности существует только правило для исходящего трафика, но нет правил для входящего трафика, ответный трафик все равно сможет поступать на ВМ. Если в группе безопасности есть только правила для входящего трафика, виртуальная машина сможет только отвечать на запросы, но не инициировать их.

Если две ВМ находятся в одной группе безопасности без правил, они не смогут обмениваться трафиком. Чтобы ВМ в одной группе смогли передавать трафик между собой, можно: 

* Использовать правило `Use self` для всей группы.
* Точно указать адреса и порты необходимых ресурсов в правилах. 

### Протоколы {#protocols}

Правила групп безопасности позволяют указать, по каким протоколам ВМ можно передавать трафик. Доступны следующие протоколы:

* TCP;
* UDP;
* ICMP;
* Все доступные протоколы.

### IP-адреса и диапазоны адресов {#cidrs}

В правилах можно разрешать прием и отправку трафика на отдельные IP-адреса или на диапазоны адресов.

Указать конкретный IP-адрес в правилах можно с помощью СIDR с маской `/32`. 

Чтобы разрешить передачу трафика на любые адреса по любым протоколам, укажите CIDR `0.0.0.0` с маской `/0` и выберите `Все` в поле выбора протокола.

Группы безопасности не блокируют отправку трафика на адреса сервисов, необходимых для работы ВМ и виртуальной сети:

* Адрес сервера метаданных — `169.254.169.254`.
* Адрес [DNS-сервера](network.md#subnet) — второй по порядку внутренний IP-адрес (обычно `x.x.x.2`) в каждой подсети.

Для работы [проверок состояния](../../load-balancer/concepts/health-check.md) ресурсов, подключенных к балансировщику, необходимо разрешить передачу трафика между диапазонами адресов `198.18.235.0/24` и `198.18.248.0/24` и целевыми ресурсами.

## Группа безопасности по умолчанию {#default-security-group}

Группа безопасности по умолчанию автоматически: 
* Создается в новой сети.
* Назначается виртуальным машинам при подключении к подсетям новой сети, если у них нет ни одной группы безопасности. 
    
    При этом автоматически назначенная группа безопасности не отображается в ответах API и CLI.

### Правила группы безопасности по умолчанию {#rules-default}

Группа безопасности по умолчанию создается со следующими правилами:

{% list tabs %}

- Исходящий трафик

    Разрешен любой исходящий трафик.
    
- Входящий трафик
    
    Разрешены: 
    * Любой входящий трафик от членов той же группы безопасности.
    * SSH-соединения на порт `22` (протокол `TCP`) с любых адресов (`0.0.0.0/0`).
    * RDP-соединения на порт `3389` (протокол `TCP`) с любых адресов (`0.0.0.0/0`).
    * Любой входящий трафик по протоколу `ICMP` с любых адресов (`0.0.0.0/0`).

{% endlist %}

Группу безопасности, созданную по умолчанию, невозможно удалить. 

{% note info %}

В сетях, созданных до запуска функциональности групп безопасности, трафик будет передаваться без ограничений для сохранения обратной совместимости.

{% endnote %}


