# Сеть и кластеры БД

{% if audience != "internal" %}

При создании кластера вы можете:

- задать сеть для самого кластера;
- задать подсети для каждого из хостов кластера;
- запросить публичный IP-адрес для доступа к кластеру извне {{ yandex-cloud }}.

Вы можете создать кластер, не задавая подсети для хостов, если выбранная для каждого хоста зона доступности содержит ровно одну подсеть сети кластера.

{% else %}

Все кластеры создаются внутри нашей сети, куда уже [есть доступ](../../mdb/access.md#network-access) из большинства сетей и от большинства сотрудников. Если у вас нет доступа, запросите доступ в [Панчере](https://puncher.yandex-team.ru/) к макросу `_PGAASINTERNALNETS_`. Для подключения к {{ MY }} в заявке нужно указать порт 3306.

{% endif %}

## Имя хоста и FQDN {#hostname}

Имя для каждого хоста в кластере {{ mmy-short-name }} генерирует при его создании. Это имя будет являться доменным именем хоста (FQDN). Имя хоста и, соответственно, FQDN невозможно изменить.

{% if audience != "internal" %}

FQDN можно использовать для доступа к хосту в рамках одной облачной сети. Подробнее читайте в [документации сервиса {{ vpc-full-name }}](../../vpc/).

### Особые FQDN {#special-fqdns}

Наравне с обычными FQDN, которые можно запросить со [списком хостов в кластере](../operations/hosts.md#list), {{ mmy-name }} предоставляет несколько особых FQDN, которые также можно использовать при подключении к кластеру.

#### Текущий мастер {#fqdn-master}

FQDN вида `c-<идентификатор кластера>.rw.{{ dns-zone }}` всегда указывает на текущий хост-мастер в кластере. {% include [Получение идентификатора кластера](../../_includes/mdb/mmy/note-api-get-cluster-id.md) %}

При подключении к этому FQDN разрешено выполнять операции чтения и записи.

Пример подключения к хосту-мастеру для кластера с идентификатором `c9qash3nb1v9ulc8j9nm`:

```bash
mysql --host=c-c9qash3nb1v9ulc8j9nm.rw.{{ dns-zone }} \
      --port=3306 \
      --ssl-ca=~/.mysql/root.crt \
      --ssl-mode=VERIFY_IDENTITY \
      --user=<имя пользователя> \
      --password \
      <имя БД>
```

#### Наименее отстающая реплика {#fqdn-replica}

FQDN вида `c-<идентификатор кластера>.ro.{{ dns-zone }}` указывает на наименее отстающую от мастера [реплику](../concepts/replication.md). Идентификатор кластера можно запросить со [списком кластеров в каталоге](../operations/cluster-list.md#list-clusters).

**Особенности:**

- При подключении к этому FQDN разрешено выполнять только операции чтения.
- Если в кластере нет активных реплик, то подключиться к этому FQDN невозможно: соответствующая CNAME-запись в DNS будет указывать <q>в никуда</q> (`null`).

Пример подключения к наименее отстающей реплике для кластера с идентификатором `c9qash3nb1v9ulc8j9nm`:

```bash
mysql --host=c-c9qash3nb1v9ulc8j9nm.ro.{{ dns-zone }} \
      --port=3306 \
      --ssl-ca=~/.mysql/root.crt \
      --ssl-mode=VERIFY_IDENTITY \
      --user=<имя пользователя> \
      --password \
      <имя БД>
```

## Публичный доступ к хосту {#public-access-to-host}

Любой хост в кластере может быть доступен извне {{ yandex-cloud }}, если вы запросили публичный доступ при создании хоста. Чтобы подключиться к такому хосту, используйте его FQDN.

Запросить публичный адрес после создания хоста невозможно, но вы можете заменить какой-либо из имеющихся хостов на новый хост с публичным адресом.

При удалении хоста с публичным FQDN соответствующий этому имени IP-адрес отзывается.

{% endif %}

## Подключение к хостам кластера {#cluster-connect}

[Подключение к хостам кластера](../operations/connect.md) {{ mmy-short-name }} возможно:

{% include [cluster-connect-note](../../_includes/mdb/cluster-connect-note.md) %}

Максимальное количество подключений определяется настройкой [max_connections](./settings-list.md#setting-max-connections), которая [зависит от класса хостов](./settings-list.md#settings-instance-dependent).

## Группы безопасности {#security-groups}

{% include [sg-rules-limits](../../_includes/mdb/sg-rules-limits.md) %}

{% note tip %}

При подключении к кластеру из той же облачной сети, в которой он находится, не забудьте [настроить](../operations/connect.md#configuring-security-groups) группы безопасности не только для кластера, но и для хоста, с которого выполняется подключение.

{% endnote %}

{% include [sg-rules-concept](../../_includes/mdb/sg-rules-concept.md) %}
