---
title: Высокая доступность кластера {{ mmy-full-name }}
description: Высокая доступность — это способность системы продолжать работу при отказе одного или нескольких компонентов. Высокая доступность кластера {{ mmy-name }} определяется количеством и расположением его хостов, настройками репликации и другими параметрами кластера.
---

# Высокая доступность кластера {{ mmy-name }}

В этой статье описаны параметры кластера, упоминаемые в [Соглашении об уровне обслуживания (SLA)](https://yandex.ru/legal/cloud_sla_mdb/), а также другие настройки и параметры, влияющие на [высокую доступность кластера {{ mmy-name }}](../../architecture/fault-tolerance.md#mdb-ha).

## Количество и расположение хостов кластера {#host-configuration}

Кластер может состоять из одного или нескольких хостов.

Кластер из одного хоста не обеспечивает высокую доступность. При выходе из строя хоста-мастера кластер будет недоступен на чтение и запись до окончания работ по его восстановлению.

Кластер с двумя и более хостами, расположенными в разных зонах доступности, устойчив к отказу одной зоны. Для production-окружений с повышенными требованиями к доступности и производительности рекомендуется использовать кластеры с тремя и более хостами: при отказе одной зоны сохраняется избыточность и нет существенного падения производительности.

{% note info %}

Если для хоста [вручную установлен источник репликации](replication.md#manual-source), такой хост не учитывается при расчете минимального числа хостов, обеспечивающих высокую доступность кластера.

{% endnote %}

## Настройки репликации и переключения мастера {#replication-settings}

Высокая доступность обеспечивается механизмами [репликации и переключения мастера](replication.md), которые имеют следующие особенности:
* В кластере используется механизм автоматического выбора и переключения на новый мастер. При выходе из строя хоста-мастера одна из реплик становится новым мастером. Также можно вручную выбрать новый мастер и [переключиться на него](../operations/update#start-manual-failover).
* Для любой реплики можно [вручную выбрать](replication.md#manual-source) хост в качестве источника репликации. Такая реплика не будет задействована в механизме выбора и переключения мастера.
* Если для хоста используется публичный доступ, то для реплик он также должен быть включен, иначе при переключении мастера кластер станет недоступен.
* Использование [FQDN текущего мастера](../operations/connect.md#fqdn-master) упрощает написание приложений, но приводит к временной недоступности кластера при переключении на новый мастер. Для быстрого переключения на новый мастер необходимо реализовать на стороне приложения определение нового мастера.
* В кластерах {{ mmy-name }} используется [полусинхронная репликация](https://dev.mysql.com/doc/refman/5.7/en/replication-semisync.html): по умолчанию мастер ожидает завершения транзакции хотя бы на одной реплике. Минимальное количество реплик, которые должны подтвердить транзакцию, можно увеличить с помощью настройки {{ MY }} [Rpl semi sync master wait for slave count](settings-list.md#setting-rpl-wait-slave-count). Для **Rpl semi sync master wait for slave count** рекомендуется задавать значение не меньше, чем максимальное число хостов в одной зоне, без учета хостов, для которых вручную выбран источник репликации. Тогда каждая транзакция будет подтверждаться хотя бы одной репликой в другой зоне доступности, так что даже при отказе целой зоны транзакции не будут потеряны.

## Свободное место в хранилище {#storage-settings}

Если хранилище баз данных заполнится на 95%, кластер перейдет в режим **Только чтение**. Чтобы кластер оставался доступным на запись, регулярно [проверяйте график Disk usage](../operations/monitoring.md#monitoring-cluster) или [создайте алерт с метрикой disk.used_bytes](../operations/monitoring.md#monitoring-integration).

## Настройки обслуживания {#maintenance-settings}

В процессе [технического обслуживания](maintenance.md) кластера и [обновления версии {{ MY }}](../operations/cluster-version-update.md) возможно временное снижение производительности операций чтения и временная недоступность кластера на запись. Учитывайте предполагаемую нагрузку на кластер при выборе:
* [окна обслуживания](maintenance.md#maintenance-window),
* момента обновления версии {{ MY }}.

## Прочие настройки {#other-settings}

На доступность кластера также могут влиять следующие настройки:

* [настройки резервного копирования](backup.md);
* выбранный [тип дисков хранилища](storage.md);
* [классы хостов](instance-types.md);
* [квоты и лимиты](limits.md);
* [настройка групп безопасности](../operations/connect.md#configuring-security-groups);
* Настройки {{ MY }} [Max connections](settings-list.md#setting-max-connections) и [Sync binlog](settings-list.md#setting-sync-binlog).
