# Управление пользователями {{ MY }}

Вы можете добавлять и удалять пользователей, а также управлять их индивидуальными настройками.

## Получить список пользователей {#list-users}

{% list tabs %}

- Консоль управления
  
  1. Перейдите на страницу каталога и выберите сервис **{{ mmy-name }}**.
  1. Нажмите на имя нужного кластера, затем выберите вкладку **Пользователи**.

- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы получить список пользователей кластера, выполните команду:
  
  ```
  $ {{ yc-mdb-my }} user list
       --cluster-name=<имя кластера>
  ```
  
  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md).

{% endlist %}

## Добавить пользователя {#adduser}

{% list tabs %}

- Консоль управления
  
  1. Перейдите на страницу каталога и выберите сервис **{{ mmy-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите кнопку **Добавить**.
  1. Введите имя пользователя базы данных и пароль (от 8 до 128 символов).
  1. Выберите одну или несколько баз данных, к которым должен иметь доступ пользователь:
      1. Нажмите кнопку **Добавить базу данных**.
      1. Выберите нужную базу данных из выпадающего списка.
      1. Повторите два предыдущих шага, пока не будут выбраны все требуемые базы данных.
      1. Чтобы удалить базу, добавленную по ошибке, наведите курсор на строку с именем базы и нажмите значок ![image](../../_assets/cross.svg) в конце строки.
  1. Настройте [роли пользователя](grant.md#db-roles) для каждой из выбранных баз данных:
      1. Нажмите значок ![image](../../_assets/plus-sign.svg) в столбце **Роли**.
      1. Выберите роль, которую вы хотите добавить пользователю из выпадающего списка.
      1. Повторите два предыдущих шага, пока не будут добавлены все требуемые роли.
  1. Чтобы отозвать роль, выданную по ошибке, нажмите значок ![image](../../_assets/cross.svg) справа от ее имени.
  1. Задайте [настройки {{ MY }}](#advanced-settings) для пользователя в разделе **Дополнительные настройки**.
  1. Нажмите кнопку **Добавить**.

- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы создать пользователя в кластере, выполните команду:
  
  ```
  $ {{ yc-mdb-my }} user create <имя пользователя>
       --cluster-name=<имя кластера>
       --password=<пароль пользователя>
       --permissions=<список баз, к которым пользователь должен иметь доступ>
  ```
  
  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md).  

{% endlist %}

## Изменить пароль {#updateuser}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmy-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) и выберите пункт **Изменить пароль**.
  1. Задайте новый пароль и нажмите кнопку **Изменить**.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы изменить пароль пользователя, выполните команду:

  ```
  $ {{ yc-mdb-my }} user update <имя пользователя>
       --cluster-name=<имя кластера>
       --password=<новый пароль>
  ```

  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md).

{% endlist %}

## Изменить настройки пользователя {#update-settings}

Чтобы изменить список доступных пользователю баз данных и уровень доступа к ним, воспользуйтесь [инструкцией по изменению списка ролей](grant.md#grant-role).

{% list tabs %}

- Консоль управления
  
  1. Перейдите на страницу каталога и выберите сервис **{{ mmy-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) и выберите пункт **Настроить**.
  1. Задайте [настройки {{ MY }}](#advanced-settings) для пользователя в разделе **Дополнительные настройки**.
  1. Нажмите кнопку **Сохранить**.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы задать [настройки {{ MY }}](#advanced-settings) для пользователя, выполните команду:

  ```
  $ {{ yc-mdb-my }} user update <имя пользователя>
       --cluster-name=<имя кластера>
       --global-permissions=<список глобальных привилегий через запятую>
       --authentication-plugin=<плагин аутентификации>
       --max-questions-per-hour=<максимальное количество запросов в час>
       --max-updates-per-hour=<максимальное количество запросов UPDATE в час>
       --max-connections-per-hour=<максимальное количество соединений в час>
       --max-user-connections=<максимальное количество одновременных соединений>
  ```

  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md).

{% endlist %}

## Удалить пользователя {#removeuser}

{% list tabs %}

- Консоль управления
  
  1. Перейдите на страницу каталога и выберите сервис **{{ mmy-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) и выберите пункт **Удалить**.

- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы удалить пользователя, выполните команду:
  
  ```
  $ {{ yc-mdb-my }} user delete <имя пользователя>
       --cluster-name=<имя кластера>
  ```
  
  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md).
  
{% endlist %}

{% include [user-ro](../../_includes/mdb/mmy-user-examples.md) %}

## Дополнительные настройки {#advanced-settings}

- **Authentication plugin** — плагин аутентификации. Определяет политику аутентификации пользователя.

  Значение по умолчанию — не задано (действует настройка `Default authentication plugin`, задаваемая при создании кластера).

  Подробнее про плагины аутентификации см. [в документации {{ MY }}](https://dev.mysql.com/doc/refman/8.0/en/pluggable-authentication.html).

- **Global permissions** — привилегии пользователя на уровне сервера (глобальные привилегии). Одному пользователю можно задать несколько глобальных привилегий. Доступные привилегии:
  - [REPLICATION CLIENT](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-client) — используйте эту глобальную привилегию если вы хотите подключиться к потоку репликации извне {{ yandex-cloud }}. В этом случае выдайте ее пользователю, под которым клиент репликации будет подключаться к кластеру. Привилегия позволяет использовать следующие операторы:
    - [SHOW MASTER STATUS](https://dev.mysql.com/doc/refman/8.0/en/show-master-status.html) — предоставляет информацию о состоянии бинарных логов мастера.
    - [SHOW REPLICA | SLAVE STATUS](https://dev.mysql.com/doc/refman/8.0/en/show-replica-status.html) — предоставляет информацию о состоянии основных параметров потока репликации.
    - [SHOW BINARY LOGS](https://dev.mysql.com/doc/refman/8.0/en/show-binary-logs.html) — выводит список бинарных логов на сервере.
  - [REPLICATION SLAVE](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave) — используйте эту глобальную привилегию если вы хотите подключиться к потоку репликации извне {{ yandex-cloud }}. В этом случае выдайте ее пользователю, под которым клиент репликации будет подключаться к кластеру. Привилегия позволяет использовать следующие операторы:
    - [SHOW REPLICAS | SHOW SLAVE HOSTS](https://dev.mysql.com/doc/refman/8.0/en/show-replicas.html) — выводит список зарегистрированных в данный момент реплик.
    - [SHOW RELAYLOG EVENTS](https://dev.mysql.com/doc/refman/8.0/en/show-relaylog-events.html) — выводит события в логе ретрансляции реплики.
    - [SHOW BINLOG EVENTS](https://dev.mysql.com/doc/refman/8.0/en/show-binlog-events.html) — выводит события в бинарном логе.
  - [PROCESS](https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_process) — позволяет получать информацию о всех выполняемых на сервере потоках и использовать оператор [SHOW ENGINE](https://dev.mysql.com/doc/refman/8.0/en/show-engine.html) для доступа к [INNODB_-таблицам](https://dev.mysql.com/doc/refman/8.0/en/innodb-information-schema-system-tables.html).

  Значение по умолчанию — не задано (глобальные привилегии не выданы пользователю).

- **Connection limits**  — раздел с настройками ограничений для пользователя.

  - **Max connections per hour** — максимально допустимое для пользователя количество соединений в час.

    Минимальное значение — 0 (нет ограничений).
    Значение по умолчанию — не задано (нет ограничений).

  - **Max questions per hour** — максимально допустимое для пользователя количество запросов в час. (Не считая запросов, выполняемых в рамках хранимых процедур).

    Минимальное значение — 0 (нет ограничений).
    Значение по умолчанию — не задано (нет ограничений).

  - **Max updates per hour** — максимально допустимое для пользователя количество запросов `UPDATE` в час.

    Минимальное значение — 0 (нет ограничений).
    Значение по умолчанию — не задано (нет ограничений).

  - **Max user connections** — максимально допустимое для пользователя количество одновременных соединений.

    Минимальное значение — 0 (нет ограничений).
    Значение по умолчанию — не задано (действует общая серверная настройка [max_user_connections](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_user_connections)).

  Подробнее см. [в документации {{ MY }}](https://dev.mysql.com/doc/refman/8.0/en/user-resources.html).
