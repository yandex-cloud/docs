---
title: "Мониторинг состояния кластера MySQL и хостов"
description: "Вы можете отслеживать состояние кластера Managed Service for MySQL и отдельных его хостов с помощью инструментов мониторинга в консоли управления. Эти инструменты предоставляют диагностическую информацию в виде графиков."
---

# Мониторинг состояния кластера и хостов

Вы можете отслеживать состояние кластера {{ mmy-name }} и отдельных его хостов с помощью инструментов мониторинга в консоли управления. Эти инструменты предоставляют диагностическую информацию в виде графиков.

{% include [monitoring-provides](../../_includes/mdb/monitoring-provides.md) %}

{% include [monitoring-period](../../_includes/mdb/monitoring-freq.md) %}

{% include [monitoring-units](../../_includes/mdb/note-monitoring-auto-units.md) %}

## Мониторинг состояния кластера {#monitoring-cluster}

Для просмотра детальной информации о состоянии кластера {{ mmy-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{ mmy-name }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **Мониторинг**.

На вкладке отображаются графики:

- **Average query time** — среднее время исполнения запросов, для каждого хоста (в миллисекундах).
- **Connections** — количество подключений, для каждого хоста.
- **Disk usage** — занятое дисковое пространство (в байтах), для каждого хоста и для кластера в целом.
- **Is Alive** — показывает доступность кластера в виде суммы состояний его хостов.

    Каждый хост в состоянии **Alive** увеличивает общую доступность на 1. При выходе из строя одного из хостов общая доступность уменьшается на 1.
    Для повышения доступности кластера вы можете [добавить в него хосты](hosts.md#add).

- **Is Primary** — показывает, какой хост является мастером и как долго.
- **Queries per second** — общее количество запросов в секунду, для каждого хоста.
- **Replication lag** — отставание реплики от мастера (в секундах).
- **Slow queries per second** — количество SQL-запросов в секунду, выполняющихся дольше, чем указано в [параметре](../concepts/settings-list.md#setting-long-query-time) `long_query_time`, для каждого хоста.
- **Threads running** — количество запущенных потоков, для каждого хоста. При увеличении нагрузки на кластер это значение будет быстро расти.

В блоке **Master overview** отображаются расширенные сведения о мастере:

- **Disk usage** — детализация занятого дискового пространства (в байтах):
   - **data** — объем, занятый данными.
   - **default tablespace** — объем, занятый данными в табличном пространстве по умолчанию.
   - **innodb logs** — объем, занятый логами InnoDB.
   - **relaylogs**, **binlogs** — объем, занятый служебными логами {{ MY }}. Подробнее [binlogs](https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html) и [relaylogs](https://dev.mysql.com/doc/refman/8.0/en/replica-logs-relaylog.html) описаны в документации {{ MY }}.
   - **temp tablespace** — объем, занятый данными во временном табличном пространстве.
   - **undo tablespace** — объем, занятый данными в [табличном пространстве InnoDB отката](https://dev.mysql.com/doc/refman/8.0/en/innodb-undo-tablespaces.html).
- **InnoDB locks** — количество блокировок таблиц InnoDB. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **InnoDB rows operation** — число операций со строками таблиц InnoDB. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Query quantiles** — квантили среднего времени выполнения запроса.
- **Sorts and joins** — доли операций сортировки и объединения в общем числе операций. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Table cache** — характеристики кешированных таблиц. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Temp tables** — количество временных таблиц. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Thread states** — количество потоков, запущенных демоном `mysqld`, в определенном состоянии. Описание состояний см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Threads** — количество потоков, запущенных демоном `mysqld`.
   - **Threads cached** — количество кешированных потоков.

      При нормальной работе кластера процесс `mysqld` кеширует большую часть соединений.

   - **Threads connected** — количество открытых потоков.

       Приближение графика к максимальному значению может означать, что открытые соединения не закрываются.

       Максимальное значение задает [параметр](../concepts/settings-list.md#setting-max-connections) `max_connections`.

   - **Threads running** — количество запущенных потоков.

       При увеличении нагрузки на кластер это значение будет быстро расти.

## Мониторинг состояния хостов {#monitoring-hosts}

Для просмотра детальной информации о состоянии отдельных хостов {{ mmy-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{mmy-name }}**.
1. Нажмите на имя нужного кластера, затем выберите вкладку **Хосты**.
1. Перейдите на страницу **Мониторинги**.
1. Выберите нужный хост из выпадающего списка.

На этой странице выводятся графики, показывающие нагрузку на отдельный хост кластера:

- **CPU usage** — загрузка процессорных ядер. При повышении нагрузки значение **idle** уменьшается.
- **Disk read/write bytes** — скорость дисковых операций (байт/с).
- **Disk IOPS** — интенсивность дисковых операций (операций/с).

    На графиках **Disk read/write bytes** и **Disk IOPS** показатель **Read** растет при активном чтении из базы данных, а **Write** — при записи в нее.

- **Memory usage** — использование оперативной памяти (в байтах). При высоких нагрузках значение показателя **Free** уменьшается, остальные — растут.
- **Network Bytes** — скорость обмена данными по сети (байт/с).
- **Network Packets** — интенсивность обмена данными по сети (пакетов/с).

   Для хостов с ролью **Replica** нормально преобладание **Received** над **Sent** на графиках **Network Bytes** и **Network Packets**.

В блоке **MySQL overview** отображаются расширенные сведения о состоянии СУБД на хосте:

- **Disk usage** — детализация занятого дискового пространства (в байтах):
   - **data** — объем, занятый данными.
   - **default tablespace** — объем, занятый данными в табличном пространстве по умолчанию.
   - **innodb logs** — объем, занятый логами InnoDB.
   - **relaylogs**, **binlogs**  — объем, занятый служебными логами {{ MY }}. Подробнее [binlogs](https://dev.mysql.com/doc/refman/8.0/en/mysqlbinlog.html) и [relaylogs](https://dev.mysql.com/doc/refman/8.0/en/replica-logs-relaylog.html) описаны в документации {{ MY }}.
   - **temp tablespace** — объем, занятый данными во временном табличном пространстве.
   - **undo tablespace** — объем, занятый данными в [табличном пространстве InnoDB отката](https://dev.mysql.com/doc/refman/8.0/en/innodb-undo-tablespaces.html).
- **File IO read bytes** — скорость чтения данных (байт/с)
- **File IO read operations** — средняя скорость файловых операций чтения (в секунду). Описание операций см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **File IO write bytes** — скорость записи данных (байт/с).
- **File IO write operations** — средняя скорость файловых операций записи (в секунду). Описание операций см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Handlers** — количество обработчиков различных операций. Подробнее см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **InnoDB cache efficiency** — характеристики эффективности буфера InnoDB. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **InnoDB data operations** — количество операций InnoDB:
   - **innodb data fsyncs** — операции `fsync()` при сбросе данных на диск;
   - **innodb data reads** — операции чтения с диска;
   - **innodb data writes** — операции записи.
- **InnoDB lock time** — время ожидания блокировки таблиц InnoDB (в секундах).
- **InnoDB locks** — количество блокировок таблиц InnoDB. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **InnoDB rows operation** — число операций со строками таблиц InnoDB. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Queries per second** — общее количество запросов в секунду.
- **Query quantiles** — квантили среднего времени выполнения запроса.
- **Replication lag** — отставание реплики от мастера (в секундах).
- **SemiSync latency** — детализация задержки подтверждения транзакции при [полусинхронной репликации](https://dev.mysql.com/doc/refman/5.7/en/replication-semisync.html) (в секундах). Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Slow queries per second** — количество SQL-запросов в секунду, выполняющихся дольше, чем указано в [параметре](../concepts/settings-list.md#setting-long-query-time) `long_query_time`.
- **Sorts and joins** — доли операций сортировки и объединения в общем числе операций. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Table cache** — характеристики кешированных таблиц. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Temp tables** — количество временных таблиц. Описание показателей см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Thread states** — количество потоков, запущенных демоном `mysqld`, в определенном состоянии. Описание состояний см. в [документации {{ MY }}]({{ mysql-vars-uri }}).
- **Threads** — количество потоков, запущенных демоном `mysqld`.
   - **Threads cached** — количество кешированных потоков.

      При нормальной работе хоста процесс `mysqld` кеширует большую часть соединений.
   - **Threads connected** — количество открытых потоков.

       Приближение графика к максимальному значению может означать, что открытые соединения не закрываются.

       Максимальное значение задает [параметр](../concepts/settings-list.md#setting-max-connections) `max_connections`.

   - **Threads running** — количество запущенных потоков.

       При увеличении нагрузки на хост это значение будет быстро расти.

## Интеграция с {{ monitoring-full-name }} {#monitoring-integration}

Чтобы настроить алерты показателей состояния [кластера](#monitoring-cluster) и [хостов](#monitoring-hosts): 

1. В консоли управления выберите каталог с кластером, для которого нужно настроить алерты.
1. Нажмите на значок ![image](../../_assets/ugly-sandwich.svg) и выберите раздел **Monitoring**.
1. В блоке **Сервисные дашборды** выберите:
    - **{{ mmy-name }} — Cluster Overview** для настройки алертов кластера;
    - **{{ mmy-name }} — Host Overview** для настройки алертов хостов.
1. На нужном графике с показателями нажмите на значок ![options](../../_assets/horizontal-ellipsis.svg) и выберите пункт **Создать алерт**.
1. Если показателей на графике больше одного, выберите запрос данных для формирования метрики и нажмите **Продолжить**. Подробнее о языке запросов см. [документацию {{ monitoring-full-name }}](../../monitoring/concepts/querying.md).
1. Задайте значения порогов `Alarm` и `Warning` для оповещения.
1. Нажмите кнопку **Создать алерт**.

Чтобы настроить автоматический мониторинг других показателей состояния кластера:

1. [Создайте алерт](../../monitoring/operations/alert/create-alert.md).
1. Добавьте метрику состояния.
1. Задайте в параметрах алерта значения порогов для оповещения.

Рекомендуемые значения порогов для некоторых метрик:

| Метрика                             | Обозначение               | `Alarm`                   | `Warning`                 |
|-------------------------------------|:-------------------------:|:-------------------------:|:-------------------------:|
| Задержка репликации                 | `mysql_replication_lag`   | `600`                     | `60`                      |
| Количество работоспособных хостов   | `mysql_is_alive`          | `<количество хостов> - 2` | `<количество хостов> - 1` |
| Среднее время выполнения запросов   | `mysql_latency_query_avg` | —                         | `2000`                    |
| Объем использованного хранилища     | `disk.used_bytes`         | 90% от размера хранилища  | 80% от размера хранилища  |
| Утилизация CPU                      | `cpu.idle`                | `10`                      | `20`                      |


## Состояния кластера и хостов
Для просмотра детальной информации о состоянии кластера {{ mch-name }}:

1. Перейдите на страницу каталога и выберите **{{ mch-name }}**.
2. Выберите нужный кластер из списка.

### Состояния кластера

{% include [monitoring-cluster-state](../../_includes/mdb/monitoring-cluster-state.md) %}


### Статусы кластера

{% include notitle [monitoring-cluster-status](../../_includes/mdb/monitoring-cluster-status.md) %}
