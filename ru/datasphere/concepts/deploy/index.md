# {{ ds-inf }}

{{ ml-platform-name }} предоставляет инструменты для релиза сервисов, доступных для сторонних ресурсов. Вы можете развернуть для эксплуатации не только модель, обученную в {{ ml-platform-name }}, но и создать при помощи тех же инструментов полноценный работающий сервис на базе [Docker-образа](/blog/posts/2022/03/docker-containers).

Для публикации сервиса в {{ ml-platform-name }} существуют специальные ресурсы — [ноды](#node) и [алиасы](#statuses).

## Ноды {#node}

_Нода_ — это изолированная в собственном контуре группа специально созданных [виртуальных машин](../../../glossary/vm.md) (_инстансов_), между которыми распределяется вычислительная нагрузка. Инстансы ноды создаются с заранее определенным окружением и зафиксированным состоянием интерпретатора. В зависимости от потребностей вы можете выбрать различные [конфигурации](../../concepts/configurations.md) инстансов.

{% note warning %}

{% include [pricing nodes](../../../_includes/datasphere/nodes-pricing-warn.md) %}

{% endnote %}

Обращение к нодам происходит по API. Запросы API могут менять состояние интерпретатора ноды. Для возврата первоначального состояния потребуется пересоздать всю ноду.

{% note info %}

Максимальный размер запроса и ответа API ноды — 16 МБ.

{% endnote %}

Для создания ноды укажите [каталог](../../../resource-manager/concepts/resources-hierarchy.md#folder) облака вашей организации, в котором нода будет разворачивать инстансы и хранить логи. В каталоге необходимо [настроить подсеть](../../../vpc/operations/subnet-create.md) с доступом в интернет с помощью [NAT-шлюза](../../../vpc/operations/create-nat-gateway.md) и создать [сервисный аккаунт](../../../iam/operations/sa/create.md) с [ролью](../../../vpc/security/index.md#vpc-user) `vpc.user`. Укажите этот сервисный аккаунт в [настройках проекта {{ ml-platform-name }}](../../operations/projects/update.md).

### Нода из модели {#models-node}

Ноды из [моделей](../models/index.md) позволяют [развернуть](../../operations/deploy/node-create.md#from-model) сохраненные в {{ ml-platform-name }} модели в качестве сервиса и обращаться к нему по API. Ноду можно создать из следующих моделей:

* [LightGBM](https://lightgbm.readthedocs.io)
* [ONNX](https://onnx.ai/)
* [Tensorflow.Keras](https://keras.io)
* [Tensorflow](https://www.tensorflow.org)
* [PyTorch](https://pytorch.org)
* [XGBoost](https://lightgbm.readthedocs.io)

Если вы хотите развернуть модель, которую не поддерживает сервер Triton, вы можете [конвертировать](https://onnx.ai/sklearn-onnx/auto_tutorial/plot_gexternal_catboost.html) ее в формат ONNX или развернуть [модель на основе Docker-образа](#docker-node).

Чтобы [создать ноду](../../operations/deploy/node-create.md#from-model) из модели, обученной не в {{ ml-platform-name }}, загрузите модель из файла в переменную в ноутбуке, а затем [создайте](../../operations/data/models.md#create) из этой переменной модель {{ ml-platform-name }}. 

Для развертывания нод из моделей {{ ml-platform-name }} использует [Triton Inference Server](https://developer.nvidia.com/triton-inference-server). Вы можете развернуть несколько моделей, сохраненных в {{ ml-platform-name }}, на одной ноде. {{ ml-platform-name }} самостоятельно определит входные и выходные параметры, обеспечит работу API модели, а затем — предоставит мониторинг самой ноды и сервера Triton.

{% note info %}

При развертывании моделей PyTorch {{ ml-platform-name }} не может автоматически определить входные и выходные параметры.

{% endnote %}

### Нода из произвольного Docker-образа {#docker-node}

Ноды, развернутые из Docker-образа, размещенного в реестре контейнеров, будут полноценным рабочим сервисом. Docker-образ не обязательно должен содержать модель, обученную в {{ ml-platform-name }} — вы можете создать любой образ и разместить его в удобном для вас реестре. О том, как загрузить Docker-образ в реестр {{ container-registry-full-name }}, см. [{#T}](../../../container-registry/operations/docker-image/docker-image-push.md). 

{% note info %}

Для использования {{ container-registry-full-name }} сервисному аккаунту проекта необходима [роль](../../../container-registry/security/index.md#container-registry-images-puller) `container-registry.images.puller`. 

{% endnote %}

При [создании ноды из Docker-образа](../../operations/deploy/node-create.md#from-docker) вы сами определяете API создаваемой ноды, порт, который ваш сервис будет использовать, время соединения, формат собираемых метрик и другие параметры. После создания ноды {{ ml-platform-name }} будет следить за ее состоянием, поддерживать работу инстансов и, при необходимости, масштабировать ноду в пределах заданного диапазона инстансов.

### Статусы ноды {#statuses}

Нода {{ ml-platform-name }} может находиться в одном из статусов:

* `Healthy` — количество инстансов со статусом `Healthy` в ноде равно минимальному числу требующихся инстансов;
* `Unhealthy` — количество инстансов со статусом `Healthy` в ноде меньше минимально допустимого;
* `Created` — нода только что создана;
* `Deleting` — нода в процессе удаления.

### Статусы инстанса {#instance-statuses}

Инстансы ноды могут иметь один из следующих статусов:

* `Healthy` – инстанс здоров и доступен для балансировки;
* `Unhealthy` – с инстансом возникли проблемы, он исключен из балансировки;
* `Created` – для инстанса создана ВМ;
* `Started` – с ВМ инстанса установлена связь;
* `Preparing` – инстанс подготавливается к обслуживанию запросов;
* `Deleting` – инстанс находится в процессе удаления;
* `Undefined` – начальное состояние инстанса, ВМ еще не создана.


## Алиас {#alias}

_Алиас_ — специальный ресурс для публикации и обновления сервиса, который позволяет незаметно для пользователей заменять ноды и обновлять развернутый сервис во время работы.

[Создайте алиас](../../../datasphere/operations/deploy/alias-create.md) и используйте его в качестве эндпоинта сервиса. Вы можете изменять связанные с ним ноды, балансировать нагрузку между ними и убирать устаревшие версии Docker-образа незаметно для пользователя.


#### См. также {#see-also}

* [{#T}](../../operations/deploy/node-create.md)
* [{#T}](../../operations/deploy/alias-create.md)
* [{#T}](../../tutorials/node-from-model.md)
* [{#T}](../../tutorials/node-from-docker.md)
* [{#T}](../../tutorials/node-from-docker-fast-api.md)
