# Эксплуатация моделей

{{ ml-platform-name }} предоставляет инструменты для релиза сервисов, доступных для сторонних ресурсов. Вы можете развернуть для эксплуатации не только модель, обученную в {{ ml-platform-name }}, но и создать при помощи тех же инструментов полноценный работающий сервис на базе [Docker-образа](https://cloud.yandex.ru/blog/posts/2022/03/docker-containers).

Для публикации сервиса {{ ml-platform-name }} предоставляет специальные ресурсы — [ноды](#node) и [алиасы](#statuses). 

## Ноды {#node}

_Нода_ — это изолированная в собственном контуре группа специально созданных {% if lang == "ru" and audience != "internal" %}[виртуальных машин](../../../glossary/vm.md){% else %}виртуальных машин{% endif %} (_инстансов_), между которыми распределяется вычислительная нагрузка. Инстансы ноды создаются с заранее определенным окружением и зафиксированным состоянием интерпретатора. В зависимости от потребностей вы можете выбрать различные [конфигурации](../../concepts/configurations.md) инстансов.

{% note warning %}

{% include [pricing nodes](../../../_includes/datasphere/nodes-pricing-warn.md) %}

{% endnote %}

Обращение к нодам происходит по API. Запросы API могут менять состояние интерпретатора ноды. Для возврата первоначального состояния потребуется пересоздать всю ноду.

{% note info %}

Максимальный размер запроса и ответа API ноды — 16 МБ.

{% endnote %}

Для создания ноды укажите [каталог](../../../resource-manager/concepts/resources-hierarchy.md#folder) облака вашей организации, в котором нода будет разворачивать инстансы и хранить логи. В каталоге необходимо [настроить подсеть](../../../vpc/operations/subnet-create.md) с доступом в интернет с помощью [NAT-шлюза](../../../vpc/operations/create-nat-gateway.md) и создать [сервисный аккаунт](../../../iam/operations/sa/create.md) с [ролью](../../../iam/concepts/access-control/roles.md#vpc-user) `vpc.user`. Укажите этот сервисный аккаунт в [настройках проекта {{ ml-platform-name }}](../../operations/projects/update.md).


### Нода из контрольной точки {#checkpoint-node}

Ноды из [контрольной точки](../checkpoints.md) подойдут для тестирования и проверки гипотез. Чтобы [создать](../../operations/deploy/node-create.md) ноду, необходимо [закрепить](../../operations/projects/checkpoints.md) контрольную точку ячейки, в которой определены входные и выходные параметры вашего будущего микросервиса: на основе этой информации {{ ml-platform-name }} автоматически сгенерирует [gRPC и REST API](../../../datasphere/operations/deploy/node-api.md).

По умолчанию инстансы ноды используют стандартные системные Docker-образы и не копируют установленные пользователем библиотеки. Если для работы вашего микросервиса необходимы пакеты, которые не входят в [список предустановленного ПО](../../../datasphere/concepts/preinstalled-packages.md), настройте Docker-образ для [развертывания окружения ноды](../../../datasphere/operations/deploy/node-customization.md).

### Нода из произвольного Docker-образа {#docker-node}

Ноды, развернутые из Docker-образа, размещенного в реестре контейнеров, будут полноценным рабочим сервисом. Docker-образ не обязательно должен содержать модель, обученную в {{ ml-platform-name }} — вы можете создать любой образ и разместить его в удобном для вас реестре. О том, как загрузить Docker-образ в реестр {{ container-registry-full-name }}, см. [{#T}](../../../container-registry/operations/docker-image/docker-image-push.md). 

{% note info %}

Для использования {{ container-registry-full-name }} сервисному аккаунту проекта необходима [роль](../../../iam/concepts/access-control/roles.md#cr-images-puller) `container-registry.images.puller`. 

{% endnote %}

При создании ноды из Docker-образа вы сами определяете API создаваемой ноды, порт, который ваш сервис будет использовать, время соединения, формат собираемых метрик и другие параметры. После создания ноды {{ ml-platform-name }} будет следить за ее состоянием, поддерживать работу инстансов и, при необходимости, масштабировать ноду в пределах заданного диапазона инстансов.

### Статусы ноды {#statuses}

Нода {{ ml-platform-name }} может находиться в одном из статусов:

* `Healthy` — количество инстансов со статусом `Healthy` в ноде равно минимальному числу требующихся инстансов;
* `Unhealthy` — количество инстансов со статусом `Healthy` в ноде меньше минимально допустимого;
* `Created` — нода только что создана;
* `Deleting` — нода в процессе удаления.

### Статусы инстанса {#instance-statuses}

Инстансы ноды могут иметь один из следующих статусов:

* `Healthy` – инстанс здоров и доступен для балансировки;
* `Unhealthy` – с инстансом возникли проблемы, он исключен из балансировки;
* `Created` – для инстанса создана ВМ;
* `Started` – с ВМ инстанса установлена связь;
* `Preparing` – инстанс подготавливается к обслуживанию запросов;
* `Deleting` – инстанс находится в процессе удаления;
* `Undefinied` – начальное состояние инстанса, ВМ еще не создана.


## Алиас {#alias}

_Алиас_ — специальный ресурс для публикации и обновления сервиса, который позволяет незаметно для пользователей заменять ноды и обновлять развернутый сервис во время работы.

[Создайте алиас](../../../datasphere/operations/deploy/alias-create.md) и используйте его в качестве эндпоинта сервиса. Вы можете изменять связанные с ним ноды, балансировать нагрузку между ними и убирать устаревшие версии Docker-образа незаметно для пользователя.


#### См. также {#see-also}

* [{#T}](../../operations/deploy/node-create.md).
* [{#T}](../../operations/deploy/alias-create.md).
{% if audience == "draft" %}* [Создание микросервиса на основе модели, обученной в {{ ml-platform-name }}](../../tutorials/datasphere/microservice.md){% endif %}