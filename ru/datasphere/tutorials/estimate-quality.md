# Оценка качества STT-моделей

Результаты распознавания речи (Speech-to-Text, STT) на платформе {{ speechkit-full-name }} зависят от выбора [модели распознавания](../../speechkit/stt/models.md). Для оценки качества распознавания используйте общепринятую метрику [WER](https://en.wikipedia.org/wiki/Word_error_rate) (Word Error Rate). Чем меньше значение метрики — тем точнее распознан фрагмент речи. Для вычисления метрики в {{ speechkit-name }} разработана библиотека `stt_metrics`. 

Чтобы вычислить метрику WER в {{ ml-platform-full-name }} с помощью этой библиотеки:

1. [Загрузите библиотеку](#satisfy-dependencies).
1. [Выполните тестовый пример](#test-example).
1. [Посмотрите методы устранения ошибок распознавания](#stt-errors-remove).
1. [Оцените качество распознавания для нескольких записей сразу](#wer-aggregate).

## Перед началом работы {#before-you-begin}

1. [Создайте проект](../operations/projects/create) в **{{ ml-platform-name }}** и откройте его.
1. [Склонируйте](../operations/projects/work-with-git.md#clone) Git-репозиторий, в котором находится ноутбуки с примерами использования {{ yandex-cloud }} API:

   ```
   https://github.com/yandex-cloud/examples.git
   ```

   Дождитесь окончания клонирования, это может занять некоторое время. После завершения операции в блоке ![folder](../../_assets/datasphere/jupyterlab/folder.svg) **File Browser** появится каталог склонированного репозитория.
1. Откройте каталог `examples/speechkitpro/estimate_quality` и ознакомьтесь с содержимым ноутбука `estimate_quality.ipynb`. В начале ноутбука описана задача проверки качества STT-моделей и метрика WER (Word Error Rate).

## Загрузите библиотеку {#satisfy-dependencies}

1. Выделите ячейку с кодом в разделе **Оценка качества STT-моделей**:

   ```
   from stt_metrics import WER, ClusterReferences
   from stt_metrics.text_transform import Lemmatizer
   ```
1. Запустите выделенную ячейку, выбрав в меню **Run → Run Selected Cells** (также можно использовать сочетание клавиш **Shift** + **Enter**).
1. Дождитесь завершения операции.

Загрузятся модули для оценки качества STT-моделей.

{% include [safe-state-warn](../../_includes/datasphere/safe-state.md) %}

## Выполните тестовый пример {#test-example}

Перейдите к разделу **Пример использования метрики WER**. В нем выполняются следующие операции:

1. Загрузка примеров:
   - распознанной речи,
   - размеченного текста.
1. Создание объекта `WER()` для обработки данных и вычисления метрики.
1. Создание объекта с информацией для вычисления WER.
1. Вычисление метрики WER для определения качества распознавания.
1. Отображение результатов вычислений:
   - количество ошибок распознавания;
   - количество слов в сравниваемых текста;
   - результат выравнивания текстов;
   - значение метрики WER.

Чтобы вычислить метрику WER:

1. Выделите все ячейки с кодом в разделе **Пример использования метрики WER** и запустите их.
1. Дождитесь завершения операции.

## Посмотрите методы устранения ошибок распознавания {#stt-errors-remove}

Ошибки распознавания речи связаны с несколькими факторами:
- Артефакты разметки. Например, варианты одного слова с <q>е</q> и <q>ё</q>.
- Различное написание фраз. Например, фраза <q>алло</q> может быть размечена как минимум четырьмя различными способами: <q>алло</q>, <q>алле</q>, <q>ало</q>, <q>але</q>.
- Варианты словоформ. Например, род, падежи существительных, времена глаголов и т.п.

Чтобы улучшить значение метрики WER, устраните ошибки с помощью следующих приемов:

- Предварительная обработка (препроцессинг) размеченного текста. Например, можно удалить артефакты разметки.
- Загрузка набора синонимов в модель расчета метрики методом `ClusterReferences()`.
- Приведение слов к нормальной форме (иными словами, их лемматизация) методом `Lemmatizer()`. Нормальной формой слова считается:
  - для существительных — именительный падеж, единственное число;
  - для прилагательных — именительный падеж, единственное число, мужской род;
  - для глаголов, причастий, деепричастий — глагол в инфинитиве несовершенного вида.

Чтобы протестировать предлагаемые методы:

1. Выделите все ячейки с кодом в разделе **Избавление от ошибок** и запустите их.
1. Дождитесь завершения операции.
1. Убедитесь, что метрика WER при последовательном применении методов уменьшается с `0.27` до `0.2` и `0.13`. 

## Оцените качество распознавания для нескольких записей сразу {#wer-aggregate}

Перейдите к разделу **Пример использования метрики WER (агрегированный)**. В нем показывается, как вычислять метрику WER одновременно для нескольких фрагментов размеченного текста методом `evaluate_wer`. Пример содержит две пары записей размеченного текста и распознанной речи.

Чтобы протестировать предлагаемый метод:

1. Выделите все ячейки с кодом в разделе **Пример использования метрики WER (агрегированный)** и запустите их.
1. Дождитесь завершения операции.
1. Убедитесь, что метрика WER рассчитана для двух размеченных текстов. 
