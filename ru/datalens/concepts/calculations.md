# Вычисляемые поля

Вычисляемое поле — это дополнительное [поле данных](dataset.md#field), значения которого вычисляются по формуле.
Вычисляемые поля позволяют вам создавать новые измерения и показатели.
При этом источник данных не изменяется.

Для записи формул вы можете использовать существующие поля датасета, константы и [функции](#functions).

Вы можете [создавать](#how-to-create-calculated-field) вычисляемые поля в интерфейсе датасета или визарда:
- Вычисляемые поля из датасета доступны во всех чартах над этим датасетом.
- Вычисляемые поля из визарда доступны только для сохраненного чарта.

## Вычисляемые поля в датасете {#dataset}

Вы можете добавлять новые поля в список полей датасета.

При создании формулы вы можете использовать любое поле датасета, в том числе вычисляемые поля, которые вы создали ранее.

После создания вычисляемого поля и сохранения датасета поле становится доступным для всех чартов и [селекторов](dashboard.md#selector) дашбордов, которые построены на основе датасета.
Чтобы поля не отображались в визарде, при создании включите опцию **Не отображать**.

Вычисляемые поля помечаются значком ![image](../../_assets/datalens/formula-dataset.svg).

## Вычисляемые поля в чарте {#chart}

Вы можете добавлять новые поля при создании и редактировании чарта в визарде:

- в списке полей из датасета;
- в секции визуализации.

При создании формулы вы можете использовать любое поле датасета, в том числе вычисляемые поля, которые вы создали ранее.

Если поле создано в чарте, то оно не будет доступно для селекторов дашборда и других чартов.

Вычисляемые поля помечаются значком ![image](../../_assets/datalens/formula-dataset.svg).

## Функции {#functions}

Функции — основной компонент создания формул. Они позволяют выполнять различные операции над полями данных.

Список доступных функций зависит от источника данных. Подробнее в разделе [{#T}](../../_api-ref/datalens/function-ref/availability.md).

{% note important %}

Избегайте зацикливания вычислений: в формуле нельзя использовать поле, которое использует эту же формулу для вычисления своего значения.

{% endnote %}

### Формат записи {#entry-format}

Формулы должны быть записаны с учетом следующих требований:

1. Указывайте аргументы функций в круглых скобках. Например, `YEAR([DATE1])`. Несколько аргументов разделяются запятой.
1. Записывайте имена полей в квадратных скобках. Например, `[CustomerID]`.
1. Записывайте значения полей и констант в допустимом [формате](dataset.md#data-types). Например, используйте точку в качестве разделителя для дробных чисел: `0.123`.

{% note info %}

Синтаксис функций регистронезависимый: `count` и `COUNT` выполнят одну и ту же операцию.

{% endnote %}

Справочная информация по формату, типам принимаемых аргументов, а также возвращаемым значениям функций доступны в интерфейсе редактора формул.
Для этого нажмите кнопку **Справочник** в интерфейсе добавления поля.

### Примеры использования функций {#examples}

#### Конкатенация строковых значений {#concat-example}
```
[City] + " " + "city"
```
Производит конкатенацию трех строковых значений: значение поля `[City]`, пробела и текста `city`. Для конкатенации вы можете также использовать строковую функцию [CONCAT](../../_api-ref/datalens/function-ref/CONCAT.md).

Полное описание [оператора сложения (+)](../../_api-ref/datalens/function-ref/OP_PLUS.md).

#### Округление даты {#datetrunc-example}
```
DATETRUNC(#2018-07-12#, "year", 5) = #2015-01-01#
```

Округляет дату `2018-07-12` до года, число которого кратно 5.

Полное описание функции округления даты [DATETRUNC](../../_api-ref/datalens/function-ref/DATETRUNC.md).

#### Преобразование типа {#to-float-conversion-example}

```
FLOAT([StringWithNumbers])
```

Преобразует строковое поле `StringWithNumbers` в формат дробного числа.

Полное описание функции преобразования [FLOAT](../../_api-ref/datalens/function-ref/FLOAT.md).

## Как создать вычисляемое поле {#how-to-create-calculated-field}

Вы можете создать вычисляемое поле в интерфейсе датасета или визарда.

{% list tabs %}

- Датасет

  {% include [datalens-create-calculated-field-in-dataset](../../_includes/datalens/operations/datalens-create-calculated-field-in-dataset.md) %}

- Визард

  1. Откройте [визард](https://datalens.yandex.ru/wizard/).
  1. Выберите датасет для создания чарта.
  1. В левой части экрана нажмите значок **![image](../../_assets/plus-sign.svg)**, который находится над списком полей датасета.
  1. Введите необходимую формулу.
  1. Нажмите **Создать**. Поле отобразится в списке полей. Вы можете его использовать в качестве источника данных для чарта.

{% endlist %}

#### См. также {#see-also}
- [{#T}](../operations/dataset/create-field.md)
- [{#T}](../operations/dataset/manage-row-level-security.md)
