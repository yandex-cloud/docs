# Создание подключения к AppMetrica Logs API

{% note warning %}

Перед созданием подключения к AppMetrica Logs API вам необходимо создать кластер ClickHouse в {{ yandex-cloud }}. {{ datalens-short-name }} будет автоматически выгружать данные AppMetrica через Logs API в указанный кластер.

{% endnote %}

## Подключение к AppMetrica Logs API {#appmetrica-logs-api-connection}

Чтобы создать подключение к AppMetrica Logs API:

{% if audience == "internal" %}

1. Перейдите на [страницу подключений](https://datalens.yandex-team.ru/connections).

{% else %}

1. Перейдите на [страницу подключений](https://datalens.yandex.ru/connections).

{% endif %}

1. Нажмите кнопку **Создать подключение**.

1. Выберите подключение **AppMetrica**.

1. Укажите параметры подключения:

    * В поле после имени папки задайте имя подключения. Имя может быть произвольным.

    * **OAuth-токен**. Нажмите кнопку **Получить токен** или укажите вручную [OAuth-токен](#get-oauth-token) для доступа к данным AppMetrica.

    * **Приложение**. Укажите одно или несколько приложений для подключения. Вы можете выбрать их из списка или указать вручную через запятую.

    * **Подключение**. Выберите **Через Logs API** в качестве типа подключения.

      {% note info %}

      Если вы хотите получить доступ не под текущей учетной записью Яндекса или в списке нет нужного приложения, перейдите в раздел [Получение OAuth-токена](#get-oauth-token).
      
      {% endnote %}
    
1. Укажите параметры выгрузки из приложений-источников данных:

    * **Источник счетчика**. Выберите из списка тип выгружаемых данных.
    * **Загружать с**. Укажите дату, начиная с которой будут выгружены данные
    * **Регулярность**. Укажите режим обновления данных в подключении.

1. Укажите информацию о целевой базе данных:

    * **Имя хоста**. Укажите путь до хоста кластера {{ CH }} в {{ yandex-cloud }}.
    * **Порт**. Укажите порт подключения к БД.
    * **Имя базы данных**. Укажите имя БД для подключения.
    * **Имя пользователя**. Укажите имя пользователя для подключения к БД.
    * **Пароль**. Укажите пароль для указанного пользователя.

1. Нажмите **Создать**.

Примечания:

* Загрузка данных в подключение может занять от нескольких минут до нескольких часов в зависимости от объема данных в счетчике и указанной начальной даты загрузки.
* Изменение параметра **Загружать с** влечет за собой полную перезагрузку данных подключения.
* Изменение параметра **Регулярность** с `Единовременной` на `Регулярную` загрузку влечет полную перезагрузку данных подключения.

## Получение OAuth-токена {#get-oauth-token}

Чтобы получить доступ к приложению в AppMetrica не под текущей учетной записью Яндекса, воспользуйтесь сценарием:

1. Переключитесь на учетную запись с доступом к AppMetrica.
1. Получите токен по [ссылке](https://oauth.yandex.ru/authorize?response_type=token&client_id=4f802221a95340dd9417c04bc30606b5). При необходимости разрешите доступ приложению, затем скопируйте токен.
1. Переключитесь на учетную запись с доступом к {{ datalens-full-name }}.
1. Создайте новое подключение к AppMetrica и добавьте полученный токен из буфера обмена в поле OAuth-токен.