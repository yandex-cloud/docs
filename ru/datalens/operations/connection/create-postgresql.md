# Создание подключения к PostgreSQL

{% include [connection-note](../../../_includes/datalens/datalens-connection-note.md) %}

## Подключение к PostgreSQL {#postgresql-connection}

Чтобы создать подключение к {{ PG }}:

{% if audience == "internal" %}

1. Перейдите на [страницу подключений](https://datalens.yandex-team.ru/connections).

{% else %}

1. Перейдите на [страницу подключений](https://datalens.yandex.ru/connections).

{% endif %}

1. Нажмите кнопку **Создать подключение**.
1. Выберите подключение **PostgreSQL**.
1. Задайте **Имя подключения**. Имя может быть произвольным.
1. Выберите тип подключения:

   {% list tabs %}

    - Выбрать в Облаке

      {% if audience != "internal" %}

      Укажите параметры подключения для БД {{ PG }}, доступной в {{ yandex-cloud }}:

      {% endif %}

      {% if audience == "internal" %}

       Укажите параметры подключения для БД {{ PG }}:

      {% endif %}

      - **Кластер**. Укажите кластер из списка доступных кластеров {{ PG }}. В настройках кластера должен быть активирован флаг **Доступ из DataLens**. Если у вас нет доступного кластера, нажмите кнопку **Создать новый**.

        {% note info %}

          В списке кластеров отображаются кластеры {{ PG }}:

           - с правами доступа для пользователя создающего подключение;
           - созданные в том же каталоге, что и экземпляр {{ datalens-short-name }}.     

        {% endnote %}   

      - **Имя хоста**. Выберите имя хоста из списка доступных в кластере {{ PG }}. Вы можете выбрать несколько хостов. Если к первому хосту подключиться не получится, {{ datalens-short-name }} выберет следующий из списка. 
      - **Порт**. Укажите порт подключения к {{ PG }}. Порт по умолчанию — 6432.
      - **Имя базы данных**. Укажите имя подключаемой базы данных.
      - **Имя пользователя**. Укажите имя пользователя для подключения к {{ PG }}.             
      - **Пароль**. Укажите пароль для пользователя.  
      - **Время жизни кэша в секундах**. Укажите время жизни кеша или оставьте значение по умолчанию. Рекомендованное значение — 300 секунд (5 минут).
      - **Уровень доступа SQL запросов**. Позволяет использовать произвольный SQL-запрос для [формирования датасета](../../concepts/dataset/settings.md#sql-request-in-datatset).

    - Указать вручную

      Укажите параметры подключения для внешней БД {{ PG }}:

      - **Имя хоста**. Укажите путь до хоста-мастера или IP-адрес хоста-мастера {{ PG }}. Вы можете указать несколько хостов через запятую. Если к первому хосту подключиться не получится, {{ datalens-short-name }} выберет следующий из списка.  
      - **Порт**. Укажите порт подключения к {{ PG }}. Порт по умолчанию — 6432.
      - **Имя базы данных**. Укажите имя подключаемой базы данных.
      - **Имя пользователя**. Укажите имя пользователя для подключения к {{ PG }}.                   
      - **Пароль**. Укажите пароль для пользователя.  
      - **Время жизни кэша в секундах**. Укажите время жизни кеша или оставьте значение по умолчанию. Рекомендованное значение — 300 секунд (5 минут).
      - **Уровень доступа SQL запросов**. Позволяет использовать произвольный SQL-запрос для [формирования датасета](../../concepts/dataset/settings.md#sql-request-in-datatset).

   {% endlist %}

1. Нажмите **Сохранить**. Подключение появится в списке.

{% include [datalens-check-host](../../../_includes/datalens/operations/datalens-check-host.md) %}

### Дополнительные настройки {#postgresql-additional-settings}

Если в запросах к БД требуется явно задать правило сортировки, перейдите к разделу **Продвинутые настройки подключения**.

Выберите один из режимов для настройки **Указание collate в запросе**:
   - **Авто** — применяется настройка по умолчанию, решение о включении локали `en_US` остается на усмотрение {{ datalens-short-name }}.
   - **Вкл** —  применяется настройка {{ datalens-short-name }}, для отдельных выражений в запросе указывается локаль `en_US`. Это приводит к использованию соответствующей логики сортировки сервером, вне зависимости от настроек сервера и конкретных таблиц. Используйте настройку {{ datalens-short-name }}, если локаль в БД несовместима с работой {{ datalens-short-name }}. Подробнее о локали и `LC_COLLATE` смотрите в разделе [{#T}](../../../managed-postgresql/operations/cluster-create.md#create-cluster).  
   - **Выкл** — применяется настройка по умолчанию, {{ datalens-short-name }} использует только имеющиеся параметры локали БД.
