# Создание QL-чарта

{% if product == "yandex-cloud" %}

{% if audience != "internal" %}

Создать QL-чарт можно одним из способов:

{% list tabs %}

- Через главную страницу
    
  1. Перейдите на главную [{{ datalens-short-name }}]({{ link-datalens-main }}). 
  1. В меню слева выберите **Чарты**.   
  1. В левом верхнем углу нажмите **Создать чарт** → **QL-чарт**. 
  1. В открывшемся окне нажмите **Выбрать подключение**. 
  1. Выберите из списка подключение БД, к которому у вас есть доступ. Убедитесь, что в подключении активирована настройка **Уровень доступа SQL-запросов** → **Разрешить подзапросы в датасетах и запросы из чартов**.
  1. На вкладке **Запрос** укажите запрос, используя SQL-диалект БД, к которой вы обращаетесь.
  1. Проверьте, чтобы секция **Available** была пустая. В эту секцию попадают поля, не участвующие в расчетах. В противном случае визуализация будет отображаться некорректно.
  1. В левом нижнем углу нажмите кнопку **Запустить**.
    
- Через подключение
   
  1. Перейдите к уже созданному подключению БД.
  1. Убедитесь, что в подключении активирована настройка **Уровень доступа SQL-запросов** → **Разрешить подзапросы в датасетах и запросы из чартов**.
  1. В правом верхнем углу нажмите **Создать QL-чарт**.
  1. На вкладке **Запрос** укажите запрос, используя SQL-диалект БД, к которой вы обращаетесь.
  1. Проверьте, чтобы секция **Available** была пустая. В эту секцию попадают поля, не участвующие в расчетах. В противном случае визуализация будет отображаться некорректно.   
  1. В левом нижнем углу нажмите кнопку **Запустить**.
    
{% endlist %}

После выполнения запроса появится визуализация на основе ваших данных.

{% include [datalens-sql-ch-example](../../../_includes/datalens/datalens-sql-ch-example.md) %}

{% else %}

Создать QL-чарт можно одним из способов:

* [через главную страницу](#main-page);
* [через подключение](#connection).

{% include [datalens-monitoring-prometheus-access-note](../../../_includes/datalens/datalens-monitoring-prometheus-access-note.md) %}

## Создание QL-чарта через главную страницу {#main-page} 

1. Перейдите на главную [{{ datalens-short-name }}](https://datalens.yandex-team.ru).
1. В меню слева выберите **Чарты**.   
1. В левом верхнем углу нажмите **Создать чарт** → **QL-чарт**. 
1. В открывшемся окне выберите **Тип чарта**:

   {% list tabs %}

   - SQL

     1. Нажмите **Выбрать подключение**.
     1. Выберите из списка подключение БД, к которому у вас есть доступ. Убедитесь, что в подключении активирована настройка **Уровень доступа SQL-запросов** → **Разрешить подзапросы в датасетах и запросы из чартов**.
     1. Нажмите **Создать**.
     1. На вкладке **Запрос** укажите запрос, используя SQL-диалект БД, к которой вы обращаетесь.
     1. В левом нижнем углу нажмите кнопку **Запустить**.

     После выполнения запроса появится визуализация на основе ваших данных.

     {% include [datalens-sql-ch-example](../../../_includes/datalens/datalens-sql-ch-example.md) %}

   - {{ prometheus-name }}

     1. Нажмите **Выбрать подключение**.
     1. Выберите из списка подключение {{ prometheus-name }}, к которому у вас есть доступ.
     1. Нажмите **Создать**.
     1. Нажмите **Добавить запрос** и укажите запрос на языке {{ prometheus-name }}.
     1. В левом нижнем углу нажмите кнопку **Запустить**.

     После выполнения запроса появится визуализация на основе ваших данных.

     {% include [datalens-prometheus-ch-example](../../../_includes/datalens/datalens-prometheus-ch-example.md) %}

     QL-чарты по данным {{ prometheus-name }} можно параметризовать так же, как и чарты типа SQL. Также для этого типа чартов предопределены обязательные глобальные параметры, которые создаются автоматически при создании QL-чарта. Вы можете отредактировать значения по умолчанию для этих параметров.

     | Параметр | Тип данных | Описание |
     |---|---|---|
     | from | datetime | Нижняя временная граница. |
     | to | datetime | Верхняя временная граница. |
     | step | number | Шаг по временной шкале в секундах. |

     На дашборде вы можете использовать один селектор для даты со специальным именем `interval` вместо двух селекторов `from` и `to`.

   - {{ monitoring-short-name }}

     {% note info %}

     Для типа чарта {{ monitoring-short-name }} используется единое для всей компании публичное подключение. Доступ к подключению есть у всех сотрудников Яндекса.

     Выбрать другое или создать свое подключение к {{ monitoring-short-name }} нельзя.

     {% endnote %}

     1. Нажмите **Создать**.
     1. Нажмите **Добавить запрос** и укажите запрос на языке {{ monitoring-short-name }}.
     1. В левом нижнем углу нажмите кнопку **Запустить**.

     После выполнения запроса появится визуализация на основе ваших данных.

     {% include [datalens-monitoring-ch-example](../../../_includes/datalens/datalens-monitoring-ch-example.md) %}

     QL-чарты по данным {{ monitoring-short-name }} можно параметризовать так же, как и чарты типа SQL. Также для этого типа чартов предопределены обязательные глобальные параметры, которые создаются автоматически при создании QL-чарта. Вы можете отредактировать значения по умолчанию для этих параметров.

     | Параметр | Тип данных | Описание |
     |---|---|---|
     | from | datetime | Нижняя временная граница. |
     | to | datetime | Верхняя временная граница. |

     На дашборде вы можете использовать один селектор для даты со специальным именем `interval` вместо двух селекторов `from` и `to`.

   {% endlist %}

## Создание QL-чарта через подключение {#connection}

1. Перейдите к уже созданному подключению БД.
1. Убедитесь, что в подключении активирована настройка **Уровень доступа SQL-запросов** → **Разрешить подзапросы в датасетах и запросы из чартов**.
1. В правом верхнем углу нажмите **Создать QL-чарт**.
1. На вкладке **Запрос** укажите запрос, используя SQL-диалект БД, к которой вы обращаетесь.
1. Проверьте, чтобы секция **Available** была пустая. В эту секцию попадают поля, не участвующие в расчетах. В противном случае визуализация будет отображаться некорректно.
1. В левом нижнем углу нажмите кнопку **Запустить**.

После выполнения запроса появится визуализация на основе ваших данных.

{% endif %}

{% endif %}

{% if product == "cloud-il" %}

Чтобы создать QL-чарт:

1. Откройте [главную страницу]({{ link-datalens-main }}) {{ datalens-short-name }}.
1. Перейдите в [воркбук](../../concepts/index.md#workbooks-and-collections), внутри которого вы хотите создать QL-чарт.
1. На странице воркбука, в правом верхнем углу, нажмите **Создать** → **QL-чарт**.
1. В поле **Select connection to start** нажмите **Выбрать**.
1. Выберите из списка подключение БД, к которому у вас есть доступ. Убедитесь, что в подключении активирована настройка **Уровень доступа SQL-запросов** → **Разрешить подзапросы в датасетах и запросы из чартов**.
1. На вкладке **Запрос** укажите запрос, используя SQL-диалект БД, к которой вы обращаетесь.
1. Проверьте, чтобы секция **Available** была пустая. В эту секцию попадают поля, не участвующие в расчетах. В противном случае визуализация будет отображаться некорректно.
1. В левом нижнем углу нажмите кнопку **Запустить**.

После выполнения запроса появится визуализация на основе ваших данных.

{% include [datalens-sql-ch-example](../../../_includes/datalens/datalens-sql-ch-example.md) %}

{% endif %}

## Добавление параметров селектора {#selector-parameters}

Для [QL-чартов](../../concepts/chart/index.md#sql-charts) в области редактирования чарта на вкладке **Параметры** можно управлять параметрами селектора, а на вкладке **Запрос** указывать переменную в самом запросе в формате `not_var{{variable}}`.

Параметры типа `date-interval` и `datetime-interval` можно использовать в коде запроса только с постфиксами `_from` и `_to`. Например, для параметра с именем `interval` нужно указать:

* `interval_from` — для получения начала интервала;
* `interval_to` — для получения конца интервала.

Чтобы добавить параметр:

1. Перейдите на вкладку **Параметры** при создании чарта.
1. Нажмите **Добавить параметр**.
1. Установите тип значения `date-interval` (`datetime-interval`).
1. Задайте имя параметру.
1. Установите начальное и конечное значение интервала.

{% cut "Пример запроса" %}

```sql
SELECT toDate(Date) as datedate, count ('Oreder ID')
FROM samples.SampleLite
WHERE not_var{{interval_from}} < datedate AND datedate < not_var{{interval_to}}
GROUP BY datedate
ORDER BY datedate
```

{% endcut %}