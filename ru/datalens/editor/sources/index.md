# Источники данных

## Общая информация {#common}

Вкладка **Urls** отвечает за описание источников данных.
Результатом работы вкладки является объект, который описывает HTTP-запросы, которые необходимо сделать для загрузки
данных.
Запросы можно выполнять методами `GET` и `POST`:

**GET запрос**

```js
module.exports = {
    totals: '/api/some/get/request?scale=d&region=RU'
};
```

**POST запрос**

```js
module.exports = {
    totals: {
        url: '/api/some/post/request',
        method: 'post',
        data: {
            scale: 'd',
            region: 'RU'
        }
    }
};
```

Для формирования URL рекомендуем использовать нашу библиотеку **URI**:
она избавит вас от необходимости вручную экранировать спецсимволы в параметрах запроса.

```js
const URI = require('libs/uri/v1');

const url = new URI(`/api/some/get/request`);

url.setParams({
    scale: 'd',
    field: ['users', 'hits', 'hosts']
});

url.setParam('region', 'RU');

module.exports = {
    totals: url.toString()
};
```

**Кэширование**

Наш сервис также поддерживает возможность кэширования ответа от источников.

Чтобы воспользоваться кэшированием в **GET** запросе, нужно указать параметр `_sp_cache_duration=<TTL>` (TTL – время жизни кэша в секундах).
У **GET** запросов ключ кэша строится из URL.

В случае работы с **POST** запросом нужно указать в параметрах свойство `cache: <TTL>` (TTL – время жизни кэша в секундах).
У **POST** запросов ключ кэша строится из URL и CRC32 хеша тела запроса.

Обратите внимание, что не все источники поддерживают кэширование ответа. Подробнее о том какие поддерживают а какие нет – ниже в списке источников.

## Список источников данных {#list-data-sources}

Ниже приведен список популярных источников, доступных в нашем сервисе.

|Имя|Поддержка кэша|Комментарий|
|:---|:---|:---|
|[Датасеты](dataset.md)|нет|Кэш работает со стороны Dataset API|
|[Статистика](stat.md)|нет||
|[Метрика](metrika.md)|да|Кэш работает по умолчанию чтобы не перегрузить API метрики|
|[Мобильная метрика](appmetrika.md)|да|Кэш работает по умолчанию чтобы не перегрузить API метрики|
|[ClickHouse](clickhouse.md)|да|Кэш доступен для всех кластеров CH|
|[Графит (графана)](graphite.md)|да|Кэш доступен для всех инсталляций Graphite|
|[Metrics](metrics.md)|да||
|[Соломон](solomon.md)|да||
|[Разладки](razladki.md)|да||
|[YQL](yql.md)|нет||
|[YT](yt.md)|да|Кэш доступен для всех кластеров YT|
|QC API|да||
|Browser|да||
|Browser Infra|да||
|Addappter Sales|да||
|Stat Infra|да||
|Infra API|да||
|YDB|да||
|YDB Meta|да||
|YDB API|да||
|[Голован (YASM)](https://charts.yandex-team.ru/editor/templates/simple-yasm)|да||
|API Timeline Crypta|нет||
|TestPalm|нет||
|Serp Docs|нет||
|Error Booster|нет||
|StarTrek API|нет||
|MDS|нет||
|Market Analytics|нет||
|Телефония (mphomon)|нет||

В данном списке приведены не все источники. Так, например, мы не вносим в него узкоспециализированные источники и отдельные инстансы ClickHouse.

### Добавление новых источников {#add-sources}

Если вы хотите использовать данные из источника, которого нет в этом списке, создайте [тикет в DLFR](https://st.yandex-team.ru/createTicket?queue=dlfr) по ссылке с описанием вашего API.

Специальных требований к API нет, как правило, бывает достаточно, чтобы по GET/POST запросам оно умело отдавать json. 

Формат данных нас на этом этапе не интересует, после подключения вы сможете либо написать свой ChartEditor-модуль для приведения данных к нужному для отрисовки формату, либо доработать API так, чтобы оно отдавало сразу в правильном формате.

## Ограничения {#limits}

Размер и время загрузки данных ограничены:

* 100 Мбайт на суммарный размер данных из всех источников во время одного запроса;
* 50 Мбайт на размер данных из одного источника;
* 300 с на суммарное время загрузки данных из всех источников во время одного запроса;
* 95 с на время загрузки данных из одного источника;
* 10 с на выполнение вкладки JavaScript.

Эти ограничения необходимы для обеспечения стабильной работы как самого сервиса, так и источников.
