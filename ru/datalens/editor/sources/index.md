# Источники данных

## Общая информация {#common}

Вкладка **Urls** отвечает за описание источников данных.
Результатом работы вкладки является объект, который описывает HTTP-запросы, которые необходимо сделать для загрузки
данных.
Запросы можно выполнять методами `GET` и `POST`:

**GET запрос**

```js
module.exports = {
    totals: '/api/some/get/request?scale=d&region=RU'
};
```

**POST запрос**

```js
module.exports = {
    totals: {
        url: '/api/some/post/request',
        method: 'post',
        data: {
            scale: 'd',
            region: 'RU'
        }
    }
};
```

Для формирования URL рекомендуем использовать нашу библиотеку **URI**:
она избавит вас от необходимости вручную экранировать спецсимволы в параметрах запроса.

```js
const URI = require('libs/uri/v1');

const url = new URI(`/api/some/get/request`);

url.setParams({
    scale: 'd',
    field: ['users', 'hits', 'hosts']
});

url.setParam('region', 'RU');

module.exports = {
    totals: url.toString()
};
```

**Кэширование**

Наш сервис также поддерживает возможность кэширования ответа от источников.

Чтобы воспользоваться кэшированием в **GET** запросе, нужно указать параметр `_sp_cache_duration=<TTL>` (TTL – время жизни кэша в секундах).
У **GET** запросов ключ кэша строится из URL.

В случае работы с **POST** запросом нужно указать в параметрах свойство `cache: <TTL>` (TTL – время жизни кэша в секундах).
У **POST** запросов ключ кэша строится из URL и CRC32 хеша тела запроса.

Обратите внимание, что не все источники поддерживают кэширование ответа. Подробнее о том какие поддерживают а какие нет – ниже в списке источников.

## Список источников данных {#list-data-sources}

Ниже приведен список популярных источников, доступных в нашем сервисе.

|Имя|Поддержка кэша|Комментарий|
|:---|:---|:---|
|[Датасеты](dataset.md)|нет|Кэш работает со стороны Dataset API|
|[Статистика](stat.md)|нет||
|[Метрика](metrika.md)|да|Кэш работает по умолчанию чтобы не перегрузить API метрики|
|[Мобильная метрика](appmetrika.md)|да|Кэш работает по умолчанию чтобы не перегрузить API метрики|
|[ClickHouse](clickhouse.md)|да|Кэш доступен для всех кластеров CH|
|[Графит (графана)](graphite.md)|да|Кэш доступен для всех инсталляций Graphite|
|[Metrics](metrics.md)|да||
|[Соломон](solomon.md)|да||
|[Разладки](razladki.md)|да||
|[YQL](yql.md)|нет||
|[YT](yt.md)|да|Кэш доступен для всех кластеров YT|
|QC API|да||
|Browser|да||
|Browser Infra|да||
|Addappter Sales|да||
|Stat Infra|да||
|Infra API|да||
|YDB|да||
|YDB Meta|да||
|YDB API|да||
|[Голован (YASM)](https://charts.yandex-team.ru/editor/templates/simple-yasm)|да||
|API Timeline Crypta|нет||
|TestPalm|нет||
|Serp Docs|нет||
|Error Booster|нет||
|StarTrek API|нет||
|MDS|нет||
|Market Analytics|нет||
|Телефония (mphomon)|нет||

В данном списке приведены не все источники. Так, например, мы не вносим в него узкоспециализированные источники и отдельные инстансы ClickHouse.

### Добавление новых источников {#add-sources}

Если вы хотите использовать данные из источника, которого нет в этом списке, создайте [тикет в CHARTS по ссылке](https://st.yandex-team.ru/createTicket?summary=%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE%20%D0%B8%D1%81%D1%82%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B0&description=**%D0%9D%D0%B0%D0%B7%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%B8%D1%81%D1%82%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B0**%3A%20%0A!!%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D1%8C!!%0A%0A**%D0%90%D0%B4%D1%80%D0%B5%D1%81%20%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0**%3A%20%0A%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%3A%20%25%25https%3A%2F%2Fexample.yandex.net%2Fapi%25%25%0A!!%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D1%8C!!%0A%0A%0A**%D0%9F%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B%2F%D1%82%D0%B5%D0%BB%D0%BE%20%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0**%3A%0A%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%3A%20%25%25%7B%22key%22%3A%20%22examples%2Fparametrized-stat-graph%22%7D%25%25%0A!!%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D1%8C!!%0A%0A**%D0%90%D0%B2%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F**%20(cookie%2C%20oauth%2C%20tvm%2C%20%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B%20user%2Fpassword%2C%20%D0%B4%D1%80%D1%83%D0%B3%D0%BE%D0%B5)%3A%0A!!%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D1%8C!!%0A%0A**%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%D1%82%20%D0%BE%D1%82%D0%B2%D0%B5%D1%82%D0%B0**%20(%D0%BD%D0%B5%D0%BE%D0%B1%D1%8F%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE)%3A%0A%25%25%7Bdata%3A%20%7B...%7D%7D%25%25%0A%0A**%D0%A1%D1%81%D1%8B%D0%BB%D0%BA%D0%B0%20%D0%B4%D0%BB%D1%8F%20%D0%B4%D0%B8%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0%20%22%D0%9F%D0%BE%D1%81%D0%BC%D0%BE%D1%82%D1%80%D0%B5%D1%82%D1%8C%20%D0%B8%D1%81%D1%82%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B8%22%20(%D0%BD%D0%B5%D0%BE%D0%B1%D1%8F%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE)**%3A%0A%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%3A%20%25%25https%3A%2F%2Fyql.yandex-team.ru%2FQueries%2F%3Cid%20%D0%B8%D0%B7%20%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2%20%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D0%B0%3E%3Feditor_page%3Dmain%25%25%0A%0A**%D0%9E%D1%82%D0%B2%D0%B5%D1%82%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5**%20(%D0%BF%D0%B5%D1%80%D0%B5%D1%87%D0%B8%D1%81%D0%BB%D0%B8%D1%82%D1%8C%20%D0%BB%D0%BE%D0%B3%D0%B8%D0%BD%D1%8B%20%D0%B8%D0%BB%D0%B8%20%D1%83%D0%BA%D0%B0%D0%B7%D0%B0%D1%82%D1%8C%20%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D1%83)%3A%20%0A!!%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D1%8C!!%0A%0A%0A**%D0%A1%D1%81%D1%8B%D0%BB%D0%BA%D0%B0%20%D0%BD%D0%B0%20Charts%20%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8C**%20(%D0%BD%D0%B5%D0%BE%D0%B1%D1%8F%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE)%3A%0A%0A&type=2&assignee=1120000000073741&priority=2&followers=1120000000020711&components=44210&queue=DLHELP)с описанием вашего API.

Специальных требований к API нет, как правило, бывает достаточно, чтобы по GET/POST запросам оно умело отдавать json. 

Формат данных нас на этом этапе не интересует, после подключения вы сможете либо написать свой ChartEditor-модуль для приведения данных к нужному для отрисовки формату, либо доработать API так, чтобы оно отдавало сразу в правильном формате.

## Ограничения {#limits}

Размер и время загрузки данных ограничены:

* 100 Мбайт на суммарный размер данных из всех источников во время одного запроса;
* 50 Мбайт на размер данных из одного источника;
* 300 с на суммарное время загрузки данных из всех источников во время одного запроса;
* 95 с на время загрузки данных из одного источника;
* 10 с на выполнение вкладки JavaScript.

Эти ограничения необходимы для обеспечения стабильной работы как самого сервиса, так и источников.
