
# Параметризация графиков

Вкладка **Params** описывает параметры по умолчанию.
С этими параметрами график работает по умолчанию.

```js
module.exports = {
    period: '20',
    metric: ['judged-pfound-5'],
    id: ['1215', '1217', '979', '483']
};
```

Параметры могут быть как обычными значениями (строками и числами), так и массивами.

При запуске скрипта, параметры из URL с которыми он был вызван накладываются
на эти параметры по умолчанию и итоговый объект можно использовать в других
табах *ChartEditor*.

Для получения значения параметра нужно использовать метод `ChartEditor.getParams()`:

```js
const params = ChartEditor.getParams();
if (params.period[0] === '20') {
    // your code
}
```

Переопределить параметры можно через url графика. Например:

```
&period=40&metric=2012&metric=2014
```

Такой url, наложенный на параметры по умолчанию, описанные выше, образует следующий объект `params`:

```js
{
  period: 40,
  metric: ['2012', '2014'],
  id: ['1215', '1217', '979', '483']
}
```

При изначальной отрисовке дашборда параметры, которые связывают внешний селектор с чартами на дашборде, остаются статичными. Если параметр динамически вычисляется в коде селектора, то перерисовка чартов с обновленными значениями параметра произойдет только при последующем изменении селектора.

## Специальные параметры {#special-parameters}

### Относительная дата {#relativedate}

**Форматы:**

* `__relative_<знак><количество><единица измерения>`
* `__relative_<знак><количество><единица измерения>_<тип приведения><единица измерения>`

- знак: `+` или `-`
- единица измерения:
  - `y` - год
  - `Q` - квартал
  - `M` - месяц
  - `w` - неделя
  - `d` - день
  - `h` - час
  - `m` - минута
  - `s` - секунда
  - `ms` - миллисекунда
- тип приведения:
  - `s` - к началу
  - `e` - к концу

**Пример:**

Если время на данный момент `2020-03-24T23:30:39.874Z`, то
- `__relative_-7d` - семь дней назад - ` 2020-03-17T00:00:00.000Z`
- `__relative_+30m` - через 30 минут - ` 2020-03-25T00:00:39.874Z`
- `__relative_-0d` - сегодня - `2020-03-24T00:00:00.000Z`
- `__relative_-0h` - сейчас - `2020-03-24T23:30:39.874Z`
- `__relative_-3M_sQ`
  * минус 3 месяца - `2019-12-24T00:00:00.000Z`
    * приведенные к началу квартала - `2019-10-01T00:00:00.000Z`
- `__relative_+15s_em`
  * плюс 15 секунд - `2020-03-24T23:30:54.874Z`
    * приведенные к концу минуты - `2020-03-24T23:30:59.999Z`

**Примечание:** если не указаны приведения, то для единиц измерения от дня и выше время приводится к началу дня,
т.е. `00:00:00.000`, а для единиц измерения меньше дня используется текущее время.

**Вспомогательный метод:** `ChartEditor.resolveRelative`
- принимает строку в формате относительной даты
- возвращает ISO дату, если строка соответствует формату, иначе - `null`

```js
// время на данный момент: 2020-02-18T09:14:56.123Z
const date = ChartEditor.resolveRelative('__relative_-7d');
// date === 2020-02-11T00:00:00.000Z
```

```js
// время на данный момент: 2020-02-18T09:14:56.123Z
const date = ChartEditor.resolveRelative('__relative_+30m_sh');
// date === 2020-02-18T09:00:00.000Z
```

```js
const date = ChartEditor.resolveRelative('2020-01-01');
// date === null
```

**Примечание:** относительные даты, прописанные на вкладке `Params` или указанные в url, будут автоматически пропущены через вспомогательный метод.
Однако в случае, если значение параметра не соответствует формату относительной даты, вместо `null` будет возвращено исходное значение.
Например:

Вкладка **Params:**
```js
module.exports = {
    date_min: '2020-01-01',
    date_max: '__relative_+1d_sw',
    incorrect: '_relative_d1',
}
```

Параметры **url:** `...?date_min=__relative_-7d`
```js
// время на данный момент: 2020-02-20T12:30:11.324Z
const params = ChartEditor.getParams();
// params === {
//   date_min: ['2020-02-13T00:00:00.000Z'],
//   date_max: ['2020-02-17T00:00:00.000Z'],
//   incorrect: ['_relative_d1']
// }
```

### Интервал {#interval}

**Формат:** `__interval_<начало>_<конец>`

`начало`/`конец` - [относительная дата](#relativedate) или ISO дата.

**Пример:**

Если время на данный момент `2020-03-24T23:30:39.874Z`, то
- `__interval_2019-03-11T09:35:48_2019-12-28T09:35:48`
  * с `2019-03-11T09:35:48` по `2019-12-28T09:35:48`
- `__interval_2019-01-17T09:35:48___relative_+0d`
  * с `2019-01-17T09:35:48` по сегодня (`2020-03-24T23:59:59.999Z`)
- `__interval___relative_-2w_sM___relative_+1d`
  * от двух недель назад - `2020-03-10T00:00:00.000Z`
    * приведенных к началу месяца - `2020-03-01T00:00:00.000Z`
  * до завтра - `2020-03-25T23:59:59.999Z`

**Вспомогательный метод:** `ChartEditor.resolveInterval`
- принимает строку в формате интервала
- возвращает объект `{from, to}`, где `from/to` - ISO дата, если строка соответствует формату, иначе - `null`

```js
// время на данный момент: 2020-02-26T07:05:52.552Z
const {from, to} = ChartEditor.resolveInterval('__interval___relative_-1y___relative_+10d_eM');
// from === 2019-02-26T00:00:00.000Z
// to === 2020-03-31T23:59:59.999Z
```

```js
// время на данный момент: 2020-02-26T07:05:52.552Z
const interval = ChartEditor.resolveInterval('__interval_2019-01-01T07:08:25.941Z___relative_+1h');
// interval.from === 2019-01-01T07:08:25.941Z
// interval.to === 2020-02-26T08:05:52.552Z
```

```js
// время на данный момент: 2020-02-26T07:05:52.552Z
const interval = ChartEditor.resolveInterval('__interval_2020.01.15___relative_-0d');
// interval === null
```

**Примечание:** начало и конец интервала, прописанного на вкладке `Params` или указанного в url, будут автоматически пропущены через вспомогательный метод для [относительной даты](#relativedate).
Однако в случае, если значение `начала`/`конца` интервала не соответствует формату, то вместо `null` будет возвращено исходное значение.
Например:

Вкладка **Params:**
```js
module.exports = {
    first: '__interval_2020-01-01T12:30:11.324Z___relative_+1d',
    second: '',
    incorrect: '__inteval_01.01.2020___relative_-1d'
}
```

Параметры **url:** `...?second=__interval___relative_-1y_eQ_2021`
```js
// время на данный момент: 2020-02-20T12:30:11.324Z
const params = ChartEditor.getParams();
// params === {
//   first: ['__interval_2020-01-01T12:30:11.324Z_2020-02-21T23:59:59.999Z'],
//   second: ['__interval_2019-03-31T23:59:59.999Z_2021'],
//   incorrect: ['__inteval_01.01.2020___relative_-1d']
// }
```
