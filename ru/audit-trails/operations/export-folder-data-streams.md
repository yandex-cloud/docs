# Загрузка аудитных логов каталога в {{ yds-name }}

Создайте новый [трейл](../concepts/trail.md), который будет загружать аудитные логи ресурсов отдельного каталога в поток данных {{ yds-name }}.


## Подготовка окружения {#before-you-begin}

Для экспорта аудитных логов каталога:

1. [Создайте](../../data-streams/operations/manage-streams.md#create-data-stream) поток данных для загрузки в него аудитных логов.
1. [Создайте](../../iam/operations/sa/create.md) сервисный аккаунт.
1. Назначьте роли сервисному аккаунту:

    {% list tabs %}

    - CLI

      {% include [cli-install](../../_includes/cli-install.md) %}

      {% include [default-catalogue](../../_includes/default-catalogue.md) %}

      * [`audit-trails.viewer`](../security/index.md#roles) на каталог, с которого будут собираться аудитные логи:

        ```
        yc resource-manager folder add-access-binding \
          --role audit-trails.viewer \
          --id <идентификатор каталога> \
          --service-account-id <идентификатор сервисного аккаунта>
        ```

        Где:
        * `role` — назначаемая роль.
        * `id` — идентификатор каталога, с которого будут собираться аудитные логи.
        * `service-account-id` — идентификатор сервисного аккаунта.

      * [`yds.writer`](../../logging/security/index.md#roles) на каталог, в котором будет находиться трейл:

        ```
        yc resource-manager folder add-access-binding \
          --role yds.writer \
          --id <идентификатор каталога> \
          --service-account-id <идентификатор сервисного аккаунта>
        ```

        Где:
        * `role` — назначаемая роль.
        * `id` — идентификатор каталога, в котором будет находиться трейл.
        * `service-account-id` — идентификатор сервисного аккаунта.

    {% endlist %}

1. На странице [Права доступа]({{ link-console-access-management }}) убедитесь, что у вас есть роли:
    * `iam.serviceAccounts.user` на сервисный аккаунт;
    * `audit-trails.editor` на каталог, где будет находиться трейл;
    * `audit-trails.viewer` на облако, с которого будут собираться аудитные логи;
    * `yds.viewer` на поток данных {{ yds-name }}.


## Создать трейл {#the-trail-creation}

Чтобы создать трейл, который экспортирует аудитные логи каталога:

{% list tabs %}

- Консоль управления

  1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором вы хотите разместить трейл.
  1. Выберите сервис **{{ at-name }}**.
  1. Нажмите кнопку **Создать трейл** и укажите:
      * **Имя** — имя создаваемого трейла.
      * **Описание** — описание трейла, необязательный параметр.
  1. В блоке **Фильтр** задайте параметры области сбора аудитных логов:
      * **Ресурс** — выберите `Каталог`.
      * **Каталог** — не требует заполнения, содержит имя каталога, в котором будет находиться трейл.
  1. В блоке **Назначение** задайте параметры объекта назначения:
      * **Назначение** —  `{{ yds-name }}`.
      * **Поток данных** — выберите поток данных. Также вы можете создать новый поток данных, для этого нажмите кнопку **Создать новый** и [укажите](../../data-streams/operations/manage-streams.md#create-data-stream) параметры потока данных.
  1. В блоке **Сервисный аккаунт** выберите сервисный аккаунт, от имени которого трейл будет загружать аудитные логи в поток данных.
  1. Нажмите кнопку **Создать**.

{% endlist %}

Трейл создастся и начнет загружать аудитные логи в поток данных. 

## Что дальше {#whats-next} 

* Узнайте о [формате аудитных логов](../concepts/format.md).
* Узнайте о порядке [загрузки аудитных логов в SIEM](../concepts/export-siem.md).
* Узнайте о [поиске по аудитным логам в бакете](../tutorials/search-bucket.md).
