# Загрузка аудитных логов в Cloud Logging

По этой инструкции вы создадите новый трейл, который будет загружать аудитные логи ресурсов отдельного облака или всех ресурсов организации в лог-группу {{ cloud-logging-name }}.

## Перед началом работы {#before-you-begin}

### Организация {#before-you-begin-organization}

Для экспорта аудитных логов организации:

1. [Создайте](../../logging/operations/write-logs.md) лог-группу для загрузки в нее аудитных логов.
1. Создайте сервисный аккаунт и назначьте ему роли:
    * `audit-trails.viewer` на организацию, с которой будут собираться аудитные логи:

        ```
        yc organization-manager organization add-access-binding --role audit-trails.viewer --id <идентификатор организации> --service-account-id <идентификатор сервисного аккаунта>
        ```

    * `logging.writer` на каталог, в котором будет находиться трейл:

        ```
        yc resourcemanager folder add-access-binding --role logging.writer --id <идентификатор каталога> --service-account-id <идентификатор сервисного аккаунта>
        ```

1. Убедитесь, что у пользователя есть роли:
    * `iam.serviceAccounts.user` на сервисный аккаунт;
    * `audit-trails.editor` на каталог, где будет находиться трейл;
    * `audit-trails.viewer` на организацию, с которой будут собираться аудитные логи;
    * `logging.viewer` на лог-группу cloud logging.

### Облако {#before-you-begin-cloud}

Для экспорта аудитных логов отдельного облака:

1. [Создайте](../../logging/operations/write-logs.md) лог-группу для загрузки в нее аудитных логов.
1. Создайте сервисный аккаунт и назначьте ему роли: 
    * `audit-trails.viewer` на облако:

        ```
        yc resourcemanager cloud add-access-binding --role audit-trails.viewer --id <идентификатор облака> --service-account-id <идентификатор сервисного аккаунта>
        ```

    * `logging.writer` на каталог, в котором будет находиться трейл:

        ```
        yc resourcemanager folder add-access-binding --role logging.writer --id <идентификатор каталога> --service-account-id <идентификатор сервисного аккаунта>
        ```

1. Убедитесь, что у пользователя есть роли:
    * `iam.serviceAccounts.user` на сервисный аккаунт;
    * `audit-trails.editor` на каталог, где будет находиться трейл;
    * `audit-trails.viewer` на облако, откуда будут собираться аудитные логи;
    * `logging.viewer` на лог-группу cloud logging.

## Создание трейла {#the-trail-creation}

### Организация {#the-trail-creation-organization}

Чтобы создать трейл, который экспортирует аудитные логи организации:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором вы хотите разместить трейл.
1. Выберите сервис {{ at-name }}.
1. Нажмите кнопку **Создать аудитный лог** и укажите:
    1. **Имя** – имя создаваемого трейла.
    1. **Описание** – описание трейла, необязательный параметр.
    1. **Сервисный аккаунт** – выберите сервисный аккаунт, от имени которого трейл будет загружать аудитные логи в лог-группу.
    1. **Назначение**:
        * **Назначение** –  {{ cloud-logging-name }}.
        * **Лог-группа** – имя лог-группы.
    1. **Фильтр**:
        * **Ресурс** – выберите `Организация`.
        * **Организация** – выберите имя организации, в которой находится текущий трейл.

### Облако {#the-trail-creation-cloud}

Чтобы создать трейл, который экспортирует аудитные логи отдельного облака:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором вы хотите разместить трейл.
1. Выберите сервис {{ at-name }}.
1. Нажмите кнопку **Создать аудитный лог** и укажите:
    1. **Имя** – имя создаваемого трейла.
    1. **Описание** – описание трейла, необязательный параметр.
    1. **Сервисный аккаунт** – выберите сервисный аккаунт, от имени которого трейл будет загружать аудитные логи в лог-группу.
    1. **Назначение**: 
        * **Назначение** –  {{ cloud-logging-name }}.
        * **Лог-группа** – имя лог-группы.
    1. **Фильтр**:
        * **Ресурс** – выберите `Облако`.
        * **Облако** – выберите имя облака, в котором находится текущий трейл.

Трейл создастся и начнет загружать аудитные логи в лог-группу. 

## Что дальше {#whats-next} 

* Узнайте о [формате аудитных логов](../concepts/format.md).
* Узнайте о порядке загрузки логов в SIEM [Загрузка аудитных логов в SIEM](../concepts/export-siem.md).
* Узнайте о [поиске по аудитным логам в бакете](../solutions/search-bucket.md)
