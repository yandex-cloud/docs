# Загрузка аудитных логов в бакет

По этой инструкции вы создадите новый трейл, который будет загружать аудитные логи ресурсов облака в бакет {{ objstorage-name }} с включенным шифрованием.

{% note tip %}

Для бакета с выключенным шифрованием настройка выгрузки выполняется аналогично. Только не требуется назначать роли сервиса {{ kms-full-name }}. 

{% endnote %}

## Перед началом работы {#before-you-begin}

1. [Создайте новый бакет](../../storage/quickstart.md#the-first-bucket) для загрузки в него аудитных логов.
1. Создайте [ключ шифрования](../../kms/operations/key.md#create) в сервисе {{ kms-short-name }}.
1. [Включите шифрование бакета](../../storage/operations/buckets/encrypt.md#add), используя созданный ключ шифрования.
1. Создайте сервисный аккаунт и назначьте ему роли: 
    * `audit-trails.viewer` на облако;
    * `storage.uploader` на бакет или каталог;
    * `kms.keys.encrypterDecrypter` на ключ шифрования.
1. Убедитесь, что у пользователя есть роли:
    * `iam.serviceAccounts.user` на сервисный аккаунт;
    * `audit-trails.editor` на каталог, где будет находиться трейл;
    * `audit-trails.viewer` на облако, откуда будут собираться аудитные логи;
    * `storage.viewer` на бакет или каталог.

## Создание трейла {#the-trail-creation}

Чтобы создать первый трейл в {{ at-name }} и запустить процесс управления аудитными логами:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором вы хотите разместить трейл.
1. Выберите сервис {{ at-name }}.
1. Нажмите кнопку **Создать аудитный лог** и укажите:
    1. **Имя** — имя создаваемого трейла.
    1. **Описание** — описание трейла, необязательный параметр.
    1. **Сервисный аккаунт** — выберите сервисный аккаунт, от имени которого трейл будет загружать файлы аудитного лога в бакет.
    1. **Назначение**: 
        * **Назначение** —  {{ objstorage-name }}.
        * **Бакет** — имя бакета, в который будут загружаться аудитные логи.
        * **Префикс объекта** — необязательный параметр, участвует в [полном имени](../concepts/format.md#log-file-name) файла аудитного лога.
    1. **Фильтр**:
        * **Ресурс** — выберите `Облако`.
        * **Облако** — выберите имя облака, в котором находится текущий трейл.
        * **Каталоги** — оставьте поле пустым.
1. Нажмите кнопку **Создать**.

Трейл создастся и начнет загружать аудитные логи в бакет. 
