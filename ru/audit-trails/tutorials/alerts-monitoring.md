# Настройка алертов в {{ monitoring-full-name }}

Из руководства вы узнаете, как отслеживать состояние [трейлов](https://cloud.yandex.ru/docs/audit-trails/concepts/trail) с помощью [алертов](https://cloud.yandex.ru/docs/monitoring/concepts/alerting#alert).

Чтобы начать отслеживать статус трейлов:

1. [Подготовьте облако к работе](#before-you-begin).
1. [Создайте канал уведомлений](#create-channel).
1. [Настройте алерты](#setup-alerts).

Если алерты вам больше не нужны, [удалите их](#clear-out).

## Подготовьте облако к работе {#before-you-begin}

{% include [before-you-begin](../../_tutorials/_tutorials_includes/before-you-begin.md) %}

## Создайте канал уведомлений {#create-channel}

Чтобы получать уведомления о срабатывании алерта:

1. В [консоли управления]({{ link-console-main }}) перейдите в каталог, в котором хотите создать канал уведомлений.
1. Выберите сервис **{{ monitoring-name }}**.
1. На панели слева выберите **Каналы**.
1. В правом верхнем углу нажмите кнопку **Создать канал**.
1. Укажите параметры канала:
    * В поле **Имя** укажите `alerts-channel`.
    * В поле **Метод** укажите метод уведомлений.
    * В поле **Получатели** перечислите получателей уведомлений.
1. Нажмите кнопку **Создать**. 

Канал появится в списке.

## Настройте алерты {#setup-alerts}

Вы можете настроить один или несколько алертов.

Более подробная информация о порядке [создания алерта](../../monitoring/operations/alert/create-alert.md) и о [параметрах алерта](../../monitoring/concepts/alerting.md#alert-parameters) приведена в документации {{ monitoring-full-name }}.

### Переход трейла в неактивное состояние {#deactivating-trail}

Алерт отправит уведомление о том, что трейл переходит в неактивный статус.

1. В [консоли управления]({{ link-console-main }}) перейдите в каталог, в котором хотите создать алерт.
1. Выберите сервис **{{ monitoring-name }}**.
1. На панели слева выберите **Алерты**.
1. В правом верхнем углу нажмите кнопку **Создать алерт**.
1. В поле **Название** укажите `deactivating-trail-alert`. 
1. В блоке **Метрики** cправа от имени каталога нажмите ![image](../../_assets/plus-sign.svg) и укажите:
    1. `service = Audit Trails`. 
    1. `name = trail.status`.
    1. `status != ACTIVE`.
    1. `trail = <имя_трейла>`.
1. В блоке **Настройки алерта** укажите:
    1. **Условие срабатывания** — `Не равно`.
    1. **Alarm** — `0`.
1. В блоке **Каналы уведомлений** нажмите кнопку **Добавить канал** и выберите канал уведомления, [созданный ранее](#create-channel).
1. Нажмите кнопку **Создать алерт**. 

Алерт создан.

### Прекращение доставки аудитных логов в объект назначения {#stopping-logs}

Алерт отправит уведомление о том, что трейл прекратил загружать аудитные логи в объект назначения, например по причине нехватки свободного места в бакете.

Параметр **Окно вычисления** зависит от конкретного трейла. В зависимости от типа и количества ресурсов в блоке сбора аудитных логов трейла, частота загрузки аудитных логов в объект назначения будет варьироваться. 

1. В [консоли управления]({{ link-console-main }}) перейдите в каталог, в котором хотите создать алерт.
1. Выберите сервис **{{ monitoring-name }}**.
1. На панели слева выберите **Алерты**.
1. В правом верхнем углу нажмите кнопку **Создать алерт**.
1. В поле **Название** укажите `stopping-logs-alert`. 
1. В блоке **Метрики** cправа от имени каталога нажмите ![image](../../_assets/plus-sign.svg) и укажите:
    1. `service = Audit Trails`. 
    1. `name = trail.delivered_events_count`.
    1. `trail = <имя_трейла>`.
1. В блоке **Настройки алерта** укажите:
    1. **Условие срабатывания** — `Равно`.
    1. **Alarm** — `0`.
    1. **Окно вычисления** — `<значение_для_трейла>`.
1. В блоке **Каналы уведомлений** нажмите кнопку **Добавить канал** и выберите канал уведомления, [созданный ранее](#create-channel).
1. Нажмите кнопку **Создать алерт**. 

Алерт создан.

### Изменение числа трейлов {#number-trails}

Алерт отправит уведомление о том, что число трейлов в облаке изменилось.

1. В [консоли управления]({{ link-console-main }}) перейдите в каталог, в котором хотите создать алерт.
1. Выберите сервис **{{ monitoring-name }}**.
1. На панели слева выберите **Алерты**.
1. В правом верхнем углу нажмите кнопку **Создать алерт**.
1. В поле **Название** укажите `number-trails-alert`. 
1. В блоке **Метрики** cправа от имени каталога нажмите ![image](../../_assets/plus-sign.svg) и укажите:
    1. `service = Audit Trails`. 
    1. `name = quota.trails_count.usage`.
1. В блоке **Настройки алерта** укажите:
    1. **Условие срабатывания** — `Не равно`.
    1. **Alarm** — `<количество_трейлов>`.
1. В блоке **Каналы уведомлений** нажмите кнопку **Добавить канал** и выберите канал уведомления, [созданный ранее](#create-channel).
1. Нажмите кнопку **Создать алерт**. 

Алерт создан.

### Израсходование квоты трейлов на облако {#trail-quota}

Алерт отправит уведомление о том, что квота на количество трейлов в облаке израсходована более чем на 80%.
   
1. В [консоли управления]({{ link-console-main }}) перейдите в каталог, в котором хотите создать алерт.
1. Выберите сервис **{{ monitoring-name }}**.
1. На панели слева выберите **Алерты**.
1. В правом верхнем углу нажмите кнопку **Создать алерт**.
1. В поле **Название** укажите `trail-quota-alert`. 
1. В блоке **Метрики** cправа от имени каталога нажмите ![image](../../_assets/plus-sign.svg) и укажите:
    1. `service = Audit Trails`. 
    1. `name = quota.trails_count.usage`.
1. В блоке **Настройки алерта** укажите:
    1. **Условие срабатывания** — `Больше`.
    1. **Alarm** — `<число_равное_80%_от_квоты>`.
1. В блоке **Каналы уведомлений** нажмите кнопку **Добавить канал** и выберите канал уведомления, [созданный ранее](#create-channel).
1. Нажмите кнопку **Создать алерт**. 

Алерт создан.

### Попытки неавторизованного доступа {#unauthorized-access}

Алерт отправит уведомление о том, что к одному из ресурсов трейла был отправлен неавторизованный запрос.

1. В [консоли управления]({{ link-console-main }}) перейдите в каталог, в котором хотите создать алерт.
1. Выберите сервис **{{ monitoring-name }}**.
1. На панели слева выберите **Алерты**.
1. В правом верхнем углу нажмите кнопку **Создать алерт**.
1. В поле **Название** укажите `unauthorized-access-alert`. 
1. В блоке **Метрики** cправа от имени каталога нажмите ![image](../../_assets/plus-sign.svg) и укажите:
    1. `service = Audit Trails`. 
    1. `name = trail.unauthorized_events_count`.
1. В блоке **Настройки алерта** укажите:
    1. **Условие срабатывания** — `Больше`.
    1. **Alarm** — `0`.
1. В блоке **Каналы уведомлений** нажмите кнопку **Добавить канал** и выберите канал уведомления, [созданный ранее](#create-channel).
1. Нажмите кнопку **Создать алерт**. 

Алерт создан.

## Как удалить созданные ресурсы {#clear-out}

Чтобы перестать отслеживать состояние трейлов, [удалите](../../monitoring/operations/alert/delete-alert.md) алерт.
