# Как начать работать с {{ captcha-full-name }}

Чтобы начать работу с сервисом:

1. [Получите ключи](#get-keys).
1. [Добавьте виджет на страницу](#add-widget).
1. [Проверьте ответ пользователя](#check-answer).

## Получите ключи {#get-keys}

Для использования сервиса {{ captcha-name }} необходимо получить ключи для клиентской и серверной части. С помощью клиентского ключа вы можете [разместить виджет](#add-widget) {{ captcha-name }} на своей странице. Серверный ключ потребуется для [проверки ответа](#check-answer) пользователя.

Чтобы получить ключи, обратитесь к своему аккаунт-менеджеру.

## Добавьте виджет на страницу {#add-widget}

Подключите виджет {{ captcha-name }} одним из методов:

* Обычным автоматическим методом: на странице пользователя подключается JS-скрипт, который автоматически находит все `div` с классом `smart-captcha` и устанавливает в них виджет.
* Расширенным методом: вы управляете подключением виджета в процессе загрузки JS-скрипта через объект `window.smartCaptcha`.

{% list tabs %}

- Обычный метод

    1. Подключите JS-скрипт к странице пользователя. Для этого разместите в любом месте страницы (например, внутри тега `<head>`) код:

        ```html
        <script src="https://captcha-api.yandex.ru/captcha.js" defer></script>
        ```

    1. Добавьте на страницу пустой контейнер (элемент `div`), в который будет автоматически вставлен виджет {{ captcha-name }}:

        ```html
        <div
          id="captcha-container"
          class="smart-captcha"
          data-sitekey="<Ключ для клиентской части>"
        ></div>
        ```

        {% note info %}

        При загрузке виджет меняет высоту контейнера, в котором он находится, на `100px`. Это может привести к нежелательному «скачку» верстки на странице из-за изменения высоты контейнера. Чтобы избавиться от этого «скачка», вы можете задать до загрузки виджета высоту контейнера `100px`.

        ```html
        <div ... style="height: 100px"></div>
        ```

        {% endnote %}

- Расширенный метод

    В этом примере управление загрузкой виджета выполняется вызовом callback-функции `onloadFunction` в процессе загрузки JS-скрипта.
  
    1. Подключите JS-скрипт к странице пользователя. Для этого разместите в любом месте страницы, например, внутри тега `<head>` код:

        ```html
        <script
          src="https://captcha-api.yandex.ru/captcha.js?render=onload&onload=onloadFunction"
          defer
        ></script>
        ```

    1. Добавьте на страницу пустой контейнер, в который будет вставлен виджет: 

        ```html
        <div id="<id контейнера>"></div>
        ```

    1. Добавьте на страницу код callback-функции:

        ```html
        <script>
          function onloadFunction() {
            if (window.smartCaptcha) {
              const container = document.getElementById('<id контейнера>');

              const widgetId = window.smartCaptcha.render(container, {
                sitekey: '<Ключ для клиентской части>',
                hl: '<Язык>',
              });
            }
          }
        </script>
        ```

        В код callback-функции стоит добавить проверку существования объекта `window.smartCaptcha`, чтобы не вызвать ошибку в случае вызова функции до завершения загрузки JS-скрипта.  

        {% note info %}

        При загрузке виджет меняет высоту контейнера, в котором он находится, на `100px`. Это может привести к нежелательному «скачку» верстки на странице из-за изменения высоты. Чтобы избавиться от этого «скачка», вы можете задать до загрузки виджета высоту контейнера `100px`.

        ```html
        <div ... style="height: 100px"></div>
        ```

        {% endnote %}

{% endlist %}

## Проверьте ответ пользователя {#check-answer}

После прохождения проверки пользователю выдается уникальный токен, который сохраняется в скрытом поле формы. Для проверки токена нужно отправить GET-запрос на адрес `https://captcha-api.yandex.ru/validate` со следующими параметрами:

* `secret` — ключ для серверной части;
* `token` — токен, полученный после прохождения проверки;
* `ip` — IP-адрес пользователя, от которого пришел запрос на проверку токена.

Пример функции проверки токена:

{% list tabs %}

- Python

    ```py
    def check_captcha():

        token = request.form["smart-token"]
        print(f"token={token}", file=sys.stderr)
        resp = requests.get(

            "https://captcha-api.yandex.ru/validate",

            {
                "secret": "<Ключ для серверной части>",
                "token": token,
                "ip": request.headers.get("X-Forwarded-For-Y", "127.0.0.1")
            }
        )

        print(f"status_code={resp.status_code}", file=sys.stderr)
        content = resp.content.decode()
        print(f"content={content}", file=sys.stderr)
        return json.loads(content)["status"] == "ok"
    ```

{% endlist %}

## Что дальше {#whats-next}

* Узнайте больше [о методах подключения](./concepts/widget-methods.md) виджета {{ captcha-name }}.
