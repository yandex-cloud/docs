---
title: "Резервные копии {{ PG }}"
description: "{{ mpg-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных {{ PG }}. Резервные копии занимают место в объеме хранилища, выделенном для кластера. Резервная копия автоматически создается раз в день."
keywords:
  - бекап
  - backup
  - резервное копирование
  - резервное копирование PostgreSQL
  - backup PostgreSQL
  - PostgreSQL
---

# Резервные копии в {{ mpg-name }}

{{ mpg-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных.

{{ mpg-name }} позволяет восстановить состояние кластера _на любой момент времени_ (Point-in-Time-Recovery, PITR) после создания самой старой полной резервной копии. Это достигается за счет дополнения данных резервной копии, выбранной в качестве начальной точки для восстановления, записями из журналов WAL (Write-Ahead Log) более поздних резервных копий кластера.

Например, если операция создания резервной копии завершилась 10.08.2020 в 12:00:00 UTC, текущая дата — 15.08.2020 19:00:00 UTC, а последний журнал опережающей записи был сохранен 15.08.2020 в 18:50:00 UTC, кластер может быть восстановлен в любое свое состояние в промежутке времени с 10.08.2020 12:00:01 UTC до 15.08.2020 18:50:00 UTC включительно.

По умолчанию PITR включен.

При создании резервных копий и восстановлении из них на заданный момент времени учитывайте, что:

* WAL состоит из файлов размером 16 МБ, которые архивируются в работающем кластере по мере достижения нужного размера или если с момента последней архивации прошло время, заданное настройкой СУБД уровня кластера [archive timeout](./settings-list.md#setting-archive-timeout). Затем архив загружается в объектное хранилище.

* На создание и загрузку архива WAL в объектное хранилище требуется некоторое время. Из-за этого состояние кластера, хранящееся в объектном хранилище, может отличаться от реального.

Подробнее о PITR см. в [документации {{ PG }}](https://www.postgresql.org/docs/current/continuous-archiving.html).

Чтобы восстановить кластер из резервной копии, [следуйте инструкциям](../operations/cluster-backups.md#restore).

## Создание резервной копии {#size}

Первая и каждая седьмая автоматические резервные копии, а также все резервные копии, созданные вручную, — полные резервные копии всех баз данных. Остальные резервные копии — инкрементные, хранится только разница с предыдущей резервной копией, что позволяет экономить место в хранилище.

Резервная копия всех данных кластера автоматически создается раз в день. Отключить автоматическое создание резервной копии невозможно. Однако при [создании](../operations/cluster-create.md) или [изменении](../operations/update.md#change-additional-settings) кластера для таких резервных копий можно задать:

* [Срок их хранения](#storage).
* Время начала резервного копирования. По умолчанию время начала — 22:00 UTC (Coordinated Universal Time). Резервное копирование начнется в течение получаса от указанного времени.

После создания резервная копия сжимается для дальнейшего хранения. Отображение точного размера резервной копии недоступно.

Резервные копии создаются только на работающих кластерах. Если вы используете кластер {{ mpg-short-name }} не круглосуточно, проверьте [настройки времени начала резервного копирования](../operations/update.md#change-additional-settings). Кластер, у которого нет резервных копий, невозможно [остановить](../operations/cluster-stop.md#stop-cluster).

О том, как вручную создать резервную копию, читайте в разделе [{#T}](../operations/cluster-backups.md).

{% include [manual-backup-restore](../../_includes/mdb/mpg/note-warn-restore-manual-backup.md) %}

## Хранение резервной копии {#storage}

Особенности хранения резервных копий в {{ mpg-name }}:

* Резервные копии хранятся в объектном хранилище в виде бинарных файлов и шифруются с помощью [GPG](https://ru.wikipedia.org/wiki/GnuPG). У каждого кластера свои ключи шифрования.

* {% include [backup-wal](../../_includes/mdb/mpg/backup-wal.md) %}

* Срок хранения резервных копий существующего кластера зависит от способа их создания:

    * Автоматические резервные копии по умолчанию хранятся 7 дней. При [создании](../operations/cluster-create.md) кластера или [изменении](../operations/update.md#change-additional-settings) его настроек можно задать другой срок хранения в диапазоне от 7 до 60 дней.

    * Резервные копии, созданные вручную, хранятся бессрочно.

* После удаления кластера все его резервные копии хранятся 7 дней.

* {% include [no-quotes-no-limits](../../_includes/mdb/backups/no-quotes-no-limits.md) %}

* {% include [using-storage](../../_includes/mdb/backups/storage.md) %}

    Подробнее см. в разделе [Правила тарификации для {{ mpg-name }}](../pricing.md#rules-storage).

## Проверка восстановления из резервной копии {#capabilities}

Для проверки возможностей резервного копирования [восстановите кластер из резервной копии](../operations/cluster-backups.md) и проверьте целостность ваших данных.
