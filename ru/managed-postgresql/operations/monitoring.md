# Мониторинг состояния кластера и хостов

Вы можете отслеживать состояние кластера {{ mpg-name }} и отдельных его хостов с помощью инструментов мониторинга в консоли управления. Эти инструменты предоставляют диагностическую информацию в виде графиков.

## Мониторинг состояния кластера {#monitoring-cluster}

Для просмотра детальной информации о состоянии кластера {{ mpg-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{ mpg-name }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **Мониторинг**.

На странице появятся следующие графики:

- **Statements, (count)** — общее количество выполняемых запросов.
- **Average statement time, (ms)** — среднее время выполнения запроса (в миллисекундах).
- **Transactions, (count)** — количество транзакций, выполняемых на кластере.
- **Average transaction time, (ms)** — среднее время выполнения транзакции (в миллисекундах).
- **PostgreSQL connections, (count)** — количество подключений к БД:
    - **Active** — активные подключения.
    - **Waiting** — подключения в ожидании.
    - **Idle** — простаивающие серверные подключения.
    - **Idle in transaction** — простаивающие подключения в транзакции.
    - **Aborted** — прерванные подключения.
      
      Большое количество **Aborted** или **Idle in transaction** подключений может означать перегрузку кластера.

- **Pooler connections, (count)** — количество подключений к пулеру:
    - **Free servers** — свободные серверные соединения.
    - **Free clients** — свободные клиентские соединения.
    - **Used servers** — занятые серверные соединения.
    - **Used clients** — активные клиентские соединения.

- **Sessions CPU usage, (count)** — количество серверных соединений, использующих CPU.
- **Sessions read bytes, (count)** — количество прочитанных данных.
- **Sessions write bytes, (count)** — количество записанных данных.
- **Sessions per wait events, (count)** — количество серверных соединений, ожидающих определенных событий.
- **Disk capacity on primary, (bytes)** — емкость диска на основной ноде (в байтах):
    - **Free** — свободное дисковое пространство.
    - **Used** — использованное дисковое пространство.  
      
      График потребления памяти в виде «пилы» может свидетельствовать о высокой нагрузке на кластер.

- **Replication lag, (seconds)** — отставание реплики от мастера (в секундах).
  
  Ненулевое значение говорит о долгих запросах на реплике или ее перегруженности. Подробнее читайте в разделе [Репликация](../concepts/replication.md).

## Мониторинг состояния хостов {#monitoring-hosts}

Для просмотра детальной информации о состоянии отдельных хостов {{ mpg-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{mpg-name }}**.
1. Нажмите на имя нужного кластера, затем выберите вкладку **Хосты**.
1. Перейдите на страницу **Мониторинги**.
1. Выберите нужный хост из выпадающего списка.

На этой странице выводятся графики, показывающие нагрузку на отдельный хост кластера:

- **CPU** — загрузка процессорных ядер. При повышении нагрузки значение **Idle** уменьшается.
- **Memory** — использование оперативной памяти (RAM) в байтах. При высоких нагрузках значение параметра **Free** уменьшается, а остальные — растут.
- **Disk Bytes** — средний объем данных, записанных в хранилище и прочитанных из него (в байтах).
- **Disk IOPS** — среднее количество операций ввода-вывода в хранилище.
- **Network Bytes** — средний объем данных, отправленных в сеть и полученных из нее (в байтах).
- **Network Packets** — среднее количество пакетов, отправленных в сеть и полученных из нее.

Характеристики **Read** и **Write** на графиках **Disk Bytes** и **Disk IOPS** растут при активном чтении из базы данных и записи в нее соответственно.

Для хостов с ролью **Replica** нормально преобладание **Received** над **Sent** на графиках **Network Bytes** и **Network Packets**.
