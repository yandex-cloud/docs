# Управление расширениями

{{ mpg-short-name }} поддерживает многие стандартные расширения {{ PG }} и некоторые нестандартные. Полный список доступных расширений и их версий в зависимости от версии {{ PG }} [приведен ниже](#postgresql).

{% note warning %}

В кластерах {{ mpg-short-name }} нельзя управлять расширениями {{ PG }} с помощью команд SQL.

{% endnote %}

## Подключение библиотек для расширений {#libraries-connection}

Некоторые расширения требуют подключения библиотек общего пользования (shared libraries). Чтобы подключить библиотеку, при [создании](../cluster-create.md) или [изменении](../update.md#change-postgresql-config) кластера укажите ее имя в [параметре Shared preload libraries](../../concepts/settings-list#setting-shared-libraries).

{{ mpg-short-name }} поддерживает подключение библиотек:

* `auto_explain` — необходима для работы [расширения auto_explain]({{ pg-docs }}/auto-explain.html);
* `pg_cron` — необходима для работы [расширения pg_cron](https://github.com/citusdata/pg_cron);
* `pg_hint_plan` — необходима для работы [расширения pg_hint_plan](https://pghintplan.osdn.jp/pg_hint_plan.html);
* `pg_qualstats` — необходима для работы [расширения pg_qualstats](https://github.com/powa-team/pg_qualstats);
* `timescaledb` — необходима для использования [расширения TimescaleDB](https://github.com/timescale/timescaledb).

{% note warning %}

Подключение библиотеки общего пользования приведет к перезагрузке {{ PG }} на хосте-мастере.

{% endnote %}

## Получить список установленных расширений {#list-extensions}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mpg-name }}**.
  1. Нажмите на имя нужного кластера и выберите блок **Базы данных**.
  1. В колонке **Расширения PostgreSQL** будет отображаться список расширений, подключенных к каждой базе данных.

- CLI

  {% include [cli-install](../../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../../_includes/default-catalogue.md) %}

  Чтобы получить список расширений для базы данных, выполните команду:

  ```bash
  {{ yc-mdb-pg }} database get <имя базы данных> \
     --cluster-name <имя кластера>
  ```

  Включенные расширения будут перечислены в списке `extensions`.

- API

  Получить список расширений для базы данных кластера можно с помощью метода [get](../../api-ref/Database/get.md).

{% endlist %}

## Изменить список установленных расширений {#update-extensions}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mpg-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Базы данных**.
  1. В строке с нужной базой данных нажмите значок ![options](../../../_assets/horizontal-ellipsis.svg) и выберите пункт **Настроить расширения PostgreSQL**.
  1. Выберите необходимые расширения и нажмите кнопку **Изменить**.

- CLI

  {% include [cli-install](../../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../../_includes/default-catalogue.md) %}

  Чтобы изменить расширения для базы данных, передайте их список в аргументе `--extensions` команды CLI. При этом расширения, не упомянутые в списке, будут выключены.

  ```bash
  {{ yc-mdb-pg }} database update <имя базы данных> \
     --cluster-name <имя кластера>
     --extensions <имя расширения>=<версия>,<имя расширения>=<версия>...
  ```

  {% note info %}

  Версия расширения не учитывается при обработке команды — в качестве версии можно передать любую непустую строку.

  {% endnote %}

- {{ TF }}

  1. Откройте актуальный конфигурационный файл {{ TF }} с планом инфраструктуры.

     О том, как создать такой файл, см. в разделе [{#T}](../cluster-create.md).

     Полный список доступных для изменения полей конфигурации базы данных кластера {{ mpg-name }} см. в [документации провайдера {{ TF }}]({{ tf-provider-link }}/mdb_postgresql_database).

  1. Добавьте к описанию соответствующей базы данных кластера один или несколько блоков `extension` (по одному блоку на каждое расширение):

      ```hcl
      resource "yandex_mdb_postgresql_database" "<имя базы данных>" {
        ...
        extension {
          name    = "<имя расширения>"
          version = "<версия расширения>"
        }
        ...
      }
      ```

  1. Проверьте корректность настроек.

     {% include [terraform-validate](../../../_includes/mdb/terraform/validate.md) %}

  1. Подтвердите изменение ресурсов.

     {% include [terraform-apply](../../../_includes/mdb/terraform/apply.md) %}

- API

    Воспользуйтесь методом API [update](../../api-ref/Database/update.md) и передайте в запросе:

    * Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](../cluster-list.md#list-clusters).
    * Имя изменяемой базы данных в параметре `databaseName`.
    * Один или несколько объектов с настройками расширений в параметре `extensions`.
    * Список настроек базы данных, которые необходимо изменить (в данном случае — `extensions`), в параметре `updateMask`.

    {% include [Note API updateMask](../../../_includes/note-api-updatemask.md) %}

{% endlist %}

## Поддерживаемые расширения и утилиты {{ PG }} {#postgresql}

#|
|| **Расширение** \ **Версия {{ PG }}** | **10** | **11** | **12** | **13** | **14** ||
|| [address_standardizer](https://postgis.net/docs/manual-3.1/postgis_installation.html#installing_pagc_address_standardizer)
Содержит функции для нормализации почтовых адресов, переданных в виде строки.
| 2.5.2 | 2.5.2 | 3.0.0 | 3.1.4 | 3.1.4 ||
|| [address_standardizer_data_us](https://postgis.net/docs/manual-3.1/postgis_installation.html#make_install_postgis_extensions)
Содержит правила нормализации почтовых адресов США и Канады для расширения `address_standardizer`.
| 2.5.2 | 2.5.2 | 3.0.0 | 3.1.4 | 3.1.4 |||
|| [amcheck]({{ pg-docs }}/amcheck.html)
Содержит функции проверки логической согласованности реляционной структуры баз данных.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 1.0 | 1.1 | 1.2 | 1.2 | 1.3 ||
|| [autoinc]({{ pg-docs }}/contrib-spi.html#id-1.11.7.47.6)
Содержит функцию `autoinc()`. Она возвращает следующее значение для последовательности, хранящейся в поле целочисленного типа. В отличие от встроенных типов, управляющих последовательностями, `autoinc()`:
* блокирует попытки вставить в поле значение из запроса;
* позволяет изменять значение в поле при обновлении записи.
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [bloom]({{ pg-docs }}/static/bloom.html)
Добавляет доступ к индексам баз данных на основе [фильтров Блума]({% if lang == "ru" %}https://ru.wikipedia.org/wiki/Фильтр_Блума{% endif %}{% if lang == "en" %}https://en.wikipedia.org/wiki/Bloom_filter{% endif %}). Эти вероятностные структуры данных требуют значительно меньше памяти, чем хеш-таблицы, но допускают ложноположительные срабатывания.
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [btree_gin]({{ pg-docs }}/static/btree-gin.html)
Содержит примеры классов оператора GIN (Generalized Inverted Index, обобщенный инвертированный индекс), используемого для обратного поиска.
| 1.2 | 1.3 | 1.3 | 1.3 | 1.3 ||
|| [btree_gist]({{ pg-docs }}/static/btree-gist.html)
Содержит классы оператора GiST (Generalized Search Tree, обобщенное дерево поиска). В отличие от индексов B-tree, GiST поддерживает операторы `<>` (<q>не равно</q>) и `<->` (<q>дистанция</q>), хотя и не обеспечивает уникальности возвращаемых значений.
| 1.5 | 1.5 | 1.5 | 1.5 | 1.6 ||
|| [citext]({{ pg-docs }}/static/citext.html)
Содержит тип данных `citext`, используемый для регистронезависимой работы со строками.
| 1.4 | 1.5 | 1.6 | 1.6 | 1.6 ||
|| [clickhouse_fdw](https://github.com/adjust/clickhouse_fdw)
Добавляет поддержку [Foreign Data Wrapper](https://wiki.postgresql.org/wiki/Foreign_data_wrappers) для доступа к базам данных {{ CH }}, поддерживает операции `SELECT FROM` и `INSERT INTO`.
| - | 1.3 | 1.3 | 1.3 | - ||
|| [cube]({{ pg-docs }}/static/cube.html)
Содержит тип данных `cube`, используемый для представления многомерных кубов.
| 1.2 | 1.4 | 1.4 | 1.4 | 1.5 ||
|| [dblink]({{ pg-docs }}/static/dblink.html)
Добавляет поддержку подключения к другим базам данных {{ PG }} из текущей сессии.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 1.2 | 1.2 | 1.2 | 1.2 | 1.2 ||
|| [dict_int]({{ pg-docs }}/static/dict-int.html)
Содержит пример дополнительного шаблона словаря для полнотекстового поиска. Использование шаблона позволяет избежать разрастания списка уникальных слов и увеличивает скорость поиска.
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [dict_xsyn]({{ pg-docs }}/static/dict-xsyn.html)
Содержит пример дополнительного шаблона словаря синонимов (Extended Synonym Dictionary) для полнотекстового поиска: при поиске слова будут найдены также все его синонимы.
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [earthdistance]({{ pg-docs }}/static/earthdistance.html)
Содержит модуль для вычисления расстояний между точками на поверхности Земли. Вычисление расстояния производится двумя способами:
* через тип данных `cube` (требует включения расширения `cube`);
* через встроенный тип данных `point`.
| 1.1 | 1.1 | 1.1 | 1.1 | 1.1 ||
|| [fuzzystrmatch]({{ pg-docs }}/fuzzystrmatch.html)
Содержит функции, используемые для определения сходства и различия строк.
| 1.1 | 1.1 | 1.1 | 1.1 | 1.1 ||
|| [hstore]({{ pg-docs }}/static/hstore.html)
Содержит тип `hstore`, позволяющий хранить пары <q>ключ:значение</q> в одном поле таблицы и эффективно работать с ними.
| 1.4 | 1.5 | 1.6 | 1.7 | 1.8 ||
|| [hypopg](https://hypopg.readthedocs.io/en/rel1_stable/)
Содержит виртуальные индексы. Они позволяют с минимальными затратами ресурсов выяснить, будет ли {{ PG }} использовать реальные индексы при обработке [проблемных запросов](../../tutorials/profiling.md#solving-inefficient-queries).
| 1.3.1 | 1.3.1 | 1.3.1 | 1.3.1 | 1.3.1 ||
|| [intarray]({{ pg-docs }}/static/intarray.html)
Содержит функции и операторы для работы с массивами целых чисел, в которых нет пустых (`NULL`) значений.
| 1.2 | 1.2 | 1.2 | 1.3 | 1.5 ||
|| [isn]({{ pg-docs }}/static/isn.html)
Содержит типы данных для международных стандартов нумерации продукции EAN13, UPC, ISBN, ISMN и ISSN. Проверка и формирование номеров осуществляется по заданному списку префиксов.
| 1.1 | 1.2 | 1.2 | 1.2 | 1.2 ||
|| [jsquery](https://github.com/postgrespro/jsquery)
Добавляет поддержку языка JsQuery, используемого для работы с данными типа `jsonb`. JsQuery позволяет организовать эффективный поиск во вложенных объектах и содержит дополнительные операторы сравнения с поддержкой индексов.
| 1.0 | 1.1 | 1.1 | 1.1 | 1.1 ||
|| [lo]({{ pg-docs }}/static/lo.html)
Содержит тип данных `lo` и функцию `lo_manage()`. Они используются для управления большими бинарными объектами (Binary Large Object, BLOB) в соответствии с требованиями спецификаций драйверов JDBC и ODBC (стандартное поведение {{ PG }} им не соответствует).
| 1.1 | 1.1 | 1.1 | 1.1 | 1.1 ||
|| [ltree]({{ pg-docs }}/static/ltree.html)
Содержит тип данных `ltree` для представления меток данных, хранящихся в древовидной иерархической структуре.
| 1.1 | 1.1 | 1.1 | 1.2 | 1.2 ||
|| [moddatetime]({{ pg-docs }}/static/contrib-spi.html#id-1.11.7.47.8)
Содержит функцию `moddatetime()`, позволяющую отслеживать время последней модификации строки таблицы.
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [oracle_fdw](https://github.com/laurenz/oracle_fdw)
Добавляет поддержку [Foreign Data Wrapper](https://wiki.postgresql.org/wiki/Foreign_data_wrappers) для доступа к базам данных Oracle.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 1.2 | 1.2 | 1.2 | 1.2 | 1.2 ||
|| [orafce](https://github.com/orafce/orafce)
Добавляет функции и операторы, которые эмулируют набор функций и пакетов БД Oracle.
| 3.18 | 3.18 | 3.18 | 3.18 | 3.18 ||
|| [pg_buffercache]({{ pg-docs }}/pgbuffercache.html)
Добавляет функции мониторинга общего буферного кеша.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 1.3 | 1.3 | 1.3 | 1.3 | 1.3 ||
|| [pg_cron](https://github.com/citusdata/pg_cron)
Позволяет добавлять в базу данных задачи по расписанию и выполнять SQL-запросы непосредственно из задачи. Требует [подключения библиотеки общего пользования](#libraries-connection) `pg_cron`. Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin). Подключение расширения приводит к перезагрузке всех хостов. Подробнее см. в разделе [{#T}](./pg_cron.md).
| 1.4.1 | 1.4.1 | 1.4.1 | 1.4.1 | 1.4.1 ||
|| [pg_hint_plan](http://pghintplan.osdn.jp/)
Содержит функции для управления планировщиком {{ PG }}.
Требует [подключения библиотеки общего пользования](#libraries-connection) `pg_hint_plan`.
| 1.3.3 | 1.3.4 | 1.3.5 | 1.3.7 | 1.4 ||
|| [pg_partman](https://github.com/pgpartman/pg_partman)
Добавляет расширенные возможности по партицированию таблиц, в том числе на основе времени или последовательности.
| 4.0.0 | 4.0.0 | 4.2.0 | 4.4.0 | 4.6.0 ||
|| [pg_qualstats](https://github.com/powa-team/pg_qualstats)
Добавляет возможность сбора статистики по предикатам в выражениях `WHERE` и предложениях `JOIN`.
Требует [подключения библиотеки общего пользования](#libraries-connection) `pg_qualstats`.
| 2.0.3 | 2.0.3 | 2.0.3 | 2.0.3 | 2.0.3 ||
|| [pg_repack](http://reorg.github.io/pg_repack/)
Содержит функции для удаления раздувания (bloat) из таблиц и индексов. В отличие от `CLUSTER` и `VACUUM FULL`, не требует эксклюзивной блокировки таблиц.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 1.4.6 | 1.4.6 | 1.4.6 | 1.4.6 | 1.4.7 ||
|| [pg_stat_kcache](https://github.com/powa-team/pg_stat_kcache)
Добавляет возможность сбора статистики по операциям чтения и записи, выполненным на уровне файловой системы.
Требует включения расширения `pg_stat_statements`.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 2.1.1 | 2.1.1 | 2.1.1 | 2.1.3 | 2.2.0 ||
|| [pg_stat_statements]({{ pg-docs }}/pgstatstatements.html)
Добавляет возможности отслеживания планирования и сбора статистики выполнения всех SQL-запросов, запущенных в кластере.
Для использования расширения необходима [роль `mdb_monitor`](../../concepts/roles.md#mdb_monitor).
| 1.6 | 1.6 | 1.7 | 1.8 | 1.9 ||
|| [pg_tm_aux](https://github.com/x4m/pg_tm_aux)
Позволяет создавать логический слот репликации в прошлом.
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [pg_trgm]({{ pg-docs }}/static/pgtrgm.html)
Содержит инструменты для быстрого поиска похожих строк на основе сопоставления триграмм.
| 1.3 | 1.4 | 1.4 | 1.5 | 1.6 ||
|| [pgcrypto]({{ pg-docs }}/static/pgcrypto.html)
Предоставляет криптографические функции для PostgreSQL.
| 1.3 | 1.3 | 1.3 | 1.3 | 1.3 ||
|| [pgrouting](http://pgrouting.org/)
Содержит функции для геопространственной маршрутизации базы данных [PostGIS](https://www.postgis.net/).
| 2.6.2 | 2.6.2 | 2.6.2 | 3.0.2 | 3.3.0 ||
|| [pgrowlocks]({{ pg-docs }}/static/pgrowlocks.html)
Содержит функцию `pgrowlocks()`, которая возвращает сведения о блокировке строк в указанной таблице.
| 1.2 | 1.2 | 1.2 | 1.2 | 1.2 ||
|| [pgstattuple]({{ pg-docs }}/pgstattuple.html)
Содержит функции для получения статистики на уровне кортежей.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 1.5 | 1.5 | 1.5 | 1.5 | 1.5 ||
|| [pgvector](https://github.com/pgvector/pgvector)
Добавляет поиск векторного подобия.
| 0.2.5 | 0.2.5 | 0.2.5 | 0.2.5 | 0.2.5 ||
|| [plv8](https://plv8.github.io/)
Добавляет поддержку процедурного языка основе JavaScript и движка V8.
| 3.0.0 | 3.0.0 | 3.0.0 | 3.0.0 | 3.0.0 ||
|| [postgis](https://postgis.net/docs/)
Добавляет возможности хранения и обработки объектов геоинформационных систем (ГИС) в базах данных {{ PG }}.
| 2.5.2 | 2.5.2 | 3.0.0 | 3.1.4 | 3.1.4 ||
|| [postgis_tiger_geocoder](https://postgis.net/docs/postgis_installation.html#loading_extras_tiger_geocoder)
Содержит функции для геокодирования на основе данных в формате [TIGER](https://wiki.openstreetmap.org/wiki/TIGER).
| 2.5.2 | 2.5.2 | 3.0.0 | 3.1.4 | 3.1.4 ||
|| [postgis_topology](https://postgis.net/docs/Topology.html)
Содержит типы данных и функции расширения `postgis` для управления топологическими объектами.
| 2.5.2 | 2.5.2 | 3.0.0 | 3.1.4 | 3.1.4 ||
|| [postgres_fdw]({{ pg-docs }}/static/postgres-fdw.html)
Добавляет поддержку [Foreign Data Wrapper](https://wiki.postgresql.org/wiki/Foreign_data_wrappers) для доступа к внешним серверам {{ PG }}.
Для использования расширения необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
| 1.0 | 1.0 | 1.0 | 1.0 | 1.1 ||
|| [rum](https://github.com/postgrespro/rum)
Добавляет метод доступа для работы с индексами `RUM`.
| 1.3 | 1.3 | 1.3 | 1.3 | 1.3 ||
|| [seg]({{ pg-docs }}/static/seg.html)
Содержит тип данных `seg` для представления отрезков линий или интервалов с плавающей запятой.
| 1.1 | 1.3 | 1.3 | 1.3 | 1.4 ||
|| [smlar](http://sigaev.ru/git/gitweb.cgi?p=smlar.git;a=blob;hb=HEAD;f=README)
Содержит набор функций для определения сходства массивов.
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [tablefunc](https://www.postgresql.org/docs/current/static/tablefunc.html)
Содержит набор функций, возвращающих таблицы (наборы строк).
| 1.0 | 1.0 | 1.0 | 1.0 | 1.0 ||
|| [timescaledb](https://github.com/timescale/timescaledb)
Добавляет возможности автоматического партицирования таблиц по времени и пространству (ключу партицирования), сохраняя при этом стандартный интерфейс {{ PG }} для работы с данными. Это позволяет масштабировать {{ PG }} для обработки временных рядов.
Требует [подключения библиотеки общего пользования](#libraries-connection) `timescaledb`.
| - | 2.3.1 | 2.4.2 | 2.5.2 | 2.6.1 ||
|| [unaccent]({{ pg-docs }}/static/unaccent.html)
Содержит словарь для поиска текста без учета диакритических знаков.
| 1.1 | 1.1 | 1.1 | 1.1 | 1.1 ||
|| [uuid-ossp]({{ pg-docs }}/static/uuid-ossp.html)
Содержит функции для генерации UUID по стандартным алгоритмам.
| 1.1 | 1.1 | 1.1 | 1.1 | 1.1 ||
|| [xml2]({{ pg-docs }}/static/xml2.html)
Добавляет поддержку запросов XPath и языка XSLT.
| 1.1 | 1.1 | 1.1 | 1.1 | 1.1 ||
|#

Утилита [pgcompacttable](https://github.com/dataegret/pgcompacttable) позволяет реорганизовать данные в таблицах, чтобы уменьшить занимаемый ими объем, без влияния на производительность кластера.

Синтаксис использования:

```bash
./bin/pgcompacttable -h c-<идентификатор кластера>.rw.{{ dns-zone }} -p 6432 -U <имя пользователя> -W <пароль> -d <имя БД> -n <имя схемы> -t <имя таблицы>
```

Требует включения расширения `pgstattuple`.

Для использования утилиты необходима [роль `mdb_admin`](../../concepts/roles.md#mdb-admin).
