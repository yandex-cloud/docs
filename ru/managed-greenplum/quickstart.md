# Как начать работать с {{ mgp-short-name }}

Чтобы начать работу с сервисом:

1. [Создайте кластер](#cluster-create).
1. [Подключитесь к кластеру](#connect).


## Перед началом работы {#before-you-begin}

1. Перейдите в [консоль управления]({{ link-console-main }}), затем войдите в {{ yandex-cloud }} или зарегистрируйтесь, если вы еще не зарегистрированы.
1. Если у вас еще нет каталога, создайте его:

    {% include [create-folder](../_includes/create-folder.md) %}

1. Подключаться к кластеру можно только изнутри {{ yandex-cloud }}. Для этого [создайте](../compute/operations/vm-create/create-linux-vm.md) промежуточную виртуальную машину на основе Linux в той же облачной сети, что и кластер {{ GP }}.
1. [Подключитесь](../compute/operations/vm-connect/ssh.md) к виртуальной машине по SSH.
1. Установите необходимые зависимости и клиент PostgreSQL:

    ```bash
    sudo apt update && sudo apt install postgresql-client --yes
    ```

## Создайте кластер {#cluster-create}

1. В консоли управления выберите каталог, в котором нужно создать кластер БД.
1. Выберите сервис **{{ mgp-name }}**.
1. Нажмите кнопку **Создать кластер**.

{% if state == "public-preview" %}

1. Введите имя кластера в поле **Имя кластера**. Оно должно быть уникальным в рамках каталога.
1. (Опционально) Введите описание кластера.
1. Выберите окружение, в котором нужно создать кластер (после создания кластера изменить окружение невозможно):
    * `PRODUCTION` — для стабильных версий ваших приложений.
    * `PRESTABLE` — для тестирования, в том числе самого сервиса {{ mgp-name }}. В Prestable-окружении раньше появляются новая функциональность, улучшения и исправления ошибок. При этом не все обновления обеспечивают обратную совместимость.
1. Выберите версию СУБД.
1. В блоке **Сетевые настройки**:
    * Выберите сеть.
    * Выберите подсети в каждой зоне доступности для этой сети. Чтобы [создать новую подсеть](../vpc/operations/subnet-create.md), нажмите кнопку **Создать новую** рядом с нужной зоной доступности.
    * В блоке **Группы безопасности** укажите [группу безопасности по умолчанию](../vpc/concepts/security-groups.md#default-security-group) — она уже содержит все необходимые для работы кластера настройки.

1. Укажите имя пользователя и пароль.

    {% include [username-and-password-limits](../_includes/mdb/mgp/note-info-user-name-and-pass-limits.md) %}

1. Укажите параметры хостов на вкладках **Master** и **Segment**.

    {% list tabs %}

    * Master

        * Укажите количество хостов-мастеров:

            * `1` — чтобы создать кластер без зеркалирования хоста-мастера;
            * `2` — чтобы создать кластер с зеркалированием хоста-мастера.

        * Укажите класс хоста — он определяет технические характеристики виртуальных машин, на которых будут развернуты хосты-мастеры кластера. При изменении этого параметра меняются характеристики всех уже созданных хостов-мастеров.
        * В блоке **Хранилище**:
            * Выберите тип хранилища — более гибкое сетевое (`network-hdd` или `network-ssd`) или более быстрое локальное хранилище (`local-ssd`).

                При выборе типа хранилища обратите внимание, что размер локального хранилища можно менять только с шагом 100 ГБ.

            * Выберите объем хранилища, который будет использоваться для данных.

    * Segment

        * Укажите количество хостов-сегментов.
        * Укажите количество сегментов на хост. Максимальное значение этого параметра зависит от класса хостов.
        * Укажите класс хоста — он определяет технические характеристики виртуальных машин, на которых будут развернуты хосты-сегменты кластера. При изменении этого параметра меняются характеристики всех уже созданных хостов-сегментов.
        * В блоке **Хранилище**:
            * Выберите тип хранилища — более гибкое сетевое (`network-hdd` или `network-ssd`) или более быстрое локальное хранилище (`local-ssd`).

                При выборе типа хранилища обратите внимание, что размер локального хранилища можно менять только с шагом 100 ГБ.

            * Выберите объем хранилища, который будет использоваться для данных.

    {% endlist %}

1. При необходимости задайте дополнительные настройки кластера:

    * **Начало резервного копирования (UTC)** — время по UTC, когда требуется начать резервное копирование кластера (в 24-часовом формате). Если время не задано, резерное копирование начнется в 22:00 UTC.

    * **Доступ из {{ datalens-name }}** — включите эту опцию, чтобы получить возможность анализировать данные из кластера в сервисе [{{ datalens-full-name }}](../datalens/concepts/index.md).

1. Нажмите кнопку **Создать кластер**.

{% else %}

1. Задайте параметры кластера и нажмите кнопку **Создать кластер**. Процесс подробно рассмотрен в разделе [{#T}](operations/cluster-create.md).

{% endif %}

1. Дождитесь, когда кластер будет готов к работе: его статус на панели {{ mgp-short-name }} сменится на **Running**, а состояние — на **Alive**. Это может занять некоторое время.


## Подключитесь к кластеру {#connect}

1. [Подключитесь](../compute/operations/vm-connect/ssh.md) к промежуточной виртуальной машине по SSH.

1. Подключитесь к хосту-мастеру кластера {{ GP }}, используя `psql`:

    ```bash
    psql --host <FQDN хоста-мастера> \
         --username <имя пользователя> \
         --dbname postgres
    ```

    Чтобы получить FQDN хоста-мастера:

    1. Перейдите на страницу каталога и выберите сервис **{{ mgp-name }}**.
    1. Нажмите на имя нужного кластера, затем выберите вкладку **Хосты**.

1. После успешного подключения выполните запрос:

    ```sql
    SELECT version();
    ```

    Кластер вернет используемые версии {{ PG }} и {{ GP }}.

{% if state != "public-preview" %}

## Что дальше {#whats-next}

* Изучите [концепции сервиса](./concepts/index.md).
* Узнайте подробнее о [создании кластера](./operations/cluster-create.md) и [подключении к кластеру](./operations/connect.md).

{% endif %}

{% include [greenplum-trademark](../_includes/mdb/mgp/trademark.md) %}
