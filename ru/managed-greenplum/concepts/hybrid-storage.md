---
title: Гибридное хранилище в {{ mgp-name }}
description: Как устроено гибридное хранилище в кластере {{ mgp-full-name }}.
---

# Гибридное хранилище в {{ mgp-name }}


{% note info %}

Функциональность находится на стадии [Preview](../../overview/concepts/launch-stages.md) и не тарифицируется.

{% endnote %}


В кластерах {{ mgp-name }} поддерживается _гибридное хранилище_: часть данных может находиться в хранилище кластера, а часть — в холодном хранилище. По умолчанию данные хранятся в хранилище кластера [на дисках выбранного типа](./storage.md). Данные, с которыми работают редко, но которые нужно хранить долго, можно перенести из хранилища кластера в холодное хранилище — в служебный бакет {{ objstorage-full-name }}. Так хранение [будет дешевле](../pricing/index.md#rules-storage).

Гибридное хранилище можно включить в кластерах {{ GP }} при [создании](../operations/cluster-create.md) или [изменении](../operations/update.md#change-additional-settings) кластера.

{% note warning %}

Включенное в кластере гибридное хранилище нельзя отключить.

{% endnote %}

## Область применения гибридного хранилища {#usage-scope}

Гибридное хранилище можно использовать только для таблиц, которые [оптимизированы для добавления](./tables.md) (append-optimized). При переносе данных между хранилищем кластера и холодным хранилищем переносятся таблицы целиком. Для работы с таблицами используется [расширение {{ YZ }}](https://github.com/open-gpdb/yezzey), разработанное {{ yandex-cloud }}.

Данные таблиц, оптимизированных для добавления, хранятся в виде набора сегментных файлов в сжатом и зашифрованном виде в служебном бакете {{ objstorage-name }}. Количество сегментных файлов зависит от количества сегментов в кластере и от структуры таблицы.

## Управление вводом-выводом при использовании гибридного хранилища {#io-planning}

При выполнении SQL-запросов к таблицам, оптимизированным для добавления, происходит множество обращений к сегментным файлам в хранилище. Время выполнения SQL-запросов зависит от того, насколько эффективно планируются запросы ввода-вывода к сегментным файлам. Если не планировать запросы ввода-вывода, то страдает производительность хранилища, увеличивается потребление оперативной памяти и время выполнения SQL-запросов. Использование планировщика позволяет защитить кластер от деградации производительности при выполнении SQL-запросов, требующих обработки большого количества данных.

Когда данные хранятся в хранилище кластера, планированием запросов ввода-вывода занимается операционная система на хостах кластера.

Когда данные хранятся в холодном хранилище, операционная система не может планировать запросы ввода-вывода к служебному бакету {{ objstorage-name }}. Поэтому, чтобы избежать деградации производительности, в кластерах {{ mgp-name }} планированием таких запросов занимается специальный прокси YProxy, разработанный {{ yandex-cloud }}. Благодаря использованию YProxy, даже если таблица размещена в холодном хранилище, то это оказывает минимальное влияние на время выполнения SQL-запросов.

Подробнее про архитектуру гибридного хранилища читайте в [статье на Хабре](https://habr.com/ru/companies/yandex_cloud_and_infra/articles/831780/). В статье также приводятся тесты производительности для разных типов хранилищ.

## Примеры использования {#examples}

* [{#T}](../tutorials/yezzey.md)

{% include [greenplum-trademark](../../_includes/mdb/mgp/trademark.md) %}
