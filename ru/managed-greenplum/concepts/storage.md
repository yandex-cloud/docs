# Типы дисков в {{ mgp-name }}

{% if audience != "internal" %}

{{ mgp-name }} позволяет использовать сетевые и локальные диски для организации хранилища кластеров баз данных. Сетевые диски реализованы на базе сетевых блоков — виртуальных дисков в инфраструктуре {{ yandex-cloud }}. Локальные диски физически размещаются в серверах кластера.

{% include [storage-type](../../_includes/mdb/mgp/storage-type.md) %}

В кластере {{ mgp-name }} тип дисков у хостов-мастеров и хостов-сегментов может отличаться.

{% include [ice-lake-local-ssd-note](../../_includes/ice-lake-local-ssd-note.md) %}

## Особенности хранилища на локальных SSD-дисках {#local-storage-features}

Хранилище на локальных SSD-дисках не обеспечивает отказоустойчивости хранения данных, а также влияет на тарификацию кластера в целом: кластер с таким хранилищем тарифицируется, даже если он остановлен. Подробнее — в [правилах тарификации](../pricing).

{% else %}

{{ mgp-name }} позволяет использовать для кластеров баз данных хранилище на локальных дисках. Локальные диски физически размещаются в серверах хостов БД.

При создании кластера вы можете выбрать для хранилища следующие типы дисков:

* Локальные SSD-диски (`local-ssd`) — самые быстрые диски. Объем такого хранилища — от 10 до 2048 ГБ.
* Стандартные локальные диски (`local-hdd`) — более медленные, но вместительные диски. Доступны только для хостов с процессорами на платформах Ice Lake или Cascade Lake и имеющих не меньше восьми vCPU.

{% endif %}

## Управление дисковым пространством {#manage-storage-space}

При заполнении хранилища любого хоста более чем на 95% кластер автоматически переходит в режим read-only. При этом для всех баз данных через запрос `ALTER DATABASE` выставляется настройка `DEFAULT_TRANSACTION_READ_ONLY = TRUE`.

В этом режиме запросы на вставку (`INSERT`), удаление (`DELETE`) или обновление (`UPDATE`) данных завершаются ошибкой.

{% if audience == "external" %}

### Отслеживание перехода в read-only {#read-only-monitor}

Чтобы отслеживать степень заполнения хранилища на хостах кластера, настройте алерты в {{ monitoring-full-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{ monitoring-name }}**.
1. Выберите сервис **{{ mgp-name }}**.
1. [Создайте канал уведомлений](../../monitoring/operations/alert/create-channel.md).
1. [Создайте алерт](../../monitoring/operations/alert/create-alert.md) со следующими параметрами:

    1. **Метрика** — задайте параметры метрики:

        * облако;
        * каталог;
        * сервис **{{ mgp-name }}**;
        * идентификатор кластера {{ mgp-name }};

            Идентификатор кластера можно [получить со списком кластеров в каталоге](../operations/cluster-list.md#list-clusters).

        * метка `disk.free_bytes`.

    1. **Условие срабатывания** — задайте условие `Меньше или равно` для процента заполнения свободного дискового пространства, при котором сработает алерт:

        * 95% от размера хранилища для `Alarm`;
        * 90% от размера хранилища для `Warning`.

    1. **Дополнительные настройки**:

        * **Функция агрегации** — `Минимум` (минимальное значение метрики за период).
        * **Окно вычисления** — желаемый период, с которым будет обновляться значение метрики.

    1. Добавьте созданный ранее канал уведомлений.

{% endif %}

### Вывод кластера из режима read-only {#read-only-solutions}

Если кластер перешел в режим read-only:

* [Увеличьте размер хранилища](../operations/update.md#change-disk-size), чтобы выйти за пороговое значение. Тогда {{ yandex-cloud }} снимет режим read-only автоматически.

* Вручную отключите режим read-only и освободите место в хранилище, удалив часть данных.

    {% note alert %}

    Не допускайте, чтобы в процессе этих действий свободное дисковое пространство уменьшилось до нуля. Поскольку предохранительный механизм отключен, {{ GP }} в этом случае аварийно завершит работу, а кластер станет неработоспособным.

    {% endnote %}

Чтобы отключить режим read-only вручную, обратитесь в [техническую поддержку]({{ link-console-support }}) или следуйте инструкции:

1. [Подключитесь к БД](../operations/connect.md) любым удобным способом.

1. Откройте транзакцию и внутри нее выполните команду:

   ```sql
   SET LOCAL transaction_read_only TO off;
   ```

1. В рамках этой же транзакции удалите ненужные данные с помощью операторов `DROP` или `TRUNCATE`. Не используйте оператор `DELETE` — при его использовании строки отмечаются как удаленные, но не удаляются из базы физически.

1. Зафиксируйте транзакцию и перезапустите все подключения к базе.

> Например, если ваша база содержит ненужную таблицу `ExcessDataTable1`, удалите ее с помощью транзакции:
>
> ```sql
> BEGIN;
> SET LOCAL transaction_read_only TO off;
> DROP TABLE ExcessDataTable1;
> COMMIT;
> ```

{% include [greenplum-trademark](../../_includes/mdb/mgp/trademark.md) %}
