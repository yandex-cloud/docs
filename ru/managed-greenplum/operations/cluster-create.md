# Создание кластера

Кластер {{ mgp-name }} состоит из хостов-мастеров, которые принимают запросы от клиента, и хостов-сегментов, которые обеспечивают обработку и хранение данных.

Подробнее см. в разделе [{#T}](../concepts/index.md).

## Как создать кластер {{ mgp-name }} {#create-cluster}

{% list tabs %}

- Консоль управления

    1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором нужно создать кластер баз данных.
    1. Выберите сервис **{{ mgp-name }}**.
    1. Нажмите кнопку **Создать кластер**.
    1. Введите имя кластера. Оно должно быть уникальным в рамках каталога.
    1. (опционально) Введите описание кластера.
    1. Выберите окружение, в котором нужно создать кластер (после создания кластера окружение изменить невозможно):
        * `PRODUCTION` — для стабильных версий ваших приложений.
        * `PRESTABLE` — для тестирования, в том числе самого сервиса {{ mgp-full-name }}. В Prestable-окружении раньше появляются новые функциональные возможности, улучшения и исправления ошибок. При этом не все обновления обеспечивают обратную совместимость.
    1. Выберите версию {{ GP }}.

    {% if product == "yandex-cloud" %}

    1. (опционально) Выберите группы [выделенных хостов](../../compute/concepts/dedicated-host.md), на которых будет размещен кластер.
       
        {% include [Dedicated hosts note](../../_includes/mdb/mgp/note-dedicated-hosts.md) %}

    {% endif %}

    1. В блоке **Сетевые настройки**:
        * Выберите облачную сеть для размещения кластера.
        * В параметре **Группы безопасности** укажите [группу безопасности](../operations/connect.md#configuring-security-groups), которая содержит правила, разрешающие любой исходящий и входящий трафик по любому протоколу с любых IP-адресов.

            {% note alert %}

            Для корректной работы кластера {{ mgp-name }} необходимо, чтобы хотя бы в одной из его групп безопасности были правила, разрешающие любой входящий и исходящий трафик с любых IP-адресов.

            {% endnote %}

        * Выберите зону доступности и подсеть для размещения кластера. Чтобы создать новую подсеть, нажмите кнопку **Создать новую** рядом с нужной зоной доступности.
        * Выберите опцию **Публичный доступ**, чтобы подключаться к кластеру из интернета.
    1. Укажите настройки пользователя-администратора. Это специальный пользователь, который необходим для управления кластером и не может быть удален. Подробнее в разделе [{#T}](../concepts/cluster-users.md).

        * **Имя пользователя** — может содержать латинские буквы, цифры, дефис и нижнее подчеркивание, но не может начинаться с дефиса. Длина от 1 до 32 символов.

            {% note info %}

            Имена `admin`, `gpadmin`, `mdb_admin`, `mdb_replication`, `monitor`, `none`, `postgres`, `public`, `repl` зарезервированы для собственных нужд {{ mgp-name }}. Создавать пользователей с этими именами нельзя.

            {% endnote %}

        * **Пароль** — длина от 8 до 128 символов.

    1. При необходимости задайте дополнительные настройки кластера:

        * {% include [Backup time](../../_includes/mdb/console/backup-time.md) %}
        * {% include [Maintenance window](../../_includes/mdb/console/maintenance-window.md) %}
        * {% include [Datalens access](../../_includes/mdb/console/datalens-access.md) %}
        * {% include [DataTransfer access](../../_includes/mdb/console/datatransfer-access.md) %}
        * {% include [Deletion protection](../../_includes/mdb/console/deletion-protection.md) %}

            {% include [Ограничения защиты от удаления](../../_includes/mdb/deletion-protection-limits-db.md) %}

    1. Укажите параметры хостов-мастеров на вкладке **Master**. Рекомендуемую конфигурацию см. в разделе [Расчет конфигурации кластера](calculate-specs.md#master).

        * Класс хоста — определяет технические характеристики виртуальных машин, на которых будут развернуты хосты-мастеры кластера.
<<<<<<< HEAD
        * В блоке **Хранилище**:
           * Выберите [тип хранилища](../concepts/storage.md).

             {% include [storages-step-settings](../../_includes/mdb/settings-storages-no-broadwell.md) %}

           * Выберите объем хранилища, который будет использоваться для данных.
=======
>>>>>>> develop

    1. Укажите параметры хостов-сегментов на вкладке **Segment**. Рекомендуемую конфигурацию см. в разделе [Расчет конфигурации кластера](calculate-specs.md#segment).

        * Количество хостов-сегментов.
        * Количество сегментов на хост. Максимальное значение этого параметра зависит от класса хостов.
        * Класс хоста — определяет технические характеристики виртуальных машин, на которых будут развернуты хосты-сегменты кластера.
<<<<<<< HEAD
        * В блоке **Хранилище**:
           * Выберите [тип хранилища](../concepts/storage.md).

             {% include [storages-step-settings](../../_includes/mdb/settings-storages-no-broadwell.md) %}
=======

    1. В блоке **Хранилище**:

        * Выберите [тип хранилища](../concepts/storage.md).
           
            {% include [storages-step-settings](../../_includes/mdb/settings-storages-no-broadwell.md) %}
>>>>>>> develop

        * Выберите объем хранилища, который будет использоваться для данных.

    1. Нажмите кнопку **Создать**.

- API

    Воспользуйтесь методом API [create](../api-ref/Cluster/create.md) и передайте в запросе:

    * Идентификатор каталога, в котором должен быть размещен кластер, в параметре `folderId`.
    * Имя кластера в параметре `name`.
    * Окружение кластера в параметре `environment`.
    * Версию {{ GP }} в параметре `config.version`.
    * Имя пользователя в параметре `userName`.
    * Пароль пользователя в параметре `userPassword`.
    * Идентификатор сети в параметре `networkId`.
    * Идентификаторы [групп безопасности](../concepts/network.md#security-groups) в параметре `securityGroupIds`.
    * Конфигурацию хостов-мастеров в параметре `masterConfig`.
    * Конфигурацию хостов-сегментов в параметре `segmentConfig`.

    При необходимости передайте дополнительные настройки кластера:

    * Настройки публичного доступа в параметре `assignPublicIp`.
    * Настройки окна резервного копирования в параметре `config.backupWindowStart`.
    * Настройки доступа из [{{ datalens-full-name }}](../../datalens/concepts/index.md) в параметре `config.access.dataLens`.
    * {% include [Maintenance window](../../_includes/mdb/api/maintenance-window.md) %}
    * Настройки защиты от удаления кластера в параметре `deletionProtection`.

        {% include [deletion-protection-limits-db](../../_includes/mdb/deletion-protection-limits-db.md) %}

{% endlist %}

{% include [greenplum-trademark](../../_includes/mdb/mgp/trademark.md) %}
