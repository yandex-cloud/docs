# Изменение настроек PXF

Настройки [PXF](../external-tables.md), которые можно задать средствами {{ yandex-cloud }}, совпадают с настройками в конфигурационном файле {{ GP }} [pxf-application.properties]({{ gp.docs.vmware }}-Platform-Extension-Framework/6.9/greenplum-platform-extension-framework/config_files.html#pxfapplicationproperties-1). Он описывает свойства протокола PXF. В кластере {{ GP }} для настроек PXF заданы значения по умолчанию. Чтобы оптимизировать работу с [внешними таблицами](../../concepts/external-tables.md), вы можете изменить настройки PXF с помощью интерфейсов {{ yandex-cloud }} вместо правки файла.

{% list tabs group=instructions %}

- Консоль управления {#console}

    Чтобы изменить настройки PXF:

    1. Перейдите [на страницу каталога]({{ link-console-main }}) и выберите сервис **{{ ui-key.yacloud.iam.folder.dashboard.label_managed-greenplum }}**.
    1. Нажмите на имя нужного кластера и выберите на панели слева ![image](../../../_assets/console-icons/arrow-right-arrow-left.svg) **{{ ui-key.yacloud.greenplum.label_pxf }}**.
    1. Нажмите кнопку ![image](../../../_assets/console-icons/pencil.svg) **{{ ui-key.yacloud.greenplum.cluster.pxf.action_edit-settings }}** в верхней части страницы.
    1. Измените настройки:

        * **Connection Timeout** — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на чтение. Диапазон значений: от `5` до `600` секунд. Значение можно указать в разных единицах времени.
        * **Upload Timeout** — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на запись. Диапазон значений: от `5` до `600` секунд. Значение можно указать в разных единицах времени.
        * **Max Threads** — максимальное количество потоков Apache Tomcat®. Диапазон значений: от `1` до `1024`.

            Чтобы предотвратить ситуации, когда запросы зависают или не выполняются из-за перерасхода памяти или некорректной работы сборщика мусора Java, задайте количество потоков Apache Tomcat®. О регулировке числа потоков читайте в документации [VMware {{ GP }} Platform Extension Framework]({{ gp.docs.vmware }}-Platform-Extension-Framework/6.9/greenplum-platform-extension-framework/cfg_mem.html).

        * **Pool Allow Core Thread Timeout** — разрешен ли таймаут для стриминговых потоков ядра приложения (core streaming threads).
        * **Pool Core Size** — количество стриминговых потоков ядра в пуле. Диапазон значений: от `1` до `1024`.
        * **Pool Queue Capacity** — максимальное количество запросов, которое можно добавить в очередь в пул за стриминговыми потоками ядра. Диапазон значений: от нуля и выше. При значении `0` очередь в пул не образуется.
        * **Pool Max Size** — максимально допустимое количество стриминговых потоков ядра. Диапазон значений: от `1` до `1024`.
        * **Xmx** — изначальный размер JVM-кучи для демона PXF. Диапазон значений: от `64` до `16384` МБ. Значение можно указать в разных единицах измерения.
        * **Xms** — максимальный размер JVM-кучи для демона PXF. Диапазон значений: от `64` до `16384` МБ. Значение можно указать в разных единицах измерения.

    1. Нажмите кнопку **{{ ui-key.yacloud.common.save }}**.

- CLI {#cli}

    {% include [cli-install](../../../_includes/cli-install.md) %}

    {% include [default-catalogue](../../../_includes/default-catalogue.md) %}

    Чтобы изменить настройки PXF:

    1. Посмотрите описание команды CLI для изменения конфигурации кластера:

        ```bash
        {{ yc-mdb-gp }} cluster update --help
        ```

    1. Задайте настройки PXF:

        ```bash
        {{ yc-mdb-gp }} cluster update <имя_или_идентификатор_кластера> \
           --pxf-connection-timeout=<таймаут_для_запросов_на_чтение> \
           --pxf-upload-timeout=<таймаут_для_запросов_на_запись> \
           --pxf-max-threads=<максимальное_число_потоков_Apache_Tomcat®> \
           --pxf-pool-allow-core-thread-timeout=<разрешен_ли_таймаут_для_стриминговых_потоков> \
           --pxf-poll-core-size=<количество_стриминговых_потоков> \
           --pxf-pool-queue-capacity=<емкость_очереди_в_пул_за_стриминговыми_потоками> \
           --pxf-pool-max-size=<максимальное_число_стриминговых_потоков> \
           --pxf-xmx=<изначальный_размер_JVM-кучи> \
           --pxf-xms=<максимальный_размер_JVM-кучи>
        ```

        Где:

        * `pxf-connection-timeout` — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на чтение (в секундах). Диапазон значений: от `5` до `600`.
        * `pxf-upload-timeout` — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на запись (в секундах). Диапазон значений: от `5` до `600`.
        * `pxf-max-threads` — максимальное количество потоков Apache Tomcat®. Диапазон значений: от `1` до `1024`.

            Чтобы предотвратить ситуации, когда запросы зависают или не выполняются из-за перерасхода памяти или некорректной работы сборщика мусора Java, задайте количество потоков Apache Tomcat®. О регулировке числа потоков читайте в документации [VMware {{ GP }} Platform Extension Framework]({{ gp.docs.vmware }}-Platform-Extension-Framework/6.9/greenplum-platform-extension-framework/cfg_mem.html).

        * `pxf-pool-allow-core-thread-timeout` — разрешен ли таймаут для стриминговых потоков ядра приложения (core streaming threads). Значение по умолчанию: `false`.
        * `pxf-poll-core-size` — количество стриминговых потоков ядра в пуле. Диапазон значений: от `1` до `1024`.
        * `pxf-pool-queue-capacity` — максимальное количество запросов, которое можно добавить в очередь в пул за стриминговыми потоками ядра. Диапазон значений: от нуля и выше. При значении `0` очередь в пул не образуется.
        * `pxf-pool-max-size` — максимально допустимое количество стриминговых потоков ядра. Диапазон значений: от `1` до `1024`.
        * `pxf-xmx` — изначальный размер JVM-кучи для демона PXF (в мегабайтах). Диапазон значений: от `64` до `16384`.
        * `pxf-xms` — максимальный размер JVM-кучи для демона PXF (в мегабайтах). Диапазон значений: от `64` до `16384`.

        Имя кластера можно [получить со списком кластеров в каталоге](../cluster-list.md#list-clusters).

- {{ TF }} {#tf}

    Чтобы изменить настройки PXF:

    1. Откройте актуальный конфигурационный файл {{ TF }} с планом инфраструктуры.

        О том, как создать такой файл, см. в разделе [{#T}](../cluster-create.md).

        Полный список доступных для изменения полей конфигурации кластера {{ mgp-name }} см. в [документации провайдера {{ TF }}]({{ tf-provider-mgp }}).

    1. В описании кластера, в блоке `pxf_config`, задайте настройки PXF:

        ```hcl
        resource "yandex_mdb_greenplum_cluster" "<имя_кластера>" {
          ...
          pxf_config {
            connection_timeout             = <таймаут_для_запросов_на_чтение>
            upload_timeout                 = <таймаут_для_запросов_на_запись>
            max_threads                    = <максимальное_число_потоков_Apache_Tomcat®>
            pool_allow_core_thread_timeout = <разрешен_ли_таймаут_для_стриминговых_потоков>
            pool_core_size                 = <количество_стриминговых_потоков>
            pool_queue_capacity            = <емкость_очереди_в_пул_за_стриминговыми_потоками>
            pool_max_size                  = <максимальное_число_стриминговых_потоков>
            xmx                            = <изначальный_размер_JVM-кучи>
            xms                            = <максимальный_размер_JVM-кучи>
          }
        }
        ```

        Где:

        * `connection_timeout` — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на чтение (в секундах). Диапазон значений: от `5` до `600`.
        * `upload_timeout` — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на запись (в секундах). Диапазон значений: от `5` до `600`.
        * `max_threads` — максимальное количество потоков Apache Tomcat®. Диапазон значений: от `1` до `1024`.

            Чтобы предотвратить ситуации, когда запросы зависают или не выполняются из-за перерасхода памяти или некорректной работы сборщика мусора Java, задайте количество потоков Apache Tomcat®. О регулировке числа потоков читайте в документации [VMware {{ GP }} Platform Extension Framework]({{ gp.docs.vmware }}-Platform-Extension-Framework/6.9/greenplum-platform-extension-framework/cfg_mem.html).

        * `pool_allow_core_thread_timeout` — разрешен ли таймаут для стриминговых потоков ядра приложения (core streaming threads). Значение по умолчанию: `false`.
        * `pool_core_size` — количество стриминговых потоков ядра в пуле. Диапазон значений: от `1` до `1024`.
        * `pool_queue_capacity` — максимальное количество запросов, которое можно добавить в очередь в пул за стриминговыми потоками ядра. Диапазон значений: от нуля и выше. При значении `0` очередь в пул не образуется.
        * `pool_max_size` — максимально допустимое количество стриминговых потоков ядра. Диапазон значений: от `1` до `1024`.
        * `xmx` — изначальный размер JVM-кучи для демона PXF (в мегабайтах). Диапазон значений: от `64` до `16384`.
        * `xms` — максимальный размер JVM-кучи для демона PXF (в мегабайтах). Диапазон значений: от `64` до `16384`.

    1. Проверьте корректность настроек.

        {% include [terraform-validate](../../../_includes/mdb/terraform/validate.md) %}

    1. Подтвердите изменение ресурсов.

        {% include [terraform-apply](../../../_includes/mdb/terraform/apply.md) %}

- API {#api}

    Чтобы изменить настройки PXF, воспользуйтесь методом REST API [update](../../api-ref/Cluster/update.md) для ресурса [Cluster](../../api-ref/Cluster/index.md) или вызовом gRPC API [ClusterService/Update](../../api-ref/grpc/Cluster/update.md) и передайте в запросе:

    * Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](../cluster-list.md#list-clusters).
    * Список изменяемых настроек PXF в параметре `configSpec.pxfConfig`:

        * `connectionTimeout` — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на чтение (в секундах). Диапазон значений: от `5` до `600`.
        * `uploadTimeout` — таймаут подключения к серверу Apache Tomcat® во время выполнения запросов на запись (в секундах). Диапазон значений: от `5` до `600`.
        * `maxThreads` — максимальное количество потоков Apache Tomcat®. Диапазон значений: от `1` до `1024`.

            Чтобы предотвратить ситуации, когда запросы зависают или не выполняются из-за перерасхода памяти или некорректной работы сборщика мусора Java, задайте количество потоков Apache Tomcat®. О регулировке числа потоков читайте в документации [VMware {{ GP }} Platform Extension Framework]({{ gp.docs.vmware }}-Platform-Extension-Framework/6.9/greenplum-platform-extension-framework/cfg_mem.html).

        * `poolAllowCoreThreadTimeout` — разрешен ли таймаут для стриминговых потоков ядра приложения (core streaming threads). Значение по умолчанию: `false`.
        * `poolCoreSize` — количество стриминговых потоков ядра в пуле. Диапазон значений: от `1` до `1024`.
        * `poolQueueCapacity` — максимальное количество запросов, которое можно добавить в очередь в пул за стриминговыми потоками ядра. Диапазон значений: от нуля и выше. При значении `0` очередь в пул не образуется.
        * `poolMaxSize` — максимально допустимое количество стриминговых потоков ядра. Диапазон значений: от `1` до `1024`.
        * `xmx` — изначальный размер JVM-кучи для демона PXF (в мегабайтах). Диапазон значений: от `64` до `16384`.
        * `xms` — максимальный размер JVM-кучи для демона PXF (в мегабайтах). Диапазон значений: от `64` до `16384`.

    * Список изменяемых полей конфигурации кластера в параметре `updateMask`.

    {% include [note-api-updatemask](../../../_includes/note-api-updatemask.md) %}

{% endlist %}

{% include [greenplum-trademark](../../../_includes/mdb/mgp/trademark.md) %}
