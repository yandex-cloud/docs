# Управление ресурсными группами

Вы можете управлять квотами на использование ресурсов кластера при помощи [ресурсных групп](../concepts/resource-groups.md). Для этого [подключитесь к кластеру](connect.md) от имени пользователя с [ролью](../concepts/cluster-users.md) `mdb_admin`.

## Посмотреть информацию о ресурсных группах {#info}

Чтобы посмотреть список ресурсных групп и значения их [параметров](../concepts/resource-groups.md#rg-params), выполните команду:

```sql
SELECT * FROM gp_toolkit.gp_resgroup_config;
```

Чтобы посмотреть список ролей и ресурсные группы, к которым они относятся, выполните команду:

```sql
SELECT rolname, rsgname FROM pg_roles, pg_resgroup
WHERE pg_roles.rolresgroup=pg_resgroup.oid;
```

## Создать ресурсную группу {#create}

Передайте имя ресурсной группы и ее [параметры](../concepts/resource-groups.md#rg-params) в команде:

```sql
CREATE RESOURCE GROUP <имя ресурсной группы> WITH (<параметр 1>, <параметр 2>, ...);
```

При создании ресурсной группы достаточно указать значение параметра `CPU_RATE_LIMIT` или `CPUSET`. Для остальных параметров будут применены значения по умолчанию.


## Назначить ресурсную группу для роли {#assign}

Чтобы создать роль и сразу назначить ей ресурсную группу, выполните команду:

```sql
CREATE ROLE <имя роли> RESOURCE GROUP <имя ресурсной группы>;
```

{% note info %}

По умолчанию новые роли попадают в ресурсную группу `default_group`.

{% endnote %}

Чтобы назначить для роли другую ресурсную группу, выполните команду:

```sql
ALTER ROLE <имя роли> RESOURCE GROUP <имя ресурсной группы>;
```

## Посмотреть текущую загрузку ресурсных групп {#load}

{% list tabs %}

* Во всем кластере

    ```sql
    SELECT * FROM gp_toolkit.gp_resgroup_status;
    ```

* На каждом хосте

    ```sql
    SELECT * FROM gp_toolkit.gp_resgroup_status_per_host;
    ```

* В каждом сегменте

    ```sql
    SELECT * FROM gp_toolkit.gp_resgroup_status_per_segment;
    ```

{% endlist %}

## Посмотреть список запросов в ресурсных группах {#queries}

Чтобы посмотреть список запросов на выполнении и в очереди, выполните команду:

```sql
SELECT query, waiting, rsgname, rsgqueueduration 
FROM pg_stat_activity;
```

## Изменить параметры ресурсной группы {#params}

Выполните команду:

```sql
ALTER RESOURCE GROUP <имя ресурсной группы> SET <имя параметра> <новое значение параметра>;
```

## Удалить ресурсную группу {#delete}

Ресурсную группу можно удалить, только если она не назначена никаким ролям и не содержит транзакций в очереди или на обработке.

Чтобы удалить ресурсную группу, выполните команду:

```sql
DROP RESOURCE GROUP <имя ресурсной группы>; 
```


## Пример создания ресурсной группы {#example}

Создайте ресурсную группу с тестовыми характеристиками:

* Имя `testgroup`.
* Максимальное количество обрабатываемых транзакций — 15.
* Доля используемых ресурсов CPU в сегменте — 10%.
* Доля оперативной памяти в сегменте — 20%.
* Доля, выделенная в качестве общей квоты, — 50%.
* Доля оперативной памяти в ресурсной группе, которую может занимать один оператор транзакции, — 30%.

Выполните команду:

```sql
CREATE RESOURCE GROUP testgroup
WITH (CONCURRENCY=15, CPU_RATE_LIMIT=10, MEMORY_LIMIT=20, MEMORY_SHARED_QUOTA=50, MEMORY_SPILL_RATIO=30);
```

Проверьте, что новая ресурсная группа появилась в списке:

```sql
SELECT * FROM gp_toolkit.gp_resgroup_config;
```


{% include [greenplum-trademark](../../_includes/mdb/mgp/trademark.md) %}
