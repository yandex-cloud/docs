# Расчет конфигурации кластера

В этом разделе приведены рекомендации для расчета оптимальной конфигурации кластера для типовой нагрузки при использовании {{ mgp-name }} в качестве корпоративного [хранилища данных]{% if lang == "ru" %}(https://ru.wikipedia.org/wiki/Хранилище_данных){% endif %}{% if lang == "en" %}(https://en.wikipedia.org/wiki/Data_storage){% endif %}.

## Конфигурация хостов-сегментов {#segment}

Хосты-сегменты предназначены для хранения данных и обработки запросов к ним, поэтому требовательны к ресурсам. При выборе конфигурации хостов-сегментов отталкивайтесь от предполагаемого объема хранимых данных без учета сжатия (в гигабайтах).

* Рекомендуемый размер хранилища для хостов-сегментов:

    ```text
    <объем данных без сжатия> × 1,5
    ```

    Формула справедлива при использовании стандартного сжатия (zstd) первого уровня (см. раздел [Создание колоночных таблиц](../concepts/tables.md#create-columnar-table)). Она учитывает [зеркалирование данных](../concepts/index.md), пространство под временные файлы при выполнении тяжелых запросов и свободное пространство, необходимое СУБД.

* Рекомендуемый суммарный объем оперативной памяти хостов-сегментов:

    ```text
    <объем данных без сжатия> ÷ 8
    ```

* Рекомендуемое суммарное количество ядер vCPU хостов-сегментов:

    ```text
    <объем данных без сжатия> ÷ 80
    ```

* Количество хостов-сегментов в кластере не принципиально, если их суммарные характеристики не ниже рассчитанных значений. При масштабировании кластера:

    * Рекомендуемое количество сегментов на хост:

        ```text
        <количество ядер vCPU на одном хосте-сегменте> ÷ 2
        ```

        При таком значении каждому сегменту выделяется одно ядро vCPU, и еще по одному ядру задействуют реплики — их количество совпадает с количеством сегментов. Задать большее значение нельзя.

    * Новые хосты будут иметь ту же конфигурацию (объем памяти, количество ядер vCPU и количество сегментов на хост), что и хосты-сегменты при создании кластера.
    * Нельзя добавить менее двух новых хостов-сегментов.

> Например, для хранения и обработки 20 480 ГБ (20 ТБ) несжатых данных понадобится кластер со следующими характеристиками хостов-сегментов:
>
> * Размер хранилища: 20 480 ГБ × 1,5 = 30 720 ГБ.
> * Объем оперативной памяти: 20 480 ГБ ÷ 8 = 2 560 ГБ.
> * Количество ядер vCPU: 20 480 ГБ ÷ 80 = 256.
> * Количество сегментов на хост: 256 ÷ 2 =128.
>
> Это соответствует, например, двадцати хостам `{{ i2.2xlarge }}` или десяти хостам `{{ i2.4xlarge }}`. Подробнее о классах хостов см. в разделе [Доступные классы хостов](../concepts/instance-types.md#available-flavors).

## Конфигурация хостов-мастеров {#master}

Хосты-мастеры предназначены для обработки подключений и координации работы сегментов. Такие хосты не хранят и не обрабатывают данные, поэтому они менее требовательны к производительности.

Для хостов-мастеров рекомендуется использовать тот же [тип дисков](../concepts/storage.md), что и для хостов-сегментов.

{% include [greenplum-trademark](../../_includes/mdb/mgp/trademark.md) %}
