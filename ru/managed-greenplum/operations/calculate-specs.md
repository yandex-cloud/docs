# Расчет конфигурации кластера

В этом разделе приведены рекомендации для расчета оптимальной конфигурации кластера для типовой нагрузки при использовании {{ mgp-name }} в качестве корпоративного [хранилища данных](https://ru.wikipedia.org/wiki/Хранилище_данных).

{% note info %}

В других сценариях использования сервиса рекомендуемые параметры и формулы расчета могут отличаться: например, при наличии большого объема архивных данных или более интенсивной обработке данных.

{% endnote %}

## Конфигурация хостов-сегментов {#segment}

Хосты-сегменты занимаются непосредственно хранением данных и обработкой запросов к ним, поэтому требовательны к ресурсам. При выборе конфигурации хостов-сегментов рекомендуем отталкиваться от предполагаемого объема хранимых данных без учета сжатия (в гигабайтах).

* Рекомендуемый размер хранилища для хостов-сегментов равен:

    ```
    <объем данных без сжатия> × 1,5
    ```

    Полученный размер верен при использовании стандартного сжатия (zstd) первого уровня (см. раздел [Создание колоночных таблиц](../concepts/tables.md#create-columnar-table)). Он также учитывает зеркалирование данных, пространство под временные файлы при выполнении тяжелых запросов и свободное пространство, необходимое СУБД.

* Рекомендуемый суммарный объем оперативной памяти хостов-сегментов равен:

    ```
    <объем данных без сжатия> ÷ 8
    ```

* Рекомендуемое суммарное количество ядер vCPU хостов-сегментов равен:

    ```
    <объем данных без сжатия> ÷ 80
    ```

* Рекомендуемое количество сегментов на хост равно:

    ```
    <количество ядер vCPU на одном хосте-сегменте> ÷ 2
    ```

  Это максимальное количество сегментов, которое может быть на одном хосте. В таком случае каждому сегменту выделяется одно ядро vCPU, и еще по одному ядру задействуют реплики — их количество совпадает с количеством сегментов.

> Например, для хранения и обработки 20 480 ГБ (20 ТБ) несжатых данных понадобится кластер со следующими характеристиками хостов-сегментов:
>
> * Размер хранилища: 30 720 ГБ;
> * Объем оперативной памяти: 2 560 ГБ;
> * Количество ядер vCPU: 256.
>
> Это соответствует, например, десяти хостам класса `{{ m2-4xlarge }}` или пяти хостам `{{ m2-8xlarge }}`. Подробнее о классах хостов см. в разделе [Доступные классы хостов](../concepts/instance-types.md#available-flavors).

Количество хостов-сегментов в кластере не принципиально, если их суммарные характеристики не ниже рассчитанных значений, но учтите, что при масштабировании кластера:

* Новые хосты будут иметь ту же конфигурацию (объем памяти, количество ядер vCPU и количество сегментов на хост), что и хосты-сегменты при создании кластера.
* Минимальное количество новых хостов-сегментов при добавлении — 2.

## Конфигурация хостов-мастеров {#master}

Хосты-мастера не хранят и не обрабатывают данные — они занимаются только обработкой подключений и координацией работы сегментов и менее требовательны к производительности, поэтому здесь приведены лишь некоторые рекомендации по их настройке.

* Рекомендуемое количество хостов: 2.

  Кластер с двумя хостами-мастерами в случае отказа одного из них продолжает обрабатывать запросы. Кластер с единственным хостом-мастером отказоустойчивости не обеспечивает.

* Рекомендуется использовать тот же [тип хранилища](../concepts/storage.md), что и для хостов-сегментов.

{% include [greenplum-trademark](../../_includes/mdb/mgp/trademark.md) %}