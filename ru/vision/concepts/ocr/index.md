---
description: "OCR (Optical Character Recognition) – это оптическое распознавание текста. Сервис выделяет найденный текст на изображении и группирует его по уровням слова группируются в строки, строки в блоки, блоки в страницы. Для распознавания текста используется языковая модель, обученная на определенном наборе языков."
---

# Оптическое распознавание текста (OCR)

В этом разделе описано, как работает возможность _распознавание текста_ (Optical Character Recognition, OCR).

## Подготовка запроса на распознавание {#request}

В запросе вы указываете список [возможностей для анализа](../index.md#features), которые необходимо применить к изображению. Чтобы распознать текст, используйте тип `TEXT_DETECTION` и задайте список языков в конфигурации.

### Конфигурация запроса {#config}

В конфигурации указывается:
* список языков, на основе которого будет [определена языковая модель](#detect-model) для распознавания.

  Если вы не знаете язык текста, укажите `"*"`, чтобы сервис выбрал наиболее подходящую модель автоматически.
* модель, которая будет использована для поиска текста на изображении. Доступные модели:
  * `page` (по умолчанию) — подходит для изображений с любым количеством строк текста.
  * `papers` — подходит для распознавания многоколоночного текста (доступна только в {{ vision-short-name }} [OCR API](../../ocr/api-ref/index.md)).
  * `handwritten` — подходит для распознавания произвольного сочетания печатного и рукописного текста на русском и английском языках.
  * `table` — подходит для распознавания таблиц на русском и английском языках.

### Определение языковой модели {#detect-model}

Для распознавания текста в сервисе используется [языковая модель](supported-languages.md), обученная на определенном наборе языков. Модель выбирается автоматически на основе списка языков, который вы указываете в конфигурации.

При каждом распознавании текста используется только одна модель. Например, если на изображении текст на китайском и японском, то распознан будет только один из этих языков. Чтобы распознать оба этих языка, укажите в запросе несколько возможностей для анализа с разными списками языков.

{% note tip %}

Для текста на русском и английском лучше всего работает [англо-русская модель](supported-languages.md#engrus). Чтобы использовать ее, укажите один из этих языков или оба в `text_detection_config`, но не указывайте другие языки.

{% endnote %}

### Требования к изображению {#image-requirements}

Изображение в запросе должно соответствовать следующим требованиям:

{% list tabs %}

- {{ vision-short-name }} API 

  {% include [file-restrictions](../../../_includes/vision/file-restrictions.md) %}

- OCR API

  {% include [file-restrictions](../../../_includes/vision/ocr-file-restrictions.md) %}

{% endlist %}

## Ответ с результатами распознавания {#response}

Сервис выделяет найденный текст на изображении и группирует его по уровням: слова группируются в строки, строки в блоки, блоки в страницы.

![image](../../../_assets/vision/text-detection.jpg)

В результате сервис возвращает объект, где для каждого из уровней дополнительно указывается:
* страницы (`pages[]`) — размер страницы;
* блоки текста (`blocks[]`) — расположение текста на странице;
* строки (`lines[]`) — расположение и [достоверность распознавания](#confidence);
* слова (`words[]`) — расположение, достоверность, текст и язык, использованный при распознавании.

Чтобы показать расположение текста, сервис возвращает координаты прямоугольника, обрамляющего текст. Координаты — количество пикселей от левого верхнего угла на изображении.

{% include [coordinates](../../../_includes/vision/coordinates.md) %}

Пример распознанного слова с координатами:

```json
{
  "boundingBox": {
    "vertices": [{
      "x": "410",
      "y": "404"
    },
    {
      "x": "410",
      "y": "467"
    },
    {
      "x": "559",
      "y": "467"
    },
    {
      "x": "559",
      "y": "404"
    }]
  },
  "languages": [{
    "languageCode": "en",
    "confidence": 0.9412244558
  }],
  "text": "you",
  "confidence": 0.9412244558
}
```

### Формат ответа {#response-format}

{{ vision-full-name }} предоставляет результат распознавания в формате [JSON Lines](https://jsonlines.org), где каждая строка JSON-файла соответствует одной распознанной странице или изображению.

### Ошибки в определении координат {#coordinate-definition-issue}

В некоторых случаях сервис возвращает координаты, которые не соответствуют отображению текста в пользовательском обработчике изображений. Это связано с некорректной обработкой метаданных `exif` обработчиком изображений пользователя.

При распознавании сервис учитывает данные о повороте изображения, которые задаются атрибутом `Orientation` секции `exif`. Некоторые средства просмотра изображений могут игнорировать заданные в `exif` значения поворота, что приводит к несоответствию полученных результатов отображаемому изображению.

Чтобы исправить эту ошибку, выполните одно из действий:

* Измените настройки обработчика изображений так, чтобы при просмотре учитывался заданный в секции `exif` угол поворота.
* При передаче в сервис удалите из секции `exif` изображения атрибут `Orientation`, либо установите для него значение `0`.

### Достоверность распознавания {#confidence}

Достоверность распознавания показывает уверенность сервиса в результате. Например, значение `"confidence": 0.9412244558` для строки <q>we like you</q> означает, что с вероятностью в 94% текст распознан корректно.

Сейчас достоверность считается только для строк. В значение `confidence` для слов и языка подставляется значение для `confidence` строки.

#### Что дальше {#what-is-next}

* [Посмотрите список поддерживаемых языков и моделей](supported-languages.md).
* [Посмотрите известные ограничения в текущей версии](known-issues.md).
* [Попробуйте распознать текст на изображении](../../operations/ocr/text-detection-image.md).