# Получение детализации расходов по каталогам

Получение детализации по каталогам работает в тестовом режиме.

## Перед началом

Если у вас еще нет разделения на каталоги, вы можете создать каталог по [инструкции](../resource-manager/operations/folder/create.md). В названии каталога рекомендуем указывать имя проекта или клиента, который использует этот каталог. В название каталога рекомендуем добавлять понятные имена: проекта, по которому вы работаете, или клиента, который использует этот каталог.

## Получить детализацию расходов

Чтобы получать детализацию расходов по каталогам:

1. [Создайте бакет](../storage/operations/buckets/create.md) в сервисе {{ objstorage-name }}. В этом бакете {{ yandex-cloud }} будет сохранять файлы с детализацией. Вы можете сохранять детализацию в нескольких бакетах.

    {% note alert %}

    Не делайте бакет публичным, иначе любой сможет скачать вашу детализацию по ссылке на бакет.

    {% endnote %}

1. Откройте бакет в консоли управления и скопируйте ссылку на него из адресной строки. Ссылка на бакет имеет формат:

    ```
    {{ link-console-main }}/folders/<FOLDER-ID/storage/bucket/<BUCKET-NAME>
    ```
1. Отправьте на почту вашему менеджеру или [службе поддержки]({{ link-console-support }}/create-ticket) заявку на включение детализации биллинга по каталогам и укажите:
   * Ссылку на бакет или несколько бакетов.
   * Префикс, который должен быть у группы файлов с детализацией.
     Если вы хотите сохранять несколько групп файлов с детализацией в одном бакете, укажите уникальный префикс для каждой группы. Например, для группы файлов с детализацией по ресурсам можно использовать префикс `yc-billing-export-with-resources`, для группы файлов без детализации по ресурсам — `yc-billing-export`.
   * Язык, на котором будут отображаться названия продуктов. Возможные значения — английский или русский язык.
   * Нужна ли детализация по ресурсам.
     При выбранной детализации по ресурсам в таблице появится столбец `resource_id`. Получить детализацию по ресурсам можно с 1 августа 2020 года, за более ранний период информация не предоставляется.
1. Дождитесь сообщения об активации бакета. Служба поддержки активирует бакет в течение суток.
1. Скачайте CSV-файлы с детализацией из бакета.
   Каждый день в бакете создается новый файл с детализацией. В имени файла указывается префикс и дата, за которую собрана детализация. Файл перезаписывается каждый час, дополняясь новыми данными.

{% note tip %}

Файлы с детализацией из бакета автоматически не удаляются, но вы можете настроить периодическое удаление файлов. Подробнее читайте в разделе [Жизненный цикл объектов](../storage/concepts/lifecycles.md) (в терминах {{ objstorage-name }} файлы в бакете называются _объектами_).

{% endnote %}

## Формат файла с детализацией расходов {#format}

Выгружаемый файл с детализацией — это таблица в CSV-формате (столбцы разделены запятой). Каждая строка отражает потребление продукта за день для указанного каталога.

Таблица содержит следующие столбцы:

* `billing_account_id` — идентификатор [платежного аккаунта](../billing/concepts/billing-account).
* `billing_account_name` — имя платежного аккаунта.
* `cloud_id` — идентификатор [облака](../resource-manager/concepts/resources-hierarchy#cloud), для которого собрана детализация.
* `cloud_name` — имя облака.
* `folder_id` — идентификатор каталога.
* `folder_name` — имя каталога на момент выгрузки детализации.
* `resource_id` — идентификатор ресурса, имя ресурса или идентификатор подписки. Значение поля может быть пустым, если использование сервиса относится ко всему каталогу или не содержит ресурсов. Соответствие сервисов и значения столбца `resource_id`:
   * {{ compute-name }} и {{ marketplace-name }} — идентификатор виртуальной машины, снимка диска, образа диска или другого ресурса, установленного через {{ marketplace-name }}.
   * {{ objstorage-name }} — имя бакета.
   * {{ vpc-name }} — идентификатор ресурса, работающего с входящим или исходящим трафиком.
   * {{ kms-short-name }} — идентификатор ключа.
   * {{ network-load-balancer-name }} — идентификатор балансировщика.
   * {{ container-registry-short-name }} — идентификатор контейнера.
   * {{ k8s }} и {{ dataproc-name }} — идентификатор кластера.
   * {{ mpg-short-name }}, {{ mch-short-name }}, {{ mmg-short-name }}, {{ mmy-short-name }}, {{ mrd-short-name }} и {{ mkf-name }} — идентификатор хоста в кластере.
   * {{ message-queue-name }} — идентификатор запроса.
   * {{ sf-name }} — идентификатор функции.
   * {{ monitoring-short-name }}, {{ datalens-short-name }}, {{ iot-name }}, {{ speechkit-short-name }}, {{ translate-name }} и {{ vision-short-name }} — пустое значение.
   * Техническая поддержка — идентификатор подписки.
* `service_id` — идентификатор сервиса, которому принадлежит потребленный продукт.
* `service_name` — имя сервиса, которому принадлежит потребленный продукт.
* `sku_id` — идентификатор потребленного продукта.
* `sku_name` — имя продукта.
* `date` — дата, за которую начислена стоимость потребления.
* `currency` — валюта платежного аккаунта. Возможные значения: `RUB` и `USD`.
* `pricing_quantity` — количество потребленных единиц продукта. Десятичный разделитель — точка.
* `pricing_unit` — единица измерения потребления продукта.
* `cost` — общая стоимость потребления. Десятичный разделитель — точка.
* `credit` — сумма скидок. Десятичный разделитель — точка.
* `monetary_grant_credit` — скидка по гранту, в том числе по гранту на знакомство с платформой. Десятичный разделитель — точка.
* `volume_incentive_credit` — скидка за объем потребления продукта. Например, за потребление 5% vCPU. Десятичный разделитель — точка.
* `cud_credit` — скидка за фиксированное потребление ресурса. Стоимость объема потребления сверх фиксированного будет равна разнице между столбцами `cost` и `credit`. Десятичный разделитель — точка.
* `misc_credit` — остальные виды скидок, в том числе скидки за потребление ресурсов после окончания действия гранта на знакомство с платформой, но до перехода на платную версию. Десятичный разделитель — точка.
* `label.user_labels.<имя метки>` — метки, проставленные ресурсам. Как управлять метками описано в разделе [{#T}](label-management.md).
* `locale` — язык каждой строки в выгрузке. От значения поля зависит язык столбца `sku_name`. Возможные значения `en` и `ru`.
* `updated_at` — дата и время последнего изменения строки в формате [Unix Timestamp](https://www.unixtimestamp.com).
* `exported_at` — дата и время добавления строки в файл детализации.

{% cut "Устаревшие параметры" %}

* `created_at` — дата и время, в которое начислена указанная стоимость потребления. В формате [Unix Timestamp](https://www.unixtimestamp.com).
* `label.system_labels.folder_id` — идентификатор каталога. Теперь значение отображается в столбце `folder_id`.

{% endcut %}

##### См. также

* [Посмотреть детализацию для облака](../billing/operations/check-charges.md)
* [Документация биллинга в {{ yandex-cloud }}](../billing/index.yaml)
