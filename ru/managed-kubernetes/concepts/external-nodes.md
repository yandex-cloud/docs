# Внешние узлы кластера

{% note info %}

Подключение внешних узлов находится на стадии [Preview](../../overview/concepts/launch-stages.md). Их использование не тарифицируется.

{% endnote %}

{{ managed-k8s-name }} позволяет подключать в качестве узлов [кластера {{ k8s }}](./index.md#kubernetes-cluster) серверы, расположенные вне {{ yandex-cloud }}.

## Требования для подключения внешних узлов к кластеру {#requirements}

Чтобы подключить внешние узлы к кластеру {{ managed-k8s-name }}, необходимо соответствие следующим требованиям:
* Сетевая связность на уровне L3 между локальной сетевой инфраструктурой ваших серверов и [облачной сетью](../../vpc/concepts/network.md#network) кластера {{ managed-k8s-name }}. Внешние узлы подключаются к [мастеру](./index.md#master) кластера только через его внутренний IP-адрес в облачной сети {{ yandex-cloud }}.

  Установить приватное выделенное соединение между вашей локальной сетевой инфраструктурой и {{ yandex-cloud }} можно следующими способами:
  * с помощью сервиса [{{ interconnect-full-name }}](../../interconnect/);
  * самостоятельно с помощью VPN.
* Кластер {{ managed-k8s-name }} использует [туннельный режим](../concepts/network-policy.md#cilium) сети.
  * В настоящий момент туннельный режим и подключение внешних серверов доступно для зональных и региональных кластеров версии не ниже 1.20 в канале RAPID, на кластерах должны быть установлены последние обновления.
* Подключаемые серверы должны иметь доступ в интернет.
* Операционная система подключаемых серверов – Ubuntu 20.04.

Как подключить внешние узлы к кластеру {{ managed-k8s-name }} читайте в разделе [{#T}](../operations/external-nodes-connect.md).

## Разделение ответственности

Ключевыми моментами для предсказуемой работы внешних узлов в кластере является обеспечение бесперебойной работы:
* вычислительной инфраструктуры - используемых серверов и установленной на них операционной системы;
  * мы не рекомендуем использовать подключаемые сервера для чего-либо кроме выполнения функций узлов кластера;
* локальной сетевой инфраструктуры используемых серверов;
* соединения между вашей локальной сетевой инфраструктурой и {{ yandex-cloud }}.

{{ yandex-cloud }} предоставляет услугу обеспечения надежного приватного соединения между вашей локальной сетевой и облачной инфраструктурой в рамках сервиса [{{ interconnect-name }}](../../interconnect/). В качестве альтернативы вы можете самостоятельно настраивать и обеспечивать качество такого соединения с помощью VPN.

{{ yandex-cloud }} не предоставляет услугу по управлению и обеспечению надежности вычислительной и сетевой инфраструктуры вне датацентров {{ yandex-cloud }}. Вы можете воспользоваться преимуществами управляемой инфраструктуры в рамках использования [обычных групп узлов](../operations/node-group/node-group-create.md) сервиса {{ managed-k8s-name }}.

## Ограничения при работе с внешними узлами

При проектировании распределения рабочих нагрузок по узлам в кластере {{ managed-k8s-name }} необходимо учитывать следующие особенности:
* к внешним узлам невозможно подключать [объекты](volume.md) `PersistentVolume` на основе облачных дисков {{ yandex-cloud }};
* [сервисы](./index.md#service) на основе L3-балансировщиков {{ yandex-cloud }} (например, `LoadBalancer`) не распределяют трафик на такие узлы.

Нагрузки, которым необходима эта функциональность, необходимо размещать только на узлах кластера {{ managed-k8s-name }}, которые расположены в {{ yandex-cloud }}. Для этого вы можете воспользоваться настройками [node affinity](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity):

```yaml
...
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: yandex.cloud/node-group-id # Метка узлов, расположенных в Yandex Cloud.
            operator: Exists
...
```

В качестве альтернативы управлению трафиком с помощью L3 балансировщиков вы можете воспользоваться управлением трафиком на уровне L7. Для этого установите в кластер {{ managed-k8s-name }} Ingress-контроллер и используйте ресурсы типа `Ingress`.

В настоящий момент [Ingress Controller на базе {{ alb-full-name }}](../tutorials/alb-ingress-controller.md) не поддерживает балансировку на внешние узлы, вы можете проголосовать за скорейшую реализацию подобной возможности [здесь](https://cloud.yandex.ru/features/1240). В качестве временной альтернативы вы можете воспользоваться одним из [альтернативных Ingress-контроллеров](../tutorials/ingress-cert-manager.md).