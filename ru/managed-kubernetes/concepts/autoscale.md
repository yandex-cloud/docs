# Автоматическое масштабирование

Автоматическое масштабирование — это изменение размера [группы узлов](./index.md#node-group), количества подов или количества выделяемых каждому поду ресурсов на основе запросов ресурсов для [подов](./index.md#pod), запущенных на узлах этой группы. Автоматическое масштабирование доступно в {{ k8s }} с версии 1.15.

В кластере {{ managed-k8s-name }} доступны три вида автоматического масштабирования:
* _Автоматическое масштабирование кластера_ ({{ k8s-ca }}). {{ managed-k8s-name }} отслеживает нагрузку на узлы и при необходимости изменяет их количество в указанных пределах.
* _Горизонтальное масштабирование подов_ ({{ k8s-hpa }}). {{ k8s }} динамически изменяет количество подов, запущенных на каждом узле группы.
* _Вертикальное масштабирование подов_ ({{ k8s-vpa }}). При повышении нагрузки {{ k8s }} выделяет каждому поду дополнительные ресурсы в установленных пределах.

Вы можете использовать несколько видов автоматического масштабирования в одном кластере. При этом не рекомендуется использовать {{ k8s-hpa }} и {{ k8s-vpa }} одновременно.

## Автоматическое масштабирование кластера {#ca}

{{ k8s-ca }} автоматически изменяет количество узлов в группе в зависимости от нагрузки.

При [создании группы узлов](../operations/node-group/node-group-create.md) выберите автоматический тип масштабирования и задайте минимальное, максимальное и начальное количество узлов в группе. {{ k8s }} будет периодически проверять состояние подов и нагрузку на узлы, при необходимости изменяя размер группы:
* Если поды не могут быть назначены из-за нехватки vCPU или RAM на существующих узлах, число узлов в группе будет постепенно увеличиваться до указанного максимального размера.
* Если нагрузка на узлы недостаточная и все поды могут быть назначены с меньшим количеством узлов в группе, число узлов в группе будет постепенно уменьшаться до указанного минимального размера. Если поды узла не могут быть расселены за установленное время ({{ k8s-decomission-timeout }}), узел принудительно останавливается. Время ожидания нельзя изменить.

{% note info %}

При подсчете текущих лимитов и [квот]({{ link-console-quotas }}) сервис {{ managed-k8s-name }} учитывает указанный максимальный размер группы узлов как фактический, независимо от текущего размера группы.

{% endnote %}

Включение {{ k8s-ca }} доступно только при создании группы узлов. Управление {{ k8s-ca }} выполняется на стороне сервиса {{ managed-k8s-name }}.

Подробнее см. в документации {{ k8s }}:

* [описание {{ k8s-ca }}](https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler);
* [параметры, используемые по умолчанию](https://github.com/kubernetes/autoscaler/blob/c6b754c359a8563050933a590f9a5dece823c836/cluster-autoscaler/FAQ.md#what-are-the-parameters-to-ca);

См. также раздел [{#T}](../qa/cluster-autoscaler.md).

## Горизонтальное автомасштабирование подов {#hpa}

При использовании горизонтального масштабирования подов {{ k8s }} изменяет их количество в зависимости от степени нагрузки на vCPU.

При [создании {{ k8s-hpa }}](../operations/autoscale.md#hpa) укажите в параметрах:
* Желаемую среднюю нагрузку на vCPU для каждого пода в процентах.
* Минимальное и максимальное количество реплик подов.

Горизонтальное автомасштабирование подов доступно для контроллеров:
* [Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/).
* [StatefulSet](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/).
* [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/).

Подробнее о {{ k8s-hpa }} см. в [документации {{ k8s }}](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).

## Вертикальное автомасштабирование подов {#vpa}

{{ k8s}} ограничивает выделение ресурсов для каждого приложения с помощью параметров `limits`. Для пода, превысившего лимит vCPU, включается режим пропуска тактов процессора. Под, превысивший лимит RAM, будет остановлен.

{{ k8s-vpa }} при необходимости выделяет дополнительные ресурсы vCPU и RAM для подов.

При [создании {{ k8s-vpa }}](../operations/autoscale.md#vpa) укажите в спецификации опцию автоматического масштабирования:
* `updateMode: "Auto"`, чтобы {{ k8s-vpa }} автоматически управлял ресурсами подов.
* `updateMode: "Off"`, чтобы {{ k8s-vpa }} [предоставлял рекомендации](https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler#quick-start) по управлению ресурсами подов, но не изменял их.

Подробнее о {{ k8s-vpa }} см. в [документации {{ k8s }}](https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler).

## Примеры использования {#examples}

* [{#T}](../tutorials/autoscaling.md)
* [{#T}](../tutorials/vpa-autoscaling.md)
* [{#T}](../tutorials/load-testing-grpc-autoscaling.md)
* [{#T}](../tutorials/cert-manager-webhook.md)