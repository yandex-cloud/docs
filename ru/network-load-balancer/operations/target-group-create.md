# Создать целевую группу

{% list tabs %}

- Консоль управления
  
  Чтобы создать новую [целевую группу](../concepts/target-resources.md):
  
  1. В [консоли управления]({{ link-console-main }}) выберите каталог, где требуется создать целевую группу.
  1. В списке сервисов выберите **{{ network-load-balancer-name }}**.
  1. На панели слева выберите ![image](../../_assets/trgroups.svg) **Целевые группы**.
  1. Нажмите кнопку **Создать целевую группу**.
  1. Введите имя целевой группы.
  
      {% include [name-format](../../_includes/name-format.md) %}
  
  1. Выберите виртуальные машины, которые нужно добавить в целевую группу.
  1. Нажмите кнопку **Создать**.

- CLI
  
  Если у вас еще нет интерфейса командной строки {{ yandex-cloud }}, [установите его](../../cli/quickstart#install).
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  1. Посмотрите описание команды CLI для создания целевой группы:
  
     ```
     yc load-balancer target-group create --help
     ```
  
  1. Получите список виртуальных машин:
  
     ```
     yc compute instance list
     ```

     Результат:
     
     ```
     +----------------------+------------+---------------+---------+
     |          ID          |    NAME    |    ZONE ID    | STATUS  |
     +----------------------+------------+---------------+---------+
     ...
     | fhmajnpl7cvhl6v1s12i | test-vm-1  | {{ region-id }}-a | RUNNING |
     | fhmajv6f27n0a4a1sbml | test-vm-2  | {{ region-id }}-a | RUNNING |
     ...
     +----------------------+------------+---------------+---------+
     ```
  
  1. Выберите `ID` виртуальной машины, которую следует добавить в целевую группу, и получите о ней сведения:
  
     ```
     yc compute instance get fhmajnpl7cvhl6v1s12i
     ```
	 
	 Результат:
	 
	 ```
       ...
       subnet_id: e9bhjah6j3k7e6v8t5fa
       primary_v4_address:
         address: 192.168.0.3
       ...
     ```

  1. Создайте целевую группу и добавьте в нее нужную виртуальную машину в качестве целевого ресурса, указав `subnet-id` и `address` виртуальной машины во флаге `--target`:
  
     ```
     yc load-balancer target-group create \
       --region-id {{ region-id }} \
       --name test-tg-1 \
       --target subnet-id=<идентификатор подсети>,address=<внутренний IP-адрес ресурса>
     ```
  


- API
  
  Создать новую целевую группу можно с помощью метода API [create](../api-ref/TargetGroup/create.md).
  
  После создания целевой группы следует добавить в нее целевые ресурсы, по которым будет распределяться нагрузка. Целевые ресурсы добавляются в группу с помощью метода [addTargets](../api-ref/TargetGroup/addTargets).

- {{ TF }}

  Если у вас ещё нет {{ TF }}, [установите его и настройте провайдер {{ yandex-cloud }}](../../tutorials/infrastructure-management/terraform-quickstart.md#install-terraform).

  1. Опишите в конфигурационном файле параметры ресурсов, которые необходимо создать:

     * `name` — имя целевой группы.
     * блок `target` — описание целевого ресурса:
        * `subnet_id` — идентификатор подсети, к которой подключены целевые объекты. Все целевые объекты в целевой группе должны быть подключены к одной и той же подсети в пределах одной зоны доступности. Обязательный параметр.
        * `address` — внутренний IP-адрес ресурса. Обязательный параметр.

     Пример структуры конфигурационного файла:

     {% if product == "yandex-cloud" %}

     ```hcl
     provider "yandex" {
       token     = "<OAuth>"
       cloud_id  = "<идентификатор облака>"
       folder_id = "<идентификатор каталога>"
       zone      = "{{ region-id }}-a"
     }
     
     resource "yandex_lb_target_group" "foo" {
       name      = "my-target-group"
     
       target {
         subnet_id = "<идентификатор подсети>"
         address   = "<внутренний IP-адрес ресурса>"
       }
     
       target {
         subnet_id = "<идентификатор подсети>"
         address   = "<внутренний IP-адрес ресурса 2>"
       }
     
     }
     ```

     {% endif %}

     {% if product == "cloud-il" %}

     ```hcl
     provider "yandex" {
       endpoint  = "{{ api-host }}:443"
       token     = "<статический ключ сервисного аккаунта>"
       cloud_id  = "<идентификатор облака>"
       folder_id = "<идентификатор каталога>"
       zone      = "{{ region-id }}-a"
     }
     
     resource "yandex_lb_target_group" "foo" {
       name      = "my-target-group"
     
       target {
         subnet_id = "<идентификатор подсети>"
         address   = "<внутренний IP-адрес ресурса>"
       }
     
       target {
         subnet_id = "<идентификатор подсети>"
         address   = "<внутренний IP-адрес ресурса 2>"
       }
     
     }
     ```

     {% endif %}

     Более подробную информацию о параметрах ресурса `yandex_lb_target_group` в {{ TF }}, см. в [документации провайдера]({{ tf-provider-link }}/lb_target_group).

  1. Проверьте корректность конфигурационных файлов.

     1. В командной строке перейдите в папку, где вы создали конфигурационный файл.
     1. Выполните проверку с помощью команды:

        ```
        terraform plan
        ```

     Если конфигурация описана верно, в терминале отобразится список создаваемых ресурсов и их параметров. Если в конфигурации есть ошибки, {{ TF }} на них укажет. 

  1. Разверните облачные ресурсы.

     1. Если в конфигурации нет ошибок, выполните команду:

        ```
        terraform apply
        ```

     1. Подтвердите создание ресурсов: введите в терминал слово `yes` и нажмите **Enter**.

     После этого в указанном каталоге будут созданы все требуемые ресурсы. Проверить появление ресурсов и их настройки можно в [консоли управления]({{ link-console-main }}).

{% endlist %}
