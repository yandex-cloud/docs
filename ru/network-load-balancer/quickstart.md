# Как начать работать с {{ network-load-balancer-short-name }}

[Сетевые балансировщики](concepts/index.md) равномерно распределяют нагрузку по облачным ресурсам и отслеживают их состояние. Это позволяет повысить доступность и отказоустойчивость ваших приложений и облачной сетевой инфраструктуры. 

Создайте сетевой балансировщик с [обработчиком](concepts/listener.md), подключите к нему [группу целевых ресурсов](concepts/target-resources) и настройте [проверку их состояния](concepts/health-check.md) с помощью сервиса {{ network-load-balancer-name }}.

## Перед началом работы {#before-you-begin}

1. Войдите в [консоль управления]({{ link-console-main }}) или зарегистрируйтесь. Если вы еще не зарегистрированы, перейдите в консоль управления и следуйте инструкциям.
1. На [странице биллинга](https://console.cloud.yandex.ru/billing) убедитесь, что у вас подключен [платежный аккаунт](../billing/concepts/billing-account.md) и он находится в статусе `ACTIVE` или `TRIAL_ACTIVE`. Если платежного аккаунта нет, [создайте его](../billing/quickstart/index.md#create_billing_account).
1. Если у вас еще нет каталога, [создайте его](../resource-manager/operations/folder/create.md).
1. Заранее [создайте](../compute/quickstart/quick-create-linux.md) несколько виртуальных машин, которые войдут в целевую группу, подключенную к сетевому балансировщику. Для тестирования можно использовать недорогие [прерываемые ВМ](../compute/concepts/preemptible-vm.md).

## Создайте целевую группу {#create-target-group}

[Целевая группа](concepts/target-resources.md) объединяет облачные ресурсы, по которым сетевой балансировщик будет распределять трафик. 

Чтобы создать целевую группу:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, где требуется создать целевую группу.
1. В списке сервисов выберите **{{ network-load-balancer-name }}**.
1. На панели слева выберите ![image](../_assets/trgroups.svg) **Целевые группы**.
1. Нажмите кнопку **Создать целевую группу**.
1. Введите имя целевой группы `test-target-group`.
1. Выберите виртуальные машины, которые нужно добавить в целевую группу.
1. Нажмите кнопку **Создать**.


## Создайте сетевой балансировщик {#create-load-balancer}

При создании сетевого балансировщика нужно создать обработчик, на котором балансировщик будет принимать трафик, а также настроить проверку состояния ресурсов в подключенной целевой группе.

Чтобы создать сетевой балансировщик:
  
1. В [консоли управления]({{ link-console-main }}) выберите каталог, где требуется создать балансировщик.
1. В списке сервисов выберите **{{ network-load-balancer-name }}**.
1. Нажмите кнопку **Создать сетевой балансировщик**.
1. Задайте имя балансировщика, например `test-load-balancer`.
1. В поле **Публичный адрес** выберите способ назначения адреса:

   * **Автоматически** — чтобы назначить случайный IP-адрес из пула адресов {{ yandex-cloud }}.
   * **Список** — чтобы выбрать публичный IP-адрес из списка зарезервированных заранее статических адресов. Подробнее читайте в разделе [{#T}](../vpc/operations/set-static-ip.md).

1. В блоке **Обработчики** нажмите **Добавить обработчик**.
1. В открывшемся окне задайте параметры обработчика:
  
   * **Имя**.
   * **Порт**, на котором балансировщик будет принимать входящий трафик, из диапазона от 1 до 32767.
   * **Целевой порт**, на который балансировщик будет направлять трафик, из диапазона от 1 до 32767.
   
1. Нажмите кнопку **Добавить**.
1. В блоке **Целевые группы** нажмите **Добавить целевую группу**.
1. Выберите целевую группу или [создайте новую](operations/target-group-create.md):
  
   * Нажмите **Создать целевую группу**.
   * Введите имя целевой группы.

     {% include [name-format](../_includes/name-format.md) %}
  
   * Выберите виртуальные машины, которые нужно добавить в целевую группу.
   * Нажмите кнопку **Создать**.

1. (опционально) Под блоком **Проверка состояния** нажмите **Настроить** и в открывшемся окне:
  
   * Введите имя проверки состояния.

     {% include [name-format](../_includes/name-format.md) %}
  
   * Выберите тип проверки: **HTTP** или **TCP**.
   * Если вы выбрали проверку через HTTP, то в поле **Путь** укажите URL, по которому будут выполняться проверки.
   * Укажите порт из диапазона 1-32767.
   * Укажите время ожидания ответа в секундах.
   * Укажите интервал отправки проверок состояния в секундах.
   * Укажите порог работоспособности — количество успешных проверок, после которого виртуальная машина будет считаться готовой к приему трафика.
   * Укажите порог неработоспособности — количество проваленных проверок, после которого на виртуальную машину перестанет подаваться трафик.
   * Нажмите кнопку **Применить**.
  
1. Нажмите кнопку **Создать**.


## Проверьте состояния ресурсов {#health-check}

Чтобы проверить [состояние сетевого балансировщика](concepts/index.md#lb-statuses) и ресурсов в подключенной целевой группе:

1. В [консоли управления]({{ link-console-main }}) выберите каталог, где требуется создать балансировщик.
1. В списке сервисов выберите **{{ network-load-balancer-name }}**.
1. Найдите в списке созданный балансировщик.
1. Убедитесь, что он находится в состоянии `Active` — это означает, что балансировщик готов передавать трафик целевым ресурсам.
1. Нажмите на имя балансировщика.
1. Посмотрите на блок **Целевая группа**. Если виртуальные машины запущены и готовы принимать трафик, у них должно быть состояние `HEALTHY`.
1. Откройте страницу сервиса {{ compute-name }} и [остановите](../compute/operations/vm-control/vm-stop-and-start.md#stop) одну из ВМ, входящих в целевую группу.
1. Вернитесь на страницу балансировщика и убедитесь, что остановленная ВМ перешла в состояние `UNHEALTHY`. Это означает, что целевой ресурс из группы не прошел проверку состояния и не готов принимать трафик.


## Удалите сетевой балансировщик и созданные ресурсы {#delete-resources}

Если вам больше не нужен балансировщик, [удалите его](operations/load-balancer-delete.md).

Затем [удалите целевую группу](operations/target-group-delete.md) и [виртуальные машины](../compute/operations/vm-control/vm-delete.md).


## Что дальше {#what-is-next}

* Узнайте больше о работе [сетевых балансировщиков](concepts/index.md).
* Ознакомьтесь с [рекомендациями](best-practices.md) по работе с балансировщиками.