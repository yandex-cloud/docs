
# Установка Ghost CMS CloudApp в {{ yandex-cloud }}

С помощью этого руководства вы установите и настроите [Ghost CMS](https://ghost.org/) — платформу для публикации контента и ведения блогов — используя сервис [Cloud Apps](../../cloud-apps/). Приложение будет развернуто на виртуальной машине с автоматической настройкой всех необходимых сервисов, включая базу данных, веб-сервер и интеграцию с почтовым сервисом.

Чтобы установить Ghost CMS:

1. [Подготовьте облако к работе](#before-you-begin).
1. [Настройте DNS-зону](#configure-dns).
1. [Установите Ghost CMS CloudApp](#install-ghost).
1. [Настройте Ghost CMS](#configure-ghost).
1. [Проверьте результат](#check-result).

Если созданные ресурсы вам больше не нужны, [удалите их](#clear-out).

## Подготовьте облако к работе {#before-you-begin}

{% include [before-you-begin](../../_tutorials/_tutorials_includes/before-you-begin.md) %}

Убедитесь, что в выбранном [каталоге](../../resource-manager/concepts/resources-hierarchy.md#folder) есть [облачная сеть](../../vpc/concepts/network.md#network) с [подсетью](../../vpc/concepts/network.md#subnet) хотя бы в одной [зоне доступности](../../overview/concepts/geo-scope.md). Для этого на странице каталога выберите **{{ vpc-short-name }}**. Если в списке есть сеть, нажмите на её имя, чтобы увидеть список подсетей. Если нужных подсетей или сети нет, [создайте их](../../vpc/quickstart.md).

### Необходимые платные ресурсы {#paid-resources}

В стоимость поддержки создаваемой инфраструктуры входят:

* плата за использование виртуальной машины (см. [тарифы {{ compute-full-name }}](../../compute/pricing.md));
* плата за использование публичной DNS-зоны и за публичные DNS-запросы (см. [тарифы {{ dns-full-name }}](../../dns/pricing.md));
* плата за хранение данных на диске (см. [тарифы {{ compute-full-name }}](../../compute/pricing.md));
* плата за использование S3-бакета для хранения медиафайлов (см. [тарифы {{ objstorage-name }}](../../storage/pricing.md)).

## Настройте DNS-зону {#configure-dns}

Перед установкой Ghost CMS вам необходимо создать публичную DNS-зону и делегировать на неё домен. Подробнее о делегировании домена читайте в [инструкции](../../troubleshooting/dns/how-to/delegate-public-zone.md).

{% list tabs group=instructions %}

* Консоль управления {#console}

  1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором хотите создать [зону DNS](../../dns/concepts/dns-zone.md).
  1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_dns }}**.
  1. Нажмите кнопку **{{ ui-key.yacloud.dns.button_zone-create }}**.
  1. Задайте настройки зоны DNS:
     * **{{ ui-key.yacloud.dns.label_zone }}** — укажите ваш зарегистрированный домен, например `example.com.` (с точкой в конце).
     * **{{ ui-key.yacloud.common.type }}** — выберите `{{ ui-key.yacloud.dns.label_public }}`.
     * **{{ ui-key.yacloud.common.name }}** — укажите имя зоны, например `example-zone`.
  1. Нажмите кнопку **{{ ui-key.yacloud.common.create }}**.

  1. Делегируйте домен на серверы {{ yandex-cloud }}. Для этого в личном кабинете вашего регистратора доменных имен укажите адреса DNS-серверов `ns1.{{ dns-ns-host-sld }}` и `ns2.{{ dns-ns-host-sld }}`.

     Делегирование происходит не сразу. Серверы интернет-провайдеров обновляют записи до 24 часов. Проверить делегирование домена можно с помощью [сервиса Whois](https://www.reg.ru/whois/check_site) или утилиты `dig`:

     ```bash
     dig +short NS example.com
     ```

     Результат:

     ```text
     ns2.{{ dns-ns-host-sld }}.
     ns1.{{ dns-ns-host-sld }}.
     ```

* {{ yandex-cloud }} CLI {#cli}

  {% include [cli-install](../../_includes/cli-install.md) %}

  1. Создайте публичную зону DNS:

     ```bash
     yc dns zone create \
       --name example-zone \
       --zone example.com. \
       --public-visibility
     ```

     Где `--zone` — имя вашего домена, например `example.com.`. Значение параметра `--zone` должно заканчиваться точкой.

     Результат:

     ```text
     id: dns39gihj0ef********
     folder_id: b1g681qpemb4********
     created_at: "2024-09-09T15:23:34.919887Z"
     name: example-zone
     zone: example.com.
     public_visibility: {}
     ```

     Подробнее о команде `yc dns zone create` читайте в [справочнике CLI](../../cli/cli-ref/dns/cli-ref/zone/create.md).

  1. Делегируйте домен на серверы {{ yandex-cloud }}. Для этого в личном кабинете вашего регистратора доменных имен укажите адреса DNS-серверов `ns1.{{ dns-ns-host-sld }}` и `ns2.{{ dns-ns-host-sld }}`.

     Делегирование происходит не сразу. Серверы интернет-провайдеров обновляют записи до 24 часов.

* API {#api}

  Чтобы создать публичную зону DNS, воспользуйтесь методом REST API [create](../../dns/api-ref/DnsZone/create.md) для ресурса [DnsZone](../../dns/api-ref/DnsZone/index.md) или вызовом gRPC API [DnsZoneService/Create](../../dns/api-ref/grpc/DnsZone/create.md).

  Делегируйте домен на серверы {{ yandex-cloud }}. Для этого в личном кабинете вашего регистратора доменных имен укажите адреса DNS-серверов `ns1.{{ dns-ns-host-sld }}` и `ns2.{{ dns-ns-host-sld }}`.

{% endlist %}

## Установите Ghost CMS CloudApp {#install-ghost}

Установите [Ghost CMS](https://yandex.cloud/ru/marketplace/products/yc/ghost-cms) с помощью Cloud Apps:

{% list tabs group=instructions %}

* Консоль управления {#console}

  1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором хотите установить приложение.
  1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_cloud-apps }}**.
  1. Нажмите кнопку **{{ ui-key.yacloud.cloud-apps.button_empty-install-application }}**.
  1. В открывшемся окне выберите приложение [**Ghost CMS**](https://yandex.cloud/ru/marketplace/products/yc/ghost-cms).
  1. Заполните параметры установки:

     {% note info %}

     **Обязательные параметры:**
     * **{{ ui-key.yacloud.cloud-apps.label_subnetwork }}** (Параметры хоста)
     * **Идентификатор DNS зоны** (Параметры хоста)

     Остальные параметры опциональны или имеют значения по умолчанию.

     {% endnote %}

     **Общие параметры:**

     * **{{ ui-key.yacloud.cloud-apps.section_parameters }}** — укажите название приложения и описание (опционально).
     * **{{ ui-key.yacloud.cloud-apps.label_service-account }}** — выберите сервисный аккаунт, от имени которого будет происходить установка приложения. Если у вас нет сервисного аккаунта, создайте его.

     **Параметры хоста:**

     * **{{ ui-key.yacloud.cloud-apps.label_subnetwork }}** — выберите подсеть VPC, в которой будет развернута виртуальная машина. **Обязательно.**
     * **Идентификатор DNS зоны** — выберите DNS-зону из списка. **Обязательно.** Поддомены будут созданы внутри выбранной DNS-зоны.

     **Параметры доменов:**

     * **Поддомен сайта** — укажите поддомен внутри выбранной DNS-зоны, на котором будет доступен основной сайт. Домен сайта будет вычислен путём добавления поддомена к домену DNS‑зоны.
     * **Поддомен админ панели** — укажите поддомен внутри выбранной DNS-зоны для доступа к административной панели Ghost CMS. По умолчанию `admin`.  Домен административной панели будет вычислен добавлением поддомена к домену DNS-зоны. Административная панель будет доступна по адресу `https://<поддомен-админ-панели>.<домен-днс-зоны>/ghost`.
     * **Поддомен админ панели базы данных** — укажите поддомен внутри выбранной DNS-зоны для доступа к административной панели базы данных. По умолчанию `db`. Домен административной панели базы данных будет вычислен добавлением поддомена к домену DNS-зоны.
     * **Отправитель почты** — укажите адрес электронной почты, от имени которого будут отправляться уведомления (например, о смене пароля или регистрации). По умолчанию используется `noreply@<домен_сайта>`.

     **Параметры виртуальной машины:**

     * **Количество vCPU** — укажите количество виртуальных процессоров. По умолчанию: `2`.
     * **Объем RAM в GB** — укажите объем оперативной памяти. По умолчанию: `2`.
     * **Гарантированная доля vCPU** — укажите гарантированную долю процессорного времени (20, 50 или 100). По умолчанию: `100`.
     * **Публичный SSH ключ** — укажите публичный SSH-ключ для доступа к виртуальной машине. Если ключ указан, он будет добавлен в `authorized_keys` пользователя `ghost`. Это опциональное поле.

     **Параметры диска:**

     * **Тип диска** — выберите тип диска. По умолчанию: `network-ssd`.
     * **Размер диска в GB** — укажите размер диска. По умолчанию: `20`.

     **Параметры базы данных:**

     * **ID секрета с паролем БД** — укажите идентификатор секрета из {{ lockbox-name }}, содержащего пароль для базы данных по ключу `db_password`. Если секрет не указан, будет сгенерирован случайный пароль, значение которого можно будет найти в автоматически созданном секрете.
     * **ID секрета с root паролем БД** — укажите идентификатор секрета из {{ lockbox-name }}, содержащего пароль для root-пользователя базы данных по ключу `db_root_password`. Если секрет не указан, будет сгенерирован случайный пароль, значение которого можно будет найти в автоматически созданном секрете.

  1. Нажмите кнопку **{{ ui-key.yacloud.cloud-apps.button_install }}**.

     Установка приложения займет 5–10 минут. В процессе установки будут созданы следующие ресурсы:

     * сервисный аккаунт;
     * секреты для хранения паролей и ключей доступа;
     * права доступа для сервисного аккаунта;
     * публичный IP-адрес для виртуальной машины;
     * группа безопасности для виртуальной машины;
     * диск для хранения данных;
     * записи в DNS-зоне для поддоменов сайта, административной панели и административной панели БД;
     * S3-бакет для хранения медиафайлов (изображения, GIF-анимации и другие файлы, загружаемые на сайт).

     {% note info %}

     Загрузка видеофайлов в S3‑бакет невозможна ввиду ограничений, наложенных используемым плагином для работы с объектным хранилищем.

     {% endnote %}

     * виртуальная машина с установленным Ghost CMS.

     После создания всех ресурсов на виртуальной машине будет происходить настройка сайта и выпуск TLS-сертификатов. Дождитесь завершения установки.

{% endlist %}

{% note info %}

При установке приложения автоматически создаются адрес {{ postbox-name }} и DNS-запись для его верификации.

{% endnote %}

## Настройте Ghost CMS {#configure-ghost}

После успешной установки приложения настройте Ghost CMS:

1. Откройте в браузере адрес административной панели: `https://<поддомен-админки>/ghost` (где `<поддомен-админки>` — поддомен, который вы указали при установке, или поддомен сайта, если поддомен административной панели не был указан).

1. Заполните форму регистрации администратора:

   * **Название сайта** — укажите название вашего сайта.
   * **Имя** — укажите ваше имя.
   * **Email** — укажите адрес электронной почты для входа в административную панель.
   * **Пароль** — создайте надежный пароль для входа в административную панель.

1. Нажмите кнопку **Создать аккаунт и запустить сайт**.

1. После регистрации вы будете перенаправлены в административную панель Ghost CMS, где сможете начать работу с сайтом.

## Проверьте результат {#check-result}

Убедитесь, что Ghost CMS работает корректно:

1. Откройте в браузере поддомен основного сайта, который вы указали при установке. Вы должны увидеть главную страницу Ghost CMS.

1. Создайте тестовый пост:

   1. В административной панели нажмите кнопку **New post** (или **Новый пост**, если интерфейс переведен на русский язык).
   1. Заполните заголовок и содержимое поста.
   1. Загрузите изображение в пост — оно автоматически сохранится в S3-бакете.
   1. Опубликуйте пост.

1. Проверьте, что пост доступен на главной странице сайта.

1. Проверьте работу почтовых уведомлений:

   1. В административной панели перейдите в раздел настроек.
   1. Попробуйте восстановить пароль, используя функцию «Забыли пароль?».
   1. Проверьте, что письмо с инструкциями по восстановлению пароля пришло на указанный адрес электронной почты.

   {% note info %}

   Интеграция с {{ postbox-name }} поддерживает регистрацию пользователей и восстановление пароля. Массовые рассылки через {{ postbox-name }} не поддерживаются, так как для них требуется специальный API.

   {% endnote %}

1. (Опционально) Если вы указали домен для административной панели БД, откройте его в браузере:

   1. Войдите в административную панель базы данных.
   1. Для входа используйте:
      * **Сервер** — `db`.
      * **Движок** — `MySQL`.
      * **Имя пользователя** — `ghost`.
      * **Пароль** — пароль базы данных. Значение пароля можно найти в секрете, который был автоматически создан при установке приложения. Имя секрета содержит `db-passwords-secret`.

## Как удалить созданные ресурсы {#clear-out}

Чтобы остановить работу и перестать платить за созданные ресурсы:

1. Удалите установленное приложение Ghost CMS:

   1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором установлено приложение.
   1. В списке сервисов выберите **{{ ui-key.yacloud.iam.folder.dashboard.label_cloud-apps }}**.
   1. Найдите установленное приложение Ghost CMS в списке.
   1. Нажмите на значок ![image](../../_assets/console-icons/ellipsis.svg) рядом с приложением и выберите **{{ ui-key.yacloud.common.delete }}**.
   1. Подтвердите удаление приложения.

   {% note warning %}

   При удалении приложения автоматически не удаляются:
   * адрес {{ postbox-name }}, созданный при установке;
   * DNS-запись для верификации {{ postbox-name }}.

   Эти ресурсы необходимо удалить вручную.

   {% endnote %}

1. При необходимости [удалите](../../dns/operations/zone-delete.md) публичную DNS-зону.
1. При необходимости удалите адрес {{ postbox-name }} и связанные с ним DNS-записи.
