# Разметка аудио

Разметка аудио — это особый способ расшифровки аудиозаписей, предоставляемый Яндексом. Результаты расшифровки представляются в текстовом виде. Разметка аудио производится не алгоритмом машинного обучения, а живыми людьми по определенным правилам. Такой подход позволяет расшифровывать данные, с которыми у обычных алгоритмов возникают трудности: записи плохого качества, содержащие фоновый шум, неразборчивую речь или слова, понятные только в контексте.

Для разметки исходный материал делится на небольшие фрагменты так, чтобы каждый участок аудио присутствовал в нескольких фрагментах. За счет этого повышается точность расшифровки. 

В этом сценарии передача записей на аудиоразметку показана на примере заранее подготовленных файлов. Чтобы передать записи на разметку:
1. [Загрузите файлы для разметки](#files-uploading).
1. [Получите результаты разметки](#results).

## Правила расшифровки аудиозаписей {#rules}

При расшифровке аудиозаписей этим методом применяются следующие правила:
* Расшифровываются не только слова, но и междометия (<q>ага</q>, <q>угу </q> и т. п.).
* Числа записываются в виде слов (<q>пятого</q> и <q>пятерка</q> не будут преобразованы в <q>5</q>).
* Буква <q>ё</q> не заменяется на <q>е</q> (<q>ёж</q>, <q>ёлка</q> и т. д.).
* Иностранные слова записываются в транслитерации так как слышатся (<q>solutions</q> → <q>солюшенс</q>, <q>солюшнс</q>).
* Жаргонизмы записываются как можно ближе к оригинальному звучанию (<q>тыща</q>). 

    Если на записи точная форма слова слышна нечетко, оно не будет записано в виде жаргонизма (в этом случае <q>тыща</q> будет преобразована в <q>тысячу</q>).
* Аббревиатуры, формулы и неизвестные слова записываются так, как слышатся ( <q>H<sub>2</sub>O</q> → <q>аш два о</q>, <q>МГУ</q> → <q>эм гэ у</q> и т. д.).
* Спецсимволы записываются словами (<q>*#06#</q> → <q>звёздочка решётка ноль шесть решётка</q>).
* Неразборчивые слова заменяются символом `?`.

## Работа с персональными данными {#sencetive-data}

Несмотря на то, что аудиозаписи обрабатывают люди, технология разметки аудио позволяет сохранить конфиденциальность данных при расшифровке. Защита персональных данных организована следующим образом:

* Размер фрагмента выбирается достаточно малым.

    Чтобы минимизировать вероятность попадания персональных данных, но при этом не лишить речь смысла.
* Голос на записи меняется до неузнаваемости.
* Расшифрованные фрагменты автоматически склеиваются в текст, соответствующий исходной записи.

## Перед началом работы {#before-you-begin}

1. [Создайте проект](../datasphere-old/operations/projects/create.md) в **{{ ml-platform-name }}** и откройте его.
1. [Склонируйте](../datasphere-old/operations/projects/work-with-git.md#clone) Git-репозиторий, в котором находятся ноутбуки с примерами использования {{ yandex-cloud }} API:

    ```text
    https://github.com/yandex-cloud/examples
    ```

    Дождитесь окончания клонирования, это может занять некоторое время. После завершения операции в блоке **File Browser** появится каталог склонированного репозитория.
1. Перейдите в каталог `/examples/speechkitpro/markup/` и откройте ноутбук `markup.ipynb`.

## Загрузите файлы для разметки {#files-uploading}

1. Познакомьтесь с тестовыми записями, которые находятся в каталоге `/examples/speechkitpro/markup/records/`.

    Также вы можете загрузить свои аудиозаписи в этот каталог, требования к записям:
    * **формат файлов**: `mp3` или `wav`;
    * **частота дискретизации**: `8000`, `16000` или `48000` Гц;
    * **разрядность**: 16 бит, little endian.
1. Выделите ячейку ноутбука с командой передачи файлов на разметку, нажав слева от нее:

    ```bash
    #!nirvana
    sk_markup_records --records-dir ./examples/speechkitpro/markup/records/ --markup-result ./examples/speechkitpro/markup/results.json
    ```
1. Запустите выбранную ячейку, выбрав в меню **Run → Run Selected Cells** (также можно использовать сочетание клавиш **Shift** + **Enter**).

    {% include [safe-state](../_includes/datasphere/safe-state.md) %}

1. Дождитесь завершения операции:

    ```text
    [Step 1/2] Processing audio files from ./examples/speechkitpro/markup/records ...
    Collected 191 files of total size 7.76 MiB.
    Preparing collected data ...

    100.0% [==================================================>]

    Successfully prepared 191 audio files.
    Expected cost: 60 units

    Are you sure you want to continue? [yes/no]
    ```

    Будет выведена информация о количестве файлов, их общем размере и примерной стоимости распознавания. {% if audience != "internal" %}Подробнее см. [{#T}](../speechkit/pricing.md).{% endif %}
1. Подтвердите отправку записей на разметку.

    В поле ввода под вопросом **Are you sure you want to continue? [yes/no]** введите `yes` и нажмите **Enter**.

    Начнется процесс разметки:

    ```text
    Preceeding to next step.
    Running markup process for records in audio...
    ```

    Этот процесс может занять длительное время. Можно закрыть ноутбук и вернуться к нему позже, чтобы проверить статус процесса разметки.

## Получите результаты разметки {#results}

Результатом разметки будет файл `results.json`, созданный внутри каталога `/examples/speechkitpro/markup/`. В файле будет находиться список JSON-объектов вида:

```json
{
    "path": "<путь к файлу N>",
    "text": "<текст файла N, размеченный человеком>"
}
```

## Особенности разметки {#features}

* Скорость разметки зависит от качества и сложности записей, а также загруженности людей. В ночное время скорость разметки ниже.
* Скорость разметки нелинейна: на разметку сложной записи низкого качества длительностью 30 минут может потребоваться столько же времени, сколько на разметку записи хорошего качества длительностью в 1 час.
* Рекомендуется загружать записи порциями длительностью не более 10 часов.
