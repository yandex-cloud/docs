# Резервное копирование в {{ objstorage-full-name }} через CloudBerry Desktop Backup

Чтобы настроить резервное копирование в {{ objstorage-name }} через CloudBerry Desktop Backup:

1. [Подготовьте облако к работе](#before-you-begin)
1. [Создайте бакет](#create-bucket)
1. [Создайте сервисный аккаунт](#create-service-account)
1. [Создайте статический ключ доступа](#create-access-key)
1. [Установите CloudBerry Desktop Backup](#install-cloudberry)
1. [Настройте CloudBerry Desktop Backup](#configure-cloudberry)
1. [Протестируйте резервное копирование](#test-backup)
1. [Удалите созданные облачные ресурсы](#clear-out)

Бесплатная версия Cloudberry Desktop Backup позволяет создать не более 200 ГБ резервных копий.

## Подготовьте облако к работе {#before-you-begin}

{% include [before-you-begin](../_tutorials_includes/before-you-begin.md) %}

{% if product == "yandex-cloud" %}

### Необходимые платные ресурсы {#paid-resources}

В стоимость поддержки резервного копирования и восстановления входит:

* плата за хранение данных (см. [тарифы {{ objstorage-full-name }}](../../storage/pricing.md#prices-storage));
* плата за операции с данными (см. [тарифы {{ objstorage-full-name }}](../../storage/pricing.md#prices-operations));
* стоимость исходящего трафика из {{ yandex-cloud }} в интернет (см. [тарифы {{ objstorage-full-name }}](../../storage/pricing#prices-storage.md#prices-traffic)).

{% endif %}

## Создайте бакет {#create-bucket}

Чтобы создать бакет для резервного копирования:

{% include [create-bucket](../_tutorials_includes/create-public-bucket.md) %}

## Создайте сервисный аккаунт {#create-service-account}

Создайте [сервисный аккаунт](../../iam/operations/sa/create.md) с ролью `editor`.

## Создайте статический ключ доступа {#create-access-key}

Создайте [статические ключи доступа](../../iam/operations/sa/create-access-key.md). Сразу сохраните идентификатор и секретный ключ. После того, как вы закроете окно, параметры закрытого ключа будут недоступны.

## Установите CloudBerry Desktop Backup {#install-cloudberry}

{% list tabs %}

- Windows

  1. [Скачайте](https://www.msp360.com/download.aspx?prod=cbbbm&p=backup) и установите CloudBerry Backup. Для загрузки введите в поле свой адрес электронной почты и нажмите кнопку **Download**
  1. Запустите CloudBerry Backup и выберите пункт **Use Home Edition (free)**. Нажмите кнопку **Next**.
  1. Введите ключ из письма или нажмите кнопку **I do not have activation code** и введите адрес своей электронной почты. Нажмите кнопку **Start FreeTrial**.

- macOS

  1. [Скачайте](https://www.msp360.com/download.aspx?prod=cbbmac&p=backup) и установите CloudBerry Backup. Для загрузки введите в поле свой адрес электронной почты и нажмите кнопку **Download**
  1. Запустите CloudBerry Backup и выберите пункт **Use Home Edition (free)**. Нажмите кнопку **Next**.
  1. Введите имя пользователя и свой адрес электронной почты. На указанный адрес придет ключ регистрации.
  1. Проверьте почту и скопируйте полученный ключ в поле **Enter registration key**.
  1. Нажмите кнопку **Finish**.
  1. В открывшемся окне нажмите кнопку **OK**.

- Linux

  1. [Скачайте](https://www.msp360.com/download.aspx?prod=cbbub1214&p=backup) и установите CloudBerry Backup. Для загрузки выберите версию, подходящую для вашего дистрибутива Linux, введите в поле свой адрес электронной почты и нажмите кнопку **Download**
  1. Запустите CloudBerry Backup и выберите пункт **Use Home Edition (free)**. Нажмите кнопку **Next**.
  1. Введите имя пользователя и свой адрес электронной почты. На указанный адрес придет ключ регистрации.
  1. Проверьте почту и скопируйте полученный ключ в поле **Enter registration key**.
  1. Нажмите кнопку **Finish**.
  1. В открывшемся окне нажмите кнопку **OK**.

{% endlist %}

## Настройте CloudBerry Backup {#configure-cloudberry}

Чтобы настроить CloudBerry Backup для работы с {{ objstorage-name }}:

{% list tabs %}

- Windows

  1. Запустите CloudBerry Backup.
  1. Откройте главное меню, нажав кнопку со значком приложения в левом верхнем углу.
  1. Выберите пункт **Add New Account**.
  1. Нажмите ссылку **Show more**.
  1. В открывшемся списке провайдеров выберите **S3 compatible**.
  1. Выберите пункт **S3 compatible**. Откроется окно параметров хранилища.
     1. В поле **Display Name** введите `{{ yandex-cloud }}`.
     1. В поле **Access Key** укажите идентификатор статического ключа доступа.
     1. В поле **Secret Key** укажите закрытый ключ.
     1. В поле **Service point** укажите `http://{{ s3-storage-host }}/`. В поле `Bucket name` должен отобразиться список ваших бакетов.
     1. Выберите в поле **Bucket name** бакет, в котором будут храниться резервные копии.
     1. Нажмите кнопку **OK**. Если все настроено верно, хранилище `{{ yandex-cloud }}` появится в окне **Registered accounts**. Закройте окно.
  1. Откройте вкладку **Home**. Откроется окно мастера создания резервных копий.
  1. Выберите **Local or Cloud Backup** и нажмите кнопку **Next**.
  1. Выберите хранилище `{{ yandex-cloud }}` и нажмите кнопку **Next**.
  1. Укажите имя плана резервного копирования: `yc-backup-plan`. Нажмите кнопку **Next**.
  1. Выберите **Simple Mode**, чтобы создать простую копию без шифрования, но с возможностью доступа к резервным копиям через любые клиентские приложения. Нажмите кнопку **Next**.
  1. Не устанавливайте дополнительных флагов и нажмите кнопку **Next**.
  1. В дереве файлов укажите те директории и файлы, которым требуется резервное копирование. Нажмите кнопку **Next**.
  1. Выберите **Backup all files in selected folders**, чтобы сделать копию всех файлов в выбранных папках. Нажмите кнопку **Next**.
  1. На экране с предупреждением о невозможности шифрования резервных копий в пробной версии нажмите **Next**.
  1. Не изменяйте настройки удаления файлов и нажмите кнопку **Next**.
  1. Не задавайте настройки расписания копирования и нажмите кнопку **Next**.
  1. Не настраивайте дополнительные действия и нажмите кнопку **Next**.
  1. Если вы хотите получать уведомления о ходе копирования, установите флаг **I want to receive a notification email when plan completes**.

     Если вы хотите получать только уведомления о неудавшемся копировании, используйте опцию **When plan fails**. Чтобы получать уведомления обо всех событиях, используйте опцию **In all cases**. Укажите свою почту в поле **Email**, имя в поле **User name** и тему письма от Cloudberry в поле **Email subject**. Если вы настраиваете уведомления впервые, вам на почту придет письмо с запросом подтверждения ящика. Перейдите по ссылке из письма, чтобы получать уведомления. Нажмите кнопку **Next**.
  1. Проверьте план и нажмите кнопку **Next**.
  1. Нажмите кнопку **Finish**.

- macOS/Linux

  1. Запустите CloudBerry Backup.
  1. Нажмите кнопку **Backup files**.
  1. Нажмите кнопку **+**.
  1. Выберите пункт **S3 compatible**. Откроется окно параметров хранилища.
     1. В поле **Display Name** введите `{{ yandex-cloud }}`.
     1. В поле **Access Key** укажите идентификатор статического ключа доступа.
     1. В поле **Secret Key** укажите закрытый ключ.
     1. В поле **Endpoint** укажите `http://{{ s3-storage-host }}/`. В поле `Bucket` должен отобразиться список ваших бакетов.
     1. Выберите в поле **Bucket** бакет, в котором будут храниться резервные копии.
     1. Нажмите кнопку **OK**. Если все настроено верно, хранилище `{{ yandex-cloud }}` появится в списке.
  1. Выберите хранилище `{{ yandex-cloud }}` и нажмите кнопку **Continue**.
  1. Укажите имя плана резервного копирования: `yc-backup-plan`. Нажмите кнопку **Continue**.
  1. В дереве файлов укажите те директории и файлы, которым требуется резервное копирование. Нажмите кнопку **Continue**.
  1. Оставьте переключатель в положении **Backup all files in selected folders**, чтобы добавить в резервную копию все файлы из выбранных директорий. Нажмите кнопку **Continue**.
  1. В бесплатной версии недоступно шифрование. Нажмите кнопку **Continue**.
  1. Задайте настройки продолжительности хранения файлов и количества копий. По умолчанию одновременно хранятся три последних резервных копии. Выберите опцию **Use default**, чтобы использовать настройки по умолчанию. Нажмите кнопку **Continue**.
  1. По умолчанию резервное копирование производится вручную. Если требуется задать расписание копирования, используйте флаг **Enable schedule** и задайте расписание. Нажмите кнопку **Continue**.
  1. Если вы хотите получать уведомления о ходе копирования, установите флаг **I want to receive a notification email when plan completes**.

     Если вы хотите получать только уведомления о неудавшемся копировании, используйте опцию **When plan fails**. Чтобы получать уведомления обо всех событиях используйте опцию **In all cases**. Укажите свою почту в поле **Email**, имя в поле **User name** и тему письма от Cloudberry в поле **Email subject**. Если вы настраиваете уведомления впервые, вам на почту придет письмо с запросом подтверждения ящика. Перейдите по ссылке из письма, чтобы получать уведомления. Нажмите кнопку **Continue**.
  1. Проверьте план и нажмите кнопку **Done**.

{% endlist %}

## Протестируйте резервное копирование {#test-backup}

Чтобы протестировать резервное копирование:

{% list tabs %}

- Windows

  1. Откройте вкладку **Backup plans**.
  1. Напротив имени плана `yc-backup-plan` нажмите кнопку со стрелкой для ручного запуска резервного копирования.
  1. Откройте [консоль управления]({{ link-console-main }}).
  1. Перейдите в каталог, где находится бакет, в который помещаются резервные копии.
  1. Выберите сервис **{{ objstorage-short-name }}**.
  1. Откройте бакет `backup` и убедитесь, что все нужные файлы были скопированы.

- macOS/Linux

  1. В блоке **Backup plans** выберите план `yc-backup-plan`.
  1. Нажмите кнопку **Start** для ручного запуска резервного копирования.
  1. Откройте [консоль управления]({{ link-console-main }}).
  1. Перейдите в каталог, где находится бакет, в который помещаются резервные копии.
  1. Выберите сервис **{{ objstorage-short-name }}**.
  1. Откройте бакет `backup` и убедитесь, что все нужные файлы были скопированы.

{% endlist %}

## Как удалить созданные ресурсы {#clear-out}

{% include [clear-out](../_tutorials_includes/storage-clear-out.md) %}
