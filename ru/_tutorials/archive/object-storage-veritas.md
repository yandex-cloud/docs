# Резервное копирование в {{ objstorage-full-name }} через Veritas Backup Exec

Чтобы настроить резервное копирование в {{ objstorage-name }} через Veritas Backup Exec:

1. [Подготовьте облако к работе](#before-you-begin)
1. [Создайте бакет](#create-bucket)
1. [Создайте сервисный аккаунт](#create-service-account)
1. [Создайте статический ключ доступа](#create-access-key)
1. [Создайте облачный инстанс на {{ objstorage-full-name }}](#new-becloudinstance)
1. [Настройте облачное хранилище](#setup-cloud)
1. [Добавьте резервируемый сервер](#add-source)
1. [Настройте задание резервного копирования](#add-target)

## Подготовьте облако к работе {#before-you-begin}

Перед использованием {{ objstorage-full-name }} нужно зарегистрироваться в {{ yandex-cloud }} и создать платежный аккаунт:

{% include [prepare-register-billing](../_common/prepare-register-billing.md) %}

Если у вас есть активный платежный аккаунт, вы можете создать или выбрать каталог, в котором будет находиться ваш бакет. Перейдите на [страницу облака](https://console.cloud.yandex.ru/cloud) и выберите или создайте каталог, в котором вы хотите создать бакет. [Подробнее об иерархии ресурсов {{ yandex-cloud }}](../../resource-manager/concepts/resources-hierarchy.md).

### Необходимые платные ресурсы {#paid-resources}

В стоимость поддержки резервного копирования и восстановления входит:

* плата за хранение данных (см. [тарифы {{ objstorage-full-name }}](../../storage/pricing.md#prices-storage));
* плата за операции с данными (см. [тарифы {{ objstorage-full-name }}](../../storage/pricing.md#prices-operations));
* стоимость исходящего трафика из {{ yandex-cloud }} в интернет (см. [тарифы {{ objstorage-full-name }}](../../storage/pricing#prices-storage.md#prices-traffic)).

## Создайте бакет {#create-bucket}

Чтобы создать бакет для резервного копирования:

{% include [create-bucket](../_tutorials_includes/create-public-bucket.md) %}

## Создайте сервисный аккаунт {#create-service-account}

Создайте [сервисный аккаунт](../../iam/operations/sa/create.md) с ролью `storage.admin`.

## Создайте статический ключ доступа {#create-access-key}

Создайте [статические ключи доступа](../../iam/operations/sa/create-access-key.md). Сохраните идентификатор и секретный ключ, они понадобятся на следующих шагах. После того, как вы закроете окно, параметры закрытого ключа будут недоступны.

## Создайте облачный инстанс на {{ objstorage-full-name }} {#new-becloudinstance}

Запустите **Backup Exec Management Command Line Interface** и выполните команду:

```bash
BEMCLI> New-BECloudInstance
```

Последовательно введите параметры облачного инстанса:

* `Provider:` — `compatible-with-s3`.
* `ServiceHost:` — `storage.yandexcloud.net`.
* `SslMode:` — `disabled`.
* `Name:` — `Yandex-Cloud`.

Результат выполнения команды:

```text
cmdlet New-BECloudInstance at command pipeline position 1
Supply values for the following parameters:
Provider: compatible-with-s3
ServiceHost: storage.yandexcloud.net
SslMode: disabled
Name: Yandex-Cloud


Name        : yandex-cloud
Id          : 12436533-a39e-4df6-81db-f8365eb4178d
Provider    : compatible-with-s3
ServiceHost : storage.yandexcloud.net
SslMode     : Disabled
UrlStyle    : Path
HttpPort    : 80
HttpsPort   : 443
Endpoint    :
```

## Настройте облачное хранилище {#setup-cloud}

1. Запустите **Veritas Backup Exec**.
1. На панели **Хранилище** выберите **Настроить облачное хранилище**.
1. Введите **Имя** для устройства облачного хранилища и нажмите **Далее**.
1. Выберите поставщика для устройства **S3** и нажмите **Далее**.
1. Введите информацию о соединении:
    * Выберите **Облачное хранилище** `yandex-cloud [ compatible-with-s3 ]`.
    * В строке **Учетная запись** нажмите **Добавить/Изменить**.
    * В окне **Выбор учетной записи** нажмите **Добавить**.
    * В поле **Имя пользователя** введите идентификатор ключа.
    * В поле **Пароль** введите секретный ключ.
    * Введите **Подтверждение пароля**.
    * Задайте **Имя учетной записи**, например `Administrator of Bucket`.
    * Нажмите **ОК**, **ОК**.
    * Нажмите **Далее**.
1. Выберите бакет для резервного копирования, нажмите **Далее**.
1. Выберите количество параллельных операций для устройства, нажмите **Далее**.
1. Проверьте выбранные настройки и нажмите **Готово**.

## Добавьте резервируемый сервер {#add-source}

1. Запустите **Veritas Backup Exec**.
1. Откройте панель **Резервное копирование и восстановление**.
1. В выпадающем списке **Серверы и виртуальные хосты** выберите **Добавить**.
1. Выберите **Компьютеры и серверы Microsoft Windows**, нажмите **Далее**.
1. Выберите опцию **Разрешить Backup Exec устанавливать доверительные отношения с серверами**, нажмите **Далее**.
1. Добавьте сервер, нажмите **Далее**.
1. (опционально) Выберите опции обновления агента и перезапуска удаленного компьютера, нажмите **Далее**.
1. Проверьте выбранные настройки и нажмите **Установить**.

## Настройте задание резервного копирования {#add-target}

1. Запустите **Veritas Backup Exec**.
1. Откройте панель **Резервное копирование и восстановление**.
1. Выберите добавленный ранее сервер.
1. В выпадающем списке **Резервное копирование** выберите **Резервное копирование в облако**.
1. (опционально) Проверьте и измените настройки резервного копирования.

    В качестве хранилища должно быть выбрано созданное ранее облачное устройство.
1. Нажмите **ОК**.
