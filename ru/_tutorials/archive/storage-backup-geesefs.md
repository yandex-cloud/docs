# Резервное копирование в {{ objstorage-full-name }} с помощью GeeseFS

В этом практическом руководстве вы настроите резервное копирование файлов из локальной системы в облачное хранилище [{{ objstorage-full-name }}](../../storage/) с помощью [GeeseFS](../../storage/tools/geesefs.md).

GeeseFS позволяет монтировать [бакет](../../storage/concepts/bucket.md) как обычную папку. Это дает возможность использовать привычные инструменты копирования и синхронизации. Резервное копирование выполняется путем копирования и синхронизации данных между локальным каталогом и бакетом. Это выглядит как работа с двумя папками, одна из которых находится в облаке. Для оптимизации процесса применяются инструменты синхронизации, которые передают только новые и измененные файлы — например, `rsync` или `robocopy`.

Чтобы настроить резервное копирование с помощью GeeseFS:

1. [Подготовьте облако к работе](#before-begin).
1. [Создайте бакет](#create-bucket).
1. [Создайте сервисный аккаунт](#create-sa).
1. [Создайте статический ключ доступа](#create-static-key).
1. [Подготовьте окружение](#prepare-env).
1. [Смонтируйте бакет](#mount-bucket).
1. [Синхронизируйте локальный каталог с бакетом](#sync).

Если созданные ресурсы вам больше не нужны, [удалите их](#clear-out).


## Перед началом работы {#before-you-begin}

{% include [before-you-begin](../_tutorials_includes/before-you-begin.md) %}


### Необходимые платные ресурсы {#paid-resources}

{% include [paid-resources](../_tutorials_includes/storage-backup/paid-resources.md) %}


## Создайте бакет {#create-bucket}

{% include [versioning-warning](../_tutorials_includes/storage-backup/versioning-warning.md) %}

{% include [create-bucket](../_tutorials_includes/storage-backup/create-bucket.md) %}


## Создайте сервисный аккаунт {#create-sa}

{% include [create-sa](../_tutorials_includes/storage-backup/create-sa.md) %}


## Создайте статический ключ доступа {#create-static-key}

{% include [create-static-key](../_tutorials_includes/storage-backup/create-static-key.md) %}


## Подготовьте окружение {#prepare-env}

### Установите GeeseFS {#install-geesefs}

{% include [geesefs-installation](../../_includes/storage/geesefs-installation.md) %}


### Аутентифицируйте GeeseFS {#auth-geesefs}

GeeseFS использует статический ключ доступа к {{ objstorage-name }}, [полученный ранее](#create-static-key). Он задается несколькими способами:

{% include [geesefs-authentication](../../_includes/storage/geesefs-authentication.md) %}


## Смонтируйте бакет {#mount-bucket}

Выберите каталог или диск для монтирования бакета. Убедитесь, что у вас достаточно прав для этой операции.

При монтировании бакета также можно задать настройки GeeseFS, связанные с [производительностью](../../storage/tools/geesefs.md#performance) и правами доступа к объектам. Чтобы посмотреть список опций и их описания, выполните команду `geesefs --help`.

{% include [geesefs-bucket-mounting](../../_includes/storage/geesefs-bucket-mounting.md) %}


## Синхронизируйте локальный каталог с бакетом {#sync}

Чтобы завершить настройку резервного копирования, настройте [ручную](#manual-sync) или [автоматическую](#auto-sync) синхронизацию локального каталога с бакетом.


### Ручная синхронизация {#manual-sync}

{% list tabs group=operating_system %}

- Linux {#linux}

  Для разовой синхронизации выполните команду:

  ```bash
  rsync -av \
    --no-owner \
    --no-group \
    --no-perms \
    --no-times \
    --delete \
    <путь_к_локальному_каталогу>/ \
    <путь_к_каталогу_монтирования>/
  ```

  Где `--delete` — флаг для удаления файлов из бакета при их удалении из локального каталога.

  {% include [note-full-path](../_tutorials_includes/storage-backup/note-full-path.md) %}

  Данная команда копирует все содержимое из локального каталога в бакет через каталог, смонтированный с помощью GeeseFS. При этом переносит только новые и измененные файлы.

  Каталог GeeseFS не является полноценной POSIX-совместимой файловой системой, поэтому не переносятся владелец, права доступа и временные метки.

- Windows {#windows}

  Для разовой синхронизации выполните в командной строке (`CMD`):

  ```bash
  robocopy "<путь_к_локальному_каталогу>" "<путь_к_каталогу_монтирования>" /MIR
  ```

  Где `/MIR` — параметр для полной синхронизации каталогов, включая удаление отсутствующих файлов.

  {% include [note-full-path](../_tutorials_includes/storage-backup/note-full-path.md) %}

  Результат:

  ```text
  -------------------------------------------------------------------------------
    ROBOCOPY     ::     Robust File Copy for Windows
  -------------------------------------------------------------------------------

        Начало : 6 октября 2025 г. 21:16:36
      Источник : C:\Users\username\geesefs\local\
    Назначение : C:\Users\username\geesefs\mount\

      Файлы: *.*
  Параметры: *.* /S /E /DCOPY:DA /COPY:DAT /PURGE /MIR /R:1000000 /W:30

  ------------------------------------------------------------------------------

  1    C:\Users\username\geesefs\local\
  100%        Новый файл             13793        image.PNG

  ------------------------------------------------------------------------------

                ВсегоСкопировано ПропущеноНесоответствие      СБОЙДополнения
  Каталогов :         1         0         1         0         0         0
     Файлов :         1         1         0         0         0         0
       Байт :    13.4 k    13.4 k         0         0         0         0
      Время :   0:00:00   0:00:00                       0:00:00   0:00:00

  Скорость :         13793000 Байт/сек.
  Скорость :            789.241 МБ/мин.
  Окончание: 6 октября 2025 г. 21:16:36
  ```

  {% note tip %}

  Чтобы каждый раз не запускать команду, можно создать BAT-файл:

  1. Откройте **Блокнот** (**Notepad**) и добавьте следующее содержимое:

      ```text
      @echo off
      robocopy "<путь_к_локальному_каталогу>" "<путь_к_каталогу_монтирования>" /MIR
      ```

  1. Сохраните файл, например, как `sync_to_s3.bat`.
  1. Чтобы синхронизировать каталоги, запустите BAT-файл.

  {% endnote %}

{% endlist %}


### Автоматическая синхронизация {#auto-sync}

{% list tabs group=operating_system %}

- Linux {#linux}

  Для автоматической синхронизации локального каталога с каталогом GeeseFS:

  1. Убедитесь, что у пользователя, от имени которого будет ставиться задание в `cron`, есть доступ к обоим каталогам.
  1. Откройте файл планировщика текущего пользователя, выполнив команду:

      ```bash
      crontab -e
      ```

  1. Добавьте в файл строку для автоматической синхронизации, например, каждые 10 минут:

      ```text
      */10 * * * * rsync -av --no-owner --no-group --no-perms --no-times --delete <путь_к_локальному_каталогу>/ <путь_к_каталогу_монтирования>/ --log-file=<путь_к_файлу_логов>
      ```

      Где:

      * `--delete` — флаг для удаления файлов из бакета при их удалении из локального каталога.
      * `--log-file` — опциональный параметр для записи логов. Указывайте полный путь.

      {% include [note-full-path](../_tutorials_includes/storage-backup/note-full-path.md) %}

  Задание будет запускаться с заданной периодичностью и выполнять синхронизацию каталогов.

  Команда в задании `cron` копирует все содержимое из локального каталога в бакет через каталог, смонтированный с помощью GeeseFS. При этом переносит только новые и измененные файлы.

  Каталог GeeseFS не является полноценной POSIX-совместимой файловой системой, поэтому не переносятся владелец, права доступа и временные метки.

- Windows {#windows}

  {% include [auto-sync-windows](../_tutorials_includes/storage-backup/auto-sync-windows.md) %}

{% endlist %}


## Как удалить созданные ресурсы {#clear-out}

{% include [clear-out](../_tutorials_includes/storage-backup/clear-out.md) %}