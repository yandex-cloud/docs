# Создание и публикация диаграммы с картой Москвы из CSV-файла

С помощью {{ datalens-short-name }} вы можете предоставлять публичный доступ к созданным чартам и дашбордам. 

{% note warning %}

Перед публикацией собственных данных убедитесь, что данные на чартах и дашбордах не являются персональными данными или коммерческой тайной. Доступ к опубликованным данным не ограничен.

{% endnote %}

В этом сценарии с помощью {{ datalens-short-name }} будут визуализированы и опубликованы показатели населения на карте районов Москвы.

В качестве исходных данных будет использоваться файл [Moscow Population 2018.csv](https://storage.yandexcloud.net/doc-files/Moscow%20Population%202018.csv) с информацией о населении и площади Москвы на 2018 год. Источник — [Список районов и поселений Москвы](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D1%80%D0%B0%D0%B9%D0%BE%D0%BD%D0%BE%D0%B2_%D0%B8_%D0%BF%D0%BE%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B9_%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D1%8B).

Для визуализации и исследования данных [подготовьте {{ datalens-short-name }} к работе](#before-you-begin), затем выполните следующие шаги:

1. [Создайте подключение](#step1).
1. [Создайте датасет](#step2).
1. [Создайте чарт с картой районов Москвы](#step3).
1. [Опубликуйте чарт](#step4).


## Перед началом работы {#before-you-begin}

{% include [before-you-begin](../includes/before-you-begin-datalens.md) %}


## Шаг 1. Создайте подключение и датасет {#step1}

Создайте датасет на основе [подключения](../../datalens/concepts/connection.md) типа **Файлы**.

1. Перейдите в интерфейс [{{ datalens-short-name }}]({{ link-datalens-main }}).
1. Нажмите кнопку **Создать подключение**.

   ![image](../../_assets/datalens/solution-05/01-create-connection.png)

1. Выберите тип подключения **Файлы**.

   ![image](../../_assets/datalens/solution-05/select-file-connection.png)

1. Нажмите кнопку **Загрузить файлы**, затем выберите необходимый файл. В данном примере **Moscow Population 2018.csv** ([ссылка на скачивание](https://yadi.sk/d/H4dQKVDpU4Rd8g)). Загрузка может занять до нескольких минут, в зависимости от скорости подключения к интернету.

   ![image](../../_assets/datalens/solution-05/04-choose-file-upload.png)

   После успешной загрузки вы увидите превью данных файла. Для просмотра используйте полосы прокрутки справа и внизу.

   ![image](../../_assets/datalens/solution-07/05-preview.png)

1. В правом верхнем углу нажмите кнопку **Создать подключение**.
1. Введите имя подключения `Moscow Population 2018` и нажмите кнопку **Создать**.

Подключение к файлу создано. Данные представлены в том же виде, что и в файле. Для дальнейшей работы с ними нужно создать датасет.

1. Нажмите кнопку **Создать датасет**.

   ![image](../../_assets/datalens/solution-07/07-create-dataset.png)

## Шаг 2. Создайте датасет {#step2}

1. Если рабочая область пустая, то перетащите таблицу **Moscow Population 2018.csv** из панели выбора на рабочую область.

    ![image](../../_assets/datalens/solution-05/06-drag-table.png)

1. Перейдите на вкладку **Поля**.

    ![image](../../_assets/datalens/solution-05/07-dataset-tab.png)

1. Для полей **Площадь**, **Население** и **Площадь жилфонда** укажите тип агрегации **Сумма**.

    ![image](../../_assets/datalens/solution-05/08-change-aggregation.png)
    
    Поля с определенными функциями агрегации становятся показателями и меняют свой цвет на голубой.

    ![image](../../_assets/datalens/solution-05/09-measures.png)
    
1. Для поля **Координаты района** измените тип данных на **Геополигон**.

    ![image](../../_assets/datalens/solution-05/10-geopoligon.png)

1. В правом верхнем углу нажмите кнопку **Сохранить**.

    ![image](../../_assets/datalens/solution-05/11-save-dataset.png)
    
1. В открывшемся окне введите имя датасета **Население Москвы** и нажмите кнопку **Создать**.
    
1. После сохранения датасета нажмите **Создать чарт**. 

    ![image](../../_assets/datalens/solution-05/12-create-chart.png)

## Шаг 3. Создайте чарт с картой районов Москвы {#step3}

1. Выберите тип визуализации **Карта**.

   ![image](../../_assets/datalens/solution-05/13-choose-map.png)

1. Выберите тип слоя **Полигоны (Геополигоны)**.

   ![image](../../_assets/datalens/solution-05/13-1-choose-map-geo.png)

1. Добавьте на карту полигоны районов. Для этого из раздела **Измерения** перетащите поле **Координаты** в секцию **Полигоны (Геополигоны)**.

    ![image](../../_assets/datalens/solution-05/14-use-coordinates.png)

1. Измените цвета районов относительно показателя населения. Для этого из раздела **Показатели** перетащите поле **Население** в секцию **Цвета**.

    ![image](../../_assets/datalens/solution-05/15-use-measure.png)

1. В правом верхнем углу нажмите кнопку **Сохранить**.

    ![image](../../_assets/datalens/solution-05/15-1-save-chart.png)
   
1. В открывшемся окне введите название чарта **Карта населения Москвы по районам** и нажмите кнопку **Сохранить**.

## Шаг 4. Опубликуйте чарт {#step4}

1. Нажмите значок ![image](../../_assets/datalens/horizontal-ellipsis.svg) и в открывшемся списке выберите **Публичный доступ**.

    ![image](../../_assets/datalens/solution-05/16-share-button.png)

1. В открывшемся окне **Настройка публичного доступа** включите **Доступ по ссылке**.

    ![image](../../_assets/datalens/solution-05/17-share1.png)
    
1. Подтвердите публикацию чарта и связанных с ним данных.

1. Скопируйте уникальный URL чарта. Нажмите **Применить**.

    ![image](../../_assets/datalens/solution-05/18-share2.png)

1. Откройте новую вкладку в браузере и перейдите по скопированной ссылке.

    ![image](../../_assets/datalens/solution-05/19-public.png)

Этой ссылкой можно поделиться с коллегами, партнерами или друзьями. При переходе по ссылке чарта не требуется авторизация и аутентификация.

**Попробуйте еще:**

* Построить столбчатую диаграмму по районам и населению.
* [Создать дашборд](../../datalens/operations/dashboard/create.md) с картой, столбчатой диаграммой и [селекторами](../../datalens/operations/dashboard/add-selector.md).
* [Опубликовать дашборд](../../datalens/concepts/datalens-public.md#how-to-publish).
