# Восстановить виртуальную машину из резервной копии другой виртуальной машины  

Если в каталоге есть несколько виртуальных машин, подключенных к {{ backup-name }}, можно восстановить одну ВМ из резервной копии другой. Это нужно, например, если исходная ВМ неисправна.

{% note info %}

Операционная система целевой ВМ должна совпадать с операционной системой исходной ВМ, из которой создана резервная копия. Размер загрузочного диска целевой ВМ должен быть не меньше размера загрузочного диска исходной ВМ.

{% endnote %}

Чтобы восстановить ВМ из копии другой ВМ:

{% list tabs %}

- Консоль управления

  1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором находится резервная копия.
  1. Выберите сервис **{{ backup-name }}**.
  1. Перейдите на вкладку ![backups](../../../_assets/backup/backups.svg) **Резервные копии**.
  1. Напротив резервной копии, из которой нужно восстановить ВМ, нажмите ![image](../../../_assets/options.svg) и выберите **Восстановить ВМ**.
  1. В поле **Целевая ВМ** выберите ВМ, в которую нужно восстановить резервную копию, или [создайте](../#connect-vm) новую ВМ с подключением к {{ backup-name }}. Чтобы создать новую ВМ для восстановления, нажмите кнопку **Создать**:
      1. На открывшейся странице задайте параметры новой ВМ и нажмите кнопку **Создать ВМ**.
          Дождитесь [подключения](../../concepts/vm-connection.md) ВМ к {{ backup-name }}.
      1. Вернитесь на страницу восстановления ВМ.
      1. Чтобы обновить список ВМ, нажмите ![refresh](../../../_assets/backup/refresh.svg).
      1.  Выберите ВМ, созданную ранее.
  1. Чтобы исключить конфликт между восстановленной и исходной ВМ, включите опцию **Удалить неактуальную ВМ**.

     Если не включить эту опцию, то после восстановления исходная ВМ, из которой была создана копия, станет неактуальной. Чтобы продолжить создавать резервные копии этой ВМ, [обновите](../refresh-connection.md) ее подключение к {{ backup-name }}.
  1. Нажмите кнопку **Восстановить**.

- CLI

  1. {% include [cli-install](../../../_includes/cli-install.md) %}

  1. {% include [default-catalogue](../../../_includes/default-catalogue.md) %}

  1. Посмотрите описание команды CLI для восстановления ВМ из резервной копии:

     ```bash
     yc backup backups recover --help
     ```

  1. Узнайте идентификаторы целевой ВМ, в которую вы хотите восстановить резервную копию, и исходной ВМ, чью резервную копию вы хотите использовать:

     ```bash
     yc compute instance list
     ```

     Результат:

     ```bash
     +----------------------+---------+---------------+---------+--------------+-------------+
     |          ID          |  NAME   |    ZONE ID    | STATUS  | EXTERNAL IP  | INTERNAL IP |
     +----------------------+---------+---------------+---------+--------------+-------------+
     | epdhmn8mdqmt******** | my-vm-1 | {{ region-id }}-b | RUNNING | 51.250.**.** | 192.168.*.* |
     | epdis3p9paoe******** | my-vm-2 | {{ region-id }}-b | RUNNING | 84.201.**.** | 192.168.*.* |
     +----------------------+---------+---------------+---------+--------------+-------------+
     ```

  1. Узнайте идентификатор резервной копии исходной ВМ:

     ```bash
     yc backup backups list \
       --instance-id <идентификатор_исходной_ВМ>
     ```

     Где `--instance-id` — идентификатор исходной ВМ, резервную копию которой вы хотите использовать.

     Результат:

     ```bash
     +--------------------------------------+--------------------------------------+----------------------+--------------------------------------+----------------------+------+------------------+--------+---------------------+
     |                  ID                  |              ARCHIVE ID              | COMPUTE INSTANCE ID  |             RESOURCE ID              |      POLICY ID       | TYPE |      DISKS       |  SIZE  |     CREATED AT      |
     +--------------------------------------+--------------------------------------+----------------------+--------------------------------------+----------------------+------+------------------+--------+---------------------+
     | 9cba836d-869c-41d2-8f25-0dac******** | 8a5b6d59-f7ce-0cb9-6cbf-151c******** | epdhmn8mdqmt******** | 7AF6A532-D1DC-4945-9D0C-E101******** | cdgiqu6ouch3******** | FULL | Disk 1 (13.0 GB) | 1.4 GB | 2023-07-11 05:10:09 |
     | 05e964ca-6a8f-481a-b83e-44c5******** | 8a5b6d59-f7ce-0cb9-6cbf-151c******** | epdhmn8mdqmt******** | 7AF6A532-D1DC-4945-9D0C-E101******** | cdgiqu6ouch3******** | FULL | Disk 1 (15.0 GB) | 1.4 GB | 2023-07-11 05:00:07 |
     +--------------------------------------+--------------------------------------+----------------------+--------------------------------------+----------------------+------+------------------+--------+---------------------+
     ```

  1. Восстановите ВМ из резервной копии:

     ```bash
     yc backup backups recover \
       --source-backup-id <идентификатор_резервной копии> \
       --destination-instance-id <идентификатор_целевой_ВМ>
     ```

     Где:

     * `--source-backup-id` — идентификатор резервной копии.
     * `--destination-instance-id` — идентификатор целевой ВМ, в которую вы хотите восстановить резервную копию.

     Результат:

     ```bash
     ...1s...6s...11s ... 9m4s...9m9s...done (9m9s)
     ```

     Подробнее о команде читайте в [справочнике CLI](../../../cli/cli-ref/managed-services/backup/backup/recover.md).

  После восстановления исходная ВМ, из которой была создана копия, станет неактуальной. Чтобы избежать конфликтов между двумя ВМ при резервном копировании, [удалите](../../../compute/operations/vm-control/vm-delete.md) неактуальную ВМ или [обновите](../refresh-connection.md) ее подключение к {{ backup-name }}.

{% endlist %}

#### См. также {#see-also}

* [{#T}](delete.md)