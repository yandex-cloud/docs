---
title: Политика жизненного цикла в {{ cloud-registry-full-name }}
description: Политика жизненного цикла — это набор правил, которые управляют хранением или удалением артефактов в реестре. Политики помогают автоматически удалять старые или неиспользуемые версии артефактов для экономии места и снижения затрат на хранение.
---

# Политика жизненного цикла в {{ cloud-registry-full-name }}

_Политика жизненного цикла_ — это набор правил, которые управляют хранением или удалением артефактов в [реестре](registry.md). Политики помогают автоматически удалять старые или неиспользуемые версии [артефактов](artifacts.md) для экономии места и снижения затрат на хранение.

Каждое правило в политике содержит фильтр по префиксу пути (`path_prefix`), который определяет выборку артефактов, к которым применяется правило. Например, если указать `path_prefix` равный `.*`, правило будет применяться ко всем артефактам всех пакетов в реестре. Если указать конкретный префикс пути, например, `ubuntu/.*` правило будет применяться только к артефактам, пути которых начинаются с этого префикса.

## Привязка к реестру {#registry-binding}

Политика жизненного цикла привязана к конкретному [реестру](registry.md). Одна политика может быть применена только к одному реестру. Правила политики применяются ко всем артефактам в этом реестре, которые соответствуют условиям правил.

## Ограничения {#limits}

Для политик жизненного цикла действуют следующие ограничения:

* Максимум **одна включенная** политика на реестр.
* Максимум **10 правил** в одной политике.
* Максимум **10 политик** для одного реестра (включая отключенные).

## Типы правил {#rule-types}

Правила в политике жизненного цикла определяют, какие артефакты должны быть сохранены или удалены. Правила бывают трех типов:

### KEEP — сохранение артефактов {#keep-rule}

Правила типа _KEEP_ описывают, какие артефакты должны быть сохранены от удаления политикой жизненного цикла. Эти правила имеют более высокий приоритет над правилами удаления (`HARD_DELETE` и `SOFT_DELETE`).

Существует два вида правил сохранения:

* **По возрасту** — сохраняет артефакты, которые моложе указанного количества дней из выборки, попадающей под фильтры правила.
* **По количеству версий** — сохраняет указанное количество последних версий артефактов из выборки, попадающей под фильтры правила (например, 5 последних версий по дате создания).

### HARD_DELETE — жесткое удаление {#hard-delete-rule}

Правило типа _HARD_DELETE_ безвозвратно удаляет артефакты, которые соответствуют условиям правила. После применения этого правила артефакты удаляются навсегда и не могут быть восстановлены.

Условия для удаления могут быть следующими:

* **По возрасту** — удаляет артефакты старше указанного количества дней из выборки, попадающей под фильтры правила.
* **По количеству версий** — удаляет самые старые артефакты из выборки, если их количество превышает указанное (удаляются самые старые версии).
* **Всегда** — удаляет все артефакты, соответствующие фильтрам правила.

### SOFT_DELETE — мягкое удаление {#soft-delete-rule}

Правило типа _SOFT_DELETE_ помечает артефакты для удаления, но не удаляет их сразу. Артефакты остаются в реестре в течение периода ожидания (cooldown period), указанного в правиле. После истечения этого периода артефакты удаляются безвозвратно.

{% note warning %}

Артефакты, помеченные для мягкого удаления, продолжают тарифицироваться и за них нужно платить на протяжении всего периода ожидания до окончательного удаления.

{% endnote %}

Условия для мягкого удаления аналогичны правилам `HARD_DELETE`.

## Фильтры правил {#rule-filters}

Каждое правило содержит фильтры, которые определяют выборку артефактов, к которым применяется правило:

* **Префикс пути** (`path_prefix`) — определяет, к каким артефактам применяется правило по их пути. Если указать `.*`, правило будет применяться ко всем артефактам всех пакетов в реестре. Можно указать конкретный префикс пути, например `@path/prefix.*`.
* **Docker-фильтры** — позволяют дополнительно фильтровать Docker-образы по статусу тегов (с тегами, без тегов).
* **Maven-фильтры** — позволяют дополнительно фильтровать Maven-артефакты по типу версии (release, snapshot).

Правила по количеству версий или дате применяются к выборке артефактов, которая попадает под все указанные фильтры.

## Применение политик {#policy-execution}

Политики жизненного цикла выполняются автоматически по расписанию. Обработка правил происходит ежедневно в указанное время. Изменения политик вступают в силу не сразу, а применяются при следующем запуске обработки.

Правила применяются в следующем порядке приоритета:

1. Сначала применяются правила `KEEP` — определяются артефакты, которые должны быть сохранены.
2. Затем применяются правила `HARD_DELETE` и `SOFT_DELETE` — определяются артефакты для удаления, за исключением тех, которые защищены правилами `KEEP`.

#### См. также {#see-also}

* [{#T}](../operations/lifecycle-policy/create.md) — создание политики жизненного цикла
* [{#T}](../tutorials/lifecycle-policy-examples.md) — примеры политик жизненного цикла
* [{#T}](../operations/registry/create.md) — создание реестра
