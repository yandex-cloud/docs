# Алертинг

Алертинг сервиса {{ monitoring-full-name }} позволяет уведомлять пользователей облака об изменении метрик. Например, вы можете настроить уведомление об изменении состояния ресурса вашего облака и вовремя среагировать на проблему.

Алертинг отслеживает изменения определенных метрик с помощью [алертов](#alert) и отправляет уведомления через [канал уведомлений](#notification-channel).

## Алерт {#alert}

_Алерт_ — периодически вычисляемая функция, которая применяется к значению метрики.

Функция вычисляется раз в минуту. Полученное значение сравнивается с заранее заданными пороговыми значениями.

Если значение функции достигает указанного порогового значения, {{ monitoring-short-name }} переводит алерт в [статус](#alert-statuses) `Alert` или `Warning` и оповещает пользователя по [каналу уведомления](#notification-channel). 
 
### Статусы алертов {#alert-statuses}

Алерт может находиться в одном из следующих статусов:

Статус | Описание
----- | -----
`OK` | Значение метрики в пределах установленной нормы
`Warning` | Значение метрики достигло порога предупреждения `Warning`
`Alarm` | Значение метрики достигло порога критического статуса `Alarm`
`No Data` | Для вычисления функции алерта не хватает данных метрик
`Error` | Значение алерта вычислить невозможно

### Параметры алерта {#alert-parameters}

Параметры алерта задаются при его создании. После сохранения алерта вы можете их отредактировать. 

С их помощью вы можете изменить условия вычисления функции алерта, например, задать [функцию агрегации](#aggregation) или указать [окно вычисления](#evaluation-window).

Главный параметр алерта — метрики, над значениями которых вычисляется функция. Метрики для алерта задаются с помощью [запросов](data-model.md#queries). Например, вы можете создать один алерт для нескольких виртуальных машин.

#### Условия срабатывания {#condition}

Вы можете задать пороговые значения метрик, в зависимости от которых {{ monitoring-short-name }} переводит алерт в состояния `Alarm` и `Warning`.

#### Окно вычисления {#evaluation-window}

Временной период, в котором будет рассчитываться функция агрегации алерта.
Окно позволяет исключить резкие изменения значения метрик, реагируя только на изменения за больший промежуток времени.

Вы можете выбрать одно из предустановленных значений окна или задать свое в следующем формате:
* `1h` — 1 час.
* `1m` — 1 минута.
* `1s` — 1 секунда.

Минимально допустимое значение — 1 минута (`1m`).  
Максимально допустимое значение — 1 час (`1h`).

> Например, значение `3m 45s` задает временное окно в 3 минуты 45 секунд.

#### Функции агрегации {#aggregation}

Функция применяется к значениям метрик, которые попали в [окно вычисления](#evaluation-window).
Полученное значение функции сравнивается с заданными порогами алерта.
Если значение удовлетворяет порогу срабатывания алерта, {{ monitoring-full-name }} изменяет его статус. 

Функция агрегации| Описание
----- | -----
**Среднее** | Вычисляет среднее значение в указанном периоде для каждой метрики.<br/>Например, если запрос возвращает две метрики, то {{ monitoring-short-name }} для каждой из них вычислит среднее значение в указанном окне
**Количество** | Вычисляет количество значений метрики в указанном периоде
**Последнее** | Использует последнее значение метрики в указанном периоде. Если значения метрики не удалось получить, {{ monitoring-full-name }} сменит статус алерта на `No Data`
**Максимум** | Использует максимальное значение метрики в указанном периоде
**Минимум** | Использует минимальное значение метрики в указанном периоде
**Сумма** | Вычисляет сумму значений за указанный период для каждой метрики

> Например, если вы хотите следить за последним значением метрики, которое было в течение последних 15 минут, необходимо выбрать функцию **Последнее** и задать **Окно вычисления** `15m`.

## Канал уведомлений {#notification-channel}

Чтобы получать уведомления о переходе алерта в другой статус, необходимо указать канал уведомлений. Канал содержит информацию о получателях и методах отправки.

Один канал можно использовать повторно для других алертов.

### Параметры канала уведомлений {#channel-parameters}

- **Получатели**. Список пользователей, которые должны получить уведомление в случае выполнения функции алерта. 

    {% note info %}

    Вы можете указать только аккаунт в {{ yandex-cloud }} в качестве получателя уведомлений.
    Для отправки SMS необходимо привязать телефонный номер к аккаунту пользователя.
    
    Подробнее об аккаунтах в {{ yandex-cloud }} в документации сервиса [{{ iam-full-name }}](../../iam/concepts/index.md#accounts).

    {% endnote %}

- **Метод уведомления**. Метод, с помощью которого пользователи получат уведомление. Например, электронная почта или SMS.

После создания канала доступны дополнительные параметры:

- **Уведомлять о статусах**. Выберите список статусов алерта, о которых нужно слать уведомление в канал.
- **Уведомлять повторно**. Выберите период, с которым {{ monitoring-short-name }} будет отправлять повторные уведомления о том, что алерт находится в том же статусе. 

### Статусы отправки {#dispatch-statuses}

Каждая отправка может находится в одном из следующих статусов:

Статус | Описание
----- | -----
`Успешно отправлено` | Уведомление успешно отправлено
`Не удалось отправить` | Не удалось отправить уведомление из-за ошибки
`Ресурс исчерпан` | Не удалось отправить уведомление из-за ограничения метода отправки
