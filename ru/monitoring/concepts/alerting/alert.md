# Алерт

_Алерт_ — периодически вычисляемый набор последовательных именованных [запросов](../data-model.md#queries).

Набор запросов вычисляется раз в минуту. Полученное значение запроса, указанного в [настройках](#alert-parameters), сравнивается с заранее заданными пороговыми значениями.

Если результат запроса, указанного в [настройках](#alert-parameters), достигает порогового значения, {{ monitoring-short-name }} переводит алерт в [статус](#alert-statuses) `Alert` или `Warning` и оповещает пользователя по [каналу уведомления](#notification-channel).

## Статусы алертов {#alert-statuses}

Алерт может находиться в одном из следующих статусов:

Статус | Описание
----- | -----
`OK` | Значение метрики в пределах установленной нормы.
`Warning` | Значение метрики достигло порога предупреждения `Warning`.
`Alarm` | Значение метрики достигло порога критического статуса `Alarm`.
`No Data` | Для вычисления функции алерта не хватает данных метрик.
`Error` | Значение алерта вычислить невозможно.

## История вычислений алерта {#evaluation-history}

История вычислений алерта представлена в виде графика, состоящего из столбцов, цвет которых зависит от статуса алерта на момент его вычисления.

Для навигации по истории можно выбрать один из предустановленных масштабов отображения:

* `1h` — 1 час.
* `1d` — 1 день.
* `1w` — 1 неделя.
* `1m` — 1 месяц.

Минимальный масштаб отображения истории — `1h`: каждый столбец на графике показывает статус алерта в соответствующую минуту. При больших масштабах цвет столбца составляется из статусов, вычисленных в этом интервале.

При нажатии на столбец загружается информация о настройках алерта в выбранный момент вычисления.

{% note info %}

При загрузке информации из истории вычисления производится повторный расчет статуса алерта, который отображается в поле **Статус**. Статус алерта в истории может не совпадать с текущим результатом вычисления из-за особенностей [прореживания исторических данных](../decimation.md) или задержек при [поставке данных](../data-collection/unified-agent/index.md) в {{ monitoring-name }}.

{% endnote %}

## Настройки алерта {#alert-parameters}

Настройки алерта задаются при его создании. После сохранения алерта их можно изменить.

### Запросы {#queries}

Набор [запросов](../data-model.md#queries), которые возвращают линию или набор линий.

Можно:

* отключить вычисление запроса, нажав кнопку ![image](../../../_assets/monitoring/concepts/visualization/chart-query-dots-menu.svg) и выбрав `Деактивировать`. Ссылки на запросы, которые не вычисляются, приводят к ошибкам.
* скрыть результаты вычисления запроса на графике, нажав кнопку ![image](../../../_assets/monitoring/concepts/visualization/chart-query-hide.svg).
* отобразить результаты вычисления запроса на графике, нажав кнопку ![image](../../../_assets/monitoring/concepts/visualization/chart-query-show.svg).

### Условия срабатывания {#condition}

#### Запрос для проверки {#request}

Имя запроса, к результату вычисления которого применяется [функция агрегации](#aggregation).

#### Функция агрегации {#aggregation}

Функция агрегации применяется к результату вычисления [запроса для проверки](#request).

Функция агрегации| Описание
----- | -----
**Хотя бы одно значение** | Хотя бы одно из значений метрики в запросе превышает заданные пороги в указанном периоде.
**Все значения** | Все значения метрики в запросе превышают заданные пороги в указанном периоде.
**Среднее** | Вычисляет среднее значение в указанном периоде для каждой метрики. Например, если запрос возвращает две метрики, {{ monitoring-short-name }} для каждой из них вычисляет среднее значение в указанном окне.
**Количество** | Вычисляет количество значений метрики в указанном периоде.
**Последнее значение** | Использует последнее значение метрики в указанном периоде. Если значения метрики не удалось получить, {{ monitoring-full-name }} меняет статус алерта на `No Data`.
**Максимум** | Использует максимальное значение метрики в указанном периоде.
**Минимум** | Использует минимальное значение метрики в указанном периоде.
**Сумма** | Вычисляет сумму значений за указанный период для каждой метрики.

Например, чтобы следить за последним значением метрики, которое было в течение последних 15 минут, необходимо выбрать функцию **Последнее** и задать [окно вычисления](#evaluation-window) `15m`.

#### Функция сравнения {#comparison}

Функция сравнения применяется к результату вычисления [функции агрегации](#aggregation) и пороговым значениям [Warning](#warn) и [Alarm](#alarm). Если агрегированное значение удовлетворяет пороговому, {{ monitoring-name }} изменяет статус алерта.

#### Warning {#warning}

Пороговое значение, при достижении которого алерт перейдет в статус `Warning`.

#### Alarm {#alarm}

Пороговое значение, при достижении которого алерт перейдет в статус `Alarm`.

#### Окно вычисления {#evaluation-window}

Временной период, в котором рассчитывается [функция агрегации](#aggregation). Окно позволяет исключить резкие изменения значения метрик, реагируя только на изменения за больший промежуток времени.

Можно выбрать одно из предустановленных значений или задать свое в следующем формате:
* `1h` — 1 час.
* `1m` — 1 минута.
* `1s` — 1 секунда.

Например, значение `3m 45s` задает временное окно в 3 минуты 45 секунд.

#### Задержка вычисления {#evaluation-delay}

Cдвиг временного окна назад во времени в секундах. По умолчанию равен 0. Позволяет исключить неожиданное срабатывание алерта в тех случаях, когда в запросах используются метрики, которые собираются с разным интервалом. Можно выбрать одно из предустановленных значений или задать свое аналогично [окну вычисления](evaluation-window).

## Обработка отсутствия данных {#no-data-policy}

Политики определяют, в какой статус алерт перейдет при отсутствии точек во временном окне или отсутствии метрик по заданному селектору. Политики применяются до вычисления условий срабатывания и исходя из результата алерт переходит в указанный в настройках статус.
