# Проверка прав на домен

Для получения и обновления сертификата от Let's Encrypt<sup>®</sup> пройдите процедуру проверки прав на каждый домен, указанный в сертификате. В {{ certificate-manager-name }} доступно два типа проверок: `HTTP` и `DNS`. При создании сертификата вы можете выбрать любой тип проверки.

{% note info %}

Проверка прав на домены требуется только для сертификатов от Let's Encrypt. {{ certificate-manager-name }} не проверяет права на домены из импортированных пользовательских сертификатов.

{% endnote %}

{{ certificate-manager-name }} ожидает успешного завершения процедуры проверки по каждому домену из сертификата (статус всех проверок — `Valid`). После этого будет выписан сертификат в Let's Encrypt. Статус сертификата изменится на `Issued`, и вы сможете использовать его в сервисах, интегрированных с {{ certificate-manager-name }}.

Если процедура проверки не будет выполнена в течение одной недели, сертификат перейдет в статус `Invalid` при получении сертификата или `Renewal_failed` при обновлении сертификата. Чтобы после этого получить сертификат, создайте новый запрос на получение сертификата от Let's Encrypt. 

## Статусы процедуры проверки сертификата {#status}

Процедура проверки может находиться в следующих статусах:
* `Pending` — процедура проверки ожидает завершения. Факт завершения процедуры проверки определяет {{ certificate-manager-name }}.
* `Processing` — процедура проверки ожидает подтверждения от Let's Encrypt.
* `Valid` — процедура проверки успешно пройдена.
* `Invalid` — процедура проверки прав на конкретный домен завершилась с ошибкой или истек срок в одну неделю, отведенный на прохождение процедуры.

## HTTP {#http}

{% note info %}

Тип проверки `HTTP` не может использоваться для [Wildcard-сертификатов](https://en.wikipedia.org/wiki/Wildcard_certificate). 

{% endnote %}

Для прохождения процедуры проверки прав на домен `example.com`:
1. Создайте файл с именем и содержимым, которые указаны в блоке **Проверка прав на домены** на странице просмотра информации по сертификату:
    1. Скопируйте ссылку из поля **Ссылка для размещения файла**:
        * Часть ссылки вида `http://example.com/.well-known/acme-challenge/` — это путь для размещения файла.
        * Вторая часть ссылки `rG1Mm1bJ...` — это имя файла, которое вам необходимо использовать.
1. Разместите файл на веб-сервере так, чтобы он был доступен по пути: 
    
    ```
    http://<имя домена>/.well-known/acme-challenge/<имя файла>
    ```   
1. После изменения статуса сертификата на `Issued` удалите файл, размещенный на веб-сервере.

## DNS {#dns}

Если у вас нет доступа к веб-серверу, или необходимо получить [Wildcard-сертификат](https://en.wikipedia.org/wiki/Wildcard_certificate), используйте тип проверки `DNS`.

Для прохождения проверки прав на домен `example.com`:
1. Разместите у своего DNS-провайдера или на собственном DNS-сервере `TXT`-запись специального вида: 
    
    Необходимое значение для домена указано в блоке **Проверка прав на домены** в поле **Значение** на странице просмотра информации по сертификату.
    
    ```
    _acme-challenge.example.com. IN TXT <значение>
    ```
1. После изменения статуса сертификата на `Issued` удалите с DNS-сервера добавленную `TXT`-запись.

#### См. также {#see-also}

- [Документация Let's Encypt. Виды проверок](https://letsencrypt.org/ru/docs/challenge-types/)