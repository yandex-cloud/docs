# Управление коннекторами

[Коннектор](../concepts/connectors.md) управляет процессом переноса топиков {{ KF }} в другой кластер или другую систему хранения данных.

Вы можете:

* [получить список коннекторов](#list);
* [создать коннектор](#create);
* [изменить коннектор](#update);
* [приостановить коннектор](#pause);
* [возобновить работу коннектора](#resume);
* [удалить коннектор](#delete).

## Получить список коннекторов {#list}

{% list tabs %}

- Консоль управления

    1. В [консоли управления]({{ link-console-main }}) перейдите в нужный каталог.
    1. В списке сервисов выберите **{{ mkf-name }}**.
    1. Выберите нужный кластер и перейдите на вкладку **Коннекторы**.

- API

    Воспользуйтесь методом API [list](../api-ref/Connector/list.md) и передайте в запросе идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).

{% endlist %}

## Создать коннектор {#create}

{% list tabs %}

- Консоль управления

    1. В [консоли управления]({{ link-console-main }}) перейдите в нужный каталог.
    1. В списке сервисов выберите **{{ mkf-name }}**.
    1. Выберите нужный кластер и перейдите на вкладку **Коннекторы**.
    1. Нажмите кнопку **Создать коннектор**.
    1. В блоке **Базовые параметры** укажите:

        * Имя коннектора.
        * Лимит задач — количество одновременно работающих процессов. Рекомендуется указывать не менее `2` для равномерного распределения нагрузки репликации.
  
    1. В блоке **Дополнительные свойства** укажите свойства коннектора в формате:

        ```text
        <ключ>:<значение>
        ```

        При этом ключ может быть как простой строкой, так и содержать префикс, указывающий на принадлежность к источнику или приемнику (псевдоним кластера в конфигурации коннектора):

        ```text
        <псевдоним кластера>.<тело ключа>:<значение>
        ```

    1. Выберите тип коннектора: [MirrorMaker](#settings-mm2) или [S3 sink](#settings-s3).

    1. Задайте конфигурацию выбранного коннектора.

        Подробнее о поддерживаемых типах коннекторов см. в разделе [{#T}](../concepts/connectors.md).

    1. Нажмите кнопку **Создать**.

- API

    Воспользуйтесь методом API [create](../api-ref/Connector/create.md) и передайте в запросе:

    * Идентификатор кластера, в котором нужно создать коннектор, в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
    * Настройки коннектора в параметре `connectorSpec`.

{% endlist %}

## Изменить коннектор {#update}

{% list tabs %}

- Консоль управления

    1. В [консоли управления]({{ link-console-main }}) перейдите в нужный каталог.
    1. В списке сервисов выберите **{{ mkf-name }}**.
    1. Выберите нужный кластер и перейдите на вкладку **Коннекторы**.
    1. В строке с нужными коннектором нажмите на значок ![image](../../_assets/options.svg) и выберите пункт **Изменить коннектор**.
    1. Внесите необходимые изменения в свойства коннектора.
    1. Нажмите кнопку **Сохранить**.

- API

    Воспользуйтесь методом API [update](../api-ref/Connector/update.md) и передайте в запросе:

    * Идентификатор кластера, в котором нужно изменить коннектор, в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
    * Настройки коннектора в параметре `connectorSpec`.

{% endlist %}

## Приостановить коннектор {#pause}

В процессе приостановки коннектора:

* разрывается подключение к приемнику;
* удаляются данные из служебных топиков коннектора.

Чтобы приостановить коннектор:

{% list tabs %}

- Консоль управления

    1. В [консоли управления]({{ link-console-main }}) перейдите в нужный каталог.
    1. В списке сервисов выберите **{{ mkf-name }}**.
    1. Выберите нужный кластер и перейдите на вкладку **Коннекторы**.
    1. Нажмите на значок ![ellipsis](../../_assets/horizontal-ellipsis.svg) рядом с именем нужного коннектора и выберите пункт **Приостановить**.

- API

    Воспользуйтесь методом API [pause](../api-ref/Connector/pause.md) и передайте в запросе:

    * Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
    * Имя коннектора в параметре `connectorName`. Чтобы узнать имя, [получите список коннекторов в кластере](#list-connectors).

{% endlist %}

## Возобновить работу коннектора {#resume}

{% list tabs %}

- Консоль управления

    1. В [консоли управления]({{ link-console-main }}) перейдите в нужный каталог.
    1. В списке сервисов выберите **{{ mkf-name }}**.
    1. Выберите нужный кластер и перейдите на вкладку **Коннекторы**.
    1. Нажмите на значок ![ellipsis](../../_assets/horizontal-ellipsis.svg) рядом с именем нужного коннектора и выберите пункт **Возобновить**.

- API

    Воспользуйтесь методом API [resume](../api-ref/Connector/resume.md) и передайте в запросе:

    * Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
    * Имя коннектора в параметре `connectorName`. Чтобы узнать имя, [получите список коннекторов в кластере](#list-connectors).

{% endlist %}

## Удалить коннектор {#delete}

{% list tabs %}

- Консоль управления

    1. В [консоли управления]({{ link-console-main }}) перейдите в нужный каталог.
    1. В списке сервисов выберите **{{ mkf-name }}**.
    1. Выберите нужный кластер и перейдите на вкладку **Коннекторы**.
    1. Нажмите на значок ![ellipsis](../../_assets/horizontal-ellipsis.svg) рядом с именем нужного коннектора и выберите пункт **Удалить**.
    1. Нажмите кнопку **Удалить**.

- API

    Воспользуйтесь методом API [delete](../api-ref/Connector/delete.md) и передайте в запросе:

    * Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
    * Имя коннектора в параметре `connectorName`. Чтобы узнать имя, [получите список коннекторов в кластере](#list-connectors).

{% endlist %}

## Параметры коннекторов {#settings}

### MirrorMaker {#settings-mm2}

* **Топики** — шаблон для отбора реплицируемых топиков, имена топиков перечисляются через запятую или символ `|`. Можно использовать выражение `.*`, например `analysis.*`. Для переноса всех топиков укажите `.*`.
* **Фактор репликации** — количество копий топика, хранящихся в кластере.
* В блоке **Кластер-источник** укажите параметры для подключения к кластеру-источнику:

    * **Псевдоним** — префикс для обозначения кластера-источника в настройках коннектора.

        {% note info %}

        Топики в кластере-приемнике будут созданы с указанным префиксом.

        {% endnote %}

    * **Использовать этот кластер** — выберите опцию для использования текущего кластера в качестве источника.
    * **Бутстрап-серверы** — список FQDN хостов-брокеров кластера-источника с номерами портов для подключения, разделенный запятыми. Например: `broker1.example.com:9091,broker2.example.com`.

      FQDN хостов-брокеров {{ mkf-name }} можно запросить со [списком хостов в кластере](cluster-hosts.md#list-hosts).

    * **SASL имя пользователя** — имя пользователя для подключения коннектора к кластеру-источнику.
    * **SASL пароль** — пароль пользователя для подключения коннектора к кластеру-источнику.
    * **SASL механизм** — выберите механизм шифрования имени и пароля.
    * **Протокол безопасности** — выберите протокол подключения коннектора:

        * `PLAINTEXT`, `SASL_PLAINTEXT` — для подключений без SSL;
        * `SSL`, `SASL_SSL` — для подключений с SSL.

* В блоке **Кластер-приемник** укажите параметры для подключения к кластеру-приемнику:

    * **Псевдоним** — префикс для обозначения кластера-приемника в настройках коннектора.
    * **Использовать этот кластер** — выберите опцию для использования текущего кластера в качестве приемника.
    * **Бутстрап-серверы** — список FQDN или IP-адресов хостов-брокеров кластера-приемника с номерами портов для подключения, разделенный запятыми.

        FQDN хостов-брокеров {{ mkf-name }} можно запросить со [списком хостов в кластере](cluster-hosts.md#list-hosts).

    * **SASL имя пользователя** — имя пользователя для подключения коннектора к кластеру-приемнику.
    * **SASL пароль** — пароль пользователя для подключения коннектора к кластеру-приемнику.
    * **SASL механизм** — выберите механизм шифрования имени и пароля.
    * **Протокол безопасности** — выберите протокол подключения коннектора:

        * `PLAINTEXT`, `SASL_PLAINTEXT` — для подключений без SSL;
        * `SSL`, `SASL_SSL` — для подключений с SSL.

### S3 Sink {#settings-s3}

* **Топики** — шаблон для отбора экспортируемых топиков, имена топиков перечисляются через запятую или символ `|`. Можно использовать выражение `.*`, например `analysis.*`. Для переноса всех топиков укажите `.*`.
* **Механизм сжатия** — выберите кодек для сжатия сообщений:

    * `none` (по умолчанию) — сжатие отсутствует;
    * `gzip` — кодек [gzip](https://www.gzip.org/);
    * `snappy` — кодек [snappy](https://github.com/google/snappy);
    * `zstd` — кодек [zstd](https://facebook.github.io/zstd/).

* (Опционально) **Максимальное количество записей на файл** — максимальное количество записей, которое может быть записано в один файл, размещенный в хранилище S3.

* В блоке **Подключение к S3** укажите параметры подключения к хранилищу:

    * **Имя бакета** — имя бакета хранилища.
    * **Эндпоинт** — эндпоинт для доступа к хранилищу (его необходимо узнать у провайдера хранилища).
    * (Опционально) **Регион** — название региона. Значение по умолчанию — `us-east-1`.
    {% if audience != "internal" %}* (Опционально) **Идентификатор ключа доступа**, **Секретный ключ** — [идентификатор и содержимое ключа сервисного аккаунта](../../iam/operations/authorized-key/create.md).{% endif %}

    Чтобы задать значения дополнительных настроек, не указанных в этом списке, создайте необходимые ключи и задайте их значения в блоке **Дополнительные свойства** при [создании](#create) или [изменении](#update) коннектора:

    * `key.converter`
    * `value.converter`
    * `value.converter.schemas.enable`
    * `format.output.type`

    Подробнее про дополнительные настройки см. в [документации коннектора](https://github.com/aiven/s3-connector-for-apache-kafka).
