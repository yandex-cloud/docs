# Работа с топиками и разделами

В кластере {{ mkf-name }} вы можете:
- [Создать топик и разделы для него](#create-topic).
- [Изменить настройки топика и его разделов](#update-topic).
- [Удалить топик](#delete-topic).
- [Получить список топиков в кластере](#list-topics).
- [Получить детальную информацию о топике](#get-topic).

## Создать топик {#create-topic}

{% list tabs %}

- Консоль управления

  Чтобы создать топик, выполните следующие действия:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и перейдите на вкладку **Топики**.
  1. Нажмите кнопку **Создать топик**.
  1. В блоке **Базовые параметры** задайте базовые параметры топика:
     - Имя топика (должно быть уникально в пределах кластера {{ KF }}).
     - Количество разделов в топике.
     - Фактор репликации. Значение этого параметра не должно превышать количество брокеров в кластере. Минимальное значение: `1`. Значение по умолчанию:
  	   - для кластера из одного или двух брокеров: `1`;
  	   - для кластера с тремя и более брокерами: `3`.
  1. В блоке **Настройки топика** задайте [настройки топика](#topic-extra-settings).
  1. Нажмите кнопку **Создать**.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы создать топик:
  
  1. Посмотрите описание команды CLI для создания топиков:

     ```
     {{ yc-mdb-kf }} topic create --help
     ```
     
  1. Создайте топик:
  
     ```
     {{ yc-mdb-kf }} topic create <имя топика> \
     --cluster-name <имя кластера> \
     --partitions <количество разделов> \
     --replication-factor <фактор репликации>
     ```
     

- API

  Воспользуйтесь методом API [create](../api-ref/Topic/create.md) и передайте в запросе:
  - Идентификатор кластера, в котором нужно создать топик, в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Настройки топика в параметре `topicSpec`.

{% endlist %}

## Изменить настройки топика {#update-topic}

{% note warning %}

Количество разделов в топике {{ KF }} допустимо изменять только в сторону увеличения.

{% endnote %}

{% list tabs %}

- Консоль управления

  Чтобы изменить настройки топика, выполните следующие действия:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера, затем выберите вкладку **Топики**.
  1. Нажмите значок ![image](../../_assets/options.svg) для нужного топика и выберите пункт **Редактировать**.
  1. Измените базовые параметры топика:
     - Количество разделов в топике.
	 - Фактор репликации. Значение этого параметра не должно превышать количество брокеров в кластере. Минимальное значение: `1`. Значение по умолчанию:
	   - для кластера из одного или двух брокеров: `1`;
	   - для кластера с тремя и более брокерами: `3`.
  1. Измените [настройки топика](#topic-extra-settings).
  1. Нажмите кнопку **Сохранить**.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы изменить настройки топика:
  
  1. Посмотрите описание команды CLI для изменения топиков:

     ```
     {{ yc-mdb-kf }} topic update --help
     ```
     
  1. Измените настройки топика:
  
     ```
     {{ yc-mdb-kf }} topic update <имя топика> \
     --cluster-name <имя кластера> \
     --partitions <количество разделов> \
     --replication-factor <фактор репликации>
     ```


- API

  Воспользуйтесь методом API [update](../api-ref/Topic/update.md) и передайте в запросе:
  - Идентификатор кластера, в котором находится топик, в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя топика в параметре `topicName`. Чтобы узнать имя, [получите список топиков в кластере](#list-topics).
  - Список настроек, которые необходимо изменить, в параметре `updateMask` (одной строкой через запятую). Если не задать этот параметр, метод API сбросит на значения по умолчанию все настройки топика, которые не были явно указаны в запросе.
  - Новые значения настроек топика в параметре `topicSpec`.

{% endlist %}

## Удалить топик {#delete-topic}

{% include [mkf-deleted-topic-permissions-note](../../_includes/mdb/mkf-deleted-topic-permissions-note.md) %}

{% list tabs %}

- Консоль управления

  Чтобы удалить топик, выполните следующие действия:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и перейдите на вкладку **Топики**.
  1. Нажмите значок ![image](../../_assets/options.svg) для нужного топика и выберите пункт **Удалить топик**.
  1. Подтвердите удаление топика и нажмите кнопку **Удалить**.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы удалить топик:
  
  1. Посмотрите описание команды CLI для изменения топиков:

     ```
     {{ yc-mdb-kf }} topic delete --help
     ```
     
  1. Удалите топик:
  
     ```
     {{ yc-mdb-kf }} topic delete <имя топика> --cluster-name <имя кластера>
     ```


- API

  Воспользуйтесь методом API [delete](../api-ref/Topic/delete.md) и передайте в запросе:
  - Идентификатор кластера, в котором находится топик, в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя топика в параметре `topicName`. Чтобы узнать имя, [получите список топиков в кластере](#list-topics).

{% endlist %}

## Получить список топиков в кластере {#list-topics}

{% list tabs %}

- Консоль управления

  Чтобы получить список топиков, выполните следующие действия:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и перейдите на вкладку **Топики**.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы получить список топиков, выполните следующую команду:
  
  ```
  {{ yc-mdb-kf }} topic list --cluster-name <имя кластера>
  ```


- API

  Воспользуйтесь методом API [list](../api-ref/Topic/list.md): передайте значение идентификатора требуемого кластера в параметре `clusterId` запроса.

  Чтобы узнать идентификатор кластера, [получите список кластеров в каталоге](cluster-list.md#list-clusters).

{% endlist %}

## Получить детальную информацию о топике {#get-topic}

{% list tabs %}

- Консоль управления

  Чтобы получить детальную информацию о топике, выполните следующие действия:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и перейдите на вкладку **Топики**.
  1. Нажмите на имя нужного топика.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы получить детальную информацию о топике, выполните следующую команду:
  
  ```
  {{ yc-mdb-kf }} topic get <имя топика> --cluster-name <имя кластера>
  ```


- API

  Чтобы получить детальную информацию о топике, воспользуйтесь методом API [get](../api-ref/Topic/get.md) и передайте в запросе:
  - Идентификатор кластера, в котором находится топик, в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя топика в параметре `topicName`. Чтобы узнать имя, [получите список топиков в кластере](#list-topics).

{% endlist %}

## Дополнительные настройки топика {#topic-extra-settings}

Эти настройки задают различные параметры топика:
- **Политика очистки лога**:
    - `Delete` — удалять сегменты лога либо при истечении срока их хранения, либо при достижении предельного размера лога.
    - `Compact` —  сжимать сообщения в логе.
    - `CompactAndDelete` — использовать как сжатие сообщений, так и удаление сегментов лога.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#cleanup.policy).

- **Тип сжатия** — какой кодек использовать для сжатия сообщений:
    - `Uncompressed` — не использовать сжатие.
    - `Zstd` — кодек Zstandard.
    - `Lz4` — кодек LZ4.
    - `Snappy` — кодек Snappy.
    - `Gzip` — кодек GZip.
    - `Producer` — кодек задается [производителем](../concepts/producers-consumers.md).

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#compression.type).

- **Delete retention, ms** — время (в миллисекундах), в течение которого нужно хранить tombstone-маркеры удаления для топиков со сжатым логом. Параметр отображается только при выборе политик очистки лога `Compact` и `CompactAndDelete`.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#delete.retention.ms).

- **Задержка удаления, мс** — время ожидания перед удалением файла из файловой системы.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#file.delete.delay.ms).

- **Максимальное число сообщений в памяти** — количество сообщений топика, которое может накопиться в памяти прежде, чем эти сообщения будут записаны на диск. Например, если параметр равен `1`, запись на диск будет происходить после получения каждого сообщения, а если `5`, то сообщения будут записываться на диск группами по пять.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#flush.messages).

- **Время хранения сообщения в памяти, мс** — время, в течение которого сообщение в топике хранится в памяти перед записью на диск.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#flush.ms).

- **Минимальная задержка сжатия, мс** — минимальное время, в течение которого сообщение в логе будет оставаться несжатым.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#min.compaction.lag.ms).

- **Максимальный размер раздела, байт** — максимальный размер, до которого может вырасти раздел. После достижения этого размера, {{ KF }} начнет удалять старые сегменты лога. Настройка применяется, если действует политика очистки лога `Delete`.

    Эта настройка полезна, если вам необходимо контролировать размер лога из-за ограниченного дискового пространства.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#retention.bytes).

- **Время жизни сегмента лога, мс** — время, по истечении которого {{ KF }} начнет удалять старые сегменты лога. Настройка применяется, если действует политика очистки лога `Delete`.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#retention.ms).

- **Максимальный размер группы сообщений** — максимальный размер пачки сообщений, который {{ KF }} разрешает записать в топик производителю или прочитать из топика потребителю (в байтах, после сжатия, если оно включено).

    Минимальное значение: `0` (по умолчанию — `1048588`, один мегабайт).

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#max.message.bytes).

- **Минимальное число синхронных реплик** —  минимальное количество реплик, от которых необходимо дождаться подтверждения записи, чтобы запись сообщения в топик считалась успешной. Этв настройка полезна, когда брокер ждет подтверждения записи от всех реплик в кластере.

    Минимальное значение: `1`. Значение по умолчанию:
	   - для кластера из одного или двух брокеров: `1`;
	   - для кластера с тремя и более брокерами: `2`.

    Подробнее см. [в документации {{ KF }}](https://kafka.apache.org/documentation/#min.insync.replicas).
