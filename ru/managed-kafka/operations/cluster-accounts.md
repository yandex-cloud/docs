# Управление учетными записями {{ KF }}

Учетные записи в {{ KF }} разграничивают права доступа [производителей и потребителей](../concepts/producers-consumers.md) данных. Производитель или потребитель получает доступ только к тем [топикам](../concepts/topics.md), которые разрешены для его учетной записи.

Вы можете использовать одну и ту же учетную запись для нескольких производителей или потребителей: первые получат права на запись в определенные топики, а вторые — на чтение.

После создания кластера {{ KF }} вы можете:
- [Создать учетную запись](#create-account).
- [Изменить пароль учетной записи](#update-password).
- [Изменить настройки учетной записи](#update-account).
- [Выдать права учетной записи](#grant-permission).
- [Отозвать права у учетной записи](#revoke-permission).
- [Удалить учетную запись](#delete-account).
- [Получить список учетных записей в кластере](#list-accounts).

## Создать учетную запись {#create-account}

{% list tabs %}

- Консоль управления

  Чтобы создать учетную запись в кластере:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите кнопку **Добавить**.
  1. Введите имя учетной записи (имя пользователя) и пароль (от 8 до 128 символов).
  1. [Выдайте права доступа](#grant-permission) к нужным топикам.
  1. Нажмите кнопку **Добавить**.

- API
  
  Воспользуйтесь методом API [create](../api-ref/User/create.md) и передайте в запросе:
  - Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Настройки учетной записи в параметре `userSpec`:
    - Имя учетной записи в параметре `name`.
    - Пароль учетной записи в параметре `password`.
    - Права доступа к топикам (один или несколько параметров `permissions`, по одному на каждый топик):
      - Имя топика в параметре `topicName`. Чтобы узнать имя, [получите список топиков в кластере](cluster-topics.md#list-topics).
      - Права доступа к топику в параметре `role`: `ACCESS_ROLE_PRODUCER` для производителя, либо `ACCESS_ROLE_CONSUMER` для потребителя.

{% endlist %}

## Изменить пароль учетной записи {#update-password}

{% list tabs %}

- Консоль управления

  Чтобы изменить пароль учетной записи:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) для нужной учетной записи и выберите пункт **Изменить пароль**.
  1. Задайте новый пароль и нажмите кнопку **Изменить**.

- API
  
  Воспользуйтесь методом API [update](../api-ref/User/update.md) и передайте в запросе:
  - Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя учетной записи в параметре `userName`. Чтобы узнать имя, [получите список учетных записей в кластере](#list-accounts).
  - Новый пароль учетной записи в параметре `password`.

{% endlist %}

## Изменить настройки учетной записи {#update-account}

{% list tabs %}

- Консоль управления

  Чтобы изменить настройки учетной записи в кластере:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) для нужной учетной записи и выберите пункт **Настроить**.
  1. [Выдайте права доступа](#grant-permission) для топиков, если это необходимо.
  1. [Отзовите права доступа](#revoke-permission) для топиков, если это необходимо.
  1. Нажмите кнопку **Добавить**.

- API
  
  Воспользуйтесь методом API [update](../api-ref/User/update.md) и передайте в запросе:
  - Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя учетной записи в параметре `userName`. Чтобы узнать имя, [получите список учетных записей в кластере](#list-accounts).
  - Новый набор прав на доступ к топикам (один или несколько параметров `permissions`, по одному на каждый топик).
  
  {% note important %}
  
  Этот метод API удалит все права, которые не были явно указаны в параметрах `permissions`.
  Чтобы избежать этого, перечислите права, которые вы хотите изменить, в параметре `updateMask` (одной строкой через запятую).

  {% endnote %}
  
{% endlist %}

## Выдать права учетной записи {#grant-permission}

{% list tabs %}

- Консоль управления

  При [создании](#create-account) или [изменении](#update-account) учетной записи можно выдавать права на доступ к нужным топикам.

  Чтобы выдать права на доступ к топику:
  1. Найдите нужный топик в списке топиков. 
  
     Если топика нет в списке — добавьте его:
     1. Нажмите кнопку **![image](../../_assets/plus.svg) Добавить топик**. Если такой кнопки нет — значит, для этой учетной записи добавлены все существующие топики кластера.
     1. Выберите нужный топик из выпадающего списка.
     
      Если кнопка **![image](../../_assets/plus.svg) Добавить топик** отсутствует или среди доступных для добавления топиков нет нужного — [создайте новый топик](cluster-topics.md#create-topic) и добавьте его.
  
  1. Нажмите кнопку **![image](../../_assets/plus.svg) в столбце **Роли** для нужного топика и выберите роль, которая определяет права доступа, из выпадающего списка:
     - `ACCESS_ROLE_CONSUMER`: потребителям, которые используют эту учетную запись, будет разрешен доступ к топику.
     - `ACCESS_ROLE_PRODUCER`: производителям, которые используют эту учетную запись, будет разрешен доступ к топику.
        
     Если нужно, чтобы к топику имели доступ и производители, и потребители — добавьте еще одну роль.
     Топику должна быть назначена минимум одна роль.

  1. Если права были назначены топику по ошибке — [отзовите их](#revoke-permission).

- API
  
  Воспользуйтесь методом API [grantPermission](../api-ref/User/grantPermission.md) и передайте в запросе:
  - Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя учетной записи в параметре `userName`. Чтобы узнать имя, [получите список учетных записей в кластере](#list-accounts).
  - Новое право на доступ к топику в параметре `permission`.
  
{% endlist %}

## Отозвать права у учетной записи {#revoke-permission}

{% list tabs %}

- Консоль управления

  При [создании](#create-account) или [изменении](#update-account) учетной записи можно отзывать права на доступ к нужным топикам.

  Чтобы отозвать права на доступ к топику:
  1. Найдите нужный топик в списке топиков. 
  1. Удалите роль, которая больше не нужна, нажав значок ![image](../../_assets/cross.svg) рядом с именем роли. Это приведет к отзыву соответствующего права доступа.
  1. Если нужно отозвать все права на доступ к топику, удалите его из списка: наведите курсор на имя топика и нажмите значок ![image](../../_assets/cross.svg) в конце строки. Удаление топика из этого списка приводит только к полному отзыву прав, сам топик и сообщения в нем не удаляются.

- API
  
  Воспользуйтесь методом API [revokePermission](../api-ref/User/revokePermission.md) и передайте в запросе:
  - Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя учетной записи в параметре `userName`. Чтобы узнать имя, [получите список учетных записей в кластере](#list-accounts).
  - Право на доступ к топику, которое требуется отозвать, в параметре `permission`.
  
{% endlist %}

## Удалить учетную запись {#delete-account}

{% list tabs %}

- Консоль управления

  Чтобы удалить учетную запись:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) для нужной учетной записи и выберите пункт **Удалить**.
  1. Подтвердите удаление и нажмите кнопку **Удалить**.

- API
  
  Воспользуйтесь методом API [delete](../api-ref/User/delete.md) и передайте в запросе:
  - Идентификатор кластера в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя учетной записи, которую требуется удалить, в параметре `userName`. Чтобы узнать имя, [получите список учетных записей в кластере](#list-accounts).
  
{% endlist %}

## Получить список учетных записей в кластере {#list-accounts}

{% list tabs %}

- Консоль управления

  Чтобы получить список учетных записей:
  1. Перейдите на страницу каталога и выберите сервис **{{ mkf-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.

- API
  
  Воспользуйтесь методом API [list](../api-ref/User/list.md): передайте значение идентификатора требуемого кластера в параметре `clusterId` запроса.

  Чтобы узнать идентификатор кластера, [получите список кластеров в каталоге](#list-clusters).

{% endlist %}