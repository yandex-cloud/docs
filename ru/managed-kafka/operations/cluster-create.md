# Создание кластера

Кластер {{ mkf-name }} — это один или несколько хостов-брокеров, на которых размещены топики и соответствующие топикам разделы. Производители и потребители могут работать с этими топиками, подключившись к хостам кластера.

{% include [mkf-zk-hosts](../../_includes/mdb/mkf-zk-hosts.md) %}

{% list tabs %}

- Консоль управления

  Чтобы создать кластер, выполните следующие действия:
  1. В консоли управления выберите каталог, в котором нужно создать кластер.
  1. Выберите сервис **{{ mkf-name }}**.
  1. Нажмите кнопку **Создать кластер**.

  1. В блоке **Базовые параметры**:
     1. Введите имя кластера и, при необходимости, его описание. Имя кластера должно быть уникальным в рамках каталога.
     1. Выберите окружение, в котором нужно создать кластер (после создания кластера окружение изменить невозможно):
        - `PRODUCTION` — для стабильных версий ваших приложений.
        - `PRESTABLE` — для тестирования, в том числе самого сервиса {{ mkf-name }}. В Prestable-окружении раньше появляются новая функциональность, улучшения и исправления ошибок. При этом не все обновления обеспечивают обратную совместимость.
     1. Выберите версию {{ KF }}.

  1. В блоке **Класс хоста** выберите платформу, тип хостов и класс хостов.

     Класс хостов определяет технические характеристики виртуальных машин, на которых будут развернуты [брокеры {{ KF }}](../concepts/brokers.md). Все доступные варианты перечислены в разделе [Классы хостов](../concepts/instance-types.md).

     При [изменении класса хостов](cluster-update.md#update-cluster) для кластера меняются характеристики всех уже созданных экземпляров.

  1. В блоке **Хранилище**:
     1. Выберите [тип хранилища](../concepts/storage.md) — более гибкое сетевое (**network-hdd** или **network-ssd**) или более быстрое локальное хранилище (**local-ssd**).
     1. Выберите объем хранилища, который будет использоваться для данных. Размер локального хранилища можно менять только с шагом 100 ГБ.

  1. В блоке **Сетевые настройки**:
     1. Выберите одну или несколько [зон доступности](../../overview/concepts/geo-scope.md), в которых нужно разместить брокеры {{ KF }}.
     1. Выберите [сеть](../../vpc/concepts/network.md).
     1. Выберите подсети в каждой зоне доступности для этой сети. Чтобы [создать новую подсеть](../../vpc/operations/subnet-create.md), нажмите на кнопку **Создать новую** рядом с нужной зоной доступности.

        {% note info %}

        Для кластера из нескольких хостов-брокеров нужно указать подсети в каждой зоне доступности, даже если вы планируете разместить брокеры только в некоторых из них. Эти подсети понадобятся для размещения трех хостов {{ ZK }} — по одному в каждой зоне доступности. Подробнее см. в разделе [{#T}](../concepts/index.md).

        {% endnote %}

     1. Для доступа к хостам-брокерам из интернета выберите опцию **Публичный доступ**. В этом случае подключаться к ним можно только с использованием SSL-соединения. Подробнее см. в разделе [{#T}](connect.md).

	    {% note warning %}

		Запросить публичный доступ после создания кластера невозможно.

		{% endnote %}

  1. В блоке **Хосты** укажите количество [хостов-брокеров](../concepts/brokers.md) {{ KF }} для размещения в каждой выбранной зоне доступности.

     При выборе количества хостов учитывайте, что:
     - Хосты кластера {{ KF }} будут равномерно расположены в выбранных зонах доступности. Количество зон и хостов в зоне следует выбирать исходя из требуемой модели отказоустойчивости и нагрузки на кластер.
     - Репликация возможна при наличии как минимум двух хостов в кластере.
     - Добавление в кластер более одного хоста приведет к автоматическому добавлению трех хостов {{ ZK }}.

  1. Если вы указали более одного хоста-брокера, то в блоке **Класс хоста {{ ZK }}** укажите характеристики [хостов {{ ZK }}](../concepts/index.md) для размещения в каждой выбранной зоне доступности.

  1. Нажмите кнопку **Создать кластер**.

  1. Дождитесь, когда кластер будет готов к работе: его статус на панели {{ mkf-short-name }} сменится на `Running`, а состояние - на `Alive`. Это может занять некоторое время.


- API

  Чтобы создать кластер, воспользуйтесь методом API [create](../api-ref/Cluster/create.md) и передайте в запросе:
  - Идентификатор каталога, в котором должен быть размещен кластер, в параметре `folderId`.
  - Имя кластера в параметре `name`.


{% endlist %}
