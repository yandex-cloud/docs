#### Квоты {#ydb-quotas}

**Режим работы с выделенными инстансами**

Вид ограничения | Значение
----- | -----
Суммарное количество ядер процессора для всех хостов баз данных в одном облаке | 64
Суммарный объем виртуальной памяти для всех хостов баз данных в одном облаке | 256 ГБ
Максимальное количество хостов в одном облаке | 8
Максимальное количество баз данных в одном облаке | 4
Максимальное количество групп хранения в одном облаке | 8

**Бессерверный режим работы**

Вид ограничения | Значение
----- | -----
Максимальное количество баз данных | 4
Максимальное количество запросов в бессерверном режиме в секунду в одном облаке | 1 000 RU
Максимальное количество схемных операций^*^ в день в одной бессерверной базе данных | 1 000
Максимальное количество схемных операций^*^ в минуту в одной бессерверной базе данных | 30

^*^ Квотируемые операции: создание, изменение и удаление схем таблиц, получение описания таблицы, получение списка таблиц, создание и удаление директорий.

**Особенности применения квоты на количество запросов в бессерверном режиме в секунду**

При превышении квоты на количество запросов в бессерверном режиме запрос не принимается к исполнению, возвращается ошибка `Throughput limit exceeded`. Получение такой ошибки означает, что запрос можно безопасно повторить позже. При повторе рекомендуется использовать конструкции, поставляемые в составе {{ ydb-short-name }} SDK. В предлагаемых конструкциях реализованы алгоритмы повторов, которые в зависимости от типа и кода ошибки используют разные стратегии повторов: без задержки, с экспоненциальным увеличением задержки, быстрый или медленный повтор и другие.

Ограничение срабатывает с некоторой задержкой, поэтому ошибка `Throughput limit exceeded` возвращается не на запросе, который привел к превышению квоты, а одном из следующих. После срабатывания ограничения запросы не будут приниматься к исполнению в течение времени, приблизительно равного отношению перерасхода к квоте. Например, если на исполнение единичного запроса потрачено 1000 RU при квоте в 100 RU, то новые запросы не будут приниматься в течение 10 секунд.

Для снижения риска получения отказов при неравномерной нагрузке {{ ydb-short-name }} гибко применяет ограничения, используя механизм резервирования пропускной способности (`burst capacity`). Пока на обработку запросов тратится меньше RU, чем указано в ограничении, неиспользованная пропускная способность резервируется. Во время пика потребления за счет накопленного резерва может быть временно предоставлена большая пропускная способность, чем указанная в ограничении.

В {{ ydb-short-name }} резервируется около 5 минут пропускной способности. Резерв позволяет выполнить, например, единичный запрос со стоимостью около `5 мин × 60 с × квота RU/с` без отказа в исполнении следующих запросов. Политика предоставления `burst capacity` может быть изменена.

Квота на количество запросов в бессерверном режиме также является инструментом защиты от оплаты перерасхода ресурсов при сбоях в приложении или атаках на сервис. Наличие механизма `burst capacity` позволяет выставлять в квоте наименьшее значение, при котором ваше приложение работает без получения ошибок `Throughput limit exceeded`, с некоторым запасом на непредвиденный рост нагрузки.
