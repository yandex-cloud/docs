## Сервис {{ ydb-full-name }} {#ydb}

### Метрики использования ресурсов {#resources}

Имя метрики<br/>Тип, единицы измерения | Описание<br/>Метки
----- | -----
`resources.storage.used_bytes`<br/>`IGAUGE`, байты  | Размер пользовательских и служебных данных, сохраненных в распределенном сетевом хранилище. К служебным данным относятся данные первичного и [вторичных индексов](https://cloud.yandex.ru/docs/ydb/oss/public/develop/concepts/secondary_indexes).
`resources.storage.limit_bytes`<br/>`IGAUGE`, байты  | Ограничение на размер пользовательских и служебных данных, которые база данных может сохранить в распределенном сетевом хранилище.

### Метрики API {#api}

Имя метрики<br/>Тип, единицы измерения | Описание<br/>Метки
----- | -----
`api.grpc.request.bytes`<br/>`RATE`, байты | Размер запросов, которые получены базой данных в определенный период времени.<br/>Метки:<br/>- _api_service_ – название сервиса gRPC API, например `table`.<br/>- _method_ – название метода сервиса gRPC API, например `ExecuteDataQuery`.
`api.grpc.request.dropped_count`<br/>`RATE`, штуки | Количество запросов, обработка которых была прекращена на транспортном (gRPC) уровне из-за ошибки.<br/>Метки:<br/>- _api_service_ – название сервиса gRPC API, например `table`.<br/>- _method_ – название метода сервиса gRPC API, например `ExecuteDataQuery`.
`api.grpc.request.inflight_count`<br/>`IGAUGE`, штуки | Количество запросов, которые одновременно обрабатываются базой данных в определенный период времени.<br/>Метки:<br/>- _api_service_ – название сервиса gRPC API, например `table`.<br/>- _method_ – название метода сервиса gRPC API, например `ExecuteDataQuery`.
`api.grpc.request.inflight_bytes`<br/>`IGAUGE`, байты | Размер запросов, которые одновременно обрабатываются базой данных в определенный период времени.<br/>Метки:<br/>- _api_service_ – название сервиса gRPC API, например `table`.<br/>- _method_ – название метода сервиса gRPC API, например `ExecuteDataQuery`.
`api.grpc.response.bytes`<br/>`RATE`, байты | Размер ответов, которые отправлены базой данный в определенный период времени.<br/>Метки:<br/>- _api_service_ – название сервиса gRPC API, например `table`.<br/>- _method_ – название метода сервиса gRPC API, например `ExecuteDataQuery`.
`api.grpc.response.count`<br/>`RATE`, штуки | Количество ответов, которые отправлены базой в определенный период времени.<br/>Метки:<br/>- _api_service_ – название сервиса gRPC API, например `table`.<br/>- _method_ – название метода сервиса gRPC API, например `ExecuteDataQuery`.<br/>- _status_ – статус выполнения запроса, подробнее статусы описаны в разделе [Обработка ошибок](https://cloud.yandex.ru/docs/ydb/oss/public/reference/ydb-sdk/error_handling).
`api.grpc.response.dropped_count`<br/>`RATE`, штуки | Количество ответов, отправка которых была прекращена на на транспортном (gRPC) уровне из-за ошибки.<br/>Метки:<br/>- _api_service_ – название сервиса gRPC API, например `table`.<br/>- _method_ – название метода сервиса gRPC API, например `ExecuteDataQuery`.
`api.grpc.response.issues`<br/>`RATE`, штуки | Количество ошибок определенного типа, возникших при выполнении запросов в определенный период времени.<br/>Метки:<br/>- _issue_type_ – тип ошибки, единственное значение – `optimistic_locks_invalidation`, подробнее инвалидация блокировок описана в разделе [Транзакции и запросы к {{ ydb-short-name }}](https://cloud.yandex.ru/docs/ydb/oss/public/develop/concepts/transactions).

### Метрики сессий {#sessions}

Имя метрики<br/>Тип, единицы измерения | Описание<br/>Метки
----- | -----
`table.session.active_count`<br/>`IGAUGE`, штуки | Количество сессий, открытых клиентами в данный момент времени.
`table.session.closed_by_idle_count`<br/>`RATE`, штуки | Количество сессий, которые закрыты по инициативе сервера баз данных в определенный период времени из-за превышения времени, выделенного на существование неактивной сессии.

### Метрики обработки транзакций {#transactions}

Длительность выполнения транзакции можно анализировать с помощью гистограммного счетчика. Интервалы заданы в миллисекундах. График показывает количество транзакций, длительность которых попадает в определенный интервал времени.

Имя метрики<br/>Тип, единицы измерения | Описание<br/>Метки
----- | -----
`table.transaction.total_duration_milliseconds`<br/>`HIST_RATE`, штуки | Количество транзакций определенной длительности выполнения на сервере и клиенте. Длительность выполнения – это время выполнения транзакции от момента явного или неявного открытия транзакции до момента фиксации изменений или отката. Включает время обработки транзакции на сервере и время на клиенте между отправкой разных запросов в одной транзакции.<br/>Метки:<br/>- _tx_kind_ – тип транзакции, возможные значения `read_only`, `read_write`, `write_only`, `pure`.
`table.transaction.server_duration_milliseconds`<br/>`HIST_RATE`, штуки | Количество транзакций определенной длительности выполнения на сервере. Длительность выполнения – это время выполнения запросов в транзакции на сервере. Не включет время ожидания на клиенте между отправкой отдельных запросов в одной транзакции.<br/>Метки:<br/> -_tx_kind_ – тип транзакции, возможные значения `read_only`, `read_write`, `write_only`, `pure`.
`table.transaction.client_duration_milliseconds`<br/>`HIST_RATE`, штуки | Количество транзакций определенной длительности выполнения на клиенте. Длительность выполнения – это время ожидания на клиенте между отправкой отдельных запросов в одной транзакции. Не включает время выполнения запросов на сервере.<br/>Метки:<br/>- _tx_kind_ – тип транзакции, возможные значения `read_only`, `read_write`, `write_only`, `pure`.

### Метрики обработки запросов {#queries}

Имя метрики<br/>Тип, единицы измерения | Описание<br/>Метки
----- | -----
`table.query.request.bytes`<br/>`RATE`, байты | Размер текста YQL-запросов и значений параметров к запросам, которые поступили в базу данных в определенный период времени.
`table.query.request.parameters_bytes`<br/>`RATE`, байты | Размер параметров к запросам, которые поступили в базу данных в определенный период времени.
`table.query.response.bytes`<br/>`RATE`, байты | Размер ответов, которые отправлены базой данных в определенный период времени.
`table.query.compilation.latency_milliseconds`<br/>`HIST_RATE`, штуки | Гистограммный счетчик. Интервалы заданы в миллисекундах. Показывает количество успешно выполненных запросов на компиляцию, длительность которых попадает в определенный интервал времени.
`table.query.compilation.active_count`<br/>`IGAUGE`, штуки | Количество компиляций, которые находятся в процессе выполнения в данный момент времени.
`table.query.compilation.count`<br/>`RATE`, штуки | Количество компиляций, которые успешно завершились в определенный период времени.
`table.query.compilation.errors`<br/>`RATE`, штуки | Количество компиляций, которые завершились с ошибкой в определенный период времени.
`table.query.compilation.cache_hits`<br/>`RATE`, штуки | Количество запросов в определенный период времени, для выполнения которых не потребовалось компилировать запрос, так как в кэше подготовленных запросов был созданный ранее план.
`table.query.compilation.cache_misses`<br/>`RATE`, штуки | Количество запросов в определенный период времени, для выполнения которых потребовалось компилировать запрос.
`table.query.execution.latency_milliseconds`<br/>`HIST_RATE`, штуки | Гистограммный счетчик. Интервалы заданы в миллисекундах. Показывает количество запросов, время выполнения которых попадает в определенный интервал.

### Метрики партиций таблиц {#datashards}

Имя метрики<br/>Тип, единицы измерения | Описание<br/>Метки
----- | -----
`table.datashard.row_count`<br/>`GAUGE`, штуки | Количество строк в таблицах базы данных.
`table.datashard.size_bytes`<br/>`GAUGE`, байты | Размер данных в таблицах базы.
`table.datashard.used_core_percents`<br/>`HIST_GAUGE`, % | Гистограммный счетчик. Интервалы заданы в процентах. Показывает количество партиций таблиц, которые используют вычислительные ресурсы в доле, попадающей в определенный интервал.
`table.datashard.read.rows`<br/>`RATE`, штуки | Количество строк, которые прочитаны всеми партициями всех таблиц в базе данных в определенный период времени.
`table.datashard.read.bytes`<br/>`RATE`, байты | Размер данных, которые прочитаны всеми партициями всех таблиц в базе в определенный период времени.
`table.datashard.write.rows`<br/>`RATE`, штуки | Количество строк, которые записаны всеми партициями всех таблиц в базе данных в определенный период времени.
`table.datashard.write.bytes`<br/>`RATE`, байты | Размер данных, которые записаны всеми партициями всех таблиц в базе в определенный период времени.
`table.datashard.scan.rows`<br/>`RATE`, штуки | Количество строк, которые прочитаны через вызовы gRPC API `StreamExecuteScanQuery` или `StreamReadTable` всеми партициями всех таблиц в базе данных в определенный период времени.
`table.datashard.scan.bytes`<br/>`RATE`, байты | Размер данных, которые прочитаны через вызов gRPC API `StreamExecuteScanQuery` или `StreamReadTable` всеми партициями всех таблиц в базе в определенный период времени.
`table.datashard.bulk_upsert.rows`<br/>`RATE`, штуки |  Количество строк, которые добавлены через вызов gRPC API `BulkUpsert` во все партиции всех таблиц в базе данных в определенный период времени.
`table.datashard.bulk_upsert.bytes`<br/>`RATE`, байты | Размер данных, которые добавлены через вызов gRPC API `BulkUpsert` во все партиции всех таблиц в базе в определенный период времени.
`table.datashard.erase.rows`<br/>`RATE`, штуки |  Количество строк, которые удалены в базе данных в определенный период времени.
`table.datashard.erase.bytes`<br/>`RATE`, байты | Размер данных, которые удалены в базе в определенный период времени.

### Метрики использования ресурсов (только для режима Dedicated) {#ydb_dedicated_resources}

Имя метрики<br/>Тип<br/>единицы измерения | Описание<br/>Метки
----- | -----
`resources.cpu.used_core_percents`<br/>`RATE`, % | Использование CPU. Значение `100` означает, что одно из ядер использовано на 100%. Значение может быть больше `100` для конфигураций с более чем 1 ядром.<br/>Метки:<br/>- _pool_ – вычислительный пул, возможные значения `user`, `system`, `batch`, `io`, `ic`.
`resources.cpu.limit_core_percents`<br/>`IGAUGE`, % | Доступный базе данных CPU в процентах. Например, для БД из трех нод по 4 ядра в `pool=user` в каждой ноде, значение этого сенсора будет равно `1200`.<br/>Метки:<br/>- _pool_ – вычислительный пул, возможные значения `user`, `system`, `batch`, `io`, `ic`.
`resources.memory.used_bytes`<br/>`IGAUGE`, байты |  Использованная нодами базы данных оперативная память.
`resources.memory.limit_bytes`<br/>`IGAUGE`, байты | Доступная нодам базы данных оперативная память.

### Метрики обработки запросов (только для режима Dedicated) {#ydb_dedicated_queries}

Имя метрики<br/>Тип<br/>единицы измерения | Описание<br/>Метки
----- | -----
`table.query.compilation.cache_evictions`<br/>`RATE`, штуки | Количество запросов, вытесненных из кэша [подготовленных запросов](../oss/public/reference/ydb-sdk/#param-prepared-queries) в определенный период времени.
`table.query.compilation.cache_size_bytes`<br/>`IGAUGE`, байты | Размер кэша [подготовленных запросов](../oss/public/reference/ydb-sdk/#param-prepared-queries).
`table.query.compilation.cached_query_count`<br/>`IGAUGE`, штуки |  Размер кэша [подготовленных запросов](../oss/public/reference/ydb-sdk/#param-prepared-queries).
