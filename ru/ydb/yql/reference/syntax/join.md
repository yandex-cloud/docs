# JOIN

Позволяет объединить два источника данных (подзапроса или таблицы) по равенству значений указанных столбцов или выражений. Если с обеих сторон нашлось более одной строки с одинаковыми значениями, то по всем этим строкам строится декартово произведение (если явно не указано обратное).

Столбцы, по которым выполняется объединение, можно указать одним из двух способов:

1. После ключевого слова `USING`, например: `table1 AS a JOIN table2 AS b USING (foo)`. Это более короткий способ записи, удобный для простых случаев. В случае объединения трёх и более таблиц в одном [`SELECT`](select.md), `USING` подразумевает одноименные столбцы соседних таблиц.
2. После ключевого слова `ON`, например `a JOIN b ON a.foo == b.bar`. Этот способ позволяет использовать разные имена столбцов и указать дополнительные условия по аналогии с [WHERE](select.md#where).

Доступны следующие логические типы `JOIN`:

* `INNER` (по умолчанию) — строки попадают в результат, только если значение ключевых колонок присутствует в обеих таблицах.
* `FULL`, `LEFT` и `RIGHT` — при отсутствии значения в обеих или в одной из таблиц включает строку в результат, но оставляет пустыми (`NULL`) колонки, соответствующие противоположной таблице.
* `LEFT/RIGHT SEMI` — одна сторона выступает как белый список (whitelist) ключей, её значения недоступны. В результат включаются столбцы только из одной таблицы, декартового произведения не возникает;
* `LEFT/RIGHT ONLY` — вычитание множеств по ключам (blacklist). Практически эквивалентно добавлению условия `IS NULL` на ключ противоположной стороны в обычном `LEFT/RIGHT`, но, как и в `SEMI`, нет доступа к значениям;
* `CROSS` — декартово произведение двух таблиц целиком без указания ключевых колонок, секция с `ON/USING` явно не пишется;
* `EXCLUSION` — обе стороны минус пересечение.

![image](../../../_assets/join.png)

{% note info %}

`NULL` является особым значением, которое ничему не равно. Таким образом, `NULL` с двух сторон **НЕ** считаются равными друг другу. Это избавляет от неоднозначности в некоторых типах `JOIN`, а также от гигантского декартового произведения, которое часто возникает в противном случае.

{% endnote %}

Если в выражении помимо `JOIN` выполняется фильтрация данных, то рекомендуется обернуть те условия, про которые известно, что они вернут `true` для большинства строк, в вызов функции `LIKELY(...)`. Если предположение о преобладании положительных значений в условии окажется верно, такая подсказка может положительно сказаться на времени выполнения запроса.

**Примеры**

```sql
SELECT
  a.value, b.value
FROM a_table AS a
FULL JOIN b_table AS b
USING (key);
```

```sql
SELECT
  a.value, b.value
FROM a_table AS a
FULL JOIN b_table AS b
ON a.key == b.key;
```
