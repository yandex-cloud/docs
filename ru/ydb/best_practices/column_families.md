## Настройка групп колонок
#### Общее описание
Существует возможность группировать колонки в таблице для оптимизации их хранения и/или использования. Как и во многих других СУБД Kikimr предоставляет механизм групп колонок (Column Families). Группа колонок принадлежит конкретной таблице и содержит колонки этой таблицы. Группа колонок может содержать произвольное число колонок своей таблицы, в том числе не содержать ни одной. По умолчанию у таблицы существует одна группа колонок, которой принадлежат все колонки этой таблицы.

В Kikimr группирование колонок - часть политики хранения данных таблицы. Основным механизмом смены хранения данных таблицы является смена профиля хранения (Profile). Например, настраивается два профиля: "HDD" и "SSD". При необходимости "ускорить" отдельную таблицу ее перемещают на SSD, меняя ей профиль. Механизм Column Families предназначен для более тонкой настройки размещения данных. Группа колонок позволяет задать особые правила хранения (относительно определенных в профиле) для части колонок таблицы. Также группы колонок используются для задания правил сжатия и кеширования.

Данные в Kikimr хранятся в сетевом хранилище. Профиль хранения задает способ размещения логических данных таблицы на сетевом хранилище. Логические данные - именованные сущности, заданные реализацией. Для таблиц это: Log, Data, External. В Kikimr помимо таблиц существуют и другие сущности (PQ, NBS). Для них логические потоки данных могут отличаться. При этом механизм задания профилей остается аналогичным.

Профиль таблицы и группы колонок задаются в опциях CREATE TABLE и ALTER TABLE.

NOTE: Сейчас существует техническое ограничение: все ключевые колонки должны принадлежать одной группе.
NOTE: В текущей версии одна колонка может принадлежать только одной группе колонок. В будущем колонки смогут принадлежать нескольким группам.

#### Основные сущности
При работе с таблицами пользователю доступна настройка трех именованных сущностей:

 **Сущность** |
 --- |
Таблица (Table) |
Колонка (Column) |
Группа колонок (ColumnFamily) |

Свойства таблицы:
- Имя
- Список колонок
- Список ключевых колонок
- Список групп колонок
- Настройки партиционаирования
- Профиль хранения (строковое имя)

Свойства колонки:
- Имя
- Тип (значение из списка)
- Группа(-ы) колонок (к которой принадлежит)

Свойства группы колонок:
- Имя
- Способ сжатия (значение из списка)
- Способ кеширования (значение из списка)
- Тип размещения для Data, External

Таблица содержит колонки. Колонки делятся на ключевые и неключевые. Ключевые колонки упорядочены (данные отсортированы в соответствии с порядком следования ключевых колонок). Неключевые колонки порядка не имеют. Все колонки, включая ключевые - nullable. По умолчанию все колонки принадлежат основной группе колонок.

Колонки могут объединяться в группы колонок. Для этого нужно использовать CREATE TABLE / ALTER TABLE:
1. Создать группу(-ы) колонок для данной таблицы
2. Задать колонке(-ам) существующую группу колонок

Группа колонок может переопределять тип размещения данных относительно указанного в профиле хранения таблицы. А также определяет способ сжатия и кешировния данных.

#### Профили хранения {#storage-profiles}
Настройки хранения данных таблиц задаются в профиле хранения таблицы.

 **Сущность** | **Смысл**
 --- | ---
 Профиль (Profile) | Задает профиль хранения данных
 Тип размещения (PoolType) | Задает способ размещения данных в сетевом хранилище

Свойства профиля:
- Имя профиля
- Тип размещения для логических потоков данных

Тип размещения (PoolType) определяет erasure-кодирование и тип физических носителей (HDD/SSD). На основе PoolType в сетевом хранилище динамически создается пул хранения. Пул может иметь собственные настройки (например, размер).

##### Задание профилей хранения {#setting-storage-profiles}
Профили задаются в конфигурационном файле profiles.txt (перенесено из channels.txt).
```
PoolType { Name: "HDD_mirror3" Config { Erasure: "mirror-3" Media: "hdd" } }
PoolType { Name: "SDD_mirror3" Config { Erasure: "mirror-3" Media: "ssd" } }

Profile {
    Name: "HDD"
    Storage { Log: "HDD_mirror3" Data: "HDD_mirror3" External: "HDD_mirror3" }
    Default: true
}

Profile {
    Name: "SSD"
    Storage { Log: "SSD_mirror3" Data: "SSD_mirror3" External: "SSD_mirror3" }
}

Profile {
    Name: "Mixed"
    Storage { Log: "SSD_mirror3" Data: "SSD_mirror3" External: "HDD_mirror3" }
}
```
В файле должен быть определен минимум 1 профиль. Пользователь обращается к профилям по имени. Один из профилей может быть промаркирован как Default (основной). Если ни один из профилей не задан основным, для создания таблиц без указания профиля используется первый профиль в файле.
PoolType может задаваться вне конфига (через консоль).

##### Особое размещение для групп колонок {#special-accommodation-for-groups-of-columns}
Группа колонок может переопределить PoolType для хранения части данных (без изменения профиля хранения). Для таблиц можно переопределить хранение для Data и External. Примеры:

```
Storage { Data: "SSD_mirror3" External: "SSD_mirror3" } // разместить Data и External на SSD
Storage { Data: "SSD_mirror3" }                         // разместить Data на SSD, оставив размещение External в соответствии с профилем таблицы
Storage { External: "SomeOtherPoolType" }               // разместить External на новом типе хранения (которого могло не быть при создании таблицы)
```
Особое размещение задается через опции CREATE/ALTER TABLE.
