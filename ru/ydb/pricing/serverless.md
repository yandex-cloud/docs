---
editable: false
---

# Правила тарификации для бессерверного режима {{ ydb-name }}

{% include [currency-choice](../_includes/pricing/currency-choice.md) %}

При использовании бессерверного режима {{ ydb-name }} плата взимается за каждый выполненный к базе данных запрос. Указывать, какие ресурсы требуются для работы, нет необходимости, база данных оперативно адаптируется к изменению пользовательской нагрузки в рамках выделенных пользователю [квот](../concepts/limits.md). Помимо запросов пользователь оплачивает хранимые в {{ ydb-name }} данные на почасовой основе. Дополнительно тарифицируются другие операции, такие как восстановление из резервной копии.
## Из чего складывается стоимость использования бессерверного режима {{ ydb-name }} {#rules}

При работе {{ ydb-name }} в бессерверном режиме вы оплачиваете:

* операции с данными;
* объем хранимых данных, включая служебные данные, например, индексы;
* дополнительные пользовательские операции, такие как восстановление данных из резервной копии.

Дополнительно оплачиваются иные потребляемые ресурсы:

* место, занятое в сервисе {{ objstorage-name }} для хранения резервных копий по требованию;
* объем исходящего трафика из {{ yandex-cloud }} в интернет.

{% include [pricing-gb-size](../_includes/pricing/pricing-gb-size.md) %}

### Операции с данными и единица запроса {#rules-ru}

{% if audience != "external" %}

Бессерверный режим {{ ydb-name }} поддерживает несколько API для выполнения операций с данными: YDB API и Document API (Amazon DynamoDB-совместимое API). Спектр запросов, которые выражаются через указанные API, широк, и простирается от точечных чтений и записей по ключу, до сложных SQL-запросов, выполняющих соединения нескольких таблиц с последующей группировкой и сортировкой результата. Каждая из таких операций потребляет ресурсы базы данных основываясь на сложности операции.

Для оценки стоимости произвольного запроса вводится понятие Request Unit (RU) — единицы запроса. 1 RU — это эталонная стоимость чтения строки таблицы объемом до 4Кб по первичному ключу. Единица запроса абстрагирует ресурсы такие как CPU, Memory, Disk I/O, используемые для выполнения операции. Любой запрос к {{ ydb-name }}, не важно при помощи какого API выполнен, имеет стоимость в терминах RU. Единицы запроса в секунду или RU/s — это показатель пропускной способности базы данных, количества используемых ресурсов и, в итоге, стоимости работы с базой данных.

{% else %}

Бессерверный режим работы {{ ydb-full-name }} поддерживает несколько способов работы с данными:
* Document API — HTTP API, совместимое с Amazon DynamoDB. С помощью этого API можно выполнять операции над документными таблицами.
* YDB API и его реализации в виде [YDB CLI](../quickstart/yql-api/ydb-cli.md) и [YDB SDK](../ydb-sdk/index.md) для [Java](https://github.com/yandex-cloud/ydb-java-sdk), [Python](https://github.com/yandex-cloud/ydb-python-sdk), [Node.js](https://github.com/yandex-cloud/ydb-nodejs-sdk), [PHP](https://github.com/yandex-cloud/ydb-php-sdk) и [Go](https://github.com/yandex-cloud/ydb-go-sdk). С помощью этого API можно выполнять операции над YDB-таблицами.

Для расчета стоимости запросов в {{ ydb-short-name }} используется понятие **единица запроса** (**RU** — request unit). Каждый выполненный запрос в зависимости от его типа, сложности и размера данных приводит к потреблению определенного количества RU. Итоговая стоимость всех выполненных запросов к {{ ydb-short-name }} складывается из стоимости каждого запроса, выраженной в RU.

{% endif %}

#### Document API {#document-api}

{% if audience != "external" %}

В Таблице 1 приведена стоимость некоторых операций Document API в терминах единиц запросов. Под операцией чтения/записи строки понимается операция с одной строкой таблицы в рамках таких вызовов API как `GetItem`/`BatchGetItem`/`PutItem`. Стоимость составной операции работы с данными (`BatchGetItem` является примером такой операции), равна сумме единичных вызовов. Например, стоимость выполнения операции `BatchGetItem` равна сумме стоимостей вызовов `GetItem` для каждого ключа. Под операцией чтения/записи строки в рамках транзакции понимается операция в рамках таких вызовов API как `TransactGetItems`/`TransactWriteItems`. Стоимость запроса складывается из суммы адресуемых операцией строк.

{% else %}

Стоимость обработки каждого документа при запросе через Document API равна стоимости единицы запроса в RU, умноженной на размер документа в блоках. Размер в блоках равен размеру в байтах, деленному на размер блока и округленному в большую сторону. Запрос несуществующего документа приравнивается к чтению документа размером в 1 блок. Если запрос обрабатывает несколько документов (например, `BatchGetItem`), итоговая стоимость равна сумме стоимостей по каждому документу.

{% endif %}

Тип запроса                                                                        | Стоимость единицы | Размер блока   |
---------------------------------------------------------------------------------- | ----------------- | -------------- |
Чтение (`GetItem`, `BatchGetItem`, `Query`, `Scan`)                                        | 1 RU              | 4 КБ           |
Чтение в рамках транзакции (`TransactGetItems`)                                      | 2 RU              | 4 КБ           |
Запись (`PutItem`, `BatchWriteItem`, `UpdateItem`)                                       | 2 RU              | 1 КБ           |
Запись в рамках транзакции (`TransactWriteItems`)                                    | 4 RU              | 1 КБ           |
Удаление (`DeleteItem`)                                                              | 2 RU              | Не применяется |
Работа со схемой базы данных (`CreateTable`, `DeleteTable`, `DescribeTable`, `ListTables`) | 0 RU              | Не применяется |

#### YDB API {#ydb-api}

{% if audience != "external" %}

Выразительные возможности YDB API позволяют формулировать широкий класс запросов. Операции с данными не ограничиваются точечными или диапазонными запросами на чтение/запись/модификацию данных. При выполнении каждого запроса {{ ydb-name }} Serverless ведет учет затраченных ресурсов:
* чтения строк в штуках и байтах;
* запись строк в штуках и байтах;
* потраченное на выполнение процессорное время.

Потраченные на выполнение ресурсы переводятся в единицы запросов по схеме аналогичной для Document API за операции чтения/записи. Стоит отметить, что единица запроса помимо записанных/прочитанных байт включает в себя эталонное потребление процессорного времени. Некоторые YQL-запросы могут потреблять значительные объемы процессорного времени работая с небольшим количеством данных. В этом случае стоимость запроса рассчитывается как максимум из:
* единиц запроса потраченных на чтение и запись данных;
* потребленного процессорного времени деленного на эталонное потребление процессора одной единицей запроса.

В документе <span style="color: red;">Просмотр стоимости выполнения запроса (поставить ссылку)</span> можно подробнее ознакомиться с тем, какие возможности имеет пользователь {{ ydb-name }} Serverless для просмотра и оценки стоимости выполнения конкретного запроса.

{% else %}

При выполнении запроса через {{ ydb-short-name }} API используются ресурсы на стороне сервера. Информация о потребленных ресурсах доступна в статистике исполнения запроса.

Для определения стоимости запроса через YDB API вычисляются стоимость использования CPU и стоимость ввода-вывода данных. Из вычисленных значений выбирается максимальное.

* Стоимость использования CPU.

  Суммируется время CPU, затраченное на компиляцию запроса, а также время использования CPU на всех этапах выполнения запроса. Сумма делится на продолжительность одного окна 1,5 мс, округляется в меньшую сторону и переводится в RU по тарифу из таблицы ниже.

  Закешированные запросы повторно не компилируются. Чтобы воспользоваться кешированием, применяйте в запросах `bind variables`, а также включите флаг сохранения плана исполнения запроса в кеше.

* Стоимость ввода-вывода данных.

  Рассчитываются следующие значения:

  * Количество операций чтения с диска. Сравнивается число прочитанных записей и блоков данных, выбирается наибольшее из них. Число блоков вычисляется делением суммы прочитанных байт на размер блока 4 КБ, с округлением вверх.
  * Количество операций записи на диск. Сравнивается число записанных записей и блоков данных, выбирается наибольшее и них. Число блоков вычисляется делением суммы записанных байт на размер блока 1 КБ, с округлением вверх.

  Учитывается ввод-вывод данных в таблицы и индексы. При удалении записей учитывается только их количество.

  Количества операций чтения и записи переводятся в RU по тарифу из таблицы ниже, полученные стоимости складываются.

{% note warning %}

Некоторые преобразования над записями требуют их чтения или удаления перед изменением, это может повлиять на стоимость запроса.

{% endnote %}

Стоимость единиц выполнения запроса в RU:

Оцениваемый параметр | Стоимость |
:--- | :---: |
Одно окно использования CPU | 1 RU
Одна операция чтения | 1 RU
Одна операция записи | 2 RU

Не тарифицируется следующие операции:

* Создание, изменение и удаление схем таблиц.
* Получение описания и списка таблиц.
* Создание и удаление директорий.

{% cut "Пример расчета стоимости запроса" %}

Статистика запроса:

```text
query_phases {
  ...
  table_access {
    ...
    reads {
      rows: 2
      bytes: 16
    }
    ...
  }
  cpu_time_us: 475
  ...
}
query_phases {
  ...
  table_access {
    ...
    updates {
      rows: 2
      bytes: 2456
    }
    ...
  }
  cpu_time_us: 514
  ...
}
compilation {
  ...
  cpu_time_us: 4062
}
process_cpu_time_us: 870
```

Где:

* `query_phases[].cpu_time_us` — время CPU на выполнение запроса в мкс.
* `compilation.cpu_time_us` — время CPU на компиляцию запроса в мкс.
* `process_cpu_time_us` — время CPU на управление взаимодействием в мкс.
* `query_phases[].reads.rows` — число прочитанных записей данных.
* `query_phases[].reads.bytes` — число прочитанных байт данных.
* `query_phases[].updates.rows` — число записанных записей данных.
* `query_phases[].updates.bytes` — число записанных байт данных.

Чтобы получить стоимость использования CPU, сумма времени CPU запроса делится на 1,5 мс, `( 475 + 514 + 4062 + 870 ) / 1500 = 3,95`. Результат округляется в меньшую сторону и переводится в RU:

```text
3 × 1 RU = 3 RU
```

Чтобы получить стоимости ввода-вывода данных:

* Вычисляется количество операций чтения с диска в записях и блоках, из них выбирается максимальное:

  * прочитаны 2 записи, количество операций равно 2;
  * прочитаны 16 байт, `16 / ( 4 × 1024 ) = 0,004`, результат округляется в большую сторону, количество операций равно 1.

  Количество операций чтения равно 2.

* Вычисляется количество операций записи на диск в записях и блоках, из них выбирается максимальное:

  * записаны 2 записи, количество операций равно 2;
  * записаны 2456 байта, `2456 / 1024 = 2,398`, результат округляется в большую сторону, количество операций равно 3.

  Количество операций записи равно 3.

Стоимость ввода-вывода:

```text
2 × 1 RU + 3 × 2 RU = 8 RU
```

Стоимость выполнения запроса равна 8 RU.

{% endcut %}

##### Особенности расчета стоимости некоторых операций

* **ReadTable**
   Операция `ReadTable` позволяет эффективно вычитывать большие диапазоны данных таблицы. Стоимость запроса зависит только от объема прочитанных данных и составляет 128 RU за 1 МБ. При расчете стоимости объем округляется в большую сторону до значения, кратного 1 МБ.

* **BulkUpsert**
   `BulkUpsert` позволяет эффективно загружать данные в базу. Стоимость записи строки в рамках операции `BulkUpsert` составляет 0,5 RU за 1 КБ записанных данных. При расчете стоимости объем данных округляется в большую сторону до значения, кратного 1 КБ. Итоговая стоимость операции рассчитывается как сумма стоимости всех записанных строк с округлением до ближайшего большего целого.

   **Пример расчета стоимости**

   Например, в рамках операции `BulkUpsert` вы записываете четыре строки данных объемом 2500 байт, 100 байт, 1200 байт и 1024 байта.

   Стоимость такой операции составит:
   > 0,5 RU × 3 + 0,5 RU × 1 + 0,5 RU × 2 + 0,5 RU × 1 = 3,5 RU
   >
   > Итого, после округления в большую сторону: 4 RU

   Где:
   * 0,5 — стоимость в единицах запросов за 1 КБ записанных данных.
   * 3 — объем первой строки в КБ после округления в большую сторону (2500 байт = 1024 байта + 1024 байта + 452 байта).
   * 1 — объем второй строки в КБ после округления в большую сторону.
   * 2 — объем третьей строки в КБ после округления в большую сторону (1200 байт = 1024 байта + 176 байт).
   * 1 — объем четвертой строки в КБ.

* **Построение вторичного индекса**
   Стоимость построения индекса складывается из стоимости операции `ReadTable` оригинальной таблицы и `BulkUpsert` в индексную таблицу. Тарифицируется объем проделанной работы — количество строк и их размер, который был прочитан из оригинальной таблицы и записан в индексную таблицу. Процесс построения индекса может быть отменен пользователем. Отмененные операции построения индекса также тарифицируются за объем проделанной работы до отмены операции.


{% endif %}

{% if audience != "external" %}

#### Использование параметризованных подготовленных запросов в YDB API
Параметризованные подготовленные запросы <span style="color: red;">ссылка</span> позволяют существенно снизить накладные расходы на выполнения запросов путем экономии процессорного времени на парсинг и оптимизацию однотипных запросов. Вызов ```PrepareDataQuery```, который осуществляет подготовку запроса, оплачивается исходя из потребленных ресурсов процессора и измеряется в единицах запросов. Стоимость подготовки запроса зависит от сложности самого запроса.

#### Операция ReadTable
Операция `ReadTable` <span style="color: red;">(поставить ссылку)</span> позволяет эффективно вычитывать большие диапазоны данных таблицы. Операция тарифицируется исходя из прочитанных данных за 1 МБ данных. Стоимость чтения 1 МБ составляет 128 RU. Объем вычитанных данных округляется в большую сторону до целых мегабайт.

#### Операция BulkUpsert
Операция `BulkUpsert` <span style="color: red;">(поставить ссылку)</span> позволяет более эффективно загружать данные в базу данных. Запись данных через `BulkUpsert` в 2 раза дешевле записи через Document API и составляет 1 RU за 1 строку размером до 1 КБ. Если размер строки более 1 КБ, размер строки округляется в большую сторону до килобайт и делится на 1 КБ, итоговое количество RU составляет стоимость запроса.

<span style="color: red;">CopyTable; что делать с бэкапом???</span>

#### Операции со схемой базы данных
Операции со схемой базы данных, например, создание и удаление таблиц, изменение схемы таблицы, листинг таблиц и получение описания таблицы -- не тарифицируются. Однако количество таких операций ограничивается. Подробнее с лимитами можно ознакомиться в разделе <span style="color: red;">Квоты (поставить ссылку)</span>.

{% endif %}

### Объем хранимых данных {#rules-storage}

{% if audience != "external" %}

Явным образом выделять хранилище для данных в {{ ydb-name }} Serverless не требуется. Мощности для хранения данных выделяются системой автоматически. Данные, записанные пользователем, хранятся в специальных структурах данных {{ ydb-name }}, которые оптимизированы под эффективную запись, чтение по первичному ключу и других операций. Объем хранимых данных в {{ ydb-name }} Serverless рассчитывается как хранилище выделенное для указанных структур данных. Например, создание глобального индекса приводит к увеличению размера хранилища на размер данного индекса. {{ ydb-name }} Serverless непрерывно следит за размером таблиц для оперативной реакции на уменьшение и увеличения объема хранимых данных.

{% else %}

В бессерверном режиме мощности для хранения данных выделяются автоматически. Объем хранимых данных при этом рассчитывается как совокупный объем пользовательских и служебных данных, которые хранятся в БД. Например, создание глобального индекса приводит к увеличению размера хранилища на размер такого индекса.

{% endif %}

### Создание резервных копий {#rules-backup-storage}

{% if audience != "external" %}

{{ ydb-name }} Serverless обеспечивает автоматическое регулярное создание резервной копии базы данных раз в сутки. Резервная копия сохраняется в сервисе {{ objstorage-full-name }}. Система хранит последние 2 резервные копии базы. В случае удаление базы данных последняя резервная копия хранится в течении 2-х дней. Описанная услуга резервного копирования предоставляется бесплатно.

Пользователь может выполнить резервное копирование базы данных в сервисе {{ ydb-name }} Serverless по требованию. В этом случае стоимость резервной копии рассчитывается исходя из цены за 1 ГБ выгруженных из {{ ydb-name }} Serverless данных. Объем данных округляется до целых ГБ в большую сторону. Дополнительно оплачивается работа с сервисом {{ objstorage-full-name }} по ценам этого сервиса.

В случае выгрузки данных при помощи утилиты ```ydb tools dump``` тарификация производится по тарифам операции `ReadTable`.

{% else %}

#### Автоматические резервные копии {#rules-auto-backup-storage}

{{ ydb-name }} автоматические создает и бесплатно хранит 2 полные резервные копии ваших баз за два последних дня. Плата за хранение автоматических резервных копий не взимается.

#### Резервные копии по требованию {#rules-auto-backup-storage}

Вы можете принудительно выполнить резервное копирование базы данных с сохранением копии в сервисе {{ objstorage-full-name }}. Стоимость такой операции зависит от объема скопированных данных. При расчете стоимости фактический объем округляется в большую сторону до значений, кратных 1 ГБ.

{% note warning %}

В случае выгрузки данных при помощи утилиты ```ydb tools dump``` тарификация производится по тарифам операции `ReadTable`.

{% endnote %}

{% endif %}

### Восстановление из резервной копии {#rules-backup-restore}

{% if audience != "external" %}

{{ ydb-name }} Serverless предлагает механизм восстановления базы и/или отдельных таблиц из резервной копии, хранимой в сервисе Object Storage. Восстановление данных из резервной копии осуществляется по требованию и тарифицируется исходя из цены восстановления за 1 ГБ. Объем данных округляется до целых ГБ в большую сторону.

В случае восстановления данных при помощи утилиты ```ydb tools restore``` тарификация производится по цене записи строки в базу данных для каждой восстановленной строки.

{% else %}

Вы можете восстанавливать базы и/или отдельные таблицы из резервных копий, которые хранятся в сервисе {{ objstorage-name }}. Стоимость такой операции зависит от объема восстановленных данных. При расчете стоимости фактический объем округляется в большую сторону до значения, кратного 1 ГБ.

{% note warning %}

В случае восстановления данных при помощи утилиты ```ydb tools restore``` тарификация производится по цене записи строки в базу данных для каждой восстановленной строки.

{% endnote %}

{% endif %}

## Скидка за резервируемый объем ресурсов {#cvos}

{% if audience != "external" %}

Сервис {{ ydb-name }} предоставляет возможность зарезервировать пропускную способность к базе данных в виде единиц запросов с существенной скидкой относительно цены за запросы по требованию. Резерв выражается в виде количества единиц запросов в секунду к базе данных. Пользователь может выбирать размер резерва с шагом 100 RU/sec. Резерв пропускной способности в 100 RU/sec означает, что если реальная пользовательская нагрузка не превышает 100 RU/sec, то ее стоимость покрывается из резерва. То есть нагрузка в 80 RU/sec будет полностью покрываться из резерва. Превышение этой нагрузки тарифицируется по ценам запросов по требованию. То есть при реальной нагрузке в 120 RU/sec и оформленном резерве в 100 RU/sec пользователь заплатит за 20 RU/sec по цене операций с данными по требованию. Если пользователь не исчерпал резерв, так как реальная нагрузка была ниже указанной в резерве, резерв сгорает. Оплата резервов выгодна тем пользователям, у которых нагрузка на базу является значительной и постоянной.

Стоит отметить, что резерв аггрегируется на окне <span style="color: red;">в 5 минут</span>. То есть при оплате резерва в 100 RU/sec, не обязательно потреблять каждую секунду 100 RU, нагрузка может плавать на протяжении указанного времени, в какую-т секунду нагрузка может составлять 150 RU, в другую -- 50 RU.

В консоли управления вы можете увидеть потенциальную экономию для текущего потребления ресурсов при переводе их на схему CVoS, а также предварительно рассчитать месячные платежи для нужного количества ядер процессора и оперативной памяти.

<span style="color: red;">Серьезно подумать о необходимости ссылаться на [CVoS](https://cloud.yandex.ru/docs/billing/operations/purchase-cvos)</span>

{% if deploy != "arc" %}
{% include [cvos](../_includes/pricing/cvos.md) %}
{% endif %}

{% else %}

Вы можете получить гарантированную скидку за потребление ресурсов сервиса, запланированное на месяц, на год или на три года вперед.

Бессерверный режим {{ ydb-name }} предоставляет {% if deploy != "arc" %} [CVoS](../../billing/concepts/cvos.md) {% else %} CVoS {% endif %} на определенное количество запросов, выраженных в единицах RU, в секунду. Вы можете выбирать размер резерва с шагом 100 RU/с.

При вычислении реального объема потребления количество запросов усредняется каждые пять минут. То есть, например, при резерве 100 RU/с не обязательно потреблять каждую секунду 100 RU. На протяжении интервала усреднения нагрузка может изменяться и составлять в один момент 150 RU/с, в другую — 50 RU/с.

{% endif %}

## Цены {#prices}

{% if region == "ru" %}

{% include notitle [rub-serverless](../../_pricing/ydb/rub-serverless.md) %}

{% endif %}

{% if region == "kz" %}

{% include notitle [kzt-serverless](../../_pricing/ydb/kzt-serverless.md) %}

{% endif %}

{% if region == "int" %}

{% include notitle [usd-serverless](../../_pricing/ydb/usd-serverless.md) %}

{% endif %}

{% if region == "ru" %}

{% include notitle [rub-egress-traffic.md](../../_pricing/rub-egress-traffic.md) %}

{% endif %}

{% if region == "kz" %}

{% include notitle [kzt-egress-traffic.md](../../_pricing/kzt-egress-traffic.md) %}

{% endif %}

{% if region == "int" %}

{% include notitle [usd-egress-traffic.md](../../_pricing/usd-egress-traffic.md) %}

{% endif %}


{% if audience != "external" %}

## Примеры расчета стоимости {#simple-example}


{% list tabs %}

- Простой пример

  Здесь простой пример

- Развернутый пример

  Здесь развернутый пример

{% endlist %}

{% endif %}

