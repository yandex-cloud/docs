# Правила тарификации для бессерверного режима {{ ydb-name }}

{% if product == "cloud-il" %}

{% note info %}

Цены, указанные ниже, начнут действовать, когда сервис {{ ydb-name }} [станет общедоступным](../../overview/concepts/launch-stages.md) (дата будет анонсирована позднее). До этого использование сервиса не тарифицируется.

{% endnote %}

{% endif %}

{% if product == "yandex-cloud" %}

{% include [currency-choice](../_includes/pricing/currency-choice.md) %}

{% endif %}

При использовании бессерверного режима {{ ydb-name }} плата взимается за каждый выполненный к базе данных запрос. Указывать, какие ресурсы требуются для работы, нет необходимости, база данных оперативно адаптируется к изменению пользовательской нагрузки. Помимо запросов пользователь оплачивает хранимые в {{ ydb-name }} данные на почасовой основе. Дополнительно тарифицируются другие операции, такие как восстановление из резервной копии.

## Из чего складывается стоимость использования бессерверного режима {{ ydb-name }} {#rules}

При работе {{ ydb-name }} в бессерверном режиме вы оплачиваете:
* Операции с данными.
* Объем хранимых данных, включая служебные данные, например, индексы.
* Дополнительные пользовательские операции, такие как восстановление данных из резервной копии.

Дополнительно оплачиваются иные потребляемые ресурсы:

* Место, занятое в сервисе {{ objstorage-full-name }} для хранения резервных копий по требованию.
* Объем исходящего трафика из {{ yandex-cloud }} в интернет.

{% include [pricing-gb-size](../_includes/pricing/pricing-gb-size.md) %}

### Операции с данными и единица запроса {#rules-ru}

Бессерверный режим работы Yandex {{ ydb-name }} поддерживает несколько способов работы с данными:
* YQL - диалект SQL для работы с реляционными таблицами, поддерживаемый в [SDK]{% if lang == "ru" %}(https://ydb.tech/ru/docs/reference/ydb-sdk/){% endif %}{% if lang == "en" %}(https://ydb.tech/en/docs/reference/ydb-sdk/){% endif %}, [CLI]{% if lang == "ru" %}(https://ydb.tech/ru/docs/reference/ydb-cli/){% endif %}{% if lang == "en" %}(https://ydb.tech/en/docs/reference/ydb-cli/){% endif %} и консоли управления {{ ydb-short-name }}.
* Document API — HTTP API, совместимый с Amazon DynamoDB. С помощью этого API можно выполнять операции над документными таблицами.

Кроме этого, к базе данных могут быть сделаны запросы через специализированные API, доступные в виде отдельных функций в SDK, CLI или консоли управления {{ ydb-short-name }}.

Для расчета стоимости запросов в {{ ydb-short-name }} используется понятие _единица запроса (RU — Request Unit)_. Каждый выполненный запрос, в зависимости от его типа, сложности и размера данных приводит к потреблению определенного количества RU. Итоговая стоимость всех выполненных запросов к {{ ydb-short-name }} складывается из стоимости каждого запроса, выраженной в RU.

Правила расчета стоимости запросов к {{ ydb-short-name }} в Request Units:
* [YQL](ru-yql.md).
* [Document API](ru-docapi.md).
* [Специальные API](ru-special.md).
* [Операции с топиками](ru-topics.md).

#### Тарифы на потребление Request Units {#prices-ru}

* **За фактическое потребление (on-demand)**. Стоимость использования {{ ydb-short-name }} за некоторый период будет равна сумме потраченных Request Units, умноженной на цену 1 Request Unit, за вычетом предоставляемого ежемесячно [бесплатного пакета](../../billing/concepts/serverless-free-tier.md#ydb). Если запросов к базе данных не было, или количество потраченных в текущем месяце Request Units меньше бесплатного пакета, плата за фактическое потребление Request Units не взимается.
* **Выделенная пропускная способность (provisioned capacity)**. Если ваша нагрузка носит предсказуемый характер и имеет постоянную составляющую, вы можете сократить стоимость использования {{ ydb-short-name }} за счет оплаты части (или всех) потраченных Request Units по почасовому тарифу. Для этого нужно установить отличное от нуля значение параметра базы данных «Выделенная пропускная способность, RU/с». Вам начнут делаться начисления по специальному тарифу, ставка которого задается за RU/с×час, тарификация посекундная. Потребление Request Units в пределах заданной пропускной способности не будет учитываться в трате Request Units по тарифу on-demand.

### Объем хранимых данных {#rules-storage}

В бессерверном режиме мощности для хранения данных выделяются автоматически. Объем хранимых данных при этом рассчитывается как совокупный объем пользовательских и служебных данных, которые хранятся в БД. Например, создание глобального индекса приводит к увеличению размера хранилища на размер такого индекса.

Для работающих в режиме тарификации по фактическому использованию топиков также тарифицируется фактически используемое дисковое пространство. Оно занимается в момент публикации каждого сообщения в топик, и освобождается в момент истечения Retention Period, настроенного в данном топике.

### Создание резервных копий {#rules-backup-storage}

#### Автоматические резервные копии {#rules-auto-backup-storage}

{{ ydb-name }} автоматически создает и бесплатно хранит 2 полные резервные копии ваших баз за два последних дня. Плата за хранение автоматических резервных копий не взимается.

#### Резервные копии по требованию {#rules-auto-backup-storage}

Вы можете принудительно выполнить резервное копирование базы данных с сохранением копии в сервисе [{{ objstorage-name }}](../../storage/). Стоимость такой операции зависит от объема скопированных данных и рассчитывается как для операции [ReadTable](ru-special.md#readtable). При расчете стоимости фактический объем округляется в большую сторону до значений, кратных 1 ГБ.

{% note warning %}

В случае выгрузки данных при помощи утилиты `ydb tools dump` тарификация производится по тарифам операции `ReadTable`.

{% endnote %}

#### Пример расчета стоимости создания резервной копии по требованию {#example-of-cost-calculation-backup-storage}

Рассмотрим расчеты стоимости создания резервных копий БД объемом 1 ГБ и 10 ГБ.

**Расчет стоимости для БД объемом 1 ГБ**

Фактическое потребление RU в месяц составит:

> 128 RU × 1024 = 131 072 RU

Где:
* 128 — стоимость запроса за 1 МБ данных.
* 1024 — объем скопированных данных в МБ.

Потраченное количество RU 131 072 [меньше 1 000 000](#prices), следовательно, создание резервной копии будет бесплатным.

**Расчет стоимости для БД объемом 10 ГБ**

Фактическое потребление RU в месяц составит:

> 128 RU × 1024 × 10 = 1 310 720 RU

Где:
* 128 — стоимость запроса за 1 МБ данных.
* 1024 × 10 — объем скопированных данных в МБ.

Потраченное количество RU 1 310 720 [свыше 1 000 000](#prices), следовательно, цена создания резервной копии составит {% if region == "ru" %}21,3800&nbsp;₽{% endif %}{% if region == "int" %}0,171040&nbsp;${% endif %}{% if region == "kz" %}106,9000&nbsp;₸{% endif %} за 1 000 000 RU.

> (1 310 720 RU - 1 000 000 RU) / 1 000 000 × {% if region == "ru" %}21,3800&nbsp;₽{% endif %}{% if region == "int" %}0,171040&nbsp;${% endif %}{% if region == "kz" %}106,9000&nbsp;₸{% endif %} = {% if region == "ru" %}6,6431936&nbsp;₽{% endif %}{% if region == "int" %}0,0531455488&nbsp;${% endif %}{% if region == "kz" %}33,215968&nbsp;₸{% endif %}
>
> Итого: {% if region == "ru" %}6,6432&nbsp;₽{% endif %}{% if region == "int" %}0,053146&nbsp;${% endif %}{% if region == "kz" %}33,2160&nbsp;₸{% endif %} — стоимость создания резервной копии 10 ГБ данных.

Где:
* 1 310 720 RU — фактическое потребление RU в месяц.
* {% if region == "ru" %}21,3800&nbsp;₽{% endif %}{% if region == "int" %}0,171040&nbsp;${% endif %}{% if region == "kz" %}106,9000&nbsp;₸{% endif %} — цена 1 миллиона RU.

### Восстановление из резервной копии {#rules-backup-restore}

Вы можете восстанавливать базы и/или отдельные таблицы из резервных копий, которые хранятся в сервисе {{ objstorage-name }}. Стоимость такой операции зависит от объема восстановленных данных и рассчитывается как для операции [BulkUpsert](ru-special.md#bulkupsert). При расчете стоимости фактический объем округляется в большую сторону до значения, кратного 1 ГБ.

{% note warning %}

В случае восстановления данных при помощи утилиты `ydb tools restore` тарификация производится по цене записи строки в базу данных для каждой восстановленной строки.

{% endnote %}

#### Пример расчета стоимости восстановления из резервной копии {#example-of-cost-calculation-backup-restore}

Рассмотрим расчеты стоимости восстановления из резервной копии БД объемом 1 ГБ и 10 ГБ.

**Расчет стоимости для БД объемом 1 ГБ**

Фактическое потребление RU в месяц составит:

> 0,5 RU × 1024 × 1024 = 524 288 RU

Где:
* 0,5 — стоимость запроса за 1 КБ данных.
* 1024 × 1024 — объем восстанавливаемых данных в КБ.

Потраченное количество RU 524 288 [меньше 1 000 000](#prices), следовательно, восстановление из резервной копии будет бесплатным.

**Расчет стоимости для БД объемом 10 ГБ**

Фактическое потребление RU в месяц составит:

> 0,5 RU × 1024 × 1024 × 10 = 5 242 880 RU

Где:
* 0,5 — стоимость запроса за 1 КБ данных.
* 1024 × 1024 × 10 — объем восстанавливаемых данных в КБ.

Потраченное количество RU 5 242 880 [свыше 1 000 000](#prices), следовательно, цена восстановления из резервной копии составит {% if region == "ru" %}21,3800&nbsp;₽{% endif %}{% if region == "int" %}0,171040&nbsp;${% endif %}{% if region == "kz" %}106,9000&nbsp;₸{% endif %} за 1 000 000 RU.

> (5 242 880 RU - 1 000 000 RU)/ 1 000 000 × {% if region == "ru" %}21,3800&nbsp;₽{% endif %}{% if region == "int" %}0,171040&nbsp;${% endif %}{% if region == "kz" %}106,9000&nbsp;₸{% endif %} = {% if region == "ru" %}90,7127744&nbsp;₽{% endif %}{% if region == "int" %}0,7257021952&nbsp;${% endif %}{% if region == "kz" %}453,563872&nbsp;₸{% endif %}
>
> Итого: {% if region == "ru" %}90,7128&nbsp;₽{% endif %}{% if region == "int" %}0,725702&nbsp;${% endif %}{% if region == "kz" %}453,5639&nbsp;₸{% endif %} — стоимость восстановления из резервной копии 10 ГБ данных.

Где:
* 5 242 880 RU — фактическое потребление RU в месяц.
* {% if region == "ru" %}21,3800&nbsp;₽{% endif %}{% if region == "int" %}0,171040&nbsp;${% endif %}{% if region == "kz" %}106,9000&nbsp;₸{% endif %} — цена 1 миллиона RU.

## Цены {% if product == "cloud-il" %}(after the service becomes public){% endif %} {#prices}

{% if product == "yandex-cloud" %}

{% if region == "ru" %}

{% include notitle [rub-serverless](../../_pricing/ydb/rub-serverless.md) %}

{% endif %}

{% if region == "kz" %}

{% include notitle [kzt-serverless](../../_pricing/ydb/kzt-serverless.md) %}

{% endif %}

{% if region == "int" %}

{% include notitle [usd-serverless](../../_pricing/ydb/usd-serverless.md) %}

{% endif %}

{% if region == "ru" %}

{% include notitle [rub-egress-traffic.md](../../_pricing/rub-egress-traffic.md) %}

{% endif %}

{% if region == "kz" %}

{% include notitle [kzt-egress-traffic.md](../../_pricing/kzt-egress-traffic.md) %}

{% endif %}

{% if region == "int" %}

{% include notitle [usd-egress-traffic.md](../../_pricing/usd-egress-traffic.md) %}

{% endif %}

{% endif %}

{% if product == "cloud-il" %}

{% include notitle [ils-serverless](../../_pricing/ydb/ils-serverless.md) %}

{% include notitle [ils-egress-traffic.md](../../_pricing/ils-egress-traffic.md) %}

{% endif %}