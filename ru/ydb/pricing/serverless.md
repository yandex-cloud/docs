---
editable: false
---

# Правила тарификации для бессерверного режима {{ ydb-name }}

{% include [currency-choice](../_includes/pricing/currency-choice.md) %}

При использовании бессерверного режима {{ ydb-name }} плата взимается за каждый выполненный к базе данных запрос. Указывать, какие ресурсы требуются для работы, нет необходимости, база данных оперативно адаптируется к изменению пользовательской нагрузки в рамках выделенных пользователю [квот](../concepts/limits.md). Помимо запросов пользователь оплачивает хранимые в {{ ydb-name }} данные на почасовой основе. Дополнительно тарифицируются другие операции, такие как восстановление из резервной копии.


## Из чего складывается стоимость использования бессерверного режима {{ ydb-name }} {#rules}

При работе {{ ydb-name }} с бессерверном режиме вы оплачиваете:

* операции с данными;
* объем хранимых данных, включая служебные данные, например, индексы;
* дополнительные пользовательские операции, такие как восстановление данных из резервной копии.

Дополнительно оплачиваются иные потребляемые ресурсы:

* место, занятое в сервисе {{ objstorage-name }} для хранения резервных копий по требованию;
* объем исходящего трафика из {{ yandex-cloud }} в интернет.

{% include [pricing-gb-size](../_includes/pricing/pricing-gb-size.md) %}

### Операции с данными и единица запроса {#rules-ru}

{% if audience != "external" %}

Бессерверноый режим {{ ydb-name }} поддерживает несколько API для выполнения операций с данными: YDB API и Document API (Amazon DynamoDB-совместимое API). Спектр запросов, которые выражаются через указанные API, широк, и простирается от точечных чтений и записей по ключу, до сложных SQL-запросов, выполняющих соединения нескольких таблиц с последующей группировкой и сортировкой результата. Каждая из таких операций потребляет ресурсы базы данных основываясь на сложности операции.

Для оценки стоимости произвольного запроса вводится понятие Request Unit (RU) — единицы запроса. 1 RU — это эталонная стоимость чтения строки таблицы объемом до 4Кб по первичному ключу. Единица запроса абстрагирует ресурсы такие как CPU, Memory, Disk I/O, используемые для выполения операции. Любой запрос к {{ ydb-name }}, не важно при помощи какого API выполнен, имеет стоимость в терминах RU. Единицы запроса в секунду или RU/s — это показатель пропускной способности базы данных, количества используемых ресурсов и, в итоге, стоимости работы с базой данных.

{% else %}

Бессерверный режим работы {{ ydb-full-name }} поддерживает несколько способов работы с данными:
* Document API — HTTP API, совместимое с Amazon DynamoDB. С помощью этого API можно выполнять операции над документными таблицами.
* YDB API и его реализации в виде [YDB CLI](../quickstart/yql-api/ydb-cli.md) и [YDB SDK](../sdk/index.md) для [Java](https://github.com/yandex-cloud/ydb-java-sdk), [Python](https://github.com/yandex-cloud/ydb-python-sdk), [Node.js](https://github.com/yandex-cloud/ydb-nodejs-sdk), [PHP](https://github.com/yandex-cloud/ydb-php-sdk) и [Go](https://github.com/yandex-cloud/ydb-go-sdk). С помощью этого API можно выполнять операции над YDB-таблицами.

Для расчета стоимости запросов в {{ ydb-short-name }} используется понятие **единица запроса** (**RU** — request unit). Каждый выполненный запрос в зависимости от его типа, сложности и размера данных приводит к потреблению определенного количества RU. Итоговая стоимость всех выполненных запросов к {{ ydb-short-name }} складывается из стоимости каждого запроса, выраженной в RU.

{% endif %}

####  Document API

{% if audience != "external" %}

В Таблице 1 приведена стоимость некоторых операций Document API в терминах единиц запросов. Под операцией чтения/записи строки понимается операция с одной строкой таблицы в рамках таких вызовов API как GetItem/BatchGetItem/PutItem. Стоимость составной операции работы с данными (BatchGetItem является примером такой операции), равна сумме единичных вызовов. Например, стоимость выполнения операции BatchGetItem равна сумме стоимостей вызовов GetItem для каждого ключа. Под операцией чтения/записи строки в рамках транзакции понимается операция в рамках таких вызовов API как TransactGetItems/TransactWriteItems. Стоимость запроса складывается из суммы адресуемых операцией строк.

{% else %}

Стоимость запросов к Document API зависит от типа операций с базой, которые выполняются в рамках запроса, и объема данных, над которыми выполняется операция. Если запрос состоит из нескольких операций (например BatchWriteItem), его стоимость складывается из стоимости операций.

{% endif %}

Тип операции                                | Размер данных | Стоимость в единицах запросов (RU)
------------------------------------------ | ------------- | -------------------
Операция чтения строки (методы GetItem, BatchGetItem, Query, Scan)                     | 4 КБ          | 1
Операция чтения строки в рамках транзакции (TransactGetItems) | 4 КБ          | 2
Операция записи строки (PutItem, BatchWriteItem, UpdateItem)                    | 1 КБ          | 2
Операция записи строки в рамках транзакции (TransactWriteItems) | 1 КБ          | 4
Операция удаления строки (DeleteItem)                    | не учитывается          | 2
Операция со схемой базы данных (CreateTable, DeleteTable, DescribeTable, ListTables) | не тарифицируется          | не тарифицируется

При оценке стоимости запроса:

* запрос на чтение, который не вернул результатов, всегда оценивается в 1 RU;
* запрос на запись строки, который не вернул результатов, всегда оценивается в 2 RU;
* запрос на запись строки в рамках транзакции, который не вернул результатов, всегда оценивается в 4 RU;
* запросы на чтение округляются в большую сторону до значения, кратного 4 КБ;
* запросы на запись округляются в большую сторону до значения, кратного 1 КБ.

#### YDB API

{% if audience != "external" %}

Выразительные возможности YDB API позволяют формулировать широкий класс запросов. Операции с данными не ограничиваются точечными или диапазонными запросами на чтение/запись/модификацию данных. При выполнении каждого запроса {{ ydb-name }} Serverless ведет учет затраченных ресурсов:
* чтения строк в штуках и байтах;
* запись строк в штуках и байтах;
* потраченное на выполнение процессорное время.

Потраченные на выполнение ресурсы переводятся в единицы запросов по схеме аналогичной для Document API за операции чтения/записи. Стоит отметить, что единица запроса помимо записанных/прочитанных байт включает в себя эталонное потребление процессорного времени. Некоторые YQL-запросы могут потреблять значительные объемы процессорного времени работая с небольшим количеством данных. В этом случае стоимость запроса рассчитывается как максимум из:
* единиц запроса потраченных на чтение и запись данных;
* потребленного процессорного времени деленного на эталонное потребление процессора одной единицей запроса.

В документе <span style="color: red;">Просмотр стоимости выполнения запроса (поставить ссылку)</span> можно подробнее ознакомиться с тем, какие возможности имеет пользователь {{ ydb-name }} Serverless для просмотра и оценки стоимости выполнения конкретного запроса.

{% else %}

Стоимость запроса к YDB API складывается из нескольких частей:

* **Процессорное время**

   Учитывается процессорное время, потраченное на разбор и компилирование запроса. Процессорное время округляется в меньшую сторону до значения, кратного 1,5 мс.

* **Операции чтения**

   Стоимость операций чтения оценивается тремя способами:
   * Суммарный объем прочитанных данных. Объем округляется в большую сторону до значения, кратного 4 КБ.
   * Число прочитанных строк.
   * Процессорное время, потраченное на операции чтения. Процессорное время округляется в меньшую сторону до значения, кратного 1,5 мс.

   Все величины переводятся в единицы RU. Итоговая стоимость операций чтения принимается равной наибольшей из этих величин.

* **Операции записи**

   Стоимость операций записи оценивается тремя способами:
   * Суммарный объем записанных данных. Объем округляется в большую сторону до значения, кратного 1 КБ.
   * Число записанных строк.
   * Процессорное время, потраченное на операции записи. Процессорное время округляется в меньшую сторону до значения, кратного 1,5 мс.

   Все величины переводятся в единицы RU. Итоговая стоимость операций записи принимается равной наибольшей из этих величин.

* **Операции удаления**

   Стоимость операций удаления оценивается тремя способами:
   * Суммарный объем удаленных данных. Объем округляется в большую сторону до значения, кратного 1 КБ.
   * Число удаленных строк.
   * Процессорное время, потраченное на операции удаления. Процессорное время округляется в меньшую сторону до значения, кратного 1,5 мс.

Итоговая стоимость запроса вычисляется как сумма всех составных частей.

Оцениваемый параметр                       | Единичный размер | Стоимость в единицах запросов (RU)
------------------------------------------ | ----------------- | -------------------
Объем прочитанных данных                   | 4 КБ              | 1
Объем записанных данных                    | 1 КБ              | 2
Объем удаленных данных                    | 1 КБ              | 2
Операция чтения строки                     | 1 строка          | 1
Операция записи строки                     | 1 строка          | 2
Операция удаления строки                   | 1 строка          | 2
Процессорное время                         | 1,5 мc            | 4
Создание, изменение, удаление схем таблиц, получение описания таблицы, получение списка таблиц, создание и удаление директорий | не тарифицируется | не тарифицируется


##### Особенности расчета стоимости некоторых операций

* **ReadTable**
   Операция ReadTable позволяет эффективно вычитывать большие диапазоны данных таблицы. Стоимость запроса зависит только от объема прочитанных данных и составляет 128 RU за 1 МБ. При расчете стоимости объем округляется в большую сторону до значения, кратного 1 МБ.

* **BulkUpsert**
   BulkUpsert позволяет эффективно загружать данные в базу. Стоимость записи строки в рамках операции BulkUpsert составляет 0,5 RU за 1 КБ записанных данных. При расчете стоимости объем данных округляется в большую сторону до значения, кратного 1 КБ. Итоговая стоимость операции рассчитывается как сумма стоимости всех записанных строк с округлением до ближайшего большего целого.

   **Пример расчета стоимости**

   Например, в рамках операции BulkUpsert вы записываете четыре строки данных объемом 2500 байт, 100 байт, 1200 байт и 1024 байта.

   Стоимость такой операции составит:
   > 0,5 RU × 3 + 0,5 RU × 1 + 0,5 RU × 2 + 0,5 RU × 1 = 3,5 RU
   >
   > Итого, после округления в большую сторону: 4 RU

   Где:
   * 0,5 — стоимость в единицах запросов за 1 КБ записанных данных.
   * 3 — объем первой строки в КБ после округления в большую сторону (2500 байт = 1024 байта + 1024 байта + 452 байта).
   * 1 — объем второй строки в КБ после округления в большую сторону.
   * 2 — объем третьей строки в КБ после округления в большую сторону (1200 байт = 1024 байта + 176 байт).
   * 1 — объем четвертой строки в КБ.

* **Построение вторичного индекса**
   Стоимость построения индекса складывается из стоимости операции ReadTable оригинальной таблицы и BulkUpsert в индексную таблицу. Тарифицируется объем проделанной работы — количество строк и их размер, который был прочитан из оригинальной таблицы и записан в индексную таблицу. Процесс построения индекса может быть отменен пользователем. Отмененные операции построения индекса также тарифицируются за объем проделанной работы до отмены операции.


{% endif %}

{% if audience != "external" %}

#### Использование параметризованных подготовленных запросов в YDB API
Параметризованные подготовленные запросы <span style="color: red;">ссылка</span> позволяют существенно снизить накладные расходы на выполнения запросов путем экономии процессорного времени на парсинг и оптимизацию однотипных запросов. Вызов ```PrepareDataQuery```, который осуществляет подготовку запроса, оплачивается исходя из потребленных ресурсов процессора и измеряется в единицах запросов. Стоимость подготовки запроса зависит от сложности самого запроса.

#### Операция ReadTable
Операция ReadTable <span style="color: red;">(поставить ссылку)</span> позволяет эффективно вычитывать большие диапазоны данных таблицы. Операция тарифицируется исходя из прочитанных данных за 1 МБ данных. Стоимость чтения 1 МБ составляет 128 RU. Объем вычитанных данных округляется до целых мегабайт вверх.

#### Операция BulkUpsert
Операция BulkUpsert <span style="color: red;">(поставить ссылку)</span> позволяет более эффективно загружать данные в базу данных. Запись данных через BulkUpsert в 2 раза дешевле записи через Document API и составляет 1 RU за 1 строку размером до 1 КБ. Если размер строки более 1 КБ, размер строки округляется вверх до килобайт и делится на 1 КБ, итоговое количество RU составляет стоимость запроса.

<span style="color: red;">CopyTable; что делать с бэкапом???</span>

#### Операции со схемой базы данных
Операции со схемой базы данных, например, создание и удаление таблиц, изменение схемы таблицы, листинг таблиц и получение описания таблицы -- не тарифицируются. Однако количество таких операций ограничивается. Подробнее с лимитами можно ознакомиться в разделе <span style="color: red;">Квоты (поставить ссылку)</span>.

{% endif %}

### Объем хранимых данных {#rules-storage}

{% if audience != "external" %}

Явным образом выделять хранилище для данных в {{ ydb-name }} Serverless не требуется. Мощности для хранения данных выделяются системой автоматически. Данные, записанные пользователем, хранятся в специальных структурах данных {{ ydb-name }}, которые оптимизированы под эффективную запись, чтение по первичному ключу и других операций. Объем хранимых данных в {{ ydb-name }} Serverless рассчитывается как хранилище выделенное для указанных структур данных. Например, создание глобального индекса приводит к увеличению размера хранилища на размер данного индекса. {{ ydb-name }} Serverless непрерывно следит за размером таблиц для оперативной реакции на уменьшение и увеличения объема хранимых данных.

{% else %}

В бессерверном режиме мощности для хранения данных выделяются автоматически. Объем хранимых данных при этом рассчитывается как совокупный объем пользовательских и служебных данных, которые хранятся в БД. Например, создание глобального индекса приводит к увеличению размера хранилища на размер такого индекса.

{% endif %}

### Создание резервных копий {#rules-backup-storage}

{% if audience != "external" %}

{{ ydb-name }} Serverless обеспечивает автоматическое регулярное создание резервной копии базы данных раз в сутки. Резервная копия сохраняется в сервисе {{ objstorage-full-name }}. Система хранит последние 2 резервные копии базы. В случае удаление базы данных последняя резервная копия хранится в течении 2-х дней. Описанная услуга резервного копирования предоставляется бесплатно.

Пользователь может выполнить резервное копирование базы данных в сервисе {{ ydb-name }} Serverless по требованию. В этом случае стоимость резервной копии рассчитывается исходя из цены за 1 ГБ выгруженных из {{ ydb-name }} Serverless данных. Объем данных округляется до целых ГБ в большую сторону. Дополнительно оплачивается работа с сервисом {{ objstorage-full-name }} по ценам этого сервиса.

В случае выгрузки данных при помощи утилиты ```ydb tools dump``` тарификация производится по тарифам операции ReadTable.

{% else %}

#### Автоматические резервные копии {#rules-auto-backup-storage}

{{ ydb-name }} автоматические создает и бесплатно хранит 2 полные резервные копии ваших баз за два последних дня. Плата за хранение автоматических резервных копий не взимается.

#### Резервные копии по требованию {#rules-auto-backup-storage}

Вы можете принудительно выполнить резервное копирование базы данных с сохранением копии в сервисе {{ objstorage-full-name }}. Стоимость такой операции зависит от объема скопированных данных. При расчете стоимости фактический объем округляется в большую сторону до значений, кратных 1 ГБ.

{% note warning %}

В случае выгрузки данных при помощи утилиты ```ydb tools dump``` тарификация производится по тарифам операции ReadTable.

{% endnote %}

{% endif %}

### Восстановление из резервной копии {#rules-backup-restore}

{% if audience != "external" %}

{{ ydb-name }} Serverless предлагает механизм восстановления базы и/или отдельных таблиц из резервной копии, хранимой в сервисе Object Storage. Восстановление данных из резервной копии осуществляется по требованию и тарифицируется исходя из цены восстановления за 1 ГБ. Объем данных округляется до целых ГБ в большую сторону.

В случае восстановления данных при помощи утилиты ```ydb tools restore``` тарификация производится по цене записи строки в базу данных для каждой восстановленной строки.

{% else %}

Вы можете восстанавливать базы и/или отдельные таблицы из резервных копий, которые хранятся в сервисе {{ objstorage-name }}. Стоимость такой операции зависит от объема восстановленных данных. При расчете стоимости фактический объем округляется в большую сторону до значения, кратного 1 ГБ.

{% note warning %}

В случае восстановления данных при помощи утилиты ```ydb tools restore``` тарификация производится по цене записи строки в базу данных для каждой восстановленной строки.

{% endnote %}

{% endif %}

## Скидка за резервируемый объем ресурсов {#cvos}

{% if audience != "external" %}

Сервис {{ ydb-name }} предоставляет возможность зарезервировать пропускную способность к базе данных в виде единиц запросов с существенной скидкой относительно цены за запросы по требованию. Резерв выражается в виде количества единиц запросов в секунду к базе данных. Пользователь может выбирать размер резерва с шагом 100 RU/sec. Резерв пропускной способности в 100 RU/sec означает, что если реальная пользовательская нагрузка не превышает 100 RU/sec, то ее стоимость покрывается из резерва. То есть нагрузка в 80 RU/sec будет полностью покрываться из резерва. Превышение этой нагрузки тарифицируется по ценам запросов по требованию. То есть при реальной нагрузке в 120 RU/sec и оформленном резерве в 100 RU/sec пользователь заплатит за 20 RU/sec по цене операций с данными по требованию. Если пользователь не исчерпал резерв, так как реальная нагрузка была ниже указанной в резерве, резерв сгорает. Оплата резервов выгодна тем пользователям, у которых нагрузка на базу является значительной и постоянной.

Стоит отметить, что резерв аггрегируется на окне <span style="color: red;">в 5 минут</span>. То есть при оплате резерва в 100 RU/sec, не обязательно потреблять каждую секунду 100 RU, нагрузка может плавать на протяжении указанного времени, в какую-т секунду нагрузка может составлять 150 RU, в другую -- 50 RU.

В консоли управления вы можете увидеть потенциальную экономию для текущего потребления ресурсов при переводе их на схему CVoS, а также предварительно рассчитать месячные платежи для нужного количества ядер процессора и оперативной памяти.

<span style="color: red;">Серьезно подумать о необходимости ссылаться на [CVoS](https://cloud.yandex.ru/docs/billing/operations/purchase-cvos)</span>

{% if deploy != "arc" %}
{% include [cvos](../_includes/pricing/cvos.md) %}
{% endif %}

{% else %}

Вы можете получить гарантированную скидку за потребление ресурсов сервиса, запланированное на месяц, на год или на три года вперед.

Бессерверный режим {{ ydb-name }} предоставляет {% if deploy != "arc" %} [CVoS](../../billing/concepts/cvos.md) {% else %} CVoS {% endif %} на определенное количество запросов, выраженных в единицах RU, в секунду. Вы можете выбирать размер резерва с шагом 100 RU/с.

При вычислении реального объема потребления количество запросов усредняется каждые пять минут. То есть, например, при резерве 100 RU/с не обязательно потреблять каждую секунду 100 RU. На протяжении интервала усреднения нагрузка может изменяться и составлять в один момент 150 RU/с, в другую — 50 RU/с.

{% endif %}

## Цены {#prices}

{% if region == "ru" %}

{% include notitle [rub-serverless](../../_pricing/ydb/rub-serverless.md) %}

{% endif %}

{% if region == "kz" %}

{% include notitle [kzt-serverless](../../_pricing/ydb/kzt-serverless.md) %}

{% endif %}

{% if region == "int" %}

{% include notitle [usd-serverless](../../_pricing/ydb/usd-serverless.md) %}

{% endif %}

{% if region == "ru" %}

{% include notitle [rub-egress-traffic.md](../../_pricing/rub-egress-traffic.md) %}

{% endif %}

{% if region == "kz" %}

{% include notitle [kzt-egress-traffic.md](../../_pricing/kzt-egress-traffic.md) %}

{% endif %}

{% if region == "int" %}

{% include notitle [usd-egress-traffic.md](../../_pricing/usd-egress-traffic.md) %}

{% endif %}


{% if audience != "external" %}

## Примеры расчета стоимости {#simple-example}


{% list tabs %}

- Простой пример

  Здесь простой пример

- Развернутый пример

  Здесь развернутый пример

{% endlist %}

{% endif %}
