---
sourcePath: overlay/internals/tablet_dsproxy.md
---
#### Что такое Distributed Storage Proxy

DS-Proxy – актор, обеспечивающий взаимодействие клиентов (Таблеток) с BS-Группой. Именно DS-Proxy выполняет Erasure-кодирование данных и гарантирует консистентность и отказоустойчивость в процессе выполнения клиентских запросов. 

Группа состоит из одного или нескольких Колец, каждое из которых является набором VDisk-ов, объединенных в Fail Domain-ы. При сохранении блоба Proxy разбивает его на несколько частей в соответствии с назначенным группе видом  Erasure-кодирования, затем каждое из Колец сохраняет копию всех частей блоба. Для этого в Кольце на основании ключа сохраняемого блоба выбирается набор Fail-доменов, в каждом из которых выбирается ровно один VDisk. Выбранные VDisk-и сохраняют блобы на физических дисках своих нод при помощи акторов PDisk. При этом, один PDisk может использоваться совместно несколькими VDisk-ами.

#### Жизненный цикл DS-Proxy
DS-Proxy статической группы запускаются сразу после запуска актора Warden на каждой из нод. Для динамических групп акторы DS-Proxy изначально не запущены и запускаются по требованию. Когда клиент отправляет запрос к не запущенному на этой же ноде актору DS-Proxy, этот запрос перенаправляется актору Warden, который всегда запущен на каждой ноде. Warden создает актор DS-Proxy для той Группы, которой предназначается запрос, а также отправляет запрос конфигурации к DS-Controller-у. Получив конфигурацию от DS-Controller-а, DS-Proxy устанавливает соединение с входящими в состав Группы VDisk-ами, переходит в рабочее состояние и начинает обрабатывать запросы.

#### Основные принципы работы DS-Proxy (Контракт)
Клиент гарантирует, что он никогда не пытается записать разные данные с одним и тем же ключом. Ответственность за это возлагается на клиента.

DS-Proxy отвечает успехом на запрос записи блоба только после того, как получает ответ об успешной записи всех частей этого блоба.
DS-Proxy отвечает успехом на запрос чтения с восстановлением блоба только после того, как убедится в наличии корректно распределенного по VDisk-ам группы полного набора частей блоба (при необходимости DS-Proxy восстанавливает эти части и записывает их, дожидаясь ответов от VDisk-ов перед тем, как отвечать клиенту).
DS-Proxy отвечает "такого блоба нет" на запрос чтения блоба только в случае, когда суммарное количество VDisk-ов группы, которые содержат части блоба (или могли содержать, но отказали/не отвечают) меньше, чем количество частей.

Возможна ситуация, когда блоб фактически успешно записан, но клиент получил ответ с ошибкой. В этом случае клиент сможет успешно прочитать этот блоб. 
Возможна ситуация, когда запрос чтения с восстановлением блоба вернул "такого блоба нет", а повторный точно такой же запрос успешно восстановил блоб, однако, невозможна ситуация, когда после успешного чтения с восстановлением повторное чтение или чтение с восстановлением возвращает "такого блоба нет".