### Решаемая задача 
SoftUpdates представляет из себя оптимизацию, которая позволяет возвращать ответ (reply) транзакции до момента ее commit-а. В обычных СУБД это приводило бы к уровню изоляции ReadUncommited (DirtyReads). В нашем случае, есть возможность остаться на уровне изоляции Serializable. Для этого нужно гранатировать, что (независимо от момента падения) пишущая транзакция будет применена ровно 1 раз, в одинаковом порядке относительно других пишущих транзакций, а reply любой транзакции будет одинаковым как до момента падения, так и после.

### Реализация 
SoftUpdates включается на конкретной таблице настройками PartitionConfig.PipelineConfig. В системе может быть микс из таблиц с включенной опцией и без. Для включения SoftUpdates на таблице нужно явно указать соответсвующий флаг в CreateTable или AlterTable.

Таблетка (слой ниже DataShard-а) обеспечивает durability за счет применения redo лога и накатывания его после рестарта. При этом закомиченный и текущий срезы данных отличаются из-за текущих транзакций в полете. Закомиченный срез будет восстановлен при рестарте логикой таблетки. Чтобы вернуть текущий срез, нужно снова проиграть транзакции в полете. Datashard обеспечивает durability за счет того, что (персистентно) сохраняет тело транзакции до факта ее commit-а. Т.е. таблетка хранит в памяти все текущие данные, пригодные для выполнения новых транзакций без ожидания коммита (улучшает перфоманс), но обеспечивает не полное durability, перенося его часть на более высокий уровень абстракции (в DataShard).

SoftUpdates реализуется за счет специального режима работы DataShard-а на старте. В этом режиме блокируется out-of-order, а мгновенные RO-транзакции помещаются в очередь (которая будет проиграна сразу по выходу из спец. режима). Выход из специального режима происходит, если у шарда не остается транзакций, запланированных к выполнению на момент падения (т.к. только они могли вернуть результат выполнения ранее).

Основной недостаток текущей реализации (почему она не включена по умолчанию) - необходимость выключать мгновенные RW-транзакции. Мгновенные транзакции не персистятся. Если пишущая мгновенная транзакция потеряется при падении, после рестарта шард не сможет достигнуть актуального состояния.

NOTE: Есть способы сохранить immediate RW при включенном SoftUpdates. Пока не рализовано. 

### Заметки 
SoftUpdates (как и прочие оптимизации, включая прогрев кешей) чувствителен к лишним перевозам таблеток и алгоритму балансировки таблеток по нодам. Поэтому, при балансировке таблеток крайне желательно отселять с перегруженных нод не самые нагруженные таблеки, а большее число средненагруженных.