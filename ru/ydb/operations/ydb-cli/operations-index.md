# Работа со вторичными индексами

В разделе описано как управлять вторичными индексами. Добавление вторичного индекса выполняется в асинхронном режиме. После запуска такой команды YDB CLI сразу выдает информацию об операции и дает пользователю возможность продолжить работу.

## Добавление вторичного индекса {#operation-index}

С помощью YDB CLI можно создать дополнительный индекс для таблицы. В следующем примере выполнено добавление индекса `title_index` по паре `title, series`:

```bash
{{ ydb-cli }} -e <эндпоинт> -d <база данных> table index add global --index-name title_index --columns title series
```

Результат команды — идентификатор операции построения индекса:

```bash
┌────────────────────────────────────────┬───────┬────────┐
| id                                     | ready | status |
├────────────────────────────────────────┼───────┼────────┤
| ydb://buildindex/7?id=1407375091598308 | false |        |
└────────────────────────────────────────┴───────┴────────┘
```

## Получить информацию о выполнении операции {#one-get}

Чтобы получить информацию о ходе добавления вторичного индекса, необходимо периодически проверять ее статус:

```bash
{{ ydb-cli }} -e <эндпоинт> -d <база данных> operation get ydb://buildindex/7?id=1407375091598308
```

Результат команды:

```bash
┌────────────────────────────────────────┬───────┬─────────┬───────┬──────────┬───────────────────────────────────────────────────────────────┬─────────────┐
| id                                     | ready | status  | state | progress | table                                                         | index       |
├────────────────────────────────────────┼───────┼─────────┼───────┼──────────┼───────────────────────────────────────────────────────────────┼─────────────┤
| ydb://buildindex/7?id=1407375091598308 | true  | SUCCESS | Done  | 100.00%  | /ru-central1/b1g4ej5ju4rf5kelpk4b/etn01lrprvnlnhv8v5kj/series | title_index |
└────────────────────────────────────────┴───────┴─────────┴───────┴──────────┴───────────────────────────────────────────────────────────────┴─────────────┘
```

Где:
- `progress` — процент шардов исходной таблицы, завершивших трансфер данных.
- `status` — результат выполнения всей операции построения. Отображается, когда операция уже завершена.


## Получить информацию обо всех операциях построения индекса для базы {#all-get}

Чтобы посмотреть все операции построения индекса для базы:

```bash
{{ ydb-cli }} -e <эндпоинт> -d <база данных> operation list buildindex
```

Результат команды:

```bash
┌────────────────────────────────────────┬───────┬─────────┬───────┬──────────┬───────────────────────────────────────────────────────────────┬─────────────┐
| id                                     | ready | status  | state | progress | table                                                         | index       |
├────────────────────────────────────────┼───────┼─────────┼───────┼──────────┼───────────────────────────────────────────────────────────────┼─────────────┤
| ydb://buildindex/7?id=1407375091598308 | true  | SUCCESS | Done  | 100.00%  | /ru-central1/b1g4ej5ju4rf5kelpk4b/etn01lrprvnlnhv8v5kj/series | title_index |
└────────────────────────────────────────┴───────┴─────────┴───────┴──────────┴───────────────────────────────────────────────────────────────┴─────────────┘

Next page token: 0

```

## Отменить операцию построения индекса {#cancel}

Для отмены операции построения индекса:

```bash
{{ ydb-cli }} -e <эндпоинт> -d <база данных> operation cancel ydb://buildindex/7?id=1407375091598308
```

После того как операция завершена или отменена, ее следует удалить из базы:

```bash
{{ ydb-cli }} -e <эндпоинт> -d <база данных> operation forget ydb://buildindex/7?id=1407375091598308
```

## Удаление индекса {#delete-index}

Если индекс не нужен, то его можно удалить. Удаление индекса — обычный синхронный запрос. Результат возвращается сразу по исполнению запроса.

```bash
{{ ydb-cli }} -e <эндпоинт> -d <база данных> table index drop --index-name title_index series
```