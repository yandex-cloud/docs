# Типы данных

В данном разделе описаны типы данных, которые поддерживаются в {{ ydb-short-name }}.

## Поддерживаемые типы данных
В {{ ydb-short-name }} используются типы данных {% if audience != "external" %} [YQL](https://yql.yandex-team.ru/docs/ydb/) {% else %} [YQL](../yql/reference/overview.md) {% endif %}. Некоторые из типов YQL поддерживаются с ограничениями — они могут использоваться только в вычислениях, но не могут быть типом столбца или использоваться в первичном ключе. Все столбцы, включая ключевые, могут содержать специальное значение `NULL`.

{% note warning "Значения NULL в ячейках первичного ключа" %}

Несмотря на наличие возможности иметь значения составного первичного ключа, в которых в части полей сохранены значения `NULL`, мы настоятельно рекомендуем никогда так не делать и не хранить в первичном ключе `NULL`.

{% endnote %}

В таблицах 1, 2 и 3 приведены возможные варианты использования типов данных YQL в {{ ydb-short-name }}.

## Числовые типы данных

<small>Таблица 1. Возможности использования числовых типов данных YQL в {{ ydb-short-name }}</small>

| **Тип** | **Пояснение** | **Используется<br>в запросах<br>и вычислениях YQL** | **Используется<br>в качестве<br>типа данных<br>столбца** | **Используется<br>в первичных<br>ключах** | **Поддерживает<br>возможность<br>сравнения** |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `Bool`     | cтандартный булев тип, `true` или `false`                       | Да | Да  | Да  | Да |
| `Int8`     | целое число со знаком, от -2<sup>7</sup>  до 2<sup>7</sup> − 1  | Да | Нет | Нет | Да |
| `Int16`    | целое число со знаком, от -2<sup>15</sup> до 2<sup>15</sup> − 1 | Да | Нет | Нет | Да |
| `Int32`    | целое число со знаком, от -2<sup>31</sup> до 2<sup>31</sup> − 1 | Да | Да  | Да  | Да |
| `Int64`    | целое число со знаком, от -2<sup>63</sup> до 2<sup>63</sup> − 1 | Да | Да  | Да  | Да |
| `Uint8`    | беззнаковое целое,     от 0 до 2<sup>8</sup> − 1                | Да | Да  | Да  | Да |
| `Uint16`   | беззнаковое целое,     от 0 до 2<sup>16</sup> − 1               | Да | Нет | Нет | Да |
| `Uint32`   | беззнаковое целое,     от 0 до 2<sup>32</sup> − 1               | Да | Да  | Да  | Да |
| `Uint64`   | беззнаковое целое,     от 0 до 2<sup>64</sup> − 1               | Да | Да  | Да  | Да |
| `Float`    | вещественное 4-байтное число                                    | Да | Да  | Нет | Да |
| `Double`   | вещественное 8-байтное число                                    | Да | Да  | Нет | Да |
| `Decimal`  | число с фиксированной точностью, сейчас поддерживается `Decimal(22, 9)` — 13 знаков в целой части, 9 в дробной | Да | Да | Нет | Да |
| `DyNumber` | бинарное представление числа с плавающей точкой, сохраняющее порядок | Да | Да | Да | Да |

## Строковые типы данных

<small>Таблица 2. Возможности использования строковых типов данных YQL в {{ ydb-short-name }}</small>

| **Тип** | **Пояснение** | **Используется<br>в запросах<br>и вычислениях YQL** | **Используется<br>в качестве<br>типа данных<br>столбца** | **Используется<br>в первичных<br>ключах** | **Поддерживает<br>возможность<br>сравнения** |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `String`       | произвольная последовательность байт | Да | Да | Да | Да |
| `Utf8`         | текст в кодировке [UTF-8](https://en.wikipedia.org/wiki/UTF-8) | Да | Да | Да | Да |
| `Json`         | валидный [JSON](https://en.wikipedia.org/wiki/JSON) в текстовом представлении | Да | Да | Нет | Нет |
| `JsonDocument` | валидный [JSON](https://en.wikipedia.org/wiki/JSON) в бинарном индексированном представлении | Да | Да | Нет | Нет |
{% if audience != "external" %}
| `Yson`         | валидный [YSON](https://wiki.yandex-team.ru/yt/userdoc/yson/) в текстовом или бинарном представлении | Да | Да | Нет | Нет |
{% endif %}
| `Uuid`         | универсальный идентификатор [UUID](https://tools.ietf.org/html/rfc4122) | Да | Нет | Нет | Да |

{% note info "Ограничения на размер" %}

Максимальный размер значения в ячейке с любым строковым типом данных — около 4 МБ.

{% endnote %}

{% note info "Отличия Json и JsonDocument" %}

В отличии от типа данных `Json`, который хранит исходное текстовое представление, переданное пользователем, `JsonDocument` использует бинарное индексированное представление. Важное отличие с точки зрения семантики состоит в том, что `JsonDocument` не сохраняет форматирование, порядок ключей в объектах и их дубликаты.

За счет индексированного представления, `JsonDocument` позволяет обходить документную модель с использованием `JsonPath` без необходимости парсинга всего содержимого. Это позволяет эффективно выполнять операции из {% if audience != "external" %} [JSON API](https://yql.yandex-team.ru/docs/yt/builtins/json/) {% else %} [JSON API](../yql/reference/builtins/json.md) {% endif %}, уменьшая задержки и стоимость пользовательских запросов. Выполнение запросов над `JsonDocument` может быть до нескольких раз эффективнее в зависимости от типа нагрузки.

Из-за добавленной избыточности `JsonDocument` менее эффективен в хранении. Дополнительные накладные расходы на хранение зависят от конкретного содержимого, но в среднем составляют 20%–30% от исходного объема. Кроме того, сохранение данных в формате `JsonDocument` требует дополнительной конвертации из текстового представления, что делает его запись несколько менее эффективной. Тем не менее, для большинства read-intensive сценариев, подразумевающих обработку данных из JSON, новый тип данных является предпочтительным и рекомендуется к использованию.

{% endnote %}

## Дата и время

<small>Таблица 3. Возможности использования типов данных даты и времени YQL в {{ ydb-short-name }}</small>

| **Тип** | **Пояснение** | **Используется<br>в запросах<br>и вычислениях YQL** | **Используется<br>в качестве<br>типа данных<br>столбца** | **Используется<br>в первичных<br>ключах** | **Поддерживает<br>возможность<br>сравнения** |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `Date`        | точность до дней | Да | Да | Да | Да |
| `Datetime`    | точность до секунд | Да | Да | Да | Да |
| `Timestamp`   | точность до микросекунд | Да | Да | Да | Да |
| `Interval`    | точность до микросекунд, допустимые значения интервалов — не более 24 часов | Да | Да | Нет | Да |

## Опциональные значения (типы, допускающие значение NULL)

Любые типизированные данные в YQL, включая столбцы таблиц, бывают как гарантированно имеющие значение, так и потенциально пустые (что обозначается как `NULL`). Такие значения называют «опциональными» или в терминах SQL «nullable».

Наиболее распространённой операцией для таких типов данных является {% if audience != "external" %} [COALESCE](https://yql.yandex-team.ru/docs/ydb/builtins/basic/#coalesce) {% else %} [COALESCE](../yql/reference/builtins/basic.md#coalesce) {% endif %}, позволяющий оставить заполненные значения без изменений, а `NULL` заменить на указанное следом значение по умолчанию.

При {% if audience != "external" %} [описании таких типов данных в текстовом виде](https://yql.yandex-team.ru/docs/ydb/misc/type_string/) {% else %} [описании таких типов данных в текстовом виде](../yql/reference/misc/type_string.md) {% endif %}, они обозначаются с вопросительным знаком на конце (например, `String?`) или как `Optional<...>`.

## Контейнеры

<small>Таблица 4. Составные типы данных YQL</small>

| **Название** | **Объявление&nbsp;типа** | **Пример&nbsp;типа** | **Пояснение** |
| :--- | :--- | :--- | :--- |
| Список                 | `List<Type>`                            | `List<Int32>`                        | Последовательность переменной длины, состоящая из элементов одного типа. |
| Словарь                | `Dict<KeyType, ValueType>`              | `Dict<String, Int32>`                | Набор пар ключ-значение с фиксированным типом ключей и значений. |
| Кортеж                 | `Tuple<Type1, ..., TypeN>`              | `Tuple<Int32, Double>`               | Набор безымянных элементов фиксированной длины с указанными типами всех элементов. |
| Структура              | `Struct<Name1:Type1, ..., NameN:TypeN>` | `Struct<Name:String, Age:Int32>`     | Набор именованных полей с указанными типами значений, фиксированный на момент начала запроса (то есть обязательно не зависящий от данных). |
| Поток                  | `Stream<Type>`                          | `Stream<Int32>`                      | Однопроходной итератор по значениям одного типа. Не является сериализуемым. |
| Вариант над кортежем   | `Variant<Type1, Type2>`                 | `Variant<Int32, String>`             | Кортеж, про который известно, что заполнен ровно один элемент. |
| Вариант над структурой | `Variant<Name1:Type1, Name2:Type2>`     | `Variant<value:Int32, error:String>` | Структура, про которую известно, что заполнен ровно один элемент. |

При необходимости контейнеры можно вкладывать друг в друга в произвольных комбинациях, например `List<Tuple<Int32, Int32>>` (список, содержащий в качестве элементов кортежи).

Опциональные значения в некоторых контекстах также могут рассматриваться как один из видов контейнеров (`Optional<Type>`), который ведёт себя как список длины 0 или 1.

Для представления множеств следует использовать словарь с значениями типа `Void` - `Dict<T, Void>`.
