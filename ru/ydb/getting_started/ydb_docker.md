# Использование Docker контейнера YDB

В разделе приведены инструкции для локального запуска базы YDB в Docker контейнере. Чаще всего он запускается для локальной отладки, но может использоваться в автоматических тестах.

{% note info "Рецепт YDB" %}

Для тестов в Аркадии рекомендуется использовать [рецепт YDB](../getting_started/ydb_recipe.md)

{% endnote %}

## Введение { #introduction }

Локальный YDB запускается в режиме однонодной конфигурации. В режиме локального запуска предоставляется только API для для работы с базой.
API для работы с данными разворачивается на порту ``2135``, имя предсозданной базы ``/local``.

В контейнере используется предсобранная сборка YDB. Образ обычно обновляется после очередного релиза YDB. Версия сборки в образе аналогична той,
что используется в продуктовых инсталяциях, однако ревизия сборки может отличаться.

## Использование Docker образа { #docker-usage }

Образ контейнера публикуется Registry: ``registry.yandex.net/yandex-docker-local-ydb:stable``. Чтобы скачать самую актуальную версию образа,
выполните команду:

```bash
sudo docker pull registry.yandex.net/yandex-docker-local-ydb:stable
```

После чего можно поднять новый контейнер:

```bash
sudo docker run --hostname localhost -e YDB_LOCAL_SURVIVE_RESTART=true -dp 2135:2135 registry.yandex.net/yandex-docker-local-ydb:stable
```

Внутри образа доступна предсобранная версия [YDB CLI](../getting_started/ydb_cli.md), с помощью которой можно выполнять различные команды, например:

```bash
sudo docker exec <CONTAINER-ID> /ydb -e localhost:2135 -d /local table query execute -q 'select 1;'
┌─────────┐
| column0 |
├─────────┤
| 1       |
└─────────┘
```

Аналогичным образом можно использовать ``ya ydb`` для доступа к данным в контейнере, например:

```bash
ya ydb -e localhost:2135 -d /local  table query execute -q 'select 1;'
┌─────────┐
| column0 |
├─────────┤
| 1       |
└─────────┘
```


## Дополнительные опции

Docker контейнер YDB поддерживает несколько дополнительных опций, которые можно задать через переменные окружения:
1. ``YDB_LOCAL_SURVIVE_RESTART=true`` - позволяет выполнить рестарт контейнера без потери данных
2. ``YDB_USE_IN_MEMORY_PDISKS=true`` - включает возможность хранения данных целиком в памяти. В случае если данная опция включена, рестарт контейнера с локальным YDB приведет к полной потери данных.
3. ``YDB_DEFAULT_LOG_LEVEL=<уровень>`` - позволяет настроить уровень логирования по умолчанию. Доступные значения уровней: ``CRIT``, ``ERROR``, ``WARN``, ``NOTICE``, ``INFO``.
