# Инструкция по веб-интерфейсу YQL

## Введение
Эта статья посвящена прежде всего не очевидным особенностям и возможностям консоли управления YQL.

Адрес консоли управления: [yql.yandex-team.ru](https://yql.yandex-team.ru/).

### Терминология


## Жучок

![](https://wiki.yandex-team.ru/yql/userguide/web/.files/bugreport.jpg)

С помощью «жучка» в левом-нижнем углу можно создать тикет о любой проблеме с конкретным запросом или с работой веб-интерфейса YQL в целом. В том числе его можно использовать как средство попросить о помощи, если в запросе возникла какая-то ошибка и не понятно, как ее исправить.

Использование «жучка» в большинстве случаев предпочтительнее других средств коммуникации (писем на рассылку и в личку, сообщениям в jabber, постам в Этушку и т.п.), так как в создаваемый таким образом тикет помимо самого запроса с результатом автоматически добавляется дополнительная диагностика из вашего браузера, которая во многих ситуациях крайне полезна.

Также см. [раздел «Обратная связь»](../quickstart.md#obratnajasvjaz).

## Tutorial
[![](https://wiki.yandex-team.ru/yql/userguide/web/.files/tutorial.jpg)](https://yql.yandex-team.ru/Tutorial/)

Начинающим пользователям рекомендуется изучить коллекцию запросов-примеров, которые можно найти в сайдбаре на вкладке [Tutorial](https://yql.yandex-team.ru/Tutorial/). Также ее можно использовать как справку, чтобы освежить в памяти, как работать с не так часто используемыми конструкциями.


## Работа с исходными данными
![](https://wiki.yandex-team.ru/yql/userguide/web/.files/tables.jpg)
В целом работа вкладки Sources напоминает типичный файловый менеджер.

Некоторые особенности отмечены на скриншоте выше:

* Панель с таблицей можно открыть и по Ctrl/Cmd+клику по имени таблицы.
* Чтобы поделиться ссылкой на просмотр таблицы, надо кликнуть на ее имени вверху панели, а затем скопировать ссылку из адресной строки.
* Иконка со стрелкой вниз означает «вставить путь к таблице в текст запроса».

## Ссылки на результат операции
![](https://jing.yandex-team.ru/files/blinkov/1.jpg)
Чтобы поделиться с коллегами результатом какого-либо вычисления, необходимо использовать специальную ссылку из вкладки Share, а не путь из адресной строки. Идентификатор из ссылки в адресной строке является техническим и его при желании можно подобрать перебором, получив неавторизованный доступ к данным. Чтобы обезопасить пользователей, работающих с непубличными данными, ссылки с такими техническими идентификаторами считаются приватными (то есть все, кроме автора запроса и команды YQL, получат по ним отказ в доступе), а для получения публичной ссылки для отправки коллегам нужно явным образом запросить публичную ссылку (на вкладке Share).

## Управление доступом к сохраненным запросом
Отвечающее за это меню находится за иконкой с «замочком» рядом с названием запроса:
![](https://jing.yandex-team.ru/files/blinkov/Screen%20Shot%202017-10-23%20at%2013.23.39.png)

## Прикладывание файлов к запросам
![](https://wiki.yandex-team.ru/yql/userguide/web/.files/file-attach.jpg)
Во всплывающем диалоге нужно придумать и ввести имя-алиас к файлу, по которому затем нужно будет к нему обращаться из запроса, а в редактор вставить или содержимое файла или URL до него в зависимости от выбранного в выпадающем меню режима.

Сервис YQL оставляет за собой право кешировать находящиеся за URL файлы на неопределенный срок, по-этому при значимом изменении находящегося за ней содержимого настоятельно рекомендуется модифицировать URL за счет добавления/изменения незначащих параметров.
## Валидация запросов
![](https://wiki.yandex-team.ru/yql/userguide/web/.files/validate.jpg)
Базовая проверка вводимых запросов на корректность выполняется в фоне по мере ввода запроса.
В случае обнаружения ошибок проблемные строки отмечаются иконками слева (красный крестик).

## Explain
![](https://wiki.yandex-team.ru/yql/userguide/web/.files/screenshot2016-05-18at13.30.36.png)
С помощью кнопки «Explain» можно получить представление о том, к выполнению каких высокоуровневых физических операций приведет запрос.

Ключевое слово `EXPLAIN` из [аналогичного раздела в инструкции к консольному клиенту](cli.md#explain) в веб-интерфейсе по-прежнему не поддерживается.

## Фильтрация сохраненных запросов
![](https://wiki.yandex-team.ru/yql/userguide/web/.files/filter.jpg)
Для тех, у кого со временем накопилось много запросов, есть возможность помечать их тегами с последующей фильтрацией по ним. Можно выбрать несколько тегов для фильтрации с зажатым Shift.

## Доступ к предыдущим версиям сохраненных запросов
![](https://jing.yandex-team.ru/files/blinkov/query-versions2.gif)

Немного нюансов:

* После открытия версии в редакторе никаких действий автоматически не выполняется. Пользователь может нажать «Save», чтобы откатиться до открытой версии запроса, «Save as», чтобы сохранить эту версию под другим именем и пр.
* Глубина истории по техническим причинам ограничена.

## Шаблоны запросов
![](https://jing.yandex-team.ru/files/blinkov/yql-templates-in-web.gif)
С помощью шаблонов можно быстро создавать типовые запросы, не связывая их при этом друг с другом, или начиная разработку нового запроса не вбивать заново любимый набор `PRAGMA`. Как можно успеть разглядеть на gif'ке, для сохранения запроса в роли шаблона есть отдельная галочка в меню «Save as», а стрелка рядом с «New query» позволяет выбрать каким из шаблонов воспользоваться.

Технически шаблоны запросов являются частным случаем именованных запросов (Query) и отличаются по тегу `template`. Это позволяет использовать для них сущестовующий функционал именованных запросов: редактирование с сохранением истории ревизий, расшаривание доступа и т.п.

## Скачивание таблиц
![](https://jing.yandex-team.ru/files/blinkov/table-download-2.jpg)
Скачивание доступно не для всех таблиц, есть следующие ограничения:

* Поддерживаются только таблицы на кластерах YT.
* Таблица должна содержать только простые типы данных (числа и строки), [контейнеры](../types/containers.md) не поддерживаются. Но при этом всегда есть возможность сделать `SELECT` по существующей таблице, чтобы исключить колонки-контейнеры или извлечь из них нужные значения в отдельные колонки.
* Имена колонок должны содержать только ASCII символы.

## Полнотекстовый поиск
![](https://jing.yandex-team.ru/files/blinkov/2018-03-14%2019_26_29.gif)
В поисковой строке можно использовать префикс со знаком минус для исключения слов из результата и двойные кавычки для точных фраз. Умеет искать и на английском и на русском, но без изысков.

## Визуализация гистограмм
![](https://jing.yandex-team.ru/files/blinkov/web-histogram.gif)

## Настройки
![](https://wiki.yandex-team.ru/yql/userguide/web/.files/settings.png)

Ниже в этом разделе вместо полного списка настроек приводятся только комментарии к тем из них, которые требуют дополнительных пояснений.

## Аутентификация
<a name="auth"></a>

![](https://wiki.yandex-team.ru/yql/userguide/web/.files/auth.png)
По умолчанию операции выполняются на YT от имени общего пользователя `yql`. Чтобы начать выполнять запросы от имени своего пользователя, нужно получить свой YT-токен [по ссылке](https://locke.yt.yandex-team.ru/auth/new) и вставить в [форму со скриншота](https://yql.yandex-team.ru/?settings_mode=token). После чего, если был выбран «Default token», то запросы YQL будут по умолчанию выполняться от вашего имени, а также он используется при навигации по вкладке Sources слева. Именованные токены можно использовать с помощью `PRAGMA yt.Auth = "my_token_name";`.

Данная манипуляция нужна, так как при OAuth-аутентификации от пользователя требуется в браузере нажать кнопку «Да, разрешаю».
В будущем YQL и YT перейдут на альтернативную схему с аутентификацией через TVM, где это уже будет не нужно и все будет происходить автоматически. Тикет: [Аутентификация по TVM-тикетам](https://st.yandex-team.ru/YQL-666)

## Темная тема оформления
![](https://wiki.yandex-team.ru/yql/userguide/web/.files/night-theme.png)
Включается на вкладке Visual в настройках.

## Advanced mode
Целевая аудитория этого режима — разработчики. Разработчики самого YQL, связанных инструментов, поддерживаемых backend'ов или каких-либо сложных конструкций из запросов на YQL. Как и написано в подписи к галочке, при включении добавляются дополнительные элементы интерфейса, которые на данный момент в основном сосредоточены вокруг более низкоуровнего [синтаксиса s-expressions](../s_expressions/index.md): просмотр AST запросов; создание и запуск запросов на s-expressions.
