# Инструкция по консольному клиенту YQL
## Введение {#introduction}
Эта статья посвящена прежде всего особенностям консольного клиента, то есть нет смысла пробовать применять описанное ниже в веб-интерфейсе.
За общей справкой о том, что такое YQL, его назначении и возможностях обращайтесь к [основному руководству пользователя](../syntax/basic.md).

Скачать консольный клиент YQL:


![](https://wiki.yandex-team.ru/yql/userguide/cli/.files/yql-demo.gif)

### Терминология {#terminology}


## Аутентификация {#authentication}
При первом запуске консольный клиент пробует автоматически получить OAuth токен в обмен на подпись ssh-ключем (поддерживается rsa, dsa и ssh-agent). Если это по каким-либо причинам не получается, клиент просит [вручную получить OAuth-токен](https://yql.yandex-team.ru/?settings_mode=token) и ввести его в поле ввода. После успешного получения токена, он сохраняется в `~/.yql/token` и далее прозрачно используется для всех обращений к [HTTP API](http.md).

![](https://wiki.yandex-team.ru/yql/userguide/cli/.files/screenshot2016-02-01at20.11.31.png)

## Неинтерактивный режим {#non-interactive-mode}
При использовании в скриптах:

* Можно использовать клиент YQL как фильтр: подать запрос на stdin и ожидать ответ в stdout.
* Можно передать запрос через указание пути к файлу в опции `-i/--input` и сохранить результат по пути, указанному в `-o/--output`.
* Предыдущие два пункта при желании можно комбинировать.
* Для обнаружения возможных ошибок стоит проверять на ненулевой код возврата (exit code).

## Подсветка синтаксиса {#syntax-highlighting}
Консольный клиент поддерживает подсветку большинства конструкций, доступных в YQL, в том числе выходящих за рамки стандартного SQL:
![](https://wiki.yandex-team.ru/yql/userguide/cli/.files/screenshot2016-02-01at20.39.47.png)

Если вам это разнообразие красок не по вкусу, можно его отключить с помощью опции `--no-color`. Также есть возможность заменить цветовую схему на альтернативную с помощью опции `--highlight-style`.

<details markdown="1">
<summary>Актуальный полный список всегда доступен в `--help`, здесь копия на момент написания.</summary>
//algol, algol_nu, autumn, borland, bw, colorful, default, emacs, friendly, fruity, igor, lovelace,
manni, monokai, murphy, native, paraiso-dark, paraiso-light, pastie, perldoc, rrt, tango, trac, vim, vs, xcode//
</details>

Эти и другие опции можно [сохранить в конфигурационный файл](#cli-config), чтобы не указывать их при каждом запуске.

## Автодополнение {#autocomplete}
Учитывает контекст, много что умеет, но далеко от идеала, так как работает по вручную написанным правилам и регулярным выражениям. Основное, что умеет подсказывать:

* Применимые в данном контексте ключевые слова.
* Кластера, пути к таблицам и колонки в них.
* [Предустановленные С++ UDF](../udf/list/index.md) и встроенные функции (в том числе агрегатные).
* Имена сохраненных запросов.

Горячие клавиши:

* `Tab`:
  * Принудительно показать варианты, если их еще нет.
  * Перейти к следующему варианту, если их несколько.
  * Выбрать предложенный вариант, если он единственный.
* Стрелки вверх-вниз или повторные нажатия на `Tab` — выбор конкретного варианта.
* `Enter` или стрелка вправо — если есть выбранный вариант, то выбрать его и показать, что можно было бы написать после него (удобно при выборе путей на кластерах или предустановленных C++ UDF).
* `Escape` или стрелка влево — закрыть меню с предложенными вариантами.

При этом в комментариях и строковых литералах автодополнение отключается автоматически. Полностью отключить автодополнение можно опцией `--no-autocomplete`.

<blockquote>Во многом ради удобства автодополнения имен колонок в таблицах и в некоторых случаях для читабельности, в YQL для SELECT поддерживается «перевернутая» форма записи, в которой сначала указывается, откуда брать данные, а затем — что с ними делать: `FROM ... SELECT ...`.</blockquote>

## История запросов {#request-history}
По умолчанию все запросы сохраняются локально в `~/.yql/history` и доступны для повторного запуска. Перемещение по истории запросов осуществляется примерно так же, как перемещение по истории команд в bash/zsh:

* стрелками можно перемещаться по истории запросов вверх—вниз. В многострочных запросах стрелки вверх—вниз позволяют перемещаться между строками запроса, переход к предыдущему/следующему запросу срабатывает только на первой и последней строках многострочного запроса.
* `Ctrl+R` — поиск в истории запросов по подстроке (в обратном хронологическом порядке), повторные `Ctrl+R` — показать следующие варианты с той же подстрокой, а `Enter` — выбрать текущий.

Запись истории и поиск по истории можно отключить с помощью аргумента командной строки `--no-history`.

Поиск по истории запросов на сервере можно делать с помощью команды `HISTORY SEARCH "my search query";`, [подробнее](../interfaces/web.md#polnotekstovyjjpoisk).

## Сохранение запросов под именем {#saving-queries-under-a-name}
Запросы, которые было не тривиально написать и которые с большой вероятностью понадобятся снова, рекомендуем сохранять под осмысленным именем на серверной части YQL. В дальнейшем реестр сохраненных запросов будет общим для [веб-интерфейса](https://yql.yandex-team.ru) и консольного клиента, но прямо сейчас это по историческим причинам не так.

Сохранение текущего запроса можно осуществить либо через опцию -t в неинтерактивном режиме, или с помощью горячих клавиш `Ctrl+S` или `Ctrl+W` (Ctrl+S, как правило, привычнее, но часто бывает уже назначен на что-нибудь в системе). В появившемся диалоге «Save query as» нужно ввести название для запроса, после чего редактирование продолжится. Чтобы отменить сохранение, нужно оставить название пустым.

Открыть сохраненный запрос можно аналогичным образом с помощью `Ctrl+O`, после чего в появившемся диалоге нужно ввести имя сохраненного запроса. Автодополнение имен в этом контексте не работает.

Другой способ обратиться к сохраненному запросу — использовать описанные ниже команды (вместо `<TITLEorID>` нужно подставить имя или идентификатор сохраненного ранее запроса):

* `QUERY OPEN <TITLEorID>;` — открыть запрос;
* `QUERY RUN <TITLEorID>;` — запустить запрос;
* `QUERY DELETE <TITLEorID>;` или `QUERY REMOVE <TITLEorID>;` — удалить запрос;
* `SHOW QUERIES;` — список сохраненных запросов;
* `SHOW QUERY <TITLEorID>;` — показать содержимое запроса и краткую информацию о нем, не открывая сам запрос.

## Форматирование результата {#formatting-of-the-result}
По умолчанию форматирование результирующих таблиц определяется автоматически по следующей логике:

* Если вывод в консоль — рисуется визуальная табличка с помощью спецсимволов (`fancy_grid`), но если она получилась слишком широкой или в значениях есть переносы строк, включается специальный режим (`expanded`), который печатает каждую строку таблицы как набор пар «имя колонки — ее значение» и разбивает строки горизонтальными линиями — для больших/многострочных значений в ячейках так читабельнее.
* Если вывод в файл — используется tab-separated values (`tsv`), но если расширение файла — `.xlsx`, то данные выводятся сразу в формате Excel.

Выбрать формат можно и вручную с помощью опции `-f/--table-format`. Помимо упомянутых выше вариантов доступно много других (см. `--help`), например `HTML` можно вставить в вики с помощью `<# <table>...</table> #>` (наш диалект вики-разметки пока не поддержали, но со временем можно доделать).

## Загрузка полного результата {#loading-the-full-result}
По умолчанию, если запрос вернул больше 100 строк, то на клиент возвращается лишь выборка данных и координаты таблиц с полным результатом операции на соответствующем кластере. С помощью опции `-r/--fetch-full-results` можно включить скачивание результатов целиком. Это не делается по умолчанию из-за ряда имеющихся ограничений:

* Для экономии ресурсов скачивание происходит напрямую с кластера (в обход серверной части YQL), а до него может не быть дырок в firewall.
* Поддерживаются только кластера YT и [простые типы данных](../types/primitive.md) (за исключением YSON и строк с непечатными символами).
* Для форматов, отличных от `tsv`, оформление таблицы все равно происходит целиком в памяти, поэтому память может неожиданно кончиться с разного рода неприятными последствиями в зависимости от операционной системы.

## Навигация по данным {#navigating-data}
<a name="cli-nav"></a>

Команды:

* `SHOW CLUSTERS;` — список кластеров.
* `SHOW TABLES cluster.[path/to/folder];` — список таблиц в директории.
* `SHOW SCHEME cluster.[path/to/table];` — схема таблицы; также можно использовать алиасы `DESCRIBE`, `SHOW SCHEMA`, `SHOW COLUMNS` или `SHOW FIELDS`. {% if yt %}Для таблиц без [указанной в мета-атрибутах схемы](../misc/schema.md) можно указать после имени таблицы `WITH inferscheme`, чтобы вывести схему по данным первой строки.{% endif %}
* `SHOW META cluster.[path/to/table];` — метаданные таблицы (размер в байтах, количество строк и пр).
* `SHOW PREVIEW cluster.[path/to/table];` — предпросмотр данных таблицы. Логически мало чем отличается от `SELECT *`, но иногда может работать немного быстрее из-за дополнительного слоя кеширования.
{% if yt %}
Особенности:

* Перечисленные выше команды поддерживают работу и с [view](../misc/schema/#view), для чего нужно указывать `cluster.[path/to/table]:myview`. В случае `SHOW PREVIEW` стоит иметь в виду, что во view могут прозрачно выполняться тяжелые вычисления, из-за чего предпросмотр будет работать долго.
* Если интересующие вас директории закрыты на чтение/навигацию для произвольного пользователя, необходимо сначала присвоить алиас своему токену, а затем использовать его в описаных выше командах по аналогии с `PRAGMA` следующим образом: `SHOW SCHEME cluster.[path/to/table] WITH yt.auth = "myalias";`.
{% endif %}
## Асинхронное выполнение {#asynchronous-operation}
По умолчанию в момент ввода законченного запроса клиент синхронно начинает ожидать выполнения запроса (операции) и выводит результат по готовности. Во время ожидания доступны две возможности:

* `Ctrl+C` отменяет выполнение запроса.
* `Ctrl+Z` на Linux/Mac и `Ctrl+Break` на Windows отправляют запрос выполняться в фоне и выводят ID, по которому к нему можно вернуться (см. ниже описание команд `SHOW`).
Также можно сразу запустить запрос в фоне, заменив последнюю `;` на `&`, что также вернет ID.

<blockquote>**NB** Используя ID операции, можно открыть запрос в веб-интерфейсе: https://yql.yandex-team.ru/Operations/<ID>.</blockquote>

Доступные команды (`<ID>` надо везде заменять на идентификатор операции):

* `SHOW OPERATIONS;` — список последних операций. Чтобы посмотреть больше результатов, можно добавить в конце число (номер страницы). Есть алиас `HISTORY;`.
* `SHOW RUNNING;` — список операций, которые прямо сейчас выполняются.
* `SHOW STATUS <ID>;` — посмотреть статус и метаданные операции.
* `SHOW RESULTS <ID>;` — показать результаты операции, если они уже готовы, в противном случае вывести текущий статус.
* `SHOW PROGRESS <ID>;` — продолжить синхронно ожидать результата выполнения запроса или показать результат, если он готов.
* `SHOW PLAN <ID>;` и `SHOW AST <ID>;` — аналогично [EXPLAIN](#explain), но по уже запущенному или завершенному запросу.
* `SHOW URL <ID>;` — получить URL на операцию в веб-интерфейсе, которым можно поделиться с коллегой.
* `ABORT <ID>;` — отменить операцию.

В интерактивном режиме клиент автоматически подписывается на push-уведомления о завершении всех операций, при получении которых всплывает сообщение, в котором указан статус (успех или нет) и снова `<ID>`, по которому можно посмотреть результат с использованием перечисленных выше команд:

![](https://wiki.yandex-team.ru/yql/userguide/cli/.files/yql-notification.gif)

## Уведомления о завершении операций {#notifications-on-completion-of-operations}
На данный момент настройки уведомлений представляют собой четыре выключателя по поддерживаемым каналов:

* `EMAIL`;
* `JABBER`;
* `SMS`;
* `TELEGRAM` (предварительно нужно [добавить бота в контакты](https://yql.yandex-team.ru/api/v2/telegram) и написать ему `/start`).
В будущем планируется сделать систему гибких фильтров, подобную той, которая [реализована в Яндекс.Почте](https://mail.yandex-team.ru/#setup/filters) ([тикет](https://st.yandex-team.ru/YQL-760)). Источником контактов служит [staff](https://staff.yandex-team.ru).

Для управления этими настройками есть три класса команд (где `<TRANSPORT>` — один из перечисленных выше):

* `NOTIFY BY <TRANSPORT> ENABLE;` — включить транспорт;
* `NOTIFY BY <TRANSPORT> DISABLE;` — отключить транспорт;
* `SHOW NOTIFICATION SETTINGS;` — просмотр текущего состояния (какие каналы уведомлений включены).

Особенности реализации транспорта Telegram:

* Для добавления бота в контакты нужно использовать именно [ссылку из инструкции](https://yql.yandex-team.ru/api/v2/telegram), а не поиск в каталоге ботов или прямой ввод URL.
* При тестировании обнаружилось, что при некоторых комбинациях браузера и клиента telegram возникают трудности с отправкой `/start` (не приходит ответа от бота). Помогает удаление бота из контактов и добавление заново, в идеале с другим браузером и клиентом.
* Никакие команды, кроме `/start`, бот не поддерживает.

## Explain {#explain}
Предоставляется три способа изучить, к выполнению каких операций сводится тот или иной запрос (далее в примерах `...` обозначает текст запроса):

* `EXPLAIN ...;` — высокоуровневый план запроса, в котором указаны только физические операции и имена таблиц, не являющихся временными.
* `EXPLAIN AST ...;` — уже оптимизированный подробный план запроса в виде [s-expressions](../s_expressions/index.md); восклицательным знаком отмечены функции, имеющие побочные эффекты.
* `EXPLAIN PARSE ...;` / `EXPLAIN VALIDATE ...;` — результат работы только SQL-транслятора, тоже в виде [s-expressions](../s_expressions/index.md), но еще в логических терминах, без физических операций; может оказаться полезен разработчикам инструментов, работающих c YQL на более низком уровне, чем SQL. VALIDATE дополнительно проверяет результат SQL-транслятора на валидность.

Пример высокоуровневого `EXPLAIN` для `JOIN` двух таблиц:
![](https://wiki.yandex-team.ru/yql/userguide/cli/.files/screenshot2016-02-02at12.44.08.png)
Поток данных идет снизу вверх, то есть в качестве исходных данных выступают две таблицы (выделены зеленым). С помощью цепочки MapReduce-операций процесс обработки запроса доходит до коммита транзакции и чтения результата в клиент (выделено синим).

## Работа с файлами {#work-with-files}
К запросам можно прикладывать файлы либо из локальной файловой системы, либо указав URL.


| **Задача** | **Локальный файл** | **URL** |
| --- | --- | --- |
| Приложить файл, указав его в аргументе командной строки | `yql -F foo.txt` | `yql -U foo.txt@http://bar.yandex-team.ru/foo.txt;` |
| Приложить файл в интерактивном режиме | `ATTACH FILE foo.txt;` | `ATTACH URL foo.txt@http://bar.yandex-team.ru/foo.txt;` |

Имя и путь к файлу (как локальный, так и URL) указываются в формате `alias@value`, где:

* `alias` — имя, по которому  нужно обращаться к файлу из текста запроса;
* `value` — URL или локальный путь к файлу.
При отсутствии `@` значение используется одновременно и как alias, и как value.

Сервис YQL оставляет за собой право кешировать находящиеся за URL файлы на неопределенный срок, по-этому при значимом изменении находящегося за ней содержимого настоятельно рекомендуется модифицировать URL за счет добавления/изменения незначащих параметров.

## Указание токенов YT {#specifying-tokens-is-yt}
У каждого пользоватея YQL существует профиль, в котором может сохраняться приватная информация, в том числе токены для работы с YT.

Управлять сохраненными токенами и квотами можно из консольного клиента с помощью перечисленных ниже команд. Токены и квоты указываются в формате `alias:type:value`, где:

* `alias` — имя токена/квоты для указания в запросах;
* `type` — `yt` или имя кластера
* `value` — токен или имя квоты.

Доступные команды:

* `AUTH PUT foo:yt:012345abcdef;` — добавить YT-токен `012345abcdef` под алиасом `foo` (если такой алиас уже существовал, его значение будет перезаписано).
* `AUTH GET;` — вывести список своих аутентификационных данных, сохраненных в профиле.
* `AUTH DELETE foo;` — удалить аутентификационные данные по алиасу.
* `PRAGMA yt.auth = "foo";` — если указать эту конструкцию в начале запроса, то он выполнится с использованием токена или квоты, которая была ранее присвоена алиасу `foo`. Для команд, описанных на этой странице, она работать не будет, только для полноценных запросов с `SELECT/INSERT/etc.`.
* Для команд [навигации по данным](#cli-nav) доступен следующий синтаксис: `SHOW <COMMAND> cluster.[some/path] WITH yt.auth = "foo";`. Эта конструкция может потребоваться в ситуации, когда с помощью ACL закрыт доступ к таблицам и директориям даже на чтение.

**NB**: По умолчанию без указания `PRAGMA` запросы выполняются от общей квоты `yql`. Чтобы переопределить это поведение, необходимо сохранить описанным выше способом токен под алиасом `default_yt` соответственно.

Ссылки на получение токенов:

* <https://banach.yt.yandex-team.ru/auth/new>
* <https://hahn.yt.yandex-team.ru/auth/new>

## Конфигурация {#configuration}
<a name="cli-config"></a>
Изменить дефолтное поведение клиента можно, сохранив значения аргументов командной строки в конфигурацонном файле `~/.yql/config`.
Имена и значения опций указываются в следующем формате:

* опции указываются по одной на строку;
* от длинного названия опции отбрасываются начальные дефисы `--`, дефисы в имени опции заменяются на символ подчеркивания `_`;
* если опция имеет значение, оно указывается на той же строки после символа `=`.

Примеры:
```
table_format=plain
```

### Шаблон запроса {#query-template}
Есть возможность сохранить и указать в конфигурационном файле шаблон запроса, который будет открываться при запуске клиента в интерактивном режиме. В таком шаблоне можно указать, например, часто используемые `USE/PRAGMA`.
Для этого:

1. Сохраняем шаблон в любой файл, например `/home/username/.yql/interactive_rc`.
2. Указываем в конфигурационном файле `edit_path=/home/username/.yql/interactive_rc` (требуется указать абсолютный путь без переменных окружения или символа ~~).

!!! warning "Внимание"
    Побочный эффект при использовании шаблона запроса — перестает работать опция `-i / --input`, вместо нее можно использовать `$ yql < input.yql`.

Еще один оказавшийся востребованным сценарий: всегда приписывать к запросу `PRAGMA inferscheme;`. Для этого предназначен аргумент командной строки `--inferscheme`,  который можно указать и в конфигурационном файле как `inferscheme`.

## Автообновление {#autoupdate}
<a name="autoupdate"></a>

Чтобы минимизировать использование устаревших версий, консольный клиент выполняет попытку самостоятельно обновляться, если это физически возможно. По умолчанию клиент проверяет наличие новой версии при запуске, но не чаще раза в сутки, и в случае успешной установки в интерактивном режиме показывает уведомление с рекомендацией перезапустить клиент командой `RESTART;`.

Расширенные возможности:

* Внепланово проверить наличие новой версии можно командой `CLI UPDATE;`, а узнать текущую версию командой `VERSION;` или запустив клиент с аргументом `$ yql -V`.
* Доступен режим синхронного обновления `$ yql update`, который может быть полезен в ситуациях, когда интерактивный режим не используется.
* С помощью переменной окружения `YQL_FORCE_UPDATE=1` можно отключить все проверки, предотвращающие обновление (обновление было выполнено недавно, совпал идентификатор сборки или хэш файла). В штатном режиме этой возможностью пользоваться, как правило, не нужно.
* По аналогии с другими функциями от автоматического обновления можно отказаться с помощью опции `--no-autoupdate` или соответствующего параметра в конфигурационном файле.

## Горячие клавиши {#hotkeys}
В разделе приведен список определенных по умолчанию в консольном клиенте горячих клавиш:

* `Ctrl+D` — выход из интерактивного режима;
* `Ctrl+C`:
  * При вводе запроса — отменить уже введенное и начать ввод заново;
  * При синхронном ожидании результата операции — ее отмена;
* `Ctrl+Z` (Linux/Mac) и `Ctrl+Break` (Windows) — продолжить выполнение операции в фоне;
* `Ctrl+S` или `Ctrl+W` — сохранить текущий запрос на сервере;
* `Ctrl+O` — открыть запрос, сохраненный ранее на сервере.

Также в интерактивном режиме доступна масса горячих клавиш в стиле Emacs и bash/zsh, что может оказаться удобным для привыкших к ним пользователей. Некоторые примеры горячих клавиш (полный список можно найти в коде [здесь](https://a.yandex-team.ru/arc/trunk/arcadia/yql/cli/interactive/key_bindings.py) и [здесь](https://a.yandex-team.ru/arc/trunk/arcadia/contrib/python/prompt_toolkit/prompt_toolkit/key_binding)):

* `Сtrl+A` — переход в начало строки, `Ctrl+E` — в конец;
* `Сtrl+F` — переход на символ вперед, `Ctrl+B` — назад;
* `Ctrl+N` — следующая строка, `Ctrl+P` — предыдущая;
* `Ctrl+U` — стереть до начала строки;
* `Сtrl+W` — стереть слово перед курсором;
* `Ctrl+T` — поменять два последних символа местами;
* `Ctrl+X Ctrl+E` — открыть текущий запрос в редакторе по умолчанию (под Linux / Mac — используется редактор, указанный в переменной `$EDITOR`). Сохранение файла под текущим именем возвращает интерактивный режим, но можно сохранить файл и под любым другим именем.

## Специальные режимы {#special-symbols}
### yql upload\_table {#yql-upload-table}
Импорт локального файла в таблицу на кластере. На данный момент поддерживается только кластера YT и файлы в формате tsv (tab-separated values). На первой строке ожидаются имена колонок, а на второй — их типы данных.

Для работы данного режима обязательно нужно передать YQL токен, который можно получить [здесь](http://yql.yandex-team.ru/?settings_mode=token), именно через переменную окружения YQL_TOKEN.

<details markdown="1">
<summary>Скринкаст</summary>
<video src="https://jing.yandex-team.ru/files/n-bar/screencast_2017-09-01_16-38-26.mp4"/></details>

{% if yt %}
### yql embedded {#yql-embedded}
Позволяет выполнять YQL запросы на кластерах YT в обход YQL как сервиса (т.е. без использования [HTTP API](../interfaces/http.md), через который работает основной режим). Использует Python биндинги к [library/embedded](../libraries/embedded.md), что влечет за собой следующие следствия:

* Требует указания путей до скомпилированных [mrjob](https://a.yandex-team.ru/arc/trunk/arcadia/yql/tools/mrjob) и [udf_resolver](https://a.yandex-team.ru/arc/trunk/arcadia/yql/tools/udf_resolver), а также всех нужных UDF (которые будут доступны **вместо** [предустановленных](../udf/list/index.md)).
* Код ядра YQL будет использоваться ровно тот, из которого это все собрано, а не тот который сейчас находится на основном стенде YQL. Таким образом стоит особенно тщательно отнестись к интеграционному тестированию.
* При сборке из Аркадии очень рекомендуем использовать как минимум опции `ya make -r --lto`.
{% endif %}
### yql python {#yql-python}
Запуск встроенного интерпретатора Python 2.7 c [предустановленной клиентской библиотекой YQL](../interfaces/python.md).
По умолчанию включается интерактивный режим на основе IPython + ptpython. Запустить скрипт на Python можно, указав имя файла скрипта в качестве первого свободного аргумента.
{% if yt %}
### yql jupyter {#yql-jupyter}
Автоматический запуск Jupyter (в прошлом IPython Notebook) с [предустановленной клиентской библиотекой YQL](../interfaces/python.md). Этому режиму посвящена [отдельная подробная статья](../guides/jupyter.md).
{% endif %}
### yql update {#yql-update}
Синхронный запуск автообновления, подробнее [см. выше](#autoupdate).
{% if yt %}
### yql proto\_field {#yql-proto-field}
См. [документацию по схематизации](../misc/schema.md#yqlprotofield).

### yql --inferscheme {#yql-inferscheme}
Автоматическое использование [PRAGMA inferscheme;](../misc/schema.md#5inferschemetolkodljaytnerekomendovano).

### yql --yt-external-tx {#yql-yt-external-tx}
Возможность запустить YQL операцию в YT под внешней транзакции. В значении передается или идентификатор уже существующей транзакции, либо специальное значение `new`, при котором:

* транзакцию на YT создает и пингует сам консольный клиент;
* требуется указание имени кластера YT через свободный аргумент консольного клиента.
Этот режим может быть полезен, если консольный клиент запускается в окружении, где велик риск его форсированной остановки снаружи (например, в Нирване), и требуется чтобы YQL операция в этом случае тоже завершалась.
{% endif %}
### yql --s-expressions {#yql-s-expressions}
Большинству пользователей это не понадобится, но консольный клиент в базовом объеме поддерживает работу с [s-expressions синтаксисом запросов](../s_expressions/index.md). Включается при указании аргумента командной строки `--s-expressions`. Поддерживается автодополнение встроенных функций и подсветка синтаксиса.
