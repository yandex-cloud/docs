# Создание брокера

{% include [note-pp](../../../_includes/iot-core/note-pp.md) %}

{% list tabs %}

- Консоль управления

  1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором вы хотите создать брокер.
  1. Выберите сервис **{{ iot-short-name }}**.
  1. На панели слева выберите **Брокеры**
  1. Нажмите кнопку **Создать брокер**.
  1. В блоке **Общая информация** укажите:
      * **Имя** брокера. Например, `my-broker`.
      * (Опционально) **Описание** — дополнительную информацию о брокере.
      * (Опционально) **Пароль**, который будете использовать для доступа к брокеру. Для создания пароля можно воспользоваться [генератором паролей](https://passwordsgenerator.net/). Не забудьте сохранить пароль, он вам понадобится.
      * (Опционально) Для присвоения брокеру метки заполните поля **Ключ**, **Значение** и нажмите кнопку **Добавить метку**.
  1. (Опционально) Добавьте [сертификаты](../../operations/certificates/create-certificates.md):
      * Чтобы добавить файл:
        1. Выберите способ **Файл**.
        1. Нажмите **Выбрать файл**.
        1. Выберите файл сертификата на вашем компьютере и нажмите **Открыть**.
        1. Нажмите **Добавить**.
      * Чтобы добавить текст:
        1. Выберите способ **Текст**.
        1. Вставьте тело сертификата в поле **Содержимое**.
        1. Нажмите **Добавить**.
  1. Нажмите кнопку **Создать**.

- CLI
  
  {% include [cli-install](../../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../../_includes/default-catalogue.md) %}
  
  1. Создайте брокер:
  
      ```
      yc iot broker create --name my-broker
      ```
	 
      {% include [name-format](../../../_includes/name-format.md) %}

      Результат:
	   
      ```
      id: b91ki3851h**********
      folder_id: aoek49ghmk*********
      created_at: "2022-05-28T11:29:42.420Z"
      name: my-broker
      ```
	 
  1. Проверьте, что брокер создался:
  
      ```
      yc iot broker list
	    ```
	  
	    Результат:
	    ```
      +----------------------+-------------+
      |          ID          |    NAME     |
      +----------------------+-------------+
      | b91ki3851h********** |  my-broker  |
      +----------------------+-------------+
      ```

- {{ TF }} 

  {% include [terraform-definition](../../../_tutorials/terraform-definition.md) %}

  Если у вас ещё нет {{ TF }}, [установите его и настройте провайдер {{ yandex-cloud }}](../../../tutorials/infrastructure-management/terraform-quickstart.md#install-terraform).  
   
  {% note info %}

  Чтобы добавить сертификаты брокеру, [подготовьте](../certificates/create-certificates.md) их заранее.

  {% endnote %}

  Чтобы создать брокер: 
     
  1. Опишите в конфигурационном файле параметры ресурса, который необходимо создать:

     * `yandex_iot_core_broker` — параметры брокера:
       * `name` — имя брокера.
       * `description` — описание брокера.
       * `labels` — метки брокера в формате `ключ:значение`.
       * `certificates` — список сертификатов брокера для авторизации с помощью [сертификатов](../../concepts/authorization.md#certs).

      Пример структуры ресурса в конфигурационном файле:
      
      ```
      resource "yandex_iot_core_broker" "my_broker" {
        name        = "test-broker"
        description = "test broker for terraform provider documentation"
        labels = {
          test-label = "label-test"
        }

        certificates = [
          file("<путь_к_первому_файлу_с_сертификатом>"),
          file("<путь_ко_второму_файлу_с_сертификатом>")
        ]
      }

      output "yandex_iot_core_broker_my_broker" {
        value = "${yandex_iot_core_broker.my_broker.id}"
      }
      ```

      Более подробную информацию о ресурсах, которые вы можете создать с помощью {{ TF }}, см. в [документации провайдера]({{ tf-provider-resources-link }}/iot_core_broker).

  1. Проверьте корректность конфигурационных файлов.
      1. В командной строке перейдите в папку, где вы создали конфигурационный файл.
      1. Выполните проверку с помощью команды:

          ```
          terraform plan
          ```

      Если конфигурация описана верно, в терминале отобразится список создаваемых ресурсов и их параметров. Если в конфигурации есть ошибки, {{ TF }} на них укажет. 

  1. Разверните облачные ресурсы.

      1. Если в конфигурации нет ошибок, выполните команду:

          ```
          terraform apply
          ```

      1. Подтвердите создание ресурсов.
      
          После этого в указанном каталоге будут созданы все требуемые ресурсы. Проверить появление ресурсов и их настройки можно в [консоли управления]({{ link-console-main }}) или с помощью команды [CLI](../../../cli/quickstart.md):

          ```bash
          yc iot broker list
          ```

- API

  Чтобы создать брокер, воспользуйтесь методом REST API [create](../../broker/api-ref/Broker/create.md) для ресурса [Broker](../../broker/api-ref/Broker/index.md) или вызовом gRPC API [BrokerService/Create](../../broker/api-ref/grpc/broker_service.md#Create).

{% endlist %}
