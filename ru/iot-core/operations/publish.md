# Отправить сообщение

Вы можете отправлять сообщения следующих типов:

- Отправлять данные с устройства в реестр, используя топики `$devices/<ID устройства>/events` или `$registries/<ID реестра>/events`.
- Отправлять команды из реестра на устройство, используя топики `$devices/<ID устройства>/commands` или `$registries/<ID реестра>/commands`.

{% note info %}


Для получения сообщения необходимо быть подписанным на отправителя. Как это сделать, читайте в разделе [{#T}](subscribe.md).

{% endnote %}

{% include [iot-before-begin](../../_includes/iot-core/iot-before-begin.md) %}

## Отправить сообщение с данными {#pub-events}

{% list tabs %}

- Mosquitto

  - Отправьте данные с устройства в топик устройства:

      ```
      $ mosquitto_pub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
      --cert device-cert.pem \ # Путь к публичной части сертификата устройства.
      --key device-key.pem \ # Путь к приватной части сертификата устройства.
      -t '$devices/<ID устройства>/events' \ # Топик устройства.
      -m 'Test data' \ # Текст сообщения.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

      Реестр, подписанный на данный топик, будет знать, какое именно устройство отправило данные, так как в топике присутствует уникальный идентификатор устройства.

  - Отправьте данные с устройства в топик реестра:

      ```
      $ mosquitto_pub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
      --cert device-cert.pem \ # Путь к публичной части сертификата устройства.
      --key device-key.pem \ # Путь к приватной части сертификата устройства.
      -t '$registries/<ID реестра>/events' \ # Топик реестра.
      -m 'Test data' \ # Текст сообщения.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

      Реестр, подписанный на данный топик, не будет знать, какое именно устройство отправило данные, так как в топике отсутствует уникальный идентификатор устройства.

{% endlist %}

## Отправить сообщение с командой {#pub-commands}

Реестр может отправить сообщение с командой одному, нескольким или всем устройствам, добавленным в него. Рассмотрим все варианты.

{% list tabs %}

- Mosquitto

  - Отправьте команду одному устройству:

      ```
      $ mosquitto_pub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
      --cert registry-cert.pem \ # Путь к публичной части сертификата реестра.
      --key registry-key.pem \ # Путь к приватной части сертификата реестра.
      -t '$devices/<ID устройства>/commands' \ # Топик устройства.
      -m 'Test command for first device' \ # Текст сообщения.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

  - Отправьте команду двум устройствам:

      ```
      $ mosquitto_pub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile cert.pem \ # Путь к сертификату удостоверяющего центра.
      --cert registry-cert.pem \ # Путь к публичной части сертификата реестра.
      --key registry-key.pem \ # Путь к приватной части сертификата реестра.
      -t '$devices/<ID первого устройства>/commands' \ # Топик первого устройства.
      -t '$devices/<ID второго устройства>/commands' \ # Топик второго устройства.
      -m 'Test command for first and second device' \ # Текст сообщения.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

  - Отправьте команду всем устройствам, добавленным в реестр:

      ```
      $ mosquitto_pub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile cert.pem \ # Путь к сертификату удостоверяющего центра.
      --cert registry-cert.pem \ # Путь к публичной части сертификата реестра.
      --key registry-key.pem \ # Путь к приватной части сертификата реестра.
      -t '$registries/<ID реестра>/commands' \ # Топик реестра.
      -m 'Test command for all devices' \ # Текст сообщения.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

{% endlist %}
