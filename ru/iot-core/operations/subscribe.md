# Подписать устройство или реестр на получение сообщений

Вы можете подписать:

- Реестр на события устройства, используя топики `$devices/<ID устройства>/events` или `$registries/<ID реестра>/events`.
- Устройство на команды реестра, используя топики `$devices/<ID устройства>/commands` или `$registries/<ID реестра>/commands`.

{% note info %}


О том, как обмениваться сообщениями, читайте в разделе [{#T}](publish.md).

{% endnote %}

{% include [iot-before-begin](../../_includes/iot-core/iot-before-begin.md) %}

## Подписать реестр на устройство {#sub-events}

Реестр можно подписать на одно, несколько или все устройства, добавленные в него. Рассмотрим все варианты.

{% list tabs %}

- Mosquitto

  - Подпишите реестр на одно устройство:

      ```
      $ mosquitto_sub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
       -p 8883 \ # Порт MQTT-брокера.
       --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
       --cert registry-cert.pem \ # Путь к публичной части сертификата реестра.
       --key registry-key.pem \ # Путь к приватной части сертификата реестра.
       -t '$devices/<ID устройства>/events' \ # Топик устройства.
       -q 1 # Уровень качества обслуживания QoS 1.
      ```

  - Подпишите реестр на несколько устройств:

      ```
      $ mosquitto_sub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
      --cert registry-cert.pem \ # Путь к публичной части сертификата реестра.
      --key registry-key.pem \ # Путь к приватной части сертификата реестра.
      -t '$devices/<ID первого устройства/events' \ # Топик первого устройства.
      -t '$devices/<ID второго устройства/events' \ # Топик второго устройства.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

  - Подпишите реестр на все устройства, добавленные в него:

      ```
      $ mosquitto_sub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
      --cert registry-cert.pem \ # Путь к публичной части сертификата реестра.
      --key registry-key.pem \ # Путь к приватной части сертификата реестра.
      -t '$registries/<ID реестра>/events' \ # Топик реестра.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

      Реестр будет получать данные только от тех устройств, которые отправляют сообщения в топик `$registries/<ID реестра>/events`.

{% endlist %}

## Подписать устройство на реестр {#sub-commands}

Команды от реестра могут предназначаться конкретному устройству или всем устройствам в реестре. Для этого используются разные топики.

{% list tabs %}

- Mosquitto

  - Подпишите устройство на команды для конкретного устройства:

      ```
      $ mosquitto_sub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
      --cert device-cert.pem \ # Путь к публичной части сертификата устройства.
      --key device-key.pem \ # Путь к приватной части сертификата устройства.
      -t '$devices/<ID устройства/commands' \ # Топик устройства.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

  - Подпишите устройство на команды для всех устройств:

      ```
      $ mosquitto_sub -h mqtt.cloud.yandex.net \ # Адрес MQTT-брокера.
      -p 8883 \ # Порт MQTT-брокера.
      --cafile rootCA.crt \ # Путь к сертификату удостоверяющего центра.
      --cert device-cert.pem \ # Путь к публичной части сертификата устройства.
      --key device-key.pem \ # Путь к приватной части сертификата устройства.
      -t '$registries/<ID реестра>/commands' \ # Топик реестра.
      -q 1 # Уровень качества обслуживания QoS 1.
      ```

      Команды будут получать только устройства, подписанные на топик `$registries/<ID реестра>/commands`.

{% endlist %}
