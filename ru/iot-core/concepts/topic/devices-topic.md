# Топики устройства

Топики устройства, доступные в сервисе:
* `$devices/<ID устройства>/events` — топик для отправки телеметрических данных.  
* `$devices/<ID устройства>/state` — перманентный топик для отправки телеметрических данных.

   Устройство может писать в эти топики, а реестр — читать из них. Реестр, подписанный на эти топики, будет знать, какое именно устройство отправило данные, так как в топике присутствует идентификатор устройства.

* `$devices/<ID устройства>/commands` — топик для получения команд.
* `$devices/<ID устройства>/config` — перманентный топик для получения команд.

   Реестр может писать в эти топики, а устройство — читать из них. В эти топики реестр отправляет команды, предназначенные конкретному устройству.

* `$monitoring/<ID устройства>/json` — топик для получения данных мониторинга в формате JSON.

   Устройство автоматически пишет в этот топик, а другие устройства и реестры могут читать из него. Реестры или устройства, подписанные на этот топик, будут знать, какое именно устройство отправило данные, так как в топике присутствует идентификатор устройства.

{% include [registry-and-device-topic-note.md](../../../_includes/iot-core/registry-and-device-topic-note.md) %}

## Топик мониторинга {#monitoring-topic}

Устройство и реестр, подписавшись на топик мониторинга, получат актуальные данные мониторинга устройства, идентификатор которого указан в топике:

* `last_auth_time` — время последней аутентификации на устройстве;
* `last_auth_ip` — IP-адрес, с которого происходила последняя аутентификация;
* `last_pub_activity_time` — время последней отправки сообщения устройством;
* `last_sub_activity_time` — время последней подписки на получение сообщений;
* `last_online_time` — время последней активности устройства;
* `registry_id` — идентификатор реестра, в котором находится устройство;
* `device_id` — идентификатор устройства.

Время указывается по [UTC](https://ru.wikipedia.org/wiki/Всемирное_координированное_время). Новые сообщения отправляются подписавшимся на топик реестрам или устройствам при каждом обращении к устройству по MQTT. Уровень качества обслуживания — [at most once](../index.md#qos). Если сообщение не пришло в ожидаемое время, рекомендуем подождать около двух минут перед реагированием.

### Пример данных мониторинга {#example}

```
{
	"last_auth_time": "2021-03-24T09:55:21.7570928Z",
	"last_auth_ip": "199.21.99.45",
	"last_pub_activity_time": "2021-03-24T09:55:21.858181573Z",
	"last_online_time": "2021-03-24T09:55:21.858181573Z",
	"registry_id": "areljb44npjoaog*****",
	"device_id": "are3tkujvebfo3s*****"
}
```
