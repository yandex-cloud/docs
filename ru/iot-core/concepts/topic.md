# Топик

_Топик_ — тема сообщения, которая позволяет классифицировать данные для их выборочной отправки и получения устройствами и реестрами.

## Описание топиков {#description}

В сервисе реализованы два типа топиков: [топики устройства](#devices-topic) и [топики реестра](#registries-topic). Оба этих типа топиков поддерживают использование [сабтопиков](#subtopic).

### Топики устройства {#devices-topic}

Топики устройства, доступные в сервисе:

- `$devices/<ID устройства>/events` — топик отправки телеметрических данных от устройства.

   Устройство может писать в этот топик, а реестр — читать из него. Реестр, подписанный на данный топик, знает, какое именно устройство отправило данные, так как в топике присутствует уникальный идентификатор устройства.

- `$devices/<ID устройства>/commands` — топик получения команд для устройства.

   Реестр может писать в этот топик, а устройство — читать из него. В данный топик реестр отправляет команды, предназначенные конкретному устройству.

### Топики реестра {#registries-topic}

Топики реестра, доступные в сервисе:

- `$registries/<ID реестра>/events` — топик получения телеметрических данных от устройства.

   Устройство может писать в этот топик, а реестр — читать из него. Реестр, подписанный на данный топик, не знает, какое именно устройство отправило данные, так как в топике отсутствует уникальный идентификатор устройства.

- `$registries/<ID реестра>/commands` — топик отправки команд для всех устройств.

   Реестр может писать в этот топик, а устройство — читать из него. В данный топик реестр отправляет команды, предназначенные всем устройствам в реестре.

### Сабтопик {#subtopic}

_Сабтопик_ — это пользовательский топик, созданный в рамках существующих в сервисе топиков устройств и реестров. Создавать сабтопик отдельно не требуется, достаточно начать отправлять в него сообщения.

Сабтопиком считается все, что указано после топика устройства или реестра и отделено символом `/`:  

```
<топик устройства или реестра>/<имя сабтопика>
```

Примеры сабтопиков:

- `$devices/<ID устройства>/events/bedroom/temperature` — это сабтопик отправки телеметрических данных о температуре в спальне от определенного устройства.

- `$registries/<ID реестра>/commands/bedroom` — это сабтопик отправки команд из реестра на все устройства в спальне.

Для сабтопиков действуют те же [принципы работы](#usage) и [ограничения](limits.md), что и для топиков.

## Использование топиков {#usage}

{% include [registry-and-device-topic-note.md](../../_includes/iot-core/registry-and-device-topic-note.md) %}

В таблице описаны действия, которые устройства и реестры совершают с топиками:

Топик | Устройство | Реестр
----|----|----
`$devices/<ID устройства>/events` | Отправляет телеметрические данные. | Получает телеметрические данные. <br/>Устройство известно.
`$devices/<ID устройства>/commands` | Получает команды. | Отправляет команды определенному устройству.
`$registries/<ID реестра>/events` | Отправляет телеметрические данные. | Получает телеметрические данные от всех устройств в реестре.<br/>Устройство неизвестно.
`$registries/<ID реестра>/commands` | Получает команды. | Отправляет команды всем устройствам в реестре.

### Использование алиасов для топиков {#aliases}

_Алиас_ — это псевдоним [топика устройства](#devices-topic), присвоенный пользователем. Алиасы можно присваивать стандартным топикам (реализованным сервисом) и топикам с произвольными сабтопиками.

Алиас задается в формате ключ-значение:

```
<алиас>='<топик устройства>'
```

Алиасы можно использовать для отправки сообщений и подписки на сообщения наравне с обычными топиками устройств. Также вы можете использовать в алиасах символы подстановки при подписке на сообщения, при этом проверяется формат исходного топика, которому был присвоен алиас.

Алиас обязан однозначно определять устройство, то есть топик, которому присваивается алиас, должен содержать уникальный идентификатор устройства.

> Если [создать алиас](../operations/device/alias/alias-create.md) `my/alias/=$devices/<ID устройства>/`, то можно использовать топик `my/alias/events`. Он будет эквивалентен `$devices/<ID устройства>/events`. По аналогии можно использовать и другие топики, начинающиеся с `$devices/<ID устройства>/`.

### Подписка на топики с использованием символов подстановки {#wildcards}

Для подписки на топики вы можете использовать фильтры с символами подстановки `#` и `+`.

Если в начале фильтра стоит `$devices/`, то в фильтр попадают топики устройств, а если `$registries/`, то топики реестров. В остальных случаях в фильтр попадают только алиасы.

#### Символ # {#sharp}

Означает подстановку одной или нескольких частей топика, а также пустой строки. Всегда является последним символом в фильтре.

Примеры использования символа **#**:

- `#` — подписаться на все алиасы топиков.
- `$devices/#` — подписаться на все топики всех устройств.
- `$devices/<ID устройства>/#` — подписаться на все топики определенного устройства.
- `$devices/<ID устройства>/events/#` — подписаться на все топики определенного устройства с телеметрическими данными.

#### Символ + {#plus}

Означает подстановку одной части топика между символами `/` либо в конце после символа `/`.

Например, по подписке `$registries/<ID реестра>/commands/+` устройства получат команды, отправленные в топики `$registries/<ID реестра>/commands/bedroom` и `$registries/<ID реестра>/commands/kitchen`, но проигнорируют команду в топик `$registries/<ID реестра>/commands/bedroom/entrance`.

Примеры использования символа **+**:

- `$devices/<ID устройства>/+` — подписаться на все топики определенного устройства с телеметрическими данными и командами.
- `$devices/<ID устройства>/events/+` — подписаться на все топики определенного устройства с телеметрическими данными из всех помещений. Предполагается, что в примере символ `+` замещает помещение.
- `$devices/+/events/bedroom/temperature` — подписаться на все топики всех устройств с телеметрическими данными о температуре в спальне.
- `$devices/+/events/bedroom/+` — подписаться на все топики всех устройств с телеметрическими данными в спальне. Предполагается, что в примере символы `+` замещают уникальный идентификатор устройства и тип датчика.

Фильтры `$devices/+` и `$registries/+` не работают, т.к. топик должен состоять из трех частей: `$<devices или registries>/<ID>/<events или commands>`.

#### Совместное использование символов + и # {#join}

После `+` можно использовать `#`, чтобы подставить остальную часть топика или сабтопика:

- `$devices/+/#` — подписаться на все топики всех устройств. Эквивалентен фильтру `$devices/#`.

- `$devices/+/events/#` — подписаться на все топики всех устройств с телеметрическими данными.

При фильтрации также учитываются общие правила подписки на топики, например:

> - Подписка на фильтр `$devices/#` с [сертификатом реестра](../operations/certificates/registry-certificates.md) эквивалентна подписке на `$devices/+/events/#`.

      При этом будут получены и все сообщения, отправленные в `$devices/<DeviceID>/events`.

> - Подписка на фильтр `$registries/#` с [сертификатом устройства](../operations/certificates/device-certificates.md) эквивалентна подписке на `$registries/<ID реестра>/commands/#`.

      При этом будут получены и все сообщения, отправленные в `$registries/<ID реестра>/commands`.

### Триггеры для топиков {#trigger}

_Триггер_ — условие, при наступлении которого автоматически запускается определенная функция.

{% include [iot-core](../../_includes/functions/iot-core-trigger-description.md) %}

Подробнее о триггерах читайте в [документации {{ sf-name }}](../../functions/concepts/trigger/index.md).
