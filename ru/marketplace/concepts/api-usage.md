# Тарификация продуктов на основе метрик издателя

{{ marketplace-short-name }} предоставляет API учета потребления, чтобы продукты могли учитывать потребление и выставлять счета пользователям {{ yandex-cloud }} через сервис {{ billing-name }}. Интеграция с API требуется для любого продукта, использующего один или несколько планов тарификации с пользовательскими измерениями, чтобы учитывать события потребления.

На основе установленных вами метрик приложение (продукт) должно фиксировать события потребления и отправлять данные о них с помощью API учета потребления. В одном запросе вы можете отправить одно или несколько событий потребления. 

Спецификацию API выставления счетов по тарифу см. в разделе [{#T}](../api-ref/index.md). Пример использования API доступен в [репозитории на GitHub](https://github.com/yandex-cloud/python-sdk/tree/master/examples/marketplace/metering-api).

## Рекомендации по разработке и тестированию {#guidelines}

* Для авторизации приложения используйте [сервисный аккаунт](../../iam/concepts/users/service-accounts.md) с ролью `marketplace.meteringAgent`.
* Чтобы создать тариф для продукта с пользовательскими метриками, оставьте заявку в кабинете партнера {{ marketplace-short-name }}. Используйте выданный тарифу `skuId` для отправки записей о потреблении.
* При установке приложение должно проверить, что у пользователя достаточно прав для его использования, и отправка событий потребления возможна. Для этого необходимо отправить запрос [write](../api-ref/ImageProductUsage/write.md) с параметром `validateOnly: true`. 
* Приложение должно учитывать возможность неудачной попытки отправки событий потребления.
* Перед публикацией продукта рекомендуем тестировать интеграцию с API с помощью ID и SKU демонстрационного продукта: `product_id: {{ mp-test-product-id }}`, `sku_id: {{ mp-test-sku-id }}`.