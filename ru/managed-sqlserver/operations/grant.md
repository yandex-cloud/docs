---
title: "Назначение привилегий и ролей пользователям SQL Server"
description: "Атомарные полномочия в SQL Server называются привилегиями, группы полномочий — ролями. {{ mms-name }} поддерживает предопределенные роли. Пользователь, создаваемый вместе с кластером {{ mms-name }}, автоматически получает роль владельца (DB_OWNER) первой базы данных в кластере. После этого вы можете создавать других пользователей и настраивать их права по своему усмотрению."
---

# Назначение привилегий и ролей пользователям

Атомарные полномочия в **{{ MS }}** называются _привилегиями_, группы полномочий — _ролями_. **{{ mms-name }}** поддерживает [предопределенные роли](#predefined-db-roles). Подробнее об организации прав доступа читайте в [документации {{ MS }}]({{ ms.docs }}/sql/relational-databases/security/authentication-access/getting-started-with-database-engine-permissions?view=sql-server-2016).

Пользователь, создаваемый вместе с кластером **{{ mms-name }}**, автоматически получает роль владельца (`DB_OWNER`) первой базы данных в кластере. После этого вы можете [создавать других пользователей](cluster-users.md#adduser) и настраивать их права по своему усмотрению:
* [Изменить список ролей пользователя](#grant-role).
* [Выдать привилегию пользователю](#grant-privilege).
* [Отозвать привилегию у пользователя](#revoke-privilege).

## Изменить список ролей пользователя {#grant-role}

Для назначения **роли** пользователю используйте консоль управления или {% if lang == "ru" and audience != "internal" %}[API](../../glossary/rest-api.md){% else %}API{% endif %} {{ yandex-cloud }}: назначение роли запросом `GRANT` отменится при следующей операции с базой.

{% list tabs %}

- Консоль управления

  1. Перейдите на [страницу каталога]({{ link-console-main }}) и выберите сервис **{{ mms-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) и выберите пункт **Настроить**.
  1. При необходимости добавьте пользователю нужные базы данных:
     1. Нажмите кнопку **Добавить базу данных**.
     1. Выберите базу данных из выпадающего списка.
     1. Повторите два предыдущих шага, пока не будут выбраны все требуемые базы данных.
     1. Чтобы отозвать доступ к определенной базе, удалите ее из перечня, нажав значок ![image](../../_assets/cross.svg) справа от имени базы данных.
  1. Задайте нужные роли пользователя для каждой из баз данных пользователя:
     1. Нажмите значок ![image](../../_assets/plus-sign.svg) в столбце **Роли**.
     1. Выберите роль, которую вы хотите добавить пользователю из выпадающего списка.
     1. Повторите два предыдущих шага, пока не будут добавлены все требуемые роли.
  1. Чтобы отозвать роль, нажмите значок ![image](../../_assets/cross.svg) справа от ее имени.
  1. Нажмите кнопку **Сохранить**.

- CLI

    {% include [cli-install](../../_includes/cli-install.md) %}

    {% include [default-catalogue](../../_includes/default-catalogue.md) %}

    Чтобы назначить роли пользователю кластера, передайте список нужных ролей в параметре `--grant-permission`. Имеющиеся роли будут полностью перезаписаны: если вы хотите дополнить или уменьшить имеющийся список, сначала запросите текущие роли с информацией о пользователе командой `{{ yc-mdb-ms }} user get`.

    Чтобы назначить роли, выполните команду:

    ```bash
    {{ yc-mdb-ms }} user grant-permission <имя пользователя> \
       --cluster-name=<имя кластера> \
       --database=<имя базы данных> \
       --roles=<список ролей>
    ```

    Где:

    * `--cluster-name` — имя кластера.
        Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).
    * `--database` — имя базы данных, к которой у пользователя есть доступ.
        Пошаговые инструкции по предоставлению доступа к базам данных представлены в разделе [Управление пользователями](./cluster-users#update-settings).
    * `--roles` — список ролей, предоставляемых пользователю.

- {{ TF }}

    1. Откройте актуальный конфигурационный файл {{ TF }} с планом инфраструктуры.

        О том, как создать такой файл, см. в разделе [{#T}](./cluster-create.md).

    1. Найдите в описании кластера {{ mms-name }} блок `user` для нужного пользователя.

    1. Измените значение поля `roles` в блоках `permission` для нужных баз данных.

        ```hcl
        resource "yandex_mdb_sqlserver_cluster" "<имя кластера>" {
          ...
          user {
            ...
            permission {
              database_name = "<имя базы>"
              roles         = ["<список ролей пользователя>"]
            }
            ...
          }
        }
        ```

        Список предопределенных ролей пользователя см. [ниже](#predefined-db-roles). В конфигурационном файле с планом инфраструктуры их следует указывать без префикса, например, `OWNER`, `DDLADMIN`, `DATAREADER`.

    1. Проверьте корректность настроек.

        {% include [terraform-validate](../../_includes/mdb/terraform/validate.md) %}

    1. Подтвердите изменение ресурсов.

        {% include [terraform-apply](../../_includes/mdb/terraform/apply.md) %}

    Подробнее см. в [документации провайдера {{ TF }}]({{ tf-provider-mms }}).

    {% include [Terraform timeouts](../../_includes/mdb/mms/terraform/timeouts.md) %}

- API

    Воспользуйтесь методом API [update](../api-ref/User/update.md) и передайте в запросе:

    * Идентификатор кластера, в котором находится пользователь в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
    * Имя пользователя в параметре `userName`. Чтобы узнать имя, [получите список пользователей в кластере](cluster-users.md#list-users).
    * Имя базы данных, для которой вы хотите изменить список ролей пользователя, в параметре `permissions.databaseName`. Чтобы узнать имя, [получите список баз данных в кластере](databases.md#list-db).
    * Массив нового списка ролей пользователя в параметре `permissions.roles`.
    * Список полей конфигурации пользователя, которые необходимо изменить (в данном случае — `permissions`), в параметре `updateMask`.

    {% include [Note API updateMask](../../_includes/note-api-updatemask.md) %}

{% endlist %}

## Выдать привилегию пользователю {#grant-privilege}

1. [Подключитесь](connect.md) к базе данных с помощью учетной записи владельца базы данных.
1. Выполните команду `GRANT`. Подробное описание синтаксиса команды смотрите в [документации {{ MS }}]({{ ms.docs }}/sql/t-sql/statements/revoke-transact-sql?view=sql-server-2016).

## Отозвать привилегию у пользователя {#revoke-privilege}

1. [Подключитесь](connect.md) к базе данных с помощью учетной записи владельца базы данных.
1. Выполните команду `REVOKE`. Подробное описание синтаксиса команды смотрите в [документации {{ MS }}]({{ ms.docs }}/sql/t-sql/statements/revoke-transact-sql?view=sql-server-2016).

{% include [user-ro](../../_includes/mdb/mms-user-examples.md) %}

## Описание предопределенных ролей {#predefined-db-roles}

* `DB_OWNER` — владелец базы данных. Пользователи, обладающие этой ролью, могут выполнять все действия по настройке и обслуживанию базы данных, удалять базу данных в {{ MS }}.
* `DB_SECURITYADMIN` — администратор безопасности. Пользователи, обладающие этой ролью, могут управлять привилегиями. Имеют возможность повышать собственные права доступа, поэтому необходимо отслеживать их действия.
* `DB_ACCESSADMIN` — администратор доступов. Пользователи, обладающие этой ролью, могут выдавать или отзывать права удаленного доступа к базе данных для пользователей и групп Windows и пользователей {{ MS }}.
* `DB_BACKUPOPERATOR` — оператор резервных копий. Пользователи, обладающие этой ролью, могут создавать резервные копии базы данных.
* `DB_DDLADMIN` — администратор DDL. Пользователи, обладающие этой ролью, могут выполнять любые команды языка описания данных (DDL).
* `DB_DATAWRITER` — пользователь с правом на запись. Пользователи, обладающие этой ролью, могут добавлять, удалять или изменять данные во всех пользовательских таблицах.
* `DB_DATAREADER` — пользователь с правом на чтение. Пользователи, обладающие этой ролью, могут считывать все данные из всех пользовательских таблиц.
* `DB_DENYDATAWRITER` — пользователь без права на запись. Пользователи, обладающие этой ролью, не могут добавлять, изменять или удалять данные в пользовательских таблицах базы данных.
* `DB_DENYDATAREADER` — пользователь без права на чтение. Пользователи, обладающие этой ролью, не могут считывать данные из пользовательских таблиц базы данных.
