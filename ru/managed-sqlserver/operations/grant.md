# Назначение привилегий и ролей пользователям

Атомарные полномочия в **{{ MS }}** называются _привилегиями_, группы полномочий — _ролями_. **{{ mms-name }}** поддерживает [предопределенные роли](#predefined-db-roles). Подробнее об организации прав доступа читайте [в документации {{ MS }}](https://docs.microsoft.com/ru-ru/sql/relational-databases/security/authentication-access/getting-started-with-database-engine-permissions?view=sql-server-2016).

Пользователь, создаваемый вместе с кластером **{{ mms-name }}**, автоматически получает роль владельца (`DB_OWNER`) первой базы данных в кластере. После этого вы можете [создавать других пользователей](cluster-users.md#adduser) и настраивать их права по своему усмотрению:
- [Изменить список ролей пользователя](#grant-role).
- [Выдать привилегию пользователю](#grant-privilege).
- [Отозвать привилегию у пользователя](#revoke-privilege).

## Изменить список ролей пользователя {#grant-role}

Для назначения **роли** пользователю используйте консоль управления или API {{ yandex-cloud }}: назначение роли запросом `GRANT` отменится при следующей операции с базой.

{% list tabs %}

- Консоль управления

  Чтобы изменить список ролей пользователя:
  1. Перейдите на страницу каталога и выберите сервис **{{ mms-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) и выберите пункт **Настроить**.
  1. При необходимости добавьте пользователю нужные базы данных:
     1. Нажмите кнопку **Добавить базу данных**.
     1. Выберите базу данных из выпадающего списка.
     1. Повторите два предыдущих шага, пока не будут выбраны все требуемые базы данных.
     1. Чтобы отозвать доступ к определенной базе, удалите ее из перечня, нажав значок ![image](../../_assets/cross.svg) справа от имени базы данных.
  1. Задайте нужные роли пользователя для каждой из баз данных пользователя:
     1. Нажмите значок ![image](../../_assets/plus-sign.svg) в столбце **Роли**.
     1. Выберите роль, которую вы хотите добавить пользователю из выпадающего списка.
     1. Повторите два предыдущих шага, пока не будут добавлены все требуемые роли.
  1. Чтобы отозвать роль, нажмите значок ![image](../../_assets/cross.svg) справа от ее имени.
  1. Нажмите кнопку **Сохранить**.

- API

  Воспользуйтесь методом API `update` и передайте в запросе:
  - Идентификатор кластера, в котором находится пользователь в параметре `clusterId`. Чтобы узнать идентификатор, [получите список кластеров в каталоге](cluster-list.md#list-clusters).
  - Имя пользователя в параметре `userName`. Чтобы узнать имя, [получите список пользователей в кластере](cluster-users.md#list-users).
  - Имя базы данных, для которой вы хотите изменить список ролей пользователя в параметре `permissions.databaseName`. Чтобы узнать имя, [получите список баз данных в кластере](databases.md#list-db).
  - Массив нового списка ролей пользователя в параметре `permissions.roles`.
  - Список полей конфигурации пользователя подлежащих изменению (в данном случае — `permissions`) в параметре `updateMask`.

  {% note warning %}

  Этот метод API сбросит все настройки пользователя, которые не были явно переданы в запросе, на значения по умолчанию. Чтобы избежать этого, обязательно передайте название поля подлежащего изменению (в данном случае — `permissions`) в параметре `updateMask`.

  {% endnote %}

{% endlist %}

## Выдать привилегию пользователю {#grant-privilege}

1. [Подключитесь](connect.md) к базе данных с помощью учетной записи владельца базы данных.
2. Выполните команду `GRANT`. Подробное описание синтаксиса команды смотрите в [документации {{ MS }}](https://docs.microsoft.com/ru-ru/sql/t-sql/statements/grant-transact-sql?view=sql-server-2016).

**Примеры:**

1. Выдать пользователю `user2` права на чтение таблицы `Products` в схеме по умолчанию `dbo`:

    ```
    GRANT SELECT ON dbo.Products TO user2;
    GO
    ```

1. Выдать пользователю `user2` права на чтение и запись в схему `myschema`:

    ```
    GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA::myschema TO user2;
    GO
    ```

## Отозвать привилегию у пользователя {#revoke-privilege}

1. [Подключитесь](connect.md) к базе данных с помощью учетной записи владельца базы данных.
2. Выполните команду `REVOKE`. Подробное описание синтаксиса команды смотрите в [документации {{ MS }}](https://docs.microsoft.com/ru-ru/sql/t-sql/statements/revoke-transact-sql?view=sql-server-2016).

**Примеры:**

1. Отозвать у пользователя `user2` права на чтение таблицы `Products` в схеме по умолчанию `dbo`:

    ```
    REVOKE SELECT ON dbo.Products FROM user2;
    GO
    ```

1. Отозвать у пользователя `user2` права на чтение всех таблиц схемы `myschema` и права доступа ко всем объектам схемы `myschema`:

    ```
    REVOKE SELECT, INSERT, UPDATE, DELETE ON SCHEMA::myschema FROM user2;
    GO
    ```

## Описание предопределенных ролей {#predefined-db-roles}

  - `DB_OWNER` — владелец базы данных. Пользователи, обладающие этой ролью, могут выполнять все действия по настройке и обслуживанию базы данных, удалять базу данных в {{ MS }}.
  - `DB_SECURITYADMIN` — администратор безопасности. Пользователи, обладающие этой ролью, могут управлять привилегиями. Имеют возможность повышать собственные права доступа, поэтому необходимо отслеживать их действия.
  - `DB_ACCESSADMIN` — администратор доступов. Пользователи, обладающие этой ролью, могут выдавать или отзывать права удаленного доступа к базе данных для пользователей и групп Windows и пользователей {{ MS }}.
  - `DB_BACKUPOPERATOR` — оператор резервных копий. Пользователи, обладающие этой ролью, могут создавать резервные копии базы данных.
  - `DB_DDLADMIN` — администратор DDL. Пользователи, обладающие этой ролью, могут выполнять любые команды языка описания данных (DDL).
  - `DB_DATAWRITER` — пользователь с правом на запись. Пользователи, обладающие этой ролью, могут добавлять, удалять или изменять данные во всех пользовательских таблицах.
  - `DB_DATAREADER` — пользователь с правом на чтение. Пользователи, обладающие этой ролью, могут считывать все данные из всех пользовательских таблиц.
  - `DB_DENYDATAWRITER` — пользователь без права на запись. Пользователи, обладающие этой ролью, не могут добавлять, изменять или удалять данные в пользовательских таблицах базы данных.
  - `DB_DENYDATAREADER` — пользователь без права на чтение. Пользователи, обладающие этой ролью, не могут считывать данные из пользовательских таблиц базы данных.
