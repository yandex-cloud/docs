# Резервные копии

{{ mms-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных. Резервные копии занимают место в объеме хранилища, выделенном для кластера. Если суммарный объем данных и резервных копий превышает объем хранилища, превышение [тарифицируется](../pricing.md).

Резервная копия автоматически создается раз в день. Отключить автоматическое создание резервной копии невозможно, и изменить промежуток хранения автоматических копий (по умолчанию 7 дней) пока тоже нельзя.

Время начала резервного копирования задается при создании или изменении кластера. Резервное копирование начнется в течение получаса от указанного времени. По умолчанию начало резервного копирования устанавливается на 22:00 UTC (Coordinated Universal Time).

{{ mms-name }} поддерживает восстановление состояния кластера на заданный момент времени (Point-in-Time Recovery, PITR) между завершением создания самой старой полной резервной копии и архивацией самого свежего журнала транзакций (transaction log). Это достигается за счет дополнения резервной копии, выбранной в качестве начальной точки для восстановления, записями из журнала транзакций кластера. Этот журнал архивируется в работающем кластере каждые 20 минут. Подробнее о PITR см. в [документации {{ MS }}](https://docs.microsoft.com/ru-ru/sql/relational-databases/backup-restore/restore-a-sql-server-database-to-a-point-in-time-full-recovery-model?view=sql-server-2016).

Чтобы восстановить кластер из резервной копии, [следуйте инструкциям](../operations/cluster-backups.md).

{% note warning %}

Вы не можете с помощью команд SQL изменять [модель восстановления](https://docs.microsoft.com/ru-ru/sql/relational-databases/backup-restore/recovery-models-sql-server?view=sql-server-2016) для операций резервного копирования и восстановления.

{% endnote %}

## Создание резервной копии {#size}

Резервные копии могут быть автоматическими и ручными, но вне зависимости от типа, резервные копии создаются по следующей схеме:

- Первая и каждая седьмая резервные копии — полные резервные копии всех баз данных.
- Остальные резервные копии — инкрементные, хранится только разница с предыдущей резервной копией, что позволяет экономить хранилище.

После создания резервная копия сжимается для дальнейшего хранения. На текущий момент отображение точного размера резервной копии недоступно.

## Хранение резервной копии {#storage}

Резервные копии хранятся во внутреннем хранилище Яндекса в виде бинарных файлов и шифруются с помощью [GMS](https://ru.wikipedia.org/wiki/GnuMS). У каждого кластера свои ключи шифрования.

Все резервные копии (автоматические и ручные) хранятся 7 дней. Чтобы гарантированно восстановиться на автоматическую резервную копию семидневной давности, может храниться до двух полных резервных копий.

## Проверка резервной копии {#verify}

### Проверка целостности резервной копии {#integrity}

Целостность резервных копий проверяется на синтетических данных интеграционными тестами сервиса. Резервные копии пользовательских кластеров на текущий момент не проверяются.

### Проверка восстановления из резервной копии {#capabilities}

Для проверки возможностей резервного копирования [восстановите кластер из резервной копии](../operations/cluster-backups.md) и проверьте целостность ваших данных.
