---
title: Резервные копии {{ MS }}
description: {{ mms-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных SQL Server. Резервная копия автоматически создается раз в день. Время начала резервного копирования задается при создании или изменении кластера СУБД MS SQL Server.
keywords:
  - бекап
  - backup
  - резервное копирование
  - резервное копирование {{ MS }}
  - backup {{ MS }}
  - ms sql server
  - {{ MS }}
---

# Резервные копии

{{ mms-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных.

{{ mms-name }} позволяет восстановить состояние кластера _на любой момент времени_ (Point-in-Time-Recovery, PITR) после создания самой старой резервной копии до момента, когда был заархивирован самый свежий журнал транзакций (Transaction Log). Это достигается за счет дополнения данных резервной копии, выбранной в качестве начальной точки для восстановления, записями из журнала транзакций кластера.

При создании резервных копий и восстановлении из них на заданный момент времени учитывайте, что:

* Журнал транзакций архивируется в работающем кластере каждые 20 минут, после чего загружается в объектное хранилище.

* На создание и загрузку архива журнала транзакций в объектное хранилище требуется некоторое время. Из-за этого состояние кластера, хранящееся в объектном хранилище, может отличаться от реального.

Подробнее о PITR см. в [документации {{ MS }}](https://docs.microsoft.com/ru-ru/sql/relational-databases/backup-restore/restore-a-sql-server-database-to-a-point-in-time-full-recovery-model?view=sql-server-2016).

Чтобы восстановить кластер или отдельную базу данных из резервной копии, [следуйте инструкциям](../operations/cluster-backups.md).

{% note warning %}

Вы не можете с помощью команд SQL изменять [модель восстановления](https://docs.microsoft.com/ru-ru/sql/relational-databases/backup-restore/recovery-models-sql-server?view=sql-server-2016) для операций резервного копирования и восстановления.

{% endnote %}

## Создание резервной копии {#size}

Резервные копии могут быть созданы автоматически и вручную, в обоих случаях создается полная резервная копия всех баз данных.

Резервная копия всех данных кластера автоматически создается раз в день. Отключить автоматическое создание резервной копии невозможно. Однако при [создании](../operations/cluster-create.md) или [изменении](../operations/update.md#change-additional-settings) кластера для таких резервных копий можно задать время начала резервного копирования. По умолчанию время начала — 22:00 UTC (Coordinated Universal Time). Резервное копирование начнется в течение получаса от указанного времени.

После создания резервная копия сжимается для дальнейшего хранения. Отображение точного размера резервной копии недоступно.

Резервные копии создаются только на работающих кластерах. Если вы используете кластер {{ mms-short-name }} не круглосуточно, проверьте [настройки времени начала резервного копирования](../operations/update.md#change-additional-settings).

О том, как вручную создать резервную копию, читайте в разделе [{#T}](../operations/cluster-backups.md).

## Хранение резервной копии {#storage}

Особенности хранения резервных копий в {{ mms-name }}:

* Резервные копии хранятся во внутреннем хранилище Яндекса в виде бинарных файлов.

* Резервные копии существующего кластера, созданные автоматически, хранятся 7 дней, а созданные вручную — бессрочно. После удаления кластера все его резервные копии хранятся 7 дней.

* {% include [no-quotes-no-limits](../../_includes/mdb/backups/no-quotes-no-limits.md) %}

* {% include [using-storage](../../_includes/mdb/backups/storage.md) %}

    Подробнее см. в разделе [Правила тарификации для {{ mms-name }}](../pricing/index.md#rules-storage).

## Проверка резервной копии {#verify}

### Проверка целостности резервной копии {#integrity}

Целостность резервных копий проверяется на синтетических данных интеграционными тестами сервиса.

### Проверка восстановления из резервной копии {#capabilities}

Для проверки возможностей резервного копирования [восстановите кластер из резервной копии](../operations/cluster-backups.md#restore-cluster) и проверьте целостность ваших данных.


## Экспорт резервной копии базы данных в {{ objstorage-full-name }} и восстановление из нее {#send-to-objstorage}

Сервис поддерживает экспорт резервных копий баз данных в бакеты [{{ objstorage-name }}](../../storage/index.yaml), а также восстановление баз данных из них. В обоих случаях к кластеру должен быть привязан [сервисный аккаунт](../../iam/concepts/users/service-accounts) с правами на доступ к бакету.

Резервная копия экспортируется в незашифрованном виде, поэтому для бакета рекомендуется выставить ограниченный доступ. Хранящаяся в {{ objstorage-name }} резервная копия, из которой будет восстановлена база данных, также не должна быть зашифрована.

О том, как экспортировать резервную копию в бакет {{ objstorage-name }} или восстановить базу данных из резервной копии, хранящейся в бакете, читайте в разделе [{#T}](../../managed-sqlserver/operations/cluster-backups.md).

