# Подготовить внешнее приложение

Чтобы {{ tracker-name }} мог обмениваться данными с приложением, необходимо настроить сетевой доступ и аутентификацию.

Чтобы в {{ tracker-name }} была доступна расширенная функциональность связей с вашим приложением, например отображение подробной информации о связанных объектах или создание связей во внешнем приложении по запросу из {{ tracker-name }}, нужно реализовать поддержку этих возможностей в приложении.

## Сетевой доступ {#network}

{% if audience == "external" %}

Ваше приложение должно быть доступно по публичному адресу через интернет. 

{% else %}

[Закажите доступ](https://puncher.yandex-team.ru/) из подсетей {{ tracker-name }} до домена вашего приложения:

- Источник в тестинге `_STARTREK_API_TESTING_NETS_`

- Источник в проде `_STARTREK_API_PRODUCTION_NETS_`

{% endif %}

## Аутентификация {#auth}

Для аутентификации запросов из {{ tracker-name }} к внешнему приложению можно использовать один из вариантов:

- Без аутентификации 

- OAuth

  В заголовке передается токен пользователя, от имени которого выполняется запрос к приложению.

  {% if audience == "internal" %}

	{% note alert %}

	Не рекомендуем использовать аутентификацию через OAuth. Это допустимо только для неподдерживаемых приложений.

	{% endnote %}

- TVM

 	В заголовке запроса передается сервисный тикет [TVM](https://wiki.yandex-team.ru/passport/tvm2/). Если вы выберете этот способ аутентификации, в вашем приложении добавьте разрешения для {{ tracker-name }}: 176 — прод {{ tracker-name }}, 177 — тестинг {{ tracker-name }}.

 	{% endif %}

## Получение информации о связанном объекте {#object-info}

Чтобы отображать в интерфейсе {{ tracker-name }} подробную информацию о связанном объекте, приложение должно передавать эту информацию по запросу:

- Метод: GET

- URL: `scheme://host:port*not_var{{remoteKey}}*`

	где
	- `remoteKey` — ключ связанного объекта в приложении;
	- `*` — любая последовательность символов.

	Например: `https://my-app.ru:8080/1234/info`

Ожидаемый формат ответа: список параметров в формате JSON

 Параметр | Тип | Описание
 -------- | -------- | ----------
 `key` | Строка | Ключ объекта. Обязательный.
 `summary` | Строка | Название объекта. Обязательный.
 `iconUrl` | Строка | URL иконки. Необязательный.<br/>Используется в том случае, если для объектов в определенном статусе нужно отображать другую иконку.
 `status` | Объект | Статус объекта. Необязательный.<br/>Содержит поля: <ul><li>`name` (строка) — название;</li><li>`description` (строка, необязательно) — описание.</li></ul>
 `resolution` | Объект |Резолюция. Необязательный.<br/>Содержит поля: <ul><li>`name` (строка) — название;</li><li>`description` (строка, необязательно) — описание.</li></ul>
 `assignee` |Объект| Исполнитель. Необязательный.<br/>Содержит поля:<ul><li>`trackerUid`(длинное целое число, необязательно) — идентификатор пользователя {{ tracker-name }};</li><li>`passportUid` (длинное целое число, необязательно) — идентификатор пользователя Яндекс ID (бывшего Паспорта);</li><li>`login` (строка, необязательно) — логин.</li></ul>
 `updated` | Строка | Дата и время обновления в формате `YYYY-MM-DDThh:mm:ss.sss±hhmm`. Необязательный.
 `deadline` | Строка | Дедлайн в формате `YYYY-MM-DDThh:mm:ss.sss±hhmm`. Необязательный.

## Создание связей в приложении по запросу из {{ tracker-name }} {#create}

Когда в {{ tracker-name }} создается связь с внешним объектом, {{ tracker-name }} может отправить в приложение запрос, чтобы создать в приложении дублирующую связь. Для этого приложение должно поддерживать создание связи по запросу:

- Метод: POST.

- URL: определяет разработчик приложения.

- Тело запроса: список параметров в формате JSON

    Параметр | Тип | Описание
    -------- | -------- | ----------
	`issueKey` | Строка | Ключ задачи в {{ tracker-name }}.
	`entityIds` | Массив строк | Идентификаторы объектов в приложении, связанных с задачей.

## Удаление связей в приложении по запросу из {{ tracker-name }} {#delete}

Когда в {{ tracker-name }} удаляется связь с внешним объектом, {{ tracker-name }} может отправить в приложение запрос, чтобы удалить эту связь из приложения. Для этого приложение должно поддерживать удаление связи по запросу:

- Метод: DELETE

- URL: `scheme://host:port*not_var{{issueKey}}*not_var{{remoteKey}}|not_var{{remoteKey}}*not_var{{issueKey}}*`

	где:

	- `issueKey` — ключ задачи в {{ tracker-name }};

	- `remoteKey` — ключ связанного объекта в приложении;

	- `*` — любая последовательность символов.

	Ключ задачи и ключ объекта могут быть указаны в любом порядке.

	Например: `https://my-app.ru:8080/links/?action=del&ticket=TEST-123&obj=1234`

{% if audience == "internal" %}

## Получение саджеста по объектам в приложении {#suggest}

Если в {{ tracker-name }} разрешено создавать связи с внешним приложением через пользовательский интерфейс, то при вводе текста в поле для указания связанного объекта можно предлагать пользователю саджест (подсказку). Для этого приложение должно передавать список объектов для саджеста по запросу:

- Метод: GET

- URL: `scheme://host:port*not_var{{suggestInput}}*`

	где
	- `suggestInput` — текст, введенный пользователем;
	- `*` — любая последовательность символов.

	Например: `https://my-app.ru:8080/suggest/?input=12`

{% endif %}