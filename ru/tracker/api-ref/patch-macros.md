# Редактировать макрос

Запрос позволяет изменить параметры макроса.

## Формат запроса {#section_a32_zrg_sfb}

Чтобы изменить параметры макроса, используйте HTTP-запрос с методом `PATCH`:

```json
PATCH /{{ ver }}/queues/<queue-id>/macros/<macros-id>
Host: {{ host }}
Authorization: OAuth <токен>
{{ org-id }}

{
  "name": "Тестовый макрос 1",
  "body": "Тестовый комментарий\nnot_var{{currentDateTime}}\nnot_var{{issue.author}}",
  "fieldChanges": <Объект или массив>
}
```

{% include [headings](../_includes/tracker/api/headings.md) %}

#### Ресурс

- **\<queue-id\>**
  Идентификатор или ключ очереди. Ключ очереди чувствителен к регистру символов.

- **\<macros-id\>**
  Идентификатор макроса.



#### Параметры запроса {#body-req}

   Тело запроса содержит измененные параметры макроса.
   Параметр | Описание | Тип данных
   ----- | ----- | -----
   name | Название макроса. | Строка
   body | [Сообщение](manager/create-macroses.md), которое будет создано при выполнении макроса. Формат: ``` <Текст сообщение>\n<переменная> ```<br/>где:<ul><li> `<Текст сообщения>`— текст, который будет создан в поле **Комментарий** при выполнении макроса.</li><li>``\n`` — символ переноса строки.</li><li>Переменная, которая может содержать:<br/>`not_var{{currentUser}}` — имя пользователя, который выполнил макрос; <br/>`not_var{{currentDateTime.date}}` — дату выполнения макроса;<br/> `not_var{{currentDateTime}}` — дату и время выполнения макроса;<br/> `{{issue.<ключ_поля>}}` — ключ поля задачи, значение которого отразится в сообщении. Полный список полей задачи: [https://tracker.yandex.ru/admin/fields]({{ link-admin-fields }})</li></ul>Чтобы удалить сообщение, используйте конструкцию `"body": {"unset":1}` | Строка
   fieldChanges | Объект или массив с информацией о новых настройках действий макроса. Структура объекта отличается в зависимости от типа [изменений](#dl_qnp_vhm_5fb). | Объект или массив.
 
**Структура объекта** `fieldChanges` {#fieldChanges}

{% list tabs %}

- Добавить действие

  Добавить действие макроса. Параметр `add` позволяет добавить поле и его значение в список имеющихся.
    ```json
    "fieldChanges": {
          "add": [
                   {
              "field": "tags", 
              "value": "tag2"
                   },
                    ...
                  ]
    ```
  **Тело запроса**
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [fieldChanges](#fieldChanges) | Объект с информацией о новых настройках действий макроса. | Объект

  **Объект массива** `fieldChanges` {#fieldChanges}
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [add](#add) | Массив с информацией о параметрах нового действия макроса. | Массив

  **Объекты массива** `add` {#add}
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  field | Идентификатор поля задачи.<br/><br/>[Полный список полей задачи]({{ link-admin-fields }}) | Строка
  value | Значение поля задачи. | Строка

- Заменить действие

  Заменить действие макроса на новое. Параметр `replace` позволяет заменить поле и его значение, заданные с помощью параметра `target` на новые, заданные с помощью параметра `replacement`.
    ```json
    "fieldChanges": {
             "replace": [
                          {
                    "target": {
                        "field": "tags", 
                        "value": "tag2"
                              }, 
                    "replacement": {
                        "field": "originalEstimation", 
                        "value": "PT2H"
                                    }
                            }
                          ]
    }
    ```

  **Тело запроса**
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [fieldChanges](#fieldChanges) | Объект с информацией о новых настройках действий макроса. | Объект

  **Параметры объекта** `fieldChanges` {#fieldChanges}
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [replace](#replace) | Массив с информацией о параметрах действия, которые нужно заменить на новые. | Массив

  **Массив объекта** `replace` {#replace}
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [target](#target-replacement) | Объект с информацией о параметрах действия, которые нужно заменить. | Объект
  [replacement](#target-replacement) | Объект с информацией о новых параметрах действия. | Объект

  **Параметры объектов** `target` и `replacement` {#target-replacement}
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  field | Идентификатор поля задачи.<br/><br/>[Полный список полей задачи]({{ link-admin-fields }}) | Строка
  value | Значение поля задачи. | Строка

- Заменить все действия

  Заменить все действия макроса на новые. Сохранятся только те поля и значения, которые указаны в массиве.

    ```json
    "fieldChanges": [
                              {
                 "field": "tags", 
                 "value": "tag2"
                              },
                              ...
    ]
    ```

  **Тело запроса**
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [fieldChanges](#fieldChanges) | Объект или массив с информацией о новых настройках действий макроса. | Объект или массив.

  **Параметры массива** `fieldChanges`{#fieldChanges}
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  field | Идентификатор поля задачи.<br/><br/>[Полный список полей задачи]({{ link-admin-fields }}) | Строка
  value | Значение поля задачи. | Строка

- Удалить действие

  Удалить действие макроса. Параметр `replace` позволяет удалить поле и его значение.

    ```json
    "fieldChanges": {
             "remove": [ 
                        {
                      "field": "tags", 
                      "value": "tag2"
                         },
                          ...
                        ]
    }
    ```

  **Тело запроса**
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [fieldChanges](#fieldChanges) | Объект с информацией о новых настройках действий макроса. | Объект

  **Поле объекта** `fieldChanges`
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  [remove](#remove) | Массив с информацией о полях и значениях действия макроса, которые нужно удалить. | Массив

  **Параметры массива** `remove` {#remove}
  Параметр | Описание | Тип данных
  ----- | ----- | -----
  field | Идентификатор поля задачи.<br/><br/>[Полный список полей задачи]({{ link-admin-fields }}) | Строка
  value | Значение поля задачи. | Строка

{% endlist %}

## Формат ответа {#section_evq_j5l_sfb}

{% list tabs %}

- Запрос выполнен успешно
  
  В случае успешного выполнения запроса API возвращает ответ с кодом 200. Тело ответа содержит JSON-объект со всеми параметрами макроса, включая измененные.

    ```json
      {
        "self": "{{ host }}/v2/queues/TEST/macros/3",
        "id": 3,
        "queue": {
          "self": "{{ host }}/v2/queues/TEST", 
          "id": "1",
          "key": "TEST",
          "display": "Тестовая очередь"
           },
        "name": "Тестовый макрос 1",
        "body": "Тестовый комментарий\nnot_var{{currentDateTime}}\nnot_var{{issue.author}}",
        "fieldChanges": [
          {
            "field": {
               "self": "{{ host }}/v2/fields/tags", 
               "id": "tags",
               "display": "Теги"
              },
            "value": [
                    "tag1"
                     ]
          },
           ...
        ]
      }
    ```

    #### Параметры ответа {#answer-params}
    Параметр | Описание | Тип данных
    ----- | ----- | -----
    self | Адрес ресурса API, который содержит параметры макроса. | Строка
    id | Идентификатор макроса. | Число
    [queue](#queue) | Объект с информацией об очереди, к задачам которой применяется макрос. | Объект
    name | Название макроса. | Строка
    body | [Сообщение](manager/create-macroses.md), которое будет создано при выполнении макроса. Формат: ``` <Текст сообщение>\n<переменная> ```<br/>где:<ul><li> `<Текст сообщения>`— текст, который будет создан в поле **Комментарий** при выполнении макроса.</li><li> ``\n`` — символ переноса строки.</li><li> Переменная, которая может содержать:<br/>`not_var{{currentUser}}` — имя пользователя, который выполнил макрос;<br/> `not_var{{currentDateTime.date}}` — дату выполнения макроса; <br/>`not_var{{currentDateTime}}` — дату и время выполнения макроса;<br/>`{{issue.<ключ_поля>}}` — ключ поля задачи, значение которого отразится в сообщении. Полный список полей задачи: [https://tracker.yandex.ru/admin/fields]({{ link-admin-fields }})</li></ul>Чтобы удалить сообщение, используйте конструкцию `"body": {"unset":1}` | Строка
    [fieldChanges](#fieldChanges) | Массив с информацией о полях задачи, изменения которых запустит макрос. | Массив объектов

    **Поля объекта** `queue` {#queue}
    Параметр | Описание | Тип данных
    ----- | ----- | -----
    self | Адрес ресурса API, который содержит информацию об очереди. | Строка
    id | Идентификатор очереди. | Строка
    key | Ключ очереди. | Строка
    display | Отображаемое название очереди. | Строка

    **Объекты массива** `fieldChanges` {#fieldChanges}
    Параметр | Описание | Тип данных
    ----- | ----- | -----    
    [field](#field) | Объект с информацией о поле задачи. | Объект
    value | Массив со значениями поля задачи. | Массив объектов

    **Поля объекта** `field` {#field}
    Параметр | Описание | Тип данных
    ----- | ----- | ----- 
    self | Адрес ресурса API, который содержит информацию о поле задачи. | Строка
    id | Идентификатор поля задачи. | Строка
    display | Отображаемое название поля задачи. | Строка

- Запрос выполнен с ошибкой

  Если запрос не был успешно обработан, ответное сообщение содержит информацию о возникших ошибках:
    HTTP-код ошибки | Описание ошибки
    ----- | -----
    `400 Bad Request` | Один из параметров запроса имеет недопустимое значение или формат данных.
    `403 Forbidden` | У пользователя или приложения нет прав на доступ к ресурсу, запрос отклонен.
    `404 Not Found` | Запрашиваемый ресурс не найден.
    `422 Unprocessable Entity` | Ошибка валидации JSON, запрос отклонен.
    `500 Internal Server Error` | Внутренняя ошибка сервиса. Попробуйте повторно отправить запрос через некоторое время.
    `503 Service Unavailable` | Сервис API временно недоступен.

{% endlist %}