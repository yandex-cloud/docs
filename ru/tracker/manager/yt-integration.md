# Выгрузка очереди задач в YT

Очереди задач из {{ tracker-name }} можно выгружать в [YT](https://yt.yandex-team.ru/docs/) — сервис распределенного хранения и обработки больших объемов данных. Это может пригодиться, например, для построения аналитики в {{ datalens-name }}.

Выгрузку очереди заказывает ее владелец через специальную форму. Синхронизация выгруженной очереди в YT с очередью в {{ tracker-name }} происходит один раз в час. Выгружаются все задачи очереди, даже задачи с ограниченным доступом.

## Представление данных {#data-format}

Выгруженная очередь доступна в кластере HAHN, в каталоге [home/startrek/tables/prod/yandex-team](https://yt.yandex-team.ru/hahn/navigation?path=//home/startrek/tables/prod/yandex-team). В нем есть два подкаталога:
* **queue** — список очередей, для которых заказали выгрузки. Внутри каждой такой очереди содержатся таблицы с сущностями очереди:
    * ##comments##
    * ##components##
    * ##issue_events##
    * ##issues##
    * ##projects##
    * ##schema_version##
    * ##versions##
    * ##worklogs##

* **common** — список сущностей, общих для всех очередей в {{ tracker-name }}:
    * ##csi_results##
    * ##priorities##
    * ##resolutions##
    * ##schema_version##
    * ##sprints##
    * ##statuses##
    * ##survey_results##
    * ##surveys##
    * ##types##
    * ##users##

В каждой таблице используются уникальные идентификаторы `id`, которые являются первичными ключами. Если в каком-то из полей содержимое представлено в виде хэша, то само значение хранится в другой таблице. Чтобы узнать его, необходимо выполнить запрос с помощью оператора ##JOIN## и в качестве значения `id` использовать этот хэш.

## Права доступа {#access-rights}

Выгрузкой очередей в YT и поддержкой их в актуальном состоянии занимаются сотрудники команды STARTREK. Только у них есть право записи в таблицы YT и право на удаление данных.

Роль `read-approver` выдается владельцу выгружаемой очереди и позволяет ему подтверждать права на чтение для отдельных сотрудников.

{% note alert %}

Владелец очереди должен ответственно подходить к выдаче прав на чтение, поскольку выгружаются все задачи очереди, даже с ограниченным доступом.

{% endnote %}

Право на чтение можно запрашивать через IDM, а подтвердить роль должен владелец очереди. Право на чтение позволяет просматривать таблицы очереди в кластере HAHN.

{% note tip %}

Если у очереди нет владельца (например, он уволился), необходимо назначить нового. Это может сделать представитель команды очереди с [правом редактирования настроек](queue-access.md). Если такого представителя нет, обратитесь в [службу поддержки](../troubleshooting.md) и назначьте нового владельца. Для этого в форме выберите пункты:
* Область вопроса\проблемы — Очереди \ Queues.
* Тип обращения — Доступ \ Access.

{% endnote %}

## Как заказать выгрузку {#order-rollout} 

Выгрузку очереди запрашивают через [форму](https://forms.yandex-team.ru/surveys/13669/). В форме необходимо перечислить ключи очередей, для которых вы заказываете выгрузку.

Очереди выгружаются в кластер HAHN, каждую очередь можно выгрузить только в отдельную папку. По умолчанию все тексты, например, описания и комментарии в задачах, будут замаскированы значками #.

По согласованию со службой безопасности маскирование можно отключить. Если вы выберете такую опцию, прямо из формы будет создана задача в очереди DATAAPROVE, а ваша очередь будет выгружена в YT только после завершения этой задачи.

{% note info %}

Очереди, в задачах которых используются персональные данные, нельзя выгружать даже в замаскированном виде.

{% endnote %}