# ОК

Чтобы провести согласование в задаче {{ tracker-name }}, используйте сервис ОК. С помощью этого сервиса в комментарии к задаче можно задать вопрос и собрать голоса (ОКи) заинтересованных пользователей. Список согласующих и их ответы увидят все сотрудники, у которых есть доступ к задаче.

## Создать согласование {#create_ok}

1. Убедитесь, что у робота `robot-ok` есть [доступ на редактирование задач](queue-access.md) в очереди, в которой вы будете проводить согласование. Доступ нужен для изменения поля <q>Статус согласования</q> и для добавления согласующих в поле <q>Доступ</q>.

1. В комментарий к задаче скопируйте текст:
    ```
    {{iframe src="https://ok.yandex-team.ru/tracker?_embedded=1&author=<логин>&object_id=<ключ_задачи>&uid=00001" frameborder=0 width=100% height=400px scrolling=no}}
    ```

1. В тексте комментария укажите: 
    - Значение параметра `author` — ваш логин.
    - Значение параметра `object_id` — ключ задачи, в которой вы создаете согласование.
    - В качестве значения `uid` можно указать любую строку. Она должна быть уникальна среди всех согласований в текущей задаче.

    {% note tip %}

    Чтобы в следующий раз заново не настраивать согласование, можно [создать макрос](#macros) и использовать его в любой задаче очереди.

    {% endnote %}

1. Нажмите **Отправить**. В комментарии появится пустая форма согласования.

1. Заполните форму согласования:
    - Опишите предмет согласования.
    - Укажите участников согласования. Порядок важен: уведомления о согласовании приходят последовательно каждому участнику после того, как проголосовал предыдущий.
        Напротив имени участника отображается календарь его отсутствия на неделе.

        {% note warning %}

        Голосовать могут только те сотрудники, у которых есть [доступ к задаче](../user/ticket-access.md).

        {% endnote %}

    - Для создания группы согласующих нажмите **Добавить группу** и укажите участников.
        По умолчанию для согласования достаточно получить ОК хотя бы от одного участника группы. Если требуется получить согласование от каждого участника группы, выберите **Подтверждение от всех**.
    - Чтобы участники могли голосовать в любом порядке, выберите **Параллельное согласование**.
    - Чтобы добавить возможность ответить на согласование отказом, выберите **Разрешить "Не ОК"**.

1. Нажмите **Создать согласование**.

## Как голосовать {#vote}

- После создания согласования каждый участник получит письмо от робота с просьбой прийти в задачу и проголосовать.
    
    {% note info %}

    Робот будет присылать напоминание один раз в день до тех пор, пока участник не проголосует. Если в течение трех дней реакция от согласующего не поступила, дополнительно уведомляется автор согласования.

    {% endnote %}

- В комментарии к задаче участник видит статус согласования и может проголосовать **ОК** или **Не ОК**.
- В случае, если получен отказ хотя бы одного из участников, робот отправит письмо автору согласования. 
- Автор согласования имеет право проголосовать за любого из участников.

## Настроить макрос {#macros}

Если вы часто проводите согласования с одинаковыми параметрами, настройте в очереди [макрос](create-macroses.md) с кодом для запуска согласования. Например:

```
{{iframe src="https://ok.yandex-team.ru/tracker?_embedded=1&author=<%currentUser.login%>&object_id=<%issue.key%>&uid=<%currentDateTime.iso8601%>&text=Согласуй, пожалуйста&users=<user_login>&users=<user_login2>" frameborder=0 width=100% height=400px scrolling=no}}
```

В коде согласования можно использовать дополнительные параметры:

- `text=любой текст` — текст согласования;
- `users=login1&users=login2&...` — логины участников согласования;
- `groups=yandex&groups=svc_ok&groups=salary-hr...` — [список групп Staff API](https://staff-api.yandex-team.ru/v3/groups?_doc=1), сотрудники-участники которых получают доступ к запуску и остановке согласования. Поддерживаются типы групп: `department, service, servicerole, wiki`.

    {% note info %}

    Участники добавленных групп не получают уведомлений о согласовании.

    {% endnote %}

- `is_parallel=true|false` — признак параллельного согласования.
- `is_reject_allowed=true|false` — признак реакции **Не ОК** в согласовании.