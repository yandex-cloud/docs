# Мониторинг сервисов {{ sk-hybrid-name }}

{{ sk-hybrid-name }} собирает и хранит метрики в формате [Prometheus](https://prometheus.io). Подробнее о типах метрик см. в [документации Prometheus](https://prometheus.io/docs/concepts/metric_types/).

Метрики сервисов {{ sk-hybrid-name }} доступны по URL-адресу:

```text
<IP-адрес>:17002/metrics/prometheus
```

Где:

* `<IP-адрес>` — IP-адрес сервиса {{ sk-hybrid-name }} в вашей сети.

## Общие метрики {{ sk-hybrid-name }} {#metrics}

| Метрика       | Тип     | Описание                                                                                                                                                                                                                                            |
|:--------------|:--------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `grpc_code_*` | COUNTER | Количество ответов с определенным кодом протокола gRPC. Каждому коду соответствует отдельная метрика: `grpc_code_ok`, `grpc_code_canceled` и т. д. Список кодов см. в [документации gRPC](https://grpc.github.io/grpc/core/md_doc_statuscodes.html) |

## Метрики синтеза речи {#tts-metrics}

| Метрика             | Тип       | Описание                                                                                               |
|:--------------------|:----------|:-------------------------------------------------------------------------------------------------------|
| `synthesis_sps`     | GAUGE     | Количество секунд синтезированного текста, которое генерируется за секунду работы {{ sk-hybrid-name }} |
| `synthesis_latency` | HISTOGRAM | Гистограмма времени ответа сервиса в миллисекундах                                                     |

## Метрики распознавания речи {#stt-metrics}

| Метрика              | Тип       | Описание                                                                                                                                                                                |
|:---------------------|:----------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `in_flight_requests` | GAUGE     | Количество активных сессий                                                                                                                                                              |
| `recognize_sps`      | GAUGE     | Количество миллисекунд распознанной речи, которое было обработано за секунду работы {{ sk-hybrid-name }}                                                                                |
| `recognize_rtf`      | HISTOGRAM | Гистограмма распределения величины [Real Time Factor](https://devopedia.org/speech-recognition), равной процентному отношению времени распознавания к длительности распознаваемой речи |

## Мониторинг производительности {#productivity-monitor}

Чтобы следить за производительностью {{ sk-hybrid-name }}, определите целевые значения метрик:

* `synthesis_sps` — требуемое количество секунд синтезированного текста в секунду.
* `recognize_sps` – требуемое количество миллисекунд распознанной речи в секунду.
* `synthesis_latency` – допустимая задержка ответа приложения синтеза речи.
* `recognize_rtf` — допустимое процентное отношение времени распознавания к длительности распознаваемого текста. Рекомендуется значение `100`, т. к. большее значение означает, что сервер не справляется с потоком запросов.

Настройте мониторинг метрик так, чтобы отслеживать их отклонение в худшую сторону относительно установленных целевых значений:

* для метрик SPS – снижение;
* для остальных метрик — превышение.
