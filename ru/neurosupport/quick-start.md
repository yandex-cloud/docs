---
noIndex: true
---

# Нейросаппорт

## О сервисе {#about}

Нейросаппорт — суфлер подсказок на основе базы знаний, специализированный под домен технической поддержки. Выдает рекомендации в реальном времени и естественной языковой манере. Может использоваться для генерации подсказок оператору поддержки или в качестве внутреннего помощника для сотрудников.

Нейросаппорт генерирует рекомендацию, как ответить на диалог или запрос, используя:

- текущую реплику клиента или историю диалога с ним;
- метаданные о контексте ситуации;
- релевантные статьи и инструкции из базы знаний.

![quick-start-infograph1](../_assets/neurosupport/quick-start-infograph1.svg)


## Получение доступа {#get-access}

Для получения доступа необходимо быть зарегистрированным в [Облаке](https://yandex.cloud).

Запрос на предоставление доступа подается через [форму](https://yandex.cloud/ru/services/neurosupport) с указанием [ID Облака](../resource-manager/operations/cloud/get-id.md).

Для начала использования требуется:

1. Получить [ID Облака](../resource-manager/operations/cloud/get-id.md).

1. Получить [ID организации](../organization/operations/organization-get-id.md).

1. Создать [каталог](../resource-manager/operations/folder/create.md).

1. Создать [Service Account](../iam/operations/sa/create.md) и выдать роли&nbsp;— `editor` и `search-api.webSearch.user` по [инструкции](../iam/operations/sa/assign-role-for-sa.md).

1. Получить токен для запросов в API, для этого:

   1. Установить консольную утилиту [yc](../cli/quickstart.md).
   1. Выполнить в консоли команду `yc init`, указав необходимые идентификаторы.

1. Получить IAM-токен по [инструкции](../iam/operations/iam-token/create-for-sa.md#via-cli).

1. Проверить доступ к API. Адрес: [https://supportgpt.{{ api-host }}](https://supportgpt.{{ api-host }}).

   Пример запроса (с генерацией токена):
   
   ```bash
   IAM_TOKEN=$(yc iam create-token)
   FOLDER_ID="${1:-<ваш folder ID>}"
   curl -H "Authorization: Bearer ${IAM_TOKEN}" -H "x-folder-id: ${FOLDER_ID}" -X GET https://supportgpt.{{ api-host }}/indexer/v1/indexes
   ```

1. Убедиться, что по итогам обработки запроса вам передали параметры для обращения к API:

   - сервис (service);
   - продукт (product);
   - префикс для создания индексов.

При возникновении вопросов добавляйтесь в [общий чат технической поддержки](https://t.me/neurosupport_api).


## Интеграция {#integration}

Нейросаппорт работает только по API. Логику вызовов API, конкретный состав передаваемых данных, логику использования результата вам требуется определить на своей стороне, в частности:

1. По запросу подсказки:

   - запрашивать всегда или по событию (действию пользователя);
   - по каким диалогам запрашивать;
   - в какой момент запрашивать;
   - какую часть диалога / данных к диалогам передавать;
   - по каким документам разрешать отвечать Нейросаппорту.

1. По отображению подсказки на своей стороне:

   - где в UI показывать подсказку;
   - показывать только подсказку или в дополнение ссылки на документы, по которым она сгенерировалась;
   - показывать подсказку как рекомендацию, которую можно опционально применить, или сразу вставлять полученный текст в блок ответа (его можно отредактировать перед отправкой).

### Архитектура интеграции {#architecture}

Основные интеграционные потоки:

1. Первичная загрузка базы знаний.
1. Периодическое обновление базы знаний.
1. Передача информации для запроса подсказки (метаданные и диалог), получение ответа.

![](../_assets/neurosupport/quick-start-infograph2.svg)

### Описание структуры API {#api-structure}

{% cut "**Documents Post**" %}

Создание индекса или обновление существующего.

`https://supportgpt.{{ api-host }}/indexer/v1/indexes/{index_name}/documents`

Метод: `POST`.

- `index_name` — Строковое имя индекса (строка, обязательное).

Схема запроса (Request Body schema: `application/json`):

- `service` — Строковый идентификатор сервиса (строка, обязательное).
- `product` — Строковый идентификатор продукта (строка).
- `meta` — Метаинформация об индексе.
- `auto_switch` — Нужно ли сразу переключиться на новый индекс после добавления данных. При установке `false` для переключения есть отдельный запрос. При создании нового индекса, данные старого индекса на какое-то время остаются в базе (логическое значение).
- `index_version` — Опциональное поле для указания версии индекса. В случае отсутствия версия будет определена автоматически. Если указать ранее загруженную версию, на которую еще не было переключения, документы будут добавлены к этой версии. Для добавления документов в активную версию, на которую уже было переключение, используйте флаг `diff` (число).
- `documents` — Список документов для индексации (обязательное):
  - `doc_id` — Id документа, длина не более 255 символов (строка, обязательное).
  - `title` — Заголовок документа (строка, обязательное).
  - `text` — Текст документа (строка, обязательное).
  - `meta` — Дополнительные метаданные документа (эти метаданные заносятся в индекс в виде пар key-value в свободном формате).
- `diff` — Если `true`, то индекс будет создан на основе существующего, с добавкой переданных документов. При совпадении id документов информация будет заменена (логическое значение).

Схема ответа:

- `index_name` — Строковое имя индекса (строка, обязательное).
- `index_version` — Версия индекса, который был обновлен (строка, обязательное).
- `index_parent_version` — Если был выставлен флаг `diff`, то в этом поле будет версия родительского индекса, на основе которого был создан новый индекс (строка).

Пример запроса:

```json
{
  "service": "your_service",
  "product": "your_product",
  "meta": {
    "source": "исходный источник данных, зависит от клиента",
    "description": "описание индекса"
  },
  "auto_switch": true,
  "index_version": 1,
  "documents": [
    {
      "doc_id": "doc42",
      "title": "Инструкция по решению такой-то технической проблемы",
      "text": "Чтобы решить такую-то техническую проблему, надо предпринять такие-то действия",
      "meta": {
        "title": "заголовок документа",
        "source_id": "исходный источник документа такой-то",
        "some_another_key": "some_another_value"
      }
    }
  ],
  "diff": false
}
```

Пример ответа:

```json
{
  "index_name": "your_index_name",
  "index_version": 3,
  "index_parent_version": 2
}
```

{% endcut %}

{% cut "**Get Indexes List**" %}

Получение имен и метаданных всех индексов, на которые у пользователя есть права.

`https://supportgpt.{{ api-host }}/indexer/v1/indexes`

Метод: `GET`.

Схема запроса (Query params):

- `service` — Строковый идентификатор сервиса (строка).
- `product` — Строковый идентификатор продукта (строка).
- `page` — Номер страницы для постраничной загрузки (число).
- `size` — Количество записей на странице (число).

Схема ответа:

- `indexes` — Список общих данных об индексах, на которые у пользователя есть права (обязательное):
  - `index_id` — Числовой идентификатор индекса (число, обязательное).
  - `name` — Строковое имя индекса (строка, обязательное).
  - `current_version` — Текущая версия индекса, но основе которой делаются генеративные ответы (число).
  - `doc_count` — Общее количество документов в индексе (число).
- `indexes_count` — Общее количество индексов, удовлетворяющих условиям фильтрации (число, обязательное).
- `pages_count` — Общее количество страниц в пагинации (число, обязательное).

Пример ответа:

```json
{
  "indexes": [
    {
      "index_id": 42,
      "name": "your_index_name",
      "current_version": 3,
      "doc_count": 1000
    }
  ],
  "indexes_count": 0,
  "pages_count": 0
}
```

{% endcut %}

{% cut "**Get Index Documents**" %}

Получение документов из индекса.

`https://supportgpt.{{ api-host }}/indexer/v1/indexes/{index_name}/documents`

Метод: `GET`.

-	`index_name` — Строковое имя индекса (строка, обязательное).

Схема запроса (Query params):

- `service` — Строковый идентификатор сервиса (строка).
- `product` — Строковый идентификатор продукта (строка).
- `index_version` — Версия индекса. В случае отсутствия будет использована текущая версия (число).
- `after_id` — Для пагинации при сортировке по id документа: вернуть документы, у которых id больше заданного (строка).
- `search_query` — Поисковой запрос по прямому вхождению текста (строка).
- `document_id` — Получить один документ по заданному id (строка).
- `limit` — Максимальное количество документов на запрос. Для получения следующей группы документов можно использовать after_id (число).
- `sort_by` — Поле для сортировки (строка).
- `sort_order` — Порядок сортировки: `asc` или `desc` (строка).

Схема ответа:

- `parameters` — Общие параметры запроса и ответа (обязательное):
  - `items_total` — Общее количество документов в индексе (число, обязательное).
  - `items_returned` — Количество документов, которые были возвращены в этом запросе (число, обязательное).
  - `last_id` — Идентификатор последнего документа, для использования в целях пагинации (строка).
  - `after_id` — Параметр из запроса (строка).
  - `limit` — Параметр из запроса (число).
  - `sort_by` — Параметр из запроса (строка).
  - `sort_order` — Параметр из запроса (строка).
- `items` — Документы из индекса (обязательное):
  - `doc_id` — Id документа (строка, обязательное).
  - `title` — Заголовок документа (строка).
  - `text` — Текст документа (строка).
  - `meta` — Дополнительные метаданные документа (эти метаданные заносятся в индекс в виде пар key-value в свободном формате).

Пример ответа:

```json
{
  "parameters": {
    "items_total": 100,
    "items_returned": 50,
    "last_id": "doc20",
    "after_id": "doc10",
    "limit": 10,
    "sort_by": "document_id",
    "sort_order": "asc"
  },
  "items": [
    {
      "doc_id": "doc42",
      "title": "Инструкция по решению такой-то технической проблемы",
      "text": "Чтобы решить такую-то техническую проблему, надо предпринять такие-то действия",
      "meta": {
        "title": "заголовок документа",
        "source_id": "исходный источник документа такой-то",
        "some_another_key": "some_another_value"
      }
    }
  ]
}
```

{% endcut %}

{% cut "**Delete Index Documents**" %}

Удаление документов из индекса.

`https://supportgpt.{{ api-host }}/indexer/v1/indexes/{index_name}/documents`

Метод: `DELETE`.

- `index_name` — Строковое имя индекса (строка, обязательное).

Схема запроса (Query params):

- `service` — Строковый идентификатор сервиса (строка, обязательное).
- `product` — Строковый идентификатор продукта (строка).
- `docs_ids` — Id документов, которые нужно удалить (обязательное).
- `index_version` — Опционально: версия индекса. В случае отсутствия будет использована текущая версия (число).
- `auto_switch` — Нужно ли сразу переключиться на новый индекс после добавления данных. При установке `false` для переключения есть отдельный запрос (логическое значение).

Схема ответа:

- `index_name` — Строковое имя индекса (строка, обязательное).
- `index_version` — Версия индекса, который был обновлен (строка, обязательное).
- `index_parent_version` — Если был выставлен флаг `diff`, то в этом поле будет версия родительского индекса, на основе которого был создан новый индекс (строка).

Пример ответа:

```json
{
  "index_name": "your_index_name",
  "index_version": 3,
  "index_parent_version": 2
}
```

{% endcut %}

{% cut "**Switch Index Version**" %}

Переключение актуальной версии индекса.

`https://supportgpt.{{ api-host }}/indexer/v1/indexes/{index_name}/switch_version`

Метод: `POST`.

- `index_name` — Строковое имя индекса (строка, обязательное).

Схема запроса (Request Body schema: `application/json`):

- `service` — Строковый идентификатор сервиса (строка, обязательное).
- `product` — Строковый идентификатор продукта (строка).
- `index_version` — Версия индекса для переключения (число, обязательное).

Схема ответа:

- `index_name` — Строковое имя индекса (строка, обязательное).
- `index_version` — Версия индекса, на которую было переключение (число, обязательное).

Пример запроса:

```json
{
  "service": "your_service",
  "product": "your_product",
  "index_version": 3
}
```

Пример ответа:

```json
{
  "index_name": "your_index_name",
  "index_version": 3
}
```

{% endcut %}

{% cut "**Answer Public**" %}

Получение генеративных ответов.

`https://supportgpt.{{ api-host }}/api/v1/answer`

Метод: `POST`.

Схема запроса (Request Body schema: `application/json`):

- `service` — Строковый идентификатор сервиса (строка, обязательное).
- `product` — Строковый идентификатор продукта (строка).
- `dialog` — Диалог пользователя и оператора:
  - `role` — Тип сообщения (строка, обязательное).
  - `text` — Текст сообщения (строка, обязательное).
  - `id` — Идентификатор сообщения в свободном виде (число).
  - `created` — Дата и время создания сообщения в ISO-формате `YYYY-mm-ddTHH:MM:SS` (строка).
- `meta_features` — Дополнительные метаданные контекста в свободном виде, зависит от бизнес-логики клиента.
- `index_name` — Имя индекса, на основании которого нужно сгенерировать ответ. В случае отсутствия будет взято имя по умолчанию, которое зависит от service/product (строка).
- `options` — Дополнительные параметры процессинга:
  - `filter_settings` — Общие параметры для фильтрации документов:
    - `filter_by_meta` — Параметры для фильтрации по метаданным документов:
      - `property name` — Массив строк или чисел.
    - `document_ids` — Id документов, среди которых будет выполняться поиск. Если список пустой, поиск будет по всем ids (массив строк).

Схема ответа:

-	`answers` — Список ответов модели, количество элементов соответствует параметру `replies` из запроса (обязательное):
  - `answer` — Текст ответа (строка, обязательное).
  - `meta` — Дополнительные данные по ответу (объект, обязательное):
    - `rag_docs` — Опционально: данные по релевантным документам из индекса (обязательное):
      - `source_id` — Id источника документа в базе клиента (число).
    - `answer_annotations` — Аннотации к ответам:
      - `label` — Идентификатор аннотации (строка, обязательное).
      - `title` — Заголовок аннотации (строка, обязательное).
      - `type` — Тип аннотации. Сейчас только `source_annotation` (строка, обязательное).
      - `text` — Текст аннотации (строка, обязательное).
      - `answer_position` — Положение аннотации в тексте (объект, обязательное):
        - `begin` — Позиция начала фрагмента текста (число, обязательное).
        - `end` — Позиция конца фрагмента текста (число, обязательное).
      - `url` — Ссылка на источник (строка).
    - `source_documents` — Опционально: источники документов, из которых был выбран ответ:
      - `source_id` — Id источника документа в базе клиента (строка, обязательное).
      - `title` — Заголовок документа (строка).
    - `request_id` — Идентификатор запроса `x-request-id` из хедера (строка).

Пример запроса:

```json
{
  "service": "your_service",
  "product": "your_product",
  "dialog": [
    {
      "role": "operator",
      "text": "Добрый день, чем я могу помочь?"
    },
    {
      "role": "client",
      "text": "Помогите решить такую-то техническую проблему"
    }
  ],
  "meta_features": {
    "user_name": "...",
    "user_created_date": "..."
  },
  "replies": 1,
  "index_name": "your_index_name",
  "options": {
    "filter_settings": {
      "filter_by_meta": {
        "doc_meta_key1": [
          "doc_meta_value1",
          "doc_meta_value2"
        ],
        "doc_meta_key2": [
          "doc_meta_value3",
          "doc_meta_value4"
        ]
      },
      "document_ids": [
        "doc1",
        "doc45",
        "doc99"
      ]
    }
  }
}
```

Пример ответа:

```json
{
  "answers": [
    {
      "answer": "Чтобы решить техническую проблему по вашему вопросу, надо выполнить такие-то действия",
      "meta": {
        "rag_docs": [
          {
            "source_id": 42
          },
          {
            "source_id": 43
          }
        ],
        "answer_annotations": [
          {
            "label": "1",
            "title": "Например, имя документа",
            "type": "source_annotation",
            "text": "Фрагмент из инструкции, как сделать что-то",
            "answer_position": {
              "begin": 42,
              "end": 78
            },
            "url": "https://example.com"
          }
        ],
        "source_documents": [
          {
            "source_id": "12345daaeaee11efb64d2e8712812345_0",
            "title": "Название документа"
          }
        ],
        "request_id": "string"
      }
    }
  ]
}
```

{% endcut %}

### Рекомендации по использованию API {#api-recommendations}

При использовании Нейросаппорта есть 2 ключевых шага:

1. загрузка базы знаний;

1. запрос генеративного ответа.

#### Загрузка базы знаний {#knowledge-base-upload}

Перед выгрузкой базы знаний проверьте ее на соответствие пункту [Рекомендации по формату базы знаний](#base-rcmnd). Соблюдение этих рекомендаций может существенно повысить качество получаемых генеративных ответов.

1. Для первичной загрузки документов базы знаний используйте метод `Documents Post`. Для формирования `index_name` используйте полученный ранее префикс, значение должно начинаться с него. Например, для префикса `some_index` название индекса может быть:

   - `some_index_1`
   - `some_index_indexname`
   - `some_index1`
   
   {% cut "**Пример запроса**" %}
   
   ```json
   {
     "service": "your_service",
     "product": "your_product",
     "meta": {
       "source": "исходный источник данных, зависит от клиента",
       "description": "описание индекса"
     },
     "auto_switch": true,
     "index_version": 1,
     "documents": [
       {
         "doc_id": "doc42",
         "title": "Инструкция по решению такой-то технической проблемы",
         "text": "Чтобы решить такую-то техническую проблему, надо предпринять такие-то действия",
         "meta": {
           "title": "заголовок документа",
           "source_id": "исходный источник документа такой-то",
           "some_another_key": "some_another_value"
         }
       }
     ],
     "diff": false
   }
   ```
   
   {% endcut %}

1. В дальнейшем данный `index_name` потребуется использовать для получения генеративных ответов.

1. Для обновления базы знаний также используется метод `Documents Post`.

1. Проверить результат загрузки можно с помощью метода `Get Index Documents`, а список доступных индексов — с помощью метода `Get Indexes List`. Удалить документы можно с помощью метода `Delete Index Documents`.

При вызове метода `Documents Post` рекомендуется заранее заполнять метаинформацию об индексе для дальнейшего упрощения процессов администрирования системы. Раздел метаинформации об индексе содержит следующие поля:

- `source` — Исходный источник данных, зависит от клиента. Можно указать основной источник данных, на базе которого собирался индекс.
- `description` — Описание, какие данные содержит индекс.

#### Запрос генеративного ответа {#request-generative-response}

После успешной загрузки документов можно переходить к этапу получения генеративных ответов.

Для этого используется метод `Answer Public`. В запросе указываются ранее полученные параметры `service` и `product`, а также `index_name`, который загружали на этапе загрузки базы знаний.

{% cut "**Пример запроса**" %}

```json
{
  "service": "your_service",
  "product": "your_product",
  "dialog": [
    {
      "role": "operator",
      "text": "Добрый день, чем я могу помочь?"
    },
    {
      "role": "client",
      "text": "Помогите решить такую-то техническую проблему"
    }
  ],
  "meta_features": {
    "user_name": "...",
    "user_created_date": "..."
  },
  "replies": 1,
  "index_name": "your_index_name",
  "options": {
    "filter_settings": {
      "filter_by_meta": {
        "doc_meta_key1": [
          "doc_meta_value1",
          "doc_meta_value2"
        ],
        "doc_meta_key2": [
          "doc_meta_value3",
          "doc_meta_value4"
        ]
      },
      "document_ids": [
        "doc1",
        "doc45",
        "doc99"
      ]
    }
  }
}
```

{% endcut %}

##### Роли {#roles}

В запросе в поле `dialog`&nbsp;→ `role` рекомендуется использовать значения:

- `client` — реплика или запрос клиента (того, кто обращается в техническую поддержку);

- `operator` — ответ оператора (если требуется ответить на диалог, уже содержащий ответы оператора);

- `bot` (также можно `robot`) — автоматические вопросы и ответы, которые дает чат-бот, например при определения тематики обращения или генерации каких-то стандартных ответов или сообщений (если требуется ответить на диалог, уже содержащий ответы робота).

##### Метаданные {#metadata}

Метаданные&nbsp;— это любая дополнительная информация, относящаяся к конкретному диалогу (и специфичная по отношению к данному диалогу). Метаданные необходимы для генерации корректного ответа.

Для передачи метаданных используется блок `meta_features`. В него рекомендуется передавать полностью русифицированный текст в виде списка «ключ: значение»:

```text
<Название_поля_на_русском_языке_1>: <значение поля (если текст, то на русском)>
<Название_поля_на_русском_языке_2>: <значение поля (если текст, то на русском)>
…
<Название_поля_на_русском_языке_N>: <значение поля (если текст, то на русском)>
```

{% cut "**Пример**" %}

```text
Номер заказа: 123
Регион: Москва
Метод оплаты: Наличные
```

{% endcut %}

Состав метаданных определяется исходя из потенциальной пользы для ответа на вопрос (и наличия этих данных на момент генерации ответа). Очень желательно не передавать в метаданных значений, которые никогда не будут использованы в ответах. Допустимо передавать общий список метаданных в каждом запросе, хотя в определенных тематиках/ситуациях потребуется использовать только часть. Не рекомендуется составлять список длиннее 3000 символов.

Если решаемая задача не подразумевает использование метаданных, рекомендуется оставлять это поле пустым.

#### Ограничения API {#api-limitations}

- В тестовом периоде: 10 запросов в минуту.
- Количество загружаемых индексов: не более 5.
- В каждом индексе не более 1000 документов, объем одного документа не более 50&nbsp;000 символов.


## Рекомендации по улучшению качества ответов {#improving-response}

Качество ответов существенно зависит от качества входных данных:

- базы знаний (ее структура, релевантность и актуальность);
- метаданных (достаточность для формирования генеративных ответов и доступность этих данных когда требуется сгенерировать ответ).

Часто на качество ответов может повлиять и длина диалога — если предыдущий диалог очень длинный, то вероятнее всего пользователь озвучил и уже получил ответ на несколько своих вопросов. Нередко качество ответа можно повысить, оставив в запросе только N последних реплик диалога (но здесь нет универсальных рекомендаций для значения N, это зависит от конкретного бизнес-сценария использования).

### Рекомендации по формату базы знаний {#base-rcmnd}

Поскольку API-информация загружается только в текстовом виде, базу знаний необходимо сконвертировать в текст (идеальный формат — классический _Markdown_).

{% cut "**Что такое Markdown?**" %}

   Markdown — это простой язык разметки, созданный для легкого форматирования текста. Его цель — быть читаемым в исходном виде и легко преобразуемым в HTML.
   
   **Основные виды форматирования Markdown:**
   
   - **Заголовки:**

      ```markdown
      # Заголовок 1
      ## Заголовок 2
      ### Заголовок 3
      ```
   
   - **Выделение текста:**

      ```markdown
      *Курсив* или _Курсив_
      **Жирный** или __Жирный__
      ```
   
   - **Списки:**
   
      Нумерованный:

      ```markdown
      1. Первый пункт
      2. Второй пункт
      ```

      {% note info %}
      
      Пункты списка в разметке можно нумеровать в любом порядке. Markdown расставит правильную нумерацию автоматически.
      
      {% endnote %}

      Маркированный:

      ```markdown
      - Пункт
      * Пункт
      + Пункт
      ```
   
   - **Ссылки:**

      ```markdown
      [Текст ссылки](https://example.com)
      ```
      
   - **Цитаты:**

      ```markdown
      > Это цитата
      >> Вложенная цитата
      ```
      
   - **Разделительная линия:**

      ```markdown
      ---
      ```
      
   - **Таблицы:**
      
      Markdown поддерживает простое создание таблиц:

      ```markdown
      | Заголовок 1 | Заголовок 2 |
      |-------------|--------------|
      | Ячейка 1    | Ячейка 2     |
      | Ячейка 3    | Ячейка 4     |
      ```
      
      Можно выравнивать текст в ячейках:

      ```markdown
      | Лево       | Центр       | Право      |
      |:-----------|:-----------:|-----------:|
      | текст      | текст       | текст      |
      | еще текст  | еще текст   | еще текст  |
      ```
      
      Примеры выравнивания:
      
      * `:---` — по левому краю;
      * `:---:` — по центру;
      * `---:` — по правому краю.
      
      Если таблица больше 10 строк, то лучше привести ее к плоской структуре.

      ```markdown
      | Заголовок 1 | Заголовок 2 |
      |-------------|--------------|
      | Ячейка 1    | Ячейка 2     |
      | Ячейка 3    | Ячейка 4     |
      
      Например, так:
      
      Строка 1:

      **Заголовок 1**: Ячейка 1
      **Заголовок 2**: Ячейка 2
      
      Строка 2:

      **Заголовок 1**: Ячейка 3
      **Заголовок 2**: Ячейка 4
      
      ...
      ```

{% endcut %}

Рекомендации перед конвертацией в текст:

1. Если в документах содержатся ссылки или другие вложенные файлы/документы (и эти данные важны для формирования генеративного ответа), то необходимо выкачать их отдельными документами и обозначить связь с исходным документом, к которому они относятся по смыслу.

1. Необходимо перевести табличные части документов в плоскую структуру (без таблиц внутри таблиц), чтобы таблицы не содержали объединенных ячеек.

1. Смысловое наполнение схем и картинок в базе знаний необходимо продублировать текстовым описанием (если эти изображения важны для формирования корректных ответов).

1. Требуется привести термины в соответствие с метаданными, чтобы в базе знаний использовались аналогичные значения и на том же языке. Например, если в метаданных используется термин `ORDER_STATUS` со значениями `OPEN`, `IN_PROCESS`, `CLOSED`, то такие же значения должны использоваться в базе знаний (а если там используется понятие `Статус заказа` со значениями `Открыт`, `В процессе`, `Закрыт`, то это может быть не учтено при формировании генеративного ответа).

1. Если размер базы знаний значительный, то рекомендуется разделить ее части (размер одной части — не более 50&nbsp;000 символов). Каждая часть должна быть самодостаточна по смысловому наполнению. Идеально, если каждый тип обращений будет представлен отдельным документом.

1. Желательно привести контент базы знаний к следующей структуре:

   ```
   #Заголовок / тематика обращений: <...текст...>
   #Примеры обращений: <...текст...>
   #Ситуации и решения: <...текст...>
   #Связанные заголовки (или контекст обращения): <...текст...>
   ```

После конвертации убедитесь, что база знаний приведена в формат, корректный для загрузки:

- У каждого документа есть заголовок / уникальный идентификатор.
- Все документы имеют единую кодировку.
- Удалены технические вставки (например, css и js, которые не имеют значения для решения проблем).
- Удалены url-кодировки, картинки в виде base64.

Также для получения корректных и полных ответов необходимо, чтобы в передаваемых данных содержалась только релевантная и актуальная информация, поэтому перед загрузкой:

1. Провалидируйте статьи базы знаний на актуальность и удалите архивные или неактуальные разделы.

1. Удалите техническую информацию (например, история изменений документа и&nbsp;т.&nbsp;п.), а также любые внутренние инструкции, которые напрямую не используются при генерации ответа.

**Примеры страниц базы знаний в разметке Markdown:**

{% note info %}

Для горизонтальной прокрутки примеров используйте полосу прокрутки внизу блока или сочетание **Shift** + вращение колеса мыши.

{% endnote %}

{% cut "**Пример 1**" %}

   ```markdown
   # Решение проблем с подключением
   
   **Ключевые слова:** не работает, подключение, ошибка сети, интернет, сбой соединения
   
   ## Типовые вопросы
   
   - Почему компьютер/телефон не подключается к интернету?
   - Что делать при ошибке соединения?
   - Как устранить сбой сети?
   - Почему не работает Wi-Fi?
   - Почему интернет работает медленно или нестабильно?
   
   ## Стандартный ответ
   
   Если у пользователя возникли проблемы с подключением к интернету (через кабель или Wi-Fi), рекомендуется пошагово выполнить базовую диагностику:
   
   1. **Перезагрузите оборудование.**
      Полностью выключите и обесточьте роутер/модем на 30 секунд, затем включите снова. Это помогает устранить временные сбои в работе устройства.
   
   2. **Проверьте физическое подключение.**
      - Убедитесь, что все сетевые кабели (Ethernet, оптика или телефонная линия) подключены надежно и без повреждений.
      - Проверьте, что индикаторы на роутере активны (обычно мигают лампочки Power, Internet, WLAN).
   
   3. **Проверьте состояние сети на устройстве.**
      - На Windows: в панели задач нажмите значок сети → **Диагностика неполадок сети**.
      - На macOS: откройте меню Wi-Fi → **Диагностика беспроводной сети**.
      - На смартфоне: отключите и заново включите Wi-Fi или мобильную сеть.
   
   4. **Проверьте правильность подключения к Wi-Fi.**
      - Убедитесь, что выбран верный Wi-Fi и введен корректный пароль.
      - При необходимости «забудьте» сеть и подключитесь заново.
   
   5. **Обновите драйверы сетевого адаптера (для ПК).**
      - На Windows: **Пуск** → **Диспетчер устройств** → **Сетевые адаптеры** → **Обновить драйвер**.
      - Проверьте наличие обновлений системы: **Параметры** → **Центр обновления Windows**.
   
   6. **Проверьте, работает ли интернет на другом устройстве.**
      Это поможет определить, связана ли проблема с конкретным устройством или с интернет-соединением в целом.
   
   7. **Сбросьте сетевые настройки.**
      - На Windows: **Параметры** → **Сеть и интернет** → **Состояние** → **Сброс сети**.
      - На Android или iOS: **Настройки** → **Сброс** → **Сбросить настройки сети**.
   
   Если после выполнения этих действий доступ к интернету не восстановлен:
   
   - Зафиксируйте код или текст ошибки (если появилось сообщение: например, `Ошибка DNS`, `Неудачное соединение`, `Отсутствует IP-адрес`).
   - Сообщите пользователю, что необходимо обратиться в техническую поддержку провайдера с подробным описанием проблемы и указанием всех предпринятых шагов.
   
   ## Дополнительная информация
   
   При обращении в техническую поддержку рекомендуйте подготовить следующую информацию:
   
   - ФИО пользователя и адрес подключения.
   - Название интернет-провайдера.
   - Модель и марку роутера или модема.
   - Тип подключения (кабельное, беспроводное, мобильное).
   - Подробности проблемы: отсутствие доступа к сети, низкая скорость, периодические разрывы соединения, ошибки при подключении и т. д.
   - Время начала возникновения неисправности.
   - Какие действия уже предпринимались для устранения проблемы.
   
   Также уточните, наблюдается ли проблема на всех устройствах или только на одном. Это поможет оперативно определить источник сбоя. В случае аппаратной неисправности или нарушения на стороне провайдера может быть организован визит специалиста.
   ```

{% endcut %}

{% cut "**Пример 2**" %}

   ```markdown
   # Корректировка платежей
   
   **Ключевые слова:** оплата, счет, платеж, возврат, списание, транзакция
   
   ## Типовые вопросы
   
   - Как отменить ошибочный платеж?
   - Почему списалась некорректная сумма?
   - Как оформить возврат средств?
   - Не пришло подтверждение оплаты — что делать?
   
   ## Стандартный ответ
   
   Если у пользователя возникли вопросы, связанные с платежами, действия могут отличаться в зависимости от ситуации. Рекомендуется:
   
   1. **Проверить историю операций.**
      Войдите в личный кабинет и ознакомьтесь с деталями последней транзакции. Убедитесь, что операция действительно прошла и отображается корректно.
   
   2. **Сохранить платежные документы.**
      Сохраните квитанцию, скриншот платежа, банковскую выписку или СМС-подтверждение. Эти данные могут понадобиться для рассмотрения заявки.
   
   3. **Оформить заявку на корректировку.**
      Перейдите в раздел **Платежи** или **Финансы** в личном кабинете и заполните форму с описанием ситуации. Укажите дату, сумму и способ оплаты.
   
   4. **Ожидать обработки обращения.**
      Стандартный срок рассмотрения — от 1 до 3 рабочих дней. Заявка будет рассмотрена специалистами, после чего пользователь получит уведомление о результате.
   
   5. **Обратиться напрямую для срочных случаев.**
      При необходимости срочного реагирования пользователь может позвонить в службу поддержки по телефону:
      +7 (XXX) XXX-XX-XX
   
   ## Дополнительная информация
   
   Чтобы ускорить обработку заявки, рекомендуется указать в обращении следующую информацию:
   
   - ФИО плательщика и контактные данные.
   - Точный способ оплаты (банковская карта, перевод, электронный кошелек и т. д.).
   - Дата и время совершения платежа.
   - Сумма и назначение платежа.
   - Номер транзакции или платежного поручения (если доступен).
   - Приложенный скриншот, фото чека или другого подтверждения.
   
   Также уточните, был ли платеж выполнен из личного кабинета, через сторонний сервис (банковское приложение, терминал и т. п.) или с чужого аккаунта.
   
   Важно:
   - Возврат средств невозможен при отсутствии подтвержденной транзакции.
   - В случае ошибки при вводе реквизитов необходимо проверить, были ли средства зачислены. Если платеж ушел неправильно, потребуется дополнительная проверка.
   - Если оплата не прошла, возможно, банк отклонил операцию. В таком случае рекомендуйте связаться с банком-эмитентом карты.
   ```

{% endcut %}

### Рекомендации к тестированию и оценке качества {#qa-recommendations}

Для тестирования рекомендуется подготовить релевантный набор данных, соответствующий потоку, на котором в дальнейшем планируется использовать сервис. Например, если планируется запускать сервис только для 1-й линии поддержки, то в тестировании должны присутствовать данные только с нее. Либо, если планируется запускать сервис по определенным тематикам, то набор данных должен отражать реальное распределение по тематикам. Это необходимо, чтобы выводы, сделанные на тестовом наборе данных, можно было потом корректно обобщить.

Рекомендуется выбирать ту часть потока обращений, для которой:

- база знаний наиболее полная;
- для формирования ответов достаточно метаданных;
- для помощи пользователю чаще всего не требуется дополнительных действий оператора (звонки, изменения в смежных системах и&nbsp;т.&nbsp;п.).

Для оценки качества ответов рекомендуется применять сравнение side-by-side, то есть сравнивать ответы Нейросаппорта с ответами оператора, который был дан для аналогичного диалога.

Рекомендации для проведения такого сравнения:

1. Подготовьте диалоги по выбранной части потока (диалог можно случайным образом разрезать так, чтобы последней была реплика клиента, на которую требуется сформировать ответ). Рекомендуется брать не более 300-500 диалогов, потому что дальнейшую разметку результатов потребуется производить вручную. Рядом с диалогом выгрузите доступные метаданные.

1. Выгрузите ответ оператора, который был фактически дан на последнюю реплику клиента. Запросите ответ Нейросаппорта для аналогичного диалога.

1. Оцените ответ оператора и ответ Нейросаппорта по шкале 1-5 с критериями из таблицы ниже. Рекомендуется выполнять оценку с перекрытием (когда несколько человек оценивают один и тот же диалог и потом эти оценки усредняются, либо диалоги с большим разбросом оценок не учитываются при сравнении), таким образом можно снизить фактор субъективности при оценках. Как минимум, рекомендуется выборочно перепроверить корректность проставленных оценок.

   #|
   || **Оценка** | **Расшифровка** | **Критерий** ||
   || 5 | Идеально | Ответили на все вопросы и дали отличный безошибочный ответ пользователю. ||
   || 4 | Хорошо | Написанный текст решает вопрос пользователя и по алгоритму является верным, но есть небольшие ошибки в формулировках и/или небольшие расхождения с редакционной политикой. ||
   || 3 | Средне | В целом, написанный текст отвечает на обращение, соответствует базе знаний и приближает к решению задачи, но требует правок (фразы и предложения):
   - Не дописали какую-то значимую информацию.
   - Ответили не на все вопросы пользователя, если их было несколько.
   ||
   || 2 | Плохо | Ответ абсолютно бесполезен и его нельзя было использовать в диалоге. Нужно писать правильный ответ с нуля.
   - Совершенно не соответствует базе знаний.
   - Не соответствует действительности и входным данным (например, решили проблему не по тому обращению или ответили не на тот вопрос).
   - Дезинформирует пользователя.
   ||
   || 1 | Критично | Очень плохой ответ. Может вызвать риски, если пользователь получит такой текст. Критерии:
   - Проникла NDA-информация.
   - Использована неприемлемая лексика.
   - Неразборчивый или непонятный текст.
   ||
   |#

1. Отдельно можно оценить диалоги с точки зрения:

   1. Полноты предоставленной информации (диалога и метаданных) для формирования правильного ответа.

   1. Необходимости выполнять дополнительные действия для обработки обращения, которые может выполнить только человек.

1. Корректно будет сравнивать Нейросаппорт и оператора только на тех диалогах, где нет какой-то дополнительной информации, доступной оператору (но недоступной для модели) и где не требуется дополнительных действий (т.&nbsp;к. оператор, как правило, отвечает на основании результата данных действий).

1. Сравните долю полученных оценок 3, 4, 5 для оператора и для Нейросаппорта — это покажет, какую долю потока возможно автоматизировать с помощью сервиса.
