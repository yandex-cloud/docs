# Управление ключами

С помощью {{ kms-name }} вы можете создавать, ротировать и удалять симметричные ключи шифрования.

## Создать ключ {#create}

Чтобы создать новый ключ:

{% list tabs %}

- Консоль управления

  1. Войдите в [консоль управления]({{ link-console-main }}).
  1. Выберите сервис **{{ kms-name }}**.
  1. На вкладке **Ключи** нажмите кнопку **Создать** и задайте атрибуты ключа:
     * Имя и опциональное описание в свободной форме.
     * Алгоритм шифрования, например AES-256.
     * Период [ротации](../concepts/index.md#rotation) (частота смены версии ключа по умолчанию).
     * Нажмите кнопку **Создать**.

  Вместе с ключом создается его первая версия: нажмите на ключ в списке, чтобы открыть страницу с его атрибутами.

- CLI

  Выполните команду со следующими параметрами:

  - `name` — имя ключа.
  - `default-algorithm` — алгоритм шифрования: `aes-128`, `aes-192` или `aes-256`.
  - `rotation-period` — период ротации ключа. Чтобы создать ключ без автоматической ротации, не указывайте параметр `rotation-period`.

  ```
  $ yc kms symmetric-key create \
    --name example-key \
    --default-algorithm aes-256 \
    --rotation-period 24h
  ```

  Вместе с ключом создается его первая версия. Она указана в поле `primary_version`.

- API

    Воспользуйтесь методом [create](../api-ref/SymmetricKey/create) для ресурса `SymmetricKey`.

{% endlist %}

## Изменить ключ {#update}

После создания ключа вы можете изменить любой из его атрибутов. Если вы измените алгоритм шифрования, то новый алгоритм будет использоваться начиная со следующей версии ключа. Чтобы сразу создать новую версию и сделать ее версией по умолчанию, ротируйте ключ.

Чтобы изменить ключ:

{% list tabs %}

- Консоль управления

  1. Войдите в [консоль управления]({{ link-console-main }}).
  1. Выберите сервис **{{ kms-name }}**.
  1. На вкладке **Ключи** нажмите на нужный ключ в списке, чтобы открыть страницу с его атрибутами, и нажмите кнопку **Изменить**.
  1. Изменив атрибуты ключа, нажмите кнопку **Сохранить**.

- CLI

  Выполните команду со следующими параметрами: 

  - `name` — имя ключа. Если в каталоге есть несколько ключей с одинаковыми именами, используйте идентификатор ключа.
  - `new-name` — новое имя ключа.
  - `default-algorithm` — алгоритм шифрования: `aes-128`, `aes-192` или `aes-256`.
  - `rotation-period` — период ротации ключа. Чтобы отключить автоматическую ротацию измененного ключа, не указывайте параметр `rotation-period`.

  ```
  $ yc kms symmetric-key update \
    --name example-key \
    --new-name example-key-2 \
    --default-algorithm aes-128 \
    --rotation-period 48h
  ```
  
- API

  Воспользуйтесь методом [update](../api-ref/SymmetricKey/update) для ресурса `SymmetricKey`.

{% endlist %}

## Ротировать ключ {#rotate}

При ротации ключа генерируется новая версия, которая сразу назначается версией по умолчанию. Вы можете настроить автоматическую периодическую ротацию, но также можете ротировать ключ вручную в любой момент.

Чтобы ротировать ключ:

{% list tabs %}

- Консоль управления

  1. Войдите в [консоль управления]({{ link-console-main }}).
  1. Выберите сервис **{{ kms-name }}**.
  1. На вкладке **Ключи** нажмите на нужный ключ в списке, чтобы открыть страницу с его атрибутами.
  1. Нажмите кнопку **Ротировать** и подтвердите ротацию (убедитесь, что смена версии по умолчанию не повредит вашей работе).

- CLI

  Выполните команду, указав идентификатор или имя ключа:

  ```
  $ yc kms symmetric-key rotate example-key
  ```

- API

  Воспользуйтесь методом [rotate](../api-ref/SymmetricKey/rotate) для ресурса `SymmetricKey`.

{% endlist %}

## Удалить ключ {#delete}

При удалении ключа также удаляются все его версии. Ключ невозможно удалить сразу: версии помеченного на удаление ключа переходят в статус `Scheduled For Destruction` на 3 дня. В это время версии ключей продолжают [тарифицироваться](../pricing.md). В течение этих 3 дней по запросу в техническую поддержку можно восстановить ключ вместе с его версиями.

{% note alert %}

Через 3 дня после запроса на удаление ключа сам ключ и его версии удаляются безвозвратно: если у вас остались зашифрованные с помощью этого ключа данные, расшифровать их будет невозможно.

{% endnote %}

Чтобы удалить ключ:

{% list tabs %}

- Консоль управления

  1. Войдите в [консоль управления]({{ link-console-main }}).
  1. Выберите сервис **{{ kms-name }}**.
  1. На вкладке **Ключи** нажмите на нужный ключ в списке, чтобы открыть страницу с его атрибутами.
  1. Нажмите кнопку **Удалить** и подтвердите удаление.

- CLI

  Выполните команду, указав идентификатор или имя ключа:

  ```
  $ yc kms symmetric-key delete example-key
  ```
  
- API

  Воспользуйтесь методом [delete](../api-ref/SymmetricKey/delete) для ресурса `SymmetricKey`.

{% endlist %}
