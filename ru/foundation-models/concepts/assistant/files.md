# Файлы-источники

Чтобы модель использовала внешние источники информации для ответов на запросы, необходимо загрузить файлы с дополнительной информацией с помощью [Files API](../../files/api-ref/grpc/index.md) и [создать](../../searchindex/api-ref/grpc/SearchIndex/create.md) для них [_поисковый индекс_](./search-index.md). Загрузить можно до 10 000 файлов, максимальный размер каждого файла — 128 МБ. Один и тот же файл может содержаться в нескольких поисковых индексах сразу. 

Со всеми ограничениями {{ assistant-api }} можно ознакомиться в разделе [{#T}](../limits.md).

Для загрузки поддерживаются следующие [MIME-типы](https://en.wikipedia.org/wiki/Media_type): 

* `application/json`
* `application/msword`
* `application/pdf`
* `application/vnd.ms-excel`
* `application/vnd.ms-excel.sheet.2`
* `application/vnd.ms-excel.sheet.3`
* `application/vnd.ms-excel.sheet.4`
* `application/vnd.ms-excel.workspace.3`
* `application/vnd.ms-excel.workspace.4`
* `application/vnd.ms-outlook`
* `application/vnd.ms-powerpoint`
* `application/vnd.ms-project`
* `application/vnd.ms-word2006ml`
* `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
* `application/vnd.openxmlformats-officedocument.wordprocessingml.document`
* `application/x-latex`
* `application/x-ms-owner`
* `application/xhtml+xml`
* `text/csv`
* `text/html`
* `text/markdown`
* `text/plain`
* `text/xml`
* `application/rtf`

В качестве источника для поискового индекса эффективнее всего использовать формат [Markdown](https://ru.wikipedia.org/wiki/Markdown), так как многие модели обучаются именно на этом формате, и, следовательно, должны понимать его лучше. Вы можете преобразовывать файлы, в том числе содержащие сложное форматирование, в формат Markdown с помощью библиотеки [docling](https://github.com/DS4SD/docling) для [Python](https://www.python.org/). Подробнее см. в разделе [{#T}](../../tutorials/pdf-searchindex-ai-assistant.md).

{% note info %}

Время хранения загруженных файлов и поисковых индексов ограничено. Вы можете настроить его при загрузке файла с помощью параметра [ExpirationConfig](../../files/api-ref/grpc/File/create.md#yandex.cloud.ai.common.ExpirationConfig). По умолчанию файлы будут удалены, если в течение 7 дней они не используются.

{% endnote %}

При создании поискового индекса вы задаете [тип поиска](./search-index.md#search-types), для которого индекс будет использоваться. Поддерживаются [полнотекстовый](./search-index.md#text-search), [векторный](./search-index.md#vector-search) и [гибридный](./search-index.md#hybrid-search) типы поиска. Скорость индексирования зависит от типа и размера файлов, а также нагрузки в сервисе и может занять от нескольких секунд до нескольких часов. Файлы индексируются [асинхронно](../index.md#working-mode). В ответ на запрос создания поискового индекса возвращается идентификатор [операции](../../../api-design-guide/concepts/async.md). По нему вы можете узнать, когда поисковый индекс будет готов.

Созданный поисковый индекс можно подключить к ассистенту. Тогда при запуске модель будет учитывать содержимое поискового индекса и отвечать, используя в первую очередь информацию из него.

## Подтверждение источников {#citations}

Если при формировании ответа AI-ассистент использует поисковые индексы с внешними источниками информации, то ответ модели содержит _ссылки на источники_ — секцию `citations` с информацией обо всех использованных при подготовке ответа индексах, внешних файлах и их фрагментах.

При работе через {{ ml-sdk-name }} ссылки на источники можно получить из свойства `citations` объекта `run`. Получить ссылки на источники через API можно по идентификатору запуска, воспользовавшись методом REST API [Run.Get](../../runs/api-ref/Run/get.md) или вызовом gRPC API [RunService/Get](../../runs/api-ref/grpc/Run/get.md). Кроме того, секция со ссылками на источники прикрепляется ко всем сообщениям ассистента, хранящимся в треде.

### Структура секции citations {#citations-structure}

Секция `citations`, содержащая ссылки на источники, имеет следующую структуру:

* `sources` — массив из одного или более фрагментов файлов-источников, использованных при генерации ответа:

    * `chunk` — информация об использованном при генерации ответа фрагменте файла-источника:

        * `searchIndex` — блок полей с информацией о поисковом индексе, содержащем использованный фрагмент файла-источника. Блок содержит идентификатор, тип, метаданные (`labels`) и другую информацию об индексе и его настройках.
        * `sourceFile` — блок полей с информацией об исходном файле-источнике, фрагмент которого использован при генерации ответа. Блок содержит идентификатор, метаданные (`labels`) и другую информацию о файле-источнике.
        * `content` — блок полей, содержащий текст фрагмента, который использовался при генерации ответа.

Подробнее о структуре секции `citations` см. в [справочнике API](../../runs/api-ref/Run/create.md#yandex.cloud.ai.assistants.v1.runs.Run).

### Метаданные файлов-источников и поисковых индексов {#labels}

Чтобы более эффективно использовать подтверждение источников и данные, возвращаемые в секции `citations`, для каждого файла-источника и поискового индекса вы можете задавать _метаданные_. Например, с помощью метаданных можно осуществлять дополнительную фильтрацию результатов или присваивать источникам более полные и осмысленные названия и описания.

Метаданные файлов-источников задаются при создании файлов с помощью метода REST API [File.Create](../../files/api-ref/File/create.md), вызова gRPC API [FileService/Create](../../files/api-ref/grpc/File/create.md) или [{{ ml-sdk-full-name }}](../../sdk/index.md). Метаданные файлов-источников передаются в виде объектов, содержащих пары `<ключ>:<значение>`.

Метаданные поисковых индексов задаются при создании индексов с помощью метода REST API [SearchIndex.Create](../../searchindex/api-ref/SearchIndex/create.md), вызова gRPC API [SearchIndexService/Create](../../searchindex/api-ref/grpc/SearchIndex/create.md) или [{{ ml-sdk-full-name }}](../../sdk/index.md). Метаданные поисковых индексов передаются в виде объектов, содержащих пары `<ключ>:<значение>`.

Метаданные каждого файла-источника и поискового индекса могут содержать одну или несколько пар `<ключ>:<значение>`.

Подробнее об использовании метаданных файлов-источников и поисковых индексов см. в разделе [{#T}](../../operations/assistant/create-with-labels.md).

{% note tip %}

После построения поискового индекса вы можете удалять файлы. Однако в этом случае информация об источниках не сохранится, поэтому блок `source` вернется пустым. Если вы хотите использовать ссылки на источники, не удаляйте файлы, использовавшиеся для построения поискового индекса.

{% endnote %}

Примеры работы со ссылками на источники с помощью SDK и API, а также примеры вывода см. в разделе [Создать ассистента с поисковым индексом](../../operations/assistant/create-with-searchindex.md#create-assistant).
