# HTTP-роутеры

HTTP-роутер определяет правила маршрутизации HTTP-запросов в [группы бэкендов](backend-group.md). 

Указывать HTTP-роутеры можно только для [обработчиков](application-load-balancer.md#listener) типа **HTTP**. Если обработчик принимает <q>чистый</q> TCP-трафик (тип **Stream**), то для него напрямую указывается группа бэкендов.

С помощью настроек HTTP-роутера можно модифицировать заголовки запросов и ответов, а также формировать небольшие статические ответы прямо на балансировщике нагрузки. Можно создать пустой HTTP-роутер, а потом добавить в него маршруты.

Маршруты внутри HTTP-роутера объединены в [виртуальные хосты](#virtual-host). Маршрутизация происходит в два этапа. 

1. На основе заголовка `Host` (`:authority` в случае HTTP/2) выбирается наиболее подходящий виртуальный хост. 

1. Выбирается первый маршрут, предикату которого удовлетворяет запрос. Порядок виртуальных хостов внутри роутера не важен, а порядок маршрутов внутри виртуального хоста важен — наиболее специфичные маршруты должны быть первыми в списке.

## Виртуальные хосты {#virtual-host}

Виртуальные хосты объединяют [маршруты](#routes), относящиеся к одному набору доменов — значений заголовков `Host` HTTP-запроса. Поддерживаются как точные совпадения, так и символы подстановки. При получении входящего запроса балансировщик по очереди проверяет предикаты маршрутов и выбирает первый, удовлетворяющий запросу. 

Также на уровне виртуального хоста настраиваются модификации HTTP-заголовков запросов и ответов.

## Маршруты {#routes}

Маршруты состоят из набора условий (предиката), на основании которых балансировщик выбирает маршрут для запроса, и действия над запросом. Доступные условия и действия зависят от типа маршрута. 

### Типы маршрутов {#routes-types}

HTTP-роутеры поддерживают два типа маршрутов — **HTTP** и **gRPC**:

1. HTTP-маршруты предназначены для обработки HTTP-запросов по протоколам HTTP/1.1 и HTTP/2.

   В качестве условий для маршрута можно указать начало или полный путь запроса, а также метод запроса (GET, POST и т. д.).
   
   С запросом, который удовлетворяет условиям, можно выполнить одно из действий:
   
   * Передача запроса в [группу бэкендов](backend-group.md) типа **HTTP** для обработки. В этом случае есть возможность настроить таймауты на обработку запроса, добавить поддержку WebSocket или изменение URI перед передачей запроса в бэкенды.   
   * Перенаправление запроса на другой адрес с выбранным кодом ответа и модификациями URI запроса. В этом случае можно заменить путь (полностью или частично), удалить query-параметры, изменить хост, порт и схему.
   * Немедленный возврат статического ответа. 
      
1. gRPC-маршруты предназначены для обработки gRPC-запросов ([удалённых вызовов процедур](https://ru.wikipedia.org/wiki/Удалённый_вызов_процедур)) по протоколу HTTP/2.

   В качестве условий для gRPC-маршрута можно указать начало или полное имя метода (FQMN, fully qualified method name). Значение должно начинаться с косой черты `/`.
   
   С запросом, который удовлетворяет условиям, можно выполнить одно из действий:
   
   * Передача запроса в [группу бэкендов](backend-group.md) типа **gRPC** для обработки. В этом случае есть возможность настроить таймауты на обработку запроса и заменить заголовок Host.   
   * Немедленный возврат статического ответа. 
      


