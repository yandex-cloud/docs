# Восстановление работоспособности кластера Managed Services for PostgreSQL после исчерпания свободного места в хранилище данных

## Описание проблемы {#case-description}

* Хранилище кластера Managed Services for PostgreSQL-кластер работает в режиме только для чтения;
* Запись новых данных в таблицы в баз данных кластера не производится.

## Диагностика и воспроизведение {#diagnosis-and-reproduction}

Проанализируйте значения графика `Disk capacity on primary` на вкладке **Мониторинг** в интерфейсе управления кластером на предмет соотношения значений `free` и `used bytes`.
Это позволит оценить уровень заполнения хранилища кластера в процентах.

При заполнении хранилища более чем на 97% хост автоматически переходит в режим `read-only`.
При этом для всех баз данных с помощью запроса `ALTER DATABASE` выставляется флаг `DEFAULT_TRANSACTION_READ_ONLY = TRUE`\.

В этом режиме запросы на вставку (`INSERT`), удаление (`DELETE`) или обновление (`UPDATE`) данных завершаются с ошибкой.

## Решение {#case-resolution}

Такой ситуации можно избежать, если настроить алерт на отслеживание перехода в `read-only`. Узнать подробнее о порядке действий для настройки такого алерта можно [здесь](../../../managed-postgresql/concepts/storage.md#read-only-monitor).

При получении алерта вы сможете вывести кластер из этого режима двумя способами:
- с помощью [увеличения размера хранилища](../../../managed-postgresql/operations/update.md#change-disk-size) — в этом случае сервис автоматически снимет режим ` read-only `;
- вручную, следуя шагам из [инструкции](../../../managed-postgresql/concepts/storage.md#read-only-solutions).

Автоматического способа расширения хранилища кластера на текущий момент не предусмотрено.
