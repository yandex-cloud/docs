# Нет доступа к ВМ по SSH и ping после обновления cloud-init

## Описание проблемы {#description}

При попытке подключения к ВМ по SSH или выполнения ping-запроса соединение не устанавливается.

Проблема наблюдается на ВМ с ОС Ubuntu после обновления пакета `cloud-init` до версии `25.1.4` или при создании ВМ из образа/снимка с данной версией `cloud-init` и некорректной конфигурацией. В серийной консоли ВМ отсутствует информация об инициализации `cloud-init`.

## Решение {#solution}

Отсутствие в выводе серийной консоли ВМ информации об инициализации `cloud-init` — характерный признак того, что проблема с сетевым доступом связана именно с этим.

Это может происходить после обновления пакета `cloud-init` на ВМ до версии *25.1.4*.

Такое поведение приводит к тому, что при запуске ВМ не производится автоматическая настройка сетевого интерфейса.

Чтобы восстановить доступ к ВМ, выполните следующие действия:
1. **Создайте снимок** диска ВМ, доступ к которой нужно восстановить.
1. **Создайте диск** из снимка. При создании диска в поле **Наполнение** выберите **Снимок** и укажите созданный снимок.
1. **Подключите диск** в качестве дополнительного к вспомогательной ВМ.
1. Измените конфигурационные файлы, влияющие на загрузку ВМ, или скопируйте важные данные.

    Чтобы восстановить работу `cloud-init` версии *25.1.4*, исправьте файл `/etc/cloud/cloud.cfg.d/90_dpkg.cfg`, оставив только `Ec2` в списке `datasource_list`. 
    В этом случае `cloud-init` будет корректно отрабатывать на старте.

    Рекомендуем применить такую настройку ко всем ВМ, где версия `cloud-init` обновлялась до *25.1.4*.
    Проверить ее можно командой:

    ```bash
    sudo cloud-init -v
    ```

1. **Отключите диск** от вспомогательной ВМ.
1. Если вы устранили проблему загрузки, **создайте новую ВМ**. При создании в блоке **Образ загрузочного диска** перейдите на вкладку **Пользовательский** и выберите исправленный диск в качестве загрузочного.
1. После восстановления доступа **не забудьте удалить неиспользуемые ресурсы**: ВМ, диски и снимки. Если их не удалить, они продолжат тарифицироваться.

В новых версиях образов ВМ внесены исправления конфигурации `cloud-init` для корректной работы новой версии.
