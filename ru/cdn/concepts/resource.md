# CDN-ресурс

_Ресурс_ — это основная логическая сущность сервиса {{ cdn-full-name }}, позволяющая настраивать и управлять распространением контента с [источников](origins.md) через CDN.

Чтобы начать распространять контент через CDN, нужно создать ресурс и указать в нем:

* источник или группу источников, которые содержат контент;
* [доменные имена для раздачи контента](#hostnames);
* основные [настройки HTTP-запросов к источникам](#http).

После создания ресурса в нем также можно настроить:

* [кеширование](caching.md);
* [HTTP-заголовки и методы](#http);
* обработку [кросс-доменных запросов (CORS)](cors.md);
* [сжатие](compression.md) и [сегментирование](slicing.md) контента. 

Чтобы новые настройки ресурса применились к CDN-серверам, может потребоваться до 15 минут.

## Доменные имена для раздачи контента {#hostnames}

_Доменные имена для раздачи контента_ используются в запросах клиентов к CDN-серверам. Например, чтобы файл `styles/common.css` был доступен по адресу `cdn.example.com/styles/common.css`, нужно указать доменное имя `cdn.example.com`.  

При создании ресурса нужно указать хотя бы одно доменное имя. Первое имя является основным, его нельзя изменить после создания ресурса.

Для корректной работы ресурса у вас должны быть:

* Права на все указанные доменные имена.
* Доступ к настройкам DNS для имен. 

  Для каждого имени в настройках вашего DNS-хостинга нужно создать CNAME-запись, связывающую это имя с доменным именем CDN-балансировщика вида `cl-<случайные символы>.gcdn.co`. Оно отображается при создании ресурса и на странице уже созданного ресурса в консоли управления. Например, так может выглядеть запись для доменного имени `cdn.example.com`: 

  ``` 
  cdn.example.com. CNAME cl-4sne12sd.gcdn.co
  ```

## Обмен данными по HTTP {#http}

Клиенты, CDN-серверы и источники обмениваются данными по протоколам HTTP и HTTPS (HTTP over TLS).

### Настройка обмена данными между клиентами и CDN-серверами {#http-clients-cdn}

Протокол коммуникаций между клиентами и CDN-серверами зависит от схемы в URI файлов, которые вы используете в своем сервисе: `http://cdn.example.com/styles/common.css` или `https://cdn.example.com/styles/common.css`. 

Чтобы файлы можно было запрашивать по HTTPS, вам нужно самостоятельно настроить ваши [доменные имена](#hostnames), в том числе выпустить для них TLS-сертификаты. Например, вы можете использовать {{ certificate-manager-full-name}}: [выпустить сертификат от Let's Encrypt<sup>®</sup>](../../certificate-manager/operations/managed/cert-create.md) и [получить его содержимое](../../certificate-manager/operations/managed/cert-get-content.md).

Для ресурса вы можете настроить:

* HTTP-заголовки в ответах CDN-серверов клиентам;
* [обработку кросс-доменных запросов](cors.md) по механизму CORS;
* HTTP-методы, которые разрешено использовать клиентам в запросах к CDN;
* [отправку контента в сжатом виде](compression.md) с использованием HTTP-заголовка `Content-Encoding: gzip`.

### Настройка обмена данными между CDN-серверами и источниками {#http-cdn-origins}

Для коммуникаций между CDN-серверами и источниками можно выбрать протокол: всегда HTTP, всегда HTTPS или тот протокол, по которому CDN-сервер обменивается данными с клиентом.

Выпустить TLS-сертификат от Let's Encrypt<sup>®</sup> для работы по HTTPS можно прямо в {{ cdn-name }}. Сертификат выпускается автоматически после сохранения настроек ресурса, это занимает до 30 минут.

Также для ресурса вы можете настроить:

* значение HTTP-заголовка `Host` в запросах CDN-серверов к источникам: основное [доменное имя для раздачи контента](#hostnames), повтор значения из запроса клиента или произвольное значение;
* другие HTTP-заголовки в запросах CDN-серверов к источникам;
* получение CDN-серверами файлов от источников по частям — [сегментацию контента](slicing.md).

Ресурс и источники должны быть настроены так, чтобы запросы от CDN-серверов были разрешены, обрабатывались корректно и не перенаправлялись.

> Например, если источники перенаправляют запросы с URI со схемой `http` на URI со схемой `https`, для ресурса нужно выбрать протокол HTTPS, и наоборот.

## Статистика использования ресурса {#stats}

{{ cdn-name }} предоставляет метрики использования ресурса за последние 30 дней:

* **Загружено из источников** — объем трафика, загруженного CDN-серверами из источников.
* **Отправлено клиентам** — объем трафика, отправленного с CDN-серверов клиентам.
* **Весь трафик** — сумма метрик **Загружено из источников** и **Отправлено клиентам**.
* **Запросы от клиентов** — количество запросов клиентов к CDN.
* **Ответы из кеша** — количество запросов клиентов, в ответ на которые CDN-серверы отправили [кешированные](caching.md) копии файлов, не запрашивая их у источников (если кеширование на CDN-серверах включено).
* **Ответы с запросами к источникам** — количество запросов клиентов, в ответ на которые CDN-серверы не смогли отправить кешированные копии файлов (например, кеширование отключено, файл еще не кешировался сервером или [время жизни кеша](caching.md#server-side-cache-age) истекло) и обратились за ними к источникам.
* **Снижение нагрузки на источники** — доля трафика, отправленного с CDN-серверов клиентам, за которым не потребовалось обращаться к источникам. Рассчитывается по формуле `(1 − (Загружено из источников / Отправлено клиентам)) × 100%`.
* **Ответы с кодами 2xx**, **3xx**, **4xx**, **5xx** — количество ответов, отправленных CDN-серверами клиентам, с соответствующими HTTP-кодами состояния.