---
title: Справочник логов запросов к CDN-серверам и экранирующим серверам
description: В данном разделе приведены описания полей логов запросов к CDN-серверам и экранирующим серверам для разных провайдеров.
---

# Справочник логов запросов к CDN-серверам и экранирующим серверам

Логи запросов к CDN-серверам и экранирующим серверам отличаются в зависимости от используемого [провайдера](concepts/providers.md).

Подробнее о выгрузке логов см. в разделе [Выгрузка логов](concepts/logs.md).

## {{ cdn-full-name }} {#yc-cdn}

Логи {{ cdn-full-name }} сохраняются в формате JSON. Одна запись в логах соответствует одному запросу к CDN-серверу.

### Пример лога {#yc-cdn-example}

```json
{
  "resource_id": "cdnrxyssrqvk********",
  "timestamp_ms": "2025-11-17 16:23:18.798",
  "bytes_sent": 103356,
  "request_uri": "/probe/test_file_102400.mp4?size=102400",
  "status": "200",
  "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 YaBrowser/25.8.0.0 Safari/537.36",
  "request_id": "3ecf1d50********",
  "remote_addr": "178.19.*.*",
  "upstream_addr": "",
  "request_time": 0,
  "upstream_cache_status": "HIT",
  "http_host": "*******.cdn.yandex.net",
  "upstream_response_time": ""
}
```

### Поля логов {#yc-cdn-fields}

#|
|| **Поле** | **Тип** | **Описание** ||
|| `resource_id` | String | Идентификатор ресурса клиента. ||
|| `timestamp_ms` | String | Время события по UTC. ||
|| `bytes_sent` | Int64 | Общее количество байтов, отправленных клиенту, включая заголовок ответа. ||
|| `request_uri` | String | Полный оригинальный URI запроса, полученный сервером [точки присутствия](./concepts/points-of-presence.md). ||
|| `status` | String | Код ответа, переданный клиенту на запрос. ||
|| `user_agent` | String | Идентифицирует браузер клиента, сделавший запрос. ||
|| `request_id` | String | Внутренний идентификатор запроса внутри сервиса. ||
|| `remote_addr` | String | IP-адрес клиента, сделавшего запрос. ||
|| `upstream_addr` | String | IP-адрес источника, который отдал ответ на запрос. Если ответ был выдан из кеша сервера точки присутствия, это поле будет пустым. ||
|| `request_time` | Float | Время обработки запроса в секундах. Это время, прошедшее с момента чтения первых байт от клиента до момента записи в лог после отправки последних байт клиенту. ||
|| `upstream_cache_status` | String | Статус обработки кеша. Возможные значения:

* `HIT` — ответ получен из кеша.
* `MISS` — ответ получен после обращения к источнику.
* `BYPASS` — кеш принудительно пропущен, ответ получен после обращения к источнику.
* `EXPIRED` — TTL хранения кеша истек, ответ получен после обращения к источнику.
* `STALE` — отдан устаревший (неактуальный) кеш. ||
|| `http_host` | String | Доменное имя, указанное клиентом в HTTP-заголовке Host при обращении к серверу. ||
|| `upstream_response_time` | String | Время ответа источника. Если ответ был выдан из кеша сервера точки присутствия, это поле будет пустым. ||
|#

## EdgeCDN {#edgecdn}

Логи [EdgeCDN](https://edgecenter.ru/cdn) содержат информацию о запросах пользователей, которые поступают на кеширующие CDN-серверы и прекеш-сервер (если для ресурса [подключен шилдинг](https://edgecenter.ru/knowledge-base/cdn/origin-shielding)). Логи сохраняются в текстовом формате. Одна запись в логах соответствует одному запросу к CDN-серверу.

### Формат лога {#edgecdn-format}

```text
"$remote_addr" "-" "$remote_user" "[$time_local]" "$request" "$status" "$body_bytes_sent" "$http_referer" "$http_user_agent" "$bytes_sent"
"$edgename" "$scheme""$host" "$request_time" "$upstream_response_time" "$request_length" "$http_range" "[$responding_node]"
"$upstream_cache_status" "$upstream_response_length" "$upstream_addr" "$gcdn_api_client_id" "$gcdn_api_resource_id" "$uid_got" "$uid_set"
"$geoip_country_code" "$geoip_city" "$shield_type" "$server_addr" "$server_port" "$upstream_status" "-" "$upstream_connect_time"
"$upstream_header_time" "$shard_addr" "$geoip2_data_asnumber" "$connection" "$connection_requests" "$request_id" "$http_x_forwarded_proto"
"$http_x_forwarded_request_id" "$ssl_cipher" "$ssl_session_id" "$ssl_session_reused" "$sent_http_content_type" "$real_tcpinfo_rtt"
"$http_x_forwarded_http_ver" "$vp_enabled" "$geoip2_region"
```

### Пример лога {#edgecdn-example}

```
"0.0.0.0" "-" "-" "[26/Apr/2019:09:47:40 +0000]" "GET /ContentCommon/images/image.png HTTP/1.1" "200" "1514283" "https://example.com/videos/10"
"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 YaBrowser/16.10.0.2309 Safari/537.36"
"1514848" "[dh-up-gc18]" "https" "cdn.example.com" "1.500" "0.445" "157" "bytes=0-1901653" "[dh]" "MISS" "10485760" "0.0.0.0:80" "2510" "7399" "-"
"-" "KZ" "-" "shield_no" "0.0.0.0" "80" "206" "-" "0.000" "0.200" "0.0.0.0" "asnumber" "106980391" "1" "c1c0f12ab35b7cccccd5dc0a********" "-" "-"
"ECDHE-RSA-AES256-GCM-SHA384" "28a4184139cb43cdc79006cf2d1a4ac9********" "r" "application/json" "11863" "HTTP/1.1" "1" "AMU"
```

### Переменные лога {#edgecdn-fields}

Системные переменные EdgeCDN не несут ценной информации для клиентского анализа.

#|
|| **Переменная** | **Значение из примера** | **Пояснение** ||
|| `$remote_addr` | `0.0.0.0` | IP-адрес пользователя. ||
|| `-` | `-` | Поле не используется. ||
|| `$remote_user` | Внутренняя системная переменная. | Имя пользователя, использованное в Basic-аутентификации. ||
|| `[$time_local]` | `[26/Apr/2019:09:47:40 +0000]` | Локальное время в [Common Log Format](https://www.w3.org/Daemon/User/Config/Logging.html#common-logfile-format). ||
|| `$request` | 

```bash
GET
/ContentCommon/images/image.png
HTTP/1.1
```

| Тип HTTP-запроса, запрошенный путь к файлу, версия HTTP. ||
|| `$status` | `200` | Код ответа от CDN-сервера. ||
|| `$body_bytes_sent` | `1514283` | Число байт, переданных клиенту, без учета заголовка ответа. ||
|| `$http_referer` | `https://example.com/videos/10` | URL, с которого пришел пользователь. ||
|| `$http_user_agent` | `Mozilla/5.0...` | User Agent, с которым обратился пользователь за файлом (браузер или иная программа). ||
|| `$bytes_sent` | `1514848` | Число байт, переданных пользователю. ||
|| `[$edgename]` | `[dh-up-gc18]` | Имя ответившего CDN-сервера в EdgeCDN. ||
|| `$scheme` | `https` | Протокол запроса (HTTP или HTTPS). ||
|| `$host` | `cdn.example.com` | Персональный домен CDN-ресурса. ||
|| `$request_time` | `1.500` | Время обработки запроса, прошедшее с момента чтения первых байт от клиента до момента записи в лог после отправки последних байт клиенту, в секундах с точностью до миллисекунд. ||
|| `$upstream_response_time` | `0.445` | Время, затраченное на получение ответа от источника, в секундах с точностью до миллисекунд. Время нескольких ответов указывается через запятые и двоеточия. ||
|| `$request_length` | `157` | Длина запроса (включая строку, заголовок и тело запроса). ||
|| `$http_range` | `bytes=0-1901653` | Размер фрагмента файла при Range-запросе. ||
|| `[$responding_node]` | `dh` | Имя ответившего дата-центра в EdgeCDN. ||
|| `$upstream_cache_status` | `MISS` | Статус запрошенного файла в кеше CDN:

* `HIT` — файл отдан из кеша.
* `STALE` — файл устарел, так как источник не ответил или ответил неправильно при обновлении кеша.
* `UPDATING` — файл устарел, так как находится в процессе обновления после поступившего ранее запроса.
* `REVALIDATED` — в результате запуска директивы proxy_cache_revalidate установлено, что файл на источнике не изменился.
* `EXPIRED` — срок жизни в кеше истек, но файл соответствует файлу с источника. Отправлен запрос на источник для повторного кеширования.
* `MISS` — файл отдан не из кеша, проксирован с источника.
* `BYPASS` — при первом запросе файла после очистки кеша. ||
|| `$upstream_response_length` | `10485760` | Длина ответа, полученная от источника, хранится в байтах. Длины нескольких ответов разделяются запятыми и двоеточиями. ||
|| `$upstream_addr` | `0.0.0.0:80` | IP-адрес источника и порт. ||
|| `$gcdn_api_client_id` | Внутренняя системная переменная. | Ваш идентификатор в системе EdgeCDN. ||
|| `$gcdn_api_resource_id` | Внутренняя системная переменная. | Идентификатор вашего CDN-ресурса в системе EdgeCDN. ||
|| `$uid_got` | Внутренняя системная переменная. | Имя Cookie и полученный идентификатор пользователя. ||
|| `$uid_set` | Внутренняя системная переменная. | Имя Cookie и выданный идентификатор пользователя. ||
|| `$geoip_country_code` | `KZ` | Код страны пользователя. ||
|| `$geoip_city` | `-` | Код города пользователя. ||
|| `$shield_type` | Внутренняя системная переменная. | Подключен ли шилдинг на этом ресурсе:
* `shield_old` — включен.
* `shield_no` — выключен. ||
|| `$server_addr` | Внутренняя системная переменная. | IP-адрес ответившей anycast-зоны или CDN-сервера. ||
|| `$server_port` | Внутренняя системная переменная. | Порт, на который пришел запрос. ||
|| `$upstream_status` | `206` | Код ответа от источника. ||
|| `-` | `-` | Поле не используется. ||
|| `$upstream_connect_time` | `0.000` | Время, затраченное на подключение к источнику, в секундах с точностью до миллисекунд. ||
|| `$upstream_header_time` | `0.200` | Время, затраченное на получение заголовков ответа от источника, в секундах с точностью до миллисекунд. ||
|| `$shard_addr` | Внутренняя системная переменная. | IP-адрес CDN-сервера, который изначально принял запрос клиента при включенном шардинге у ресурса. ||
|| `$geoip2_data_asnumber` | `asnumber` | Номер автономной системы, откуда пришел запрос пользователя. ||
|| `$connection` | Внутренняя системная переменная. | Порядковый номер соединения. ||
|| `$connection_requests` | Внутренняя системная переменная. | Текущее число запросов в соединении. ||
|| `$request_id` | Внутренняя системная переменная. | Уникальный идентификатор запроса, сформированный из 16 случайных байтов, в шестнадцатеричном виде. ||
|| `$http_x_forwarded_proto` | `-` | Изначальный протокол входящего запроса (HTTP или HTTPS). ||
|| `$http_x_forwarded_request_id` | Внутренняя системная переменная. | Изначальный идентификатор входящего запроса. ||
|| `$ssl_cipher` | Внутренняя системная переменная. | Название используемого шифра для установленного SSL-соединения. ||
|| `$ssl_session_id` | Внутренняя системная переменная. | Идентификатор сессии установленного SSL-соединения. ||
|| `$ssl_session_reused` | Внутренняя системная переменная. | Возвращает `r`, если сессия была использована повторно, — иначе `.`. ||
|| `$sent_http_content_type` | `application/json` | Значение HTTP-заголовка Content-Type, указывающее тип MIME передаваемого ресурса. ||
|| `$real_tcpinfo_rtt` | `11863` | Среднее время (задержка), которое необходимо для передачи пакета на сервер и с сервера. ||
|| `$http_x_forwarded_http_ver` | `HTTP/1.1` | Версия HTTP в запросе пользователя. ||
|| `$vp_enabled` | `1` | Флаг определяет, включена ли на ресурсе работа со Стриминговой платформой.
* `1` — включен.
* `0` — выключен. ||
|| `$geoip2_region` | `AMU` | Название региона по стандарту [ISO 3166-2](https://www.iso.org/ru/iso-3166-country-codes.html). ||
|#

Подробнее о логах EdgeCDN см. в [документации EdgeCenter](https://edgecenter.ru/knowledge-base/cdn/raw-logs).

#### См. также {#see-also}

* [Выгрузка логов](concepts/logs.md)
* [Настройка выгрузки логов](operations/resources/configure-logs.md)
