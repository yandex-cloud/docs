# Сеть в {{ data-transfer-full-name }}

{% if audience != "internal" %}
При создании эндпоинта вы можете выбрать [облачную сеть](../../vpc/concepts/network.md) и [группы безопасности](../../vpc/concepts/security-groups.md) для сетевого трафика. Если используемые в эндпоинтах виртуальные машины или кластеры БД находятся в выбранной облачной сети, то во время трансфера к ним будут применены правила выбранных групп безопасности. Это позволяет выполнять трансферы, не изменяя правила существующих групп безопасности виртуальных машин или кластеров БД.

Если вам необходимо мигрировать данные между {{ yandex-cloud }} и сторонним облаком, добавьте в группу безопасности кластера-эндпоинта правила, разрешающие входящие подключения к нему из интернета с [IP-адресов, используемых сервисом {{ data-transfer-name }}](https://stat.ripe.net/widget/announced-prefixes#w.resource%3DAS200350%26w.min_peers_seeing%3D0).

## Диапазоны IP-адресов подсетей {#subnet-address-ranges}

При трансфере между хостами источника и приемника, находящимися внутри {{ yandex-cloud }} в разных подсетях, диапазоны IP-адресов этих подсетей не должны пересекаться. Например, к ошибке приведет использование хостами подсетей с такими диапазонами:

* `network-1/subnet-a` с IPv4 CIDR `10.130.0.0/24`.
* `network-2/subnet-b` с IPv4 CIDR `10.130.0.0/24`.

## Трансфер между источником из внешней сети и приемником в {{ yandex-cloud }} {#source-external}

Обеспечить доступ к источнику, который находится во внешней сети, можно одним из следующих способов:

* [настроив источник таким образом, чтобы к нему можно было подключиться из интернета](../operations/prepare.md#source-mg).
* с помощью [{{ interconnect-full-name }}](../../interconnect/);
* с помощью промежуточной ВМ, на которой настроена [маршрутизация трафика в {{ vpc-name }}](../../vpc/concepts/static-routes.md).

{% else %}
По умолчанию трансферы запускаются на кластере YT Vanga. Источник и приемник должны быть доступны из макроса `_YTVANGANETS_` либо `_YTNETS_`.

## Трансфер между Яндексом и внешним {{ yandex-cloud }}

Для переноса данных из внутреннего облака во внешнее, во внешнем облаке должна быть заведена специальная IPv6-сеть, которая обеспечивает связность со внутренней инфраструктурой Яндекса. Подробности есть в [политиках ИБ](https://wiki.yandex-team.ru/security/policies/yandex-cloud-rules/#setevajasvjaznostibalanceirovka).

Чтобы переносить данные во внешнее Облако, например, в Managed Service for ClickHouse, нужно выполнить следующее:

1. Если такая сеть не была создана при создании облака, запросите ее через [форму](https://st.yandex-team.ru/createTicket?queue=CLOUD&_form=54816). В форме выберите стенд **PROD**, укажите родительский макрос `_CLOUD_YANDEX_CLIENTS_`, и выберите пункт "требуется выделить project_id".
2. Запросите через [Puncher](https://puncher.yandex-team.ru/) доступ к выделенному project_id от макроса `_YTVANGANETS_` либо `_YTNETS_`. Для Managed Service for ClickHouse укажите порты TCP 8443 и 9440. Информацию о портах для других БД смотрите в документации соответствующих БД.
3. Создайте в облаке кластер Managed Service for ClickHouse или другой требуемой БД, разместив его хосты в сети из п.1
4. Создайте эндпоинты и трансфер **во [внутреннем Облаке](https://cloud.yandex-team.ru)**. При этом эндпоинт-приемник нужно настроить как **On-Premise**, явно указав список хостов БД.
5. Активируйте трансфер.

{% note warning %}

Использование выделенной IPv6-сети является предпочтительным способом трансфера в {{ yandex-cloud }}. Не используйте для этого интернет.

{% endnote %}

## Трансферы между Яндексом и хранилищами в интернете

Для экспорта данных в интернет выполните следующее:

1. Согласуйте данное решение с СИБ. Запрещено выкачивать данные из Яндекса без явного одобрения СИБ.
2. Создайте эндпоинты и трансфер **во [внутреннем Облаке](https://cloud.yandex-team.ru)**. При этом эндпоинт в интернете нужно настроить как **On-Premise**, явно указав список хостов БД. Не забывайте включить SSL в настройках подключения, если это необходимо.
3. Заведите тикет на дежурного в очереди [DTSUPPORT](https://st.yandex-team.ru/DTSUPPORT) с указанием `id` трансфера из предыдущего пункта. В тикете обязательно должно присутствовать подтверждение того, что схема согласована с СИБ (например, комментарий или связанный тикет).
4. После того, как дежурный включит для трансфера доступ в интернет (пока что это никак не отображается в UI и где-либо еще), активируйте трансфер и убедитесь в том, что все работает.

Доступ в интернет выдается отдельно для каждого трансфера, поэтому постарайтесь выстроить сценарий работы с данными таким образом, чтобы трансфер можно было переиспользовать на регулярной основе, а не заводить каждый раз новый.
{% endif %}