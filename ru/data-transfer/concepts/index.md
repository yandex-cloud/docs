# Обзор

Сервис {{ data-transfer-full-name }} позволяет легко переносить данные между базами данных. Сервис позволяет сократить время на процесс миграции и минимизировать простой при переключении на новую базу данных. Для переноса данных вам не нужно устанавливать никакие драйверы, вся настройка делается в консоли управления.

## Эндпоинт {#endpoint}

_Эндпоинт_ — это конфигурация для подключения к базе данных.

Эндпоинты доступны для следующих баз данных:
* Пользовательская база данных {{ MY }}.
* База данных [сервиса {{  mmy-short-name }}<sup>®</sup>](../../managed-mysql).
* Пользовательская база данных {{ PG }}.
* База данных [сервиса {{ mpg-short-name }}](../../managed-postgresql).

### Типы эндпоинтов {#endpoint-type}

Эндпоинты бывают следующих типов: 
* Источник — описывает настройки базы данных, из которой будет передаваться информация. 
* Приемник — описывает настройки базы данных, в которую будет производиться перенос информации.

## Трансфер {#transfer}

_Трансфер_ – это процесс переноса данных между двумя эндпоинтами. Трансфер должен находиться в одном каталоге с эндпоинтами, которые он соединяет.

На стадии [Preview](../../overview/concepts/launch-stages.md) соединять можно только эндпоинты в рамках одного типа баз данных. Доступны трансферы между следующими эндпоинтами: 

База данных источник | База данных приемник
----|----
{{ MY }} | {{ mmy-short-name }}
{{ mmy-short-name }} | {{ MY }} 
{{ PG }} | {{ mpg-short-name }}
{{ mpg-short-name }} | {{ PG }} 

### Типы трансферов {#transfer-type}

Трансферы бывают следующих типов:
* Копирование — это конечный процесс переноса снапшота базы данных.
* Репликация — это процесс непрерывного получения изменений из базы данных источника и применения их к базе данных приемнику.
* Копирование и репликация — это перенос и поддержка текущего состояния базы источника в базу приемника.

## Какие задачи решает сервис? {#solutions}

### Миграция однородных баз данных {#migration}

Перенесите свои данные в Облако или из него в рамках сценария аварийного восстановления. При этом исходная (источник) и целевая (приемник) базы данных должны быть одинаковы, а структуры схем, типы данных и коды совместимы.

### Организация процесса разработки и разделение нагрузки {#development}

Воспользуйтесь сервисом {{ data-transfer-name }} для разделения различных сред разработки. 

Например, разработчики, тестировщики или аналитики вашего продукта используют инфраструктуру Облака для своих задач. Вы можете быстро организовать окружение для нового участника, а за наличие в них актуальной копии данных из продуктового окружения будет отвечать сервис {{ data-transfer-name }}. 

Схема работает и в обратном направлении, когда ваша актуальная стабильная версия сервиса базируется в Облаке, а для организации рабочего процесса необходимо иметь реплику данных в локальных базах.

### Объединение нескольких баз данных {#merge}

Используйте {{ data-transfer-name }} для объединения нескольких баз данных в одну. 

Например, при миграции в Яндекс.Облако вы можете собрать свои данные в единую базу данных в сервисе управляемых баз данных. Объединять можно только однородные базы данных.

## Пропускная способность {#bandwidth} 

При копировании скорость может достигать 15 МБ/с. База размером 100 ГБ скопируется за 2–3 часа. При репликации пропускная способность составляет 20–30 тысяч транзакций в секунду.

## Особенности работы сервиса {#specific}

Сценарии, при которых миграция осуществляется между мажорными версиями с понижением версии не гарантируются.

Из-за особенностей протоколов разных БД также есть свои нюансы работы с разными базами данных:
* [{#T}](#mysql).
* [{#T}](#postgresql).

### Особенности работы с MySQL {#mysql}

1. Проверьте, что на источнике включен режим полного binary-лога.
1. Работа с ограничениями (`CONSTRAINT`).
    * По умолчанию `CONSTRAINT` на приемнике включены. Это будет учитываться при работе трансфера. Для крупных баз это может существенно на производительность при репликации.
    * На уровне трансфера доступно отключения `CONSTRAINT`, которая может помочь решить проблему производительности. Но в зависимости от подсистема хранения данных низкого уровня поведение может получиться различным: в отличие от [MyISAM](https://ru.wikipedia.org/wiki/MyISAM), для [InnoDB](https://ru.wikipedia.org/wiki/InnoDB) каскадное удаление работает без гарантий.
1. Регулярное тестирование проходят только подсистемы хранения данных низкого уровня MyISAM и InnoDB. Корректное поведение для остальных не гарантируется.
1. Обработка операторов `ALTER`:
    * В некоторых случаях может приводить к временному замедлению работы репликации, после чего процесс должен восстановиться.
    * Если вы производите сложные манипуляции с изменением схем на источнике, то лучше произвести явные проверки на приемнике.
    
1. Лимит на размер отправляемого chunk можно изменять с помощью параметра `max_allowed_packet`.
1. [SQL mode](https://dev.mysql.com/doc/mysql-replication-excerpt/5.6/en/replication-features-sql-mode.html) на источнике и приемнике должен быть одинаковым.

    Трансфер проверяет данное требование и, в случае обнаружения различий, будет требовать вмешательства администратора.

### Особенности работы с PostgreSQL {#postgresql}

1. Если вы используете [User-defined](https://www.postgresql.org/docs/9.5/xtypes.html) в своих схемах, то необходимо заранее создать схему на приемнике.

    Из-за особенностей репликационного протокола репликация сможет сохранить данные из таких столбцов только с типом `text`.
1. На стадии копирования на приемнике должны быть выключены: проверка целостности внешних ключей, триггеры и другие `constraints`.
    
    Это необходимо из-за отсутствия возможности сделать проверку для конкретной вставки. В такой конфигурации источник обеспечивает гарантии по внешним ключам. 
1. Работа с [sequence](https://www.postgresql.org/docs/9.5/sql-createsequence.html). 

    Значения позиций в последовательности при репликации нельзя гарантированно сохранить, поэтому рекомендуется сделать обновление `sequence` на приемнике.
1. Репликационный протокол PostgreSQL не позволяет получать информацию об изменениях схем данных. 
    
    В случае изменения схемы базы на источнике операция репликации получит ошибку на первой вставке в новое поле или таблицу. На этой стадии потребуется вмешательство администратора на приемнике, чтобы произвести изменения схемы.

