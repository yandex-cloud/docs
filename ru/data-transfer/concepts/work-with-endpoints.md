---
title: Работа {{ data-transfer-full-name }} с источниками и приемниками
description: '{{ data-transfer-full-name }} учитывает особенности источников и приемников при подготовке трансфера и во время передачи данных'
---

# Особенности работы с эндпоинтами

Сервис {{ data-transfer-full-name }} имеет ряд ограничений и особенностей функционирования в зависимости от типов эндпоинтов.

## {{ CH }} {#clickhouse}

Трансферы типов {{ dt-type-copy }} и {{ dt-type-copy-repl }} (на стадии копирования) _из {{ CH }} в {{ CH }}_ не поддерживают работу с `VIEW`. В эндпоинте-источнике типа {{ CH }} `VIEW` должны быть включены в "Список исключенных таблиц", если "Список включенных таблиц" пуст или не указан. Если "Список включенных таблиц" непустой, в нем не должно присутствовать объектов `VIEW`.

Источник поддерживает `MATERIALIZED VIEW`, но работает с ними как с обыкновенными таблицами. Таким образом, в трансферах _из {{ CH }} в {{ CH }}_ `MATERIALIZED VIEW` переносятся как таблицы, а не как объекты `MATERIALIZED VIEW`.

Если на приемнике {{ CH }} включена репликация, то движки для воссоздания таблиц будут выбраны в зависимости от типа источника:

* При переносе данных из строковых СУБД будут использоваться движки [ReplicatedReplacingMergeTree]({{ ch.docs }}/engines/table-engines/mergetree-family/replication/) и [ReplacingMergeTree]({{ ch.docs }}/engines/table-engines/mergetree-family/replacingmergetree/).
* При переносе данных из {{ CH }} будут использоваться движки семейства [ReplicatedMergeTree]({{ ch.docs }}/engines/table-engines/mergetree-family/replication/).

## {{ GP }} {#greenplum}

В трансферах _из {{ GP }} в {{ GP }}_ и _из {{ GP }} в {{ PG }}_ схема не переносится в текущей версии {{data-transfer-full-name}}. При наличии пользовательских типов данных в таблицах в таких трансферах, такие пользовательские типы необходимо создать в целевой базе данных вручную до запуска трансфера. Для переноса схемы вручную можно использовать утилиту [pg_dump]({{ gp.docs.vmware }}/5/greenplum-database/utility_guide-client_utilities-pg_dump.html).

Источник считает `FOREIGN TABLE` и `EXTERNAL TABLE` обыкновенными представлениями и работает с ними в соответствии с общим алгоритмом для `VIEW`.

{% include [matview limits](../../_includes/data-transfer/pg-gp-matview.md) %}

## {{ MG }} {#mongodb}

По умолчанию сервис не шардирует коллекции, переносимые в шардированный кластер. Подробнее см. в разделе [Подготовка к трансферу](../operations/prepare.md#target-mg).

Трансфер в {{ MG }} не переносит индексы. Когда трансфер перейдет в статус {{ dt-status-repl }}, создайте индекс для каждой шардируемой коллекции вручную:

```javascript
db.<имя_коллекции>.createIndex(<свойства_индекса>)
```

Описание функции `createIndex()` см. в [документации {{ MG }}](https://www.mongodb.com/docs/manual/reference/method/db.collection.createIndex/#mongodb-method-db.collection.createIndex).

## {{ MY }} {#mysql}

Типы данных в таблицах приемника {{ MY }} могут иметь свойство `unsigned`:

* `unsigned smallint` — значения более 2^31 не поместятся на приемнике.
* `unsigned bigint` — значения более 2^63 не поместятся на приемнике.

Первичный ключ в {{ MY }} не может быть строкой неограниченной длины.

Приемник {{ MY }} игнорирует имя схемы в источнике и создает таблицы в схеме, имя которой указано в настройках эндпоинта.

## {{ PG }} {#postgresql}

{% include [pg-types-limits](../../_includes/data-transfer/notes/pg-source-features.md) %}

Источник считает `FOREIGN TABLE` обыкновенными представлениями и работает с ними в соответствии с общим алгоритмом для представлений.

Если в источнике трансфера _из {{ PG }} в {{ PG }}_ задан непустой "Список включенных таблиц", пользовательские типы данных, присутствующие в этих таблицах, не переносятся. В этом случае перенесите пользовательские типы данных вручную.

При переносе [партиционированных таблиц](https://www.postgresql.org/docs/current/ddl-partitioning.html) необходимо учитывать следующее:

* **Для таблиц, партиционированных декларативным методом:**

    * Пользователю необходим доступ к основной таблице и всем ее партициям на источнике.
    * Трансфер выполняется по принципу <q>как есть</q>: на приемнике будут созданы все партиции и основная таблица.
    * На этапе копирования партиции переносятся на приемник независимо друг от друга. Для этого настройте [параллельное копирование](sharded.md), оно ускорит трансфер.
    * На этапе репликации данные будут автоматически попадать в нужные партиции.
    * Если после того, как трансфер перешел на этап репликации, на источнике будут созданы новые партиции, необходимо будет перенести их на приемник вручную.
    * Пользователь может перенести на приемник только часть партиций. Для этого он должен добавить эти партиции в [Список включенных таблиц](../operations/endpoint/source/postgresql#additional-settings) или закрыть доступ к ненужным партициям на источнике.

* **Для таблиц, партиционированных методом наследования:**

    * Пользователю необходим доступ к родительской таблице и всем таблицам-наследникам.
    * На этапе копирования данные из таблиц-наследников не дублируются в родительскую таблицу. Чтобы перенести данные из таблиц-наследников, их необходимо явно указать в списке переносимых таблиц.
    * На этапе копирования таблицы-наследники переносятся на приемник независимо друг от друга. Для этого настройте [параллельное копирование](sharded.md), оно ускорит трансфер.
    * На этапе репликации данные будут автоматически попадать в нужные таблицы-наследники или в родительскую таблицу, если наследование используется не для партиционирования.
    * Если после того, как трансфер перешел на этап репликации, на источнике будут созданы новые таблицы-наследники, необходимо будет перенести их на приемник вручную.

    При переносе базы данных из {{ PG }} в другую СУБД пользователь может включить в эндпоинте-источнике настройку [Объединять наследуемые таблицы](../operations/endpoint/source/postgresql#additional-settings). В этом случае:

    * На приемник будет перенесена только родительская таблица, которая будет содержать данные тех таблиц-наследников, которые были явно указаны в списке переносимых таблиц.
    * Пользователь по-прежнему может ускорить трансфер, поскольку копирование таблиц-наследников с источника в общую таблицу на приемнике происходит параллельно. Для ускорения трансфера включите [параллельное копирование](sharded.md).

### Скорость переноса данных {#postgresql-speed}

Средняя скорость переноса одной таблицы в один поток для трансферов из {{ PG }} в:

* {{ PG }} — 21 Мбит/сек.
* Другую СУБД — 3,5 Мбит/сек.

Увеличить скорость переноса данных можно с помощью [параллельного копирования](./sharded.md).



### Количество подключений к базе данных {#postgresql-connection-limit}

В {{ PG }} есть [ограничение на количество подключений пользователя](../../managed-postgresql/concepts/settings-list.md#setting-conn-limit) к базе данных. Если для трансфера количество подключений превышает это ограничение, то трансфер будет работать неправильно или не будет работать вовсе.

Рассчитать количество подключений, которое потребуется трансферу, можно по формулам:

* Для {{ PG }}-источника и типа трансфера _{{ dt-type-copy }}_:

    ```text
    <количество_воркеров> * <количество_потоков> + 1
    ```

    Где:
    * `количество_воркеров` и `количество_потоков` — параметры трансфера, в котором указан {{ PG }}-источник.
    * `1` — подключение для мастер-транзакции.

* Для {{ PG }}-источника и типа трансфера _{{ dt-type-copy-repl }}_:

    ```text
    <количество_воркеров> * <количество_потоков> + 2
    ```

    Где:
    * `количество_воркеров` и `количество_потоков` — параметры трансфера, в котором указан {{ PG }}-источник.
    * `2` — подключения для мастер-транзакции и слот-монитора.

* Для {{ PG }}-приемника:

    ```text
    <количество_воркеров> * <количество_потоков>
    ```

    Где `количество_воркеров` и `количество_потоков` — параметры трансфера, в котором указан {{ PG }}-приемник.

Если расчетное количество превышает ограничение, выполните одно из действий:

* [Уменьшите количество воркеров или потоков](../../data-transfer/operations/transfer.md#update) в трансфере.
* [Увеличьте максимальное допустимое количество подключений](../../managed-postgresql/operations/cluster-users.md#update-settings) для пользователя в {{ PG }}.

## {{ yds-full-name }} {#yds}

По умолчанию при переносе данных из {{ yds-name }} в {{ CH }} для каждой партиции создается отдельная таблица. Чтобы все данные попадали в одну таблицу, укажите правила конвертации в [дополнительных настройках эндпоинта для источника](../operations/endpoint/source/data-streams.md#additional-settings).


## {{ objstorage-name }} {#object-storage}

Трансферы из источника данных {{ objstorage-name }} работают в режиме APPEND-ONLY. Удаление файла из {{ objstorage-name }} никак не повлияет на данные в приемнике. При обновлении файла: если в приемнике указаны синтетические ключи, то строки из файла обновятся в приемнике, если не указаны — допишутся. По умолчанию первичный ключ содержит 2 колонки: имя файла и номер строки в файле.

## Oracle {#oracle}

Источник игнорирует `VIEW` и `MATERIALIZED VIEW` в трансферах любого типа.

{% include [clickhouse-disclaimer](../../_includes/clickhouse-disclaimer.md) %}
