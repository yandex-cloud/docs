# Управление эндпоинтом-источником

[Эндпоинт](../concepts/index.md#endpoint)-источник описывает настройки базы данных, из которой будет передаваться информация с помощью {{ data-transfer-name }}. Вы можете [создать](#create-endpoint), [изменить](#update-endpoint) или [удалить](#delete-endpoint) такой эндпоинт.

## Создать эндпоинт {#create-endpoint}

{% list tabs %}

- Консоль управления

    1. Перейдите на [страницу каталога]({{ link-console-main }}) и выберите сервис **{{ data-transfer-name }}**.
    1. На вкладке **Эндпоинты** нажмите кнопку **Создать эндпоинт**.
    1. В поле **Направление** выберите **Источник**.
    1. Укажите имя эндпоинта. Используйте строчные латинские буквы и цифры.
    1. (Опционально) укажите описание эндпоинта.
    1. В поле **База данных** выберите тип СУБД, из которой вы хотите передавать данные.
    1. Задайте параметры эндпоинта:

        - [{#T}](#settings-mysql).
        - [{#T}](#settings-postgresql).

    1. Нажмите кнопку **Создать**.

{% endlist %}

## Изменить эндпоинт {#update-endpoint}

{% list tabs %}

- Консоль управления

    1. Перейдите на [страницу каталога]({{ link-console-main }}) и выберите сервис **{{ data-transfer-name }}**.
    1. На вкладке **Эндпоинты** выберите эндпоинт и нажмите кнопку ![pencil](../../_assets/pencil.svg) **Редактировать** на панели сверху.
    1. Отредактируйте параметры эндпоинта:

        - [{#T}](#settings-mysql).
        - [{#T}](#settings-postgresql).

    1. Нажмите кнопку **Применить**.

{% endlist %}

## Удалить эндпоинт {#delete-endpoint}

{% include [delete-endpoint](../../_includes/delete-endpoint.md) %}

## Параметры эндпоинтов {#endpoint-settings}

### {{ MY }} {#settings-mysql}

В процессе работы трансфера схема базы данных переносится с источника на приемник. Перенос выполняется в два этапа:

1. На стадии активации.

    Этап выполняется перед копированием или репликацией для создания схемы на приемнике. На этом этапе вы можете включить перенос представлений и хранимых процедур и функций.

2. На стадии деактивации.

    Этот этап выполняется в конце работы трансфера, при его деактивации. Если трансфер постоянно работает в режиме репликации, то финальная стадия переноса будет выполнена только при остановке репликации. На этом этапе вы можете включить перенос представлений, хранимых процедур и функций, триггеров.

    На финальной стадии предполагается, что при деактивации трансфера на источнике нет пишущей нагрузки. Это можно гарантировать переводом в режим «только чтение» (read-only). На этой стадии схема базы данных на приемнике приводится в состояние, когда она будет консистентна схеме на источнике.

{% list tabs %}

- {{ mmy-name }}

    Обязательные настройки:

    - Идентификатор кластера, из которого необходимо передавать данные.
    - Имя базы данных в кластере.
    - Имя пользователя базы данных.
    - Пароль пользователя для доступа к базе данных.

    Дополнительные настройки:

    - Белый список таблиц. Будут передаваться данные только из таблиц белого списка. Задается с помощью регулярных выражений.
    - Черный список таблиц. Данные из таблиц черного списка передаваться не будут. Задается с помощью регулярных выражений.
    - Часовой пояс базы. Указывается как идентификатор IANA. По умолчанию используется UTC+0.
    
- {{ MY }}

    Обязательные настройки:

    - IP или FQDN хоста, из которого необходимо передавать данные.
    - Порт базы данных для подключения к СУБД.
    - Имя базы данных в кластере.
    - Имя пользователя базы данных.
    - Пароль пользователя для доступа к базе данных.

    Дополнительные настройки:

    - Белый список таблиц. Будут передаваться данные только из таблиц белого списка. Задается с помощью регулярных выражений.
    - Черный список таблиц. Данные из таблиц черного списка передаваться не будут. Задается с помощью регулярных выражений.
    - В поле **PEM-сертификат** нажмите кнопку **Загрузить файл** и загрузите [PEM-сертификат](../../managed-mysql/operations/connect.md#Configuring-an-SSL-certificate) для шифрования передаваемых данных.
    - Часовой пояс базы. Указывается как идентификатор IANA. По умолчанию используется UTC+0.

{% endlist %}

### {{ PG }} {#settings-postgresql}

В процессе работы трансфера схема базы данных переносится с источника на приемник. Перенос выполняется в два этапа:

1. На стадии активации.

    Этот этап выполняется при активации трансфера перед копированием или репликацией для создания схемы на приемнике. Вы можете выбрать, какие части схемы будут перенесены. По умолчанию это `TABLE`, `VIEW`, `PRIMARY KEY`, `SEQUENCE`, `SEQUENCE OWNED BY`, `RULE`, `TYPE`, `FUNCTION`, `DEFAULT`.

2. На стадии деактивации.

    Эта стадия выполняется в конце работы трансфера, при его деактивации. Если трансфер постоянно работает в режиме репликации, то финальная стадия переноса будет выполнена только при остановке репликации. Вы можете выбрать, какие части схемы будут перенесены.

    На финальной стадии предполагается, что при деактивации трансфера на источнике нет пишущей нагрузки. Это можно гарантировать переводом в режим «только чтение» (read-only). На этой стадии схема базы данных на приемнике приводится в состояние, когда она будет консистентна схеме на источнике.

    Рекомендуется включать в финальную стадию переноса ресурсоемкие операции, например, перенос индексов. Перенос индексов в начале трансфера может замедлить его работу.

Настройки эндпоинта-источника по умолчанию позволяют успешно выполнить трансфер для большинства баз данных. Изменяйте настройки первичной и финальной стадий переноса только если в этом есть необходимость.

Перенос схемы и на первичной, и на финальных стадиях выполняется с помощью [утилиты `pg_dump`](https://www.postgresql.org/docs/current/app-pgdump.html).

{% note info %}

При перезапуске трансфера на стадии репликации схемы таблиц на приемнике сохраняются. При этом на приемник переносятся только схемы таблиц, отсутствующих в приемнике на момент перезапуска.

{% endnote %}

Значения позиций в последовательности при репликации нельзя гарантированно сохранить, поэтому рекомендуется сделать обновление `sequence` на приемнике.

{% list tabs %}

- {{ mpg-name }}

    Обязательные настройки:

    - Идентификатор кластера, из которого необходимо передавать данные.
    - Имя базы данных в кластере.
    - Имя пользователя базы данных.
    - Пароль пользователя для доступа к базе данных.

    Дополнительные настройки:

    - Белый список таблиц. Будут передаваться данные только из таблиц белого списка. В списке указывайте полные имена таблиц в формате `schema.tablename`.
    - Черный список таблиц. Данные из таблиц черного списка передаваться не будут. В списке указывайте полные имена таблиц в формате `schema.tablename`.
    - Идентификатор репликационного слота PostgreSQL для подключения к кластеру БД.
    - Максимальный размер WAL для слота репликации.
    - В поле **Схема БД приемника, в которой будет создана техническая таблица __consumer_keeper** введите имя схемы хранения.
    - Для объединения содержимого таблиц выберите опцию **Объединить наследуемые таблицы**.
    - Первичная конфигурация переноса схемы на первичной стадии трансфера.
    - Финальная конфигурация переноса схемы на финальной стадии трансфера.

- {{ PG }}

    Обязательные настройки:

    - IP или FQDN хоста, из которого необходимо передавать данные.
    - Порт базы данных для подключения к СУБД.
    - Имя базы данных в источнике.
    - Имя пользователя базы данных.
    - Пароль пользователя для доступа к базе данных.

    Дополнительные настройки:

    - Белый список таблиц. Будут передаваться данные только из таблиц белого списка. Этот список передается в ключе `--table` утилиты `pg_dump.`  В списке указывайте полные имена таблиц в формате `schema.tablename`.
    - Черный список таблиц. Данные из таблиц черного списка передаваться не будут. Этот список передается в ключе `--exclude-table` утилиты `pg_dump.`  В списке указывайте полные имена таблиц в формате `schema.tablename`.
    - Идентификатор репликационного слота {{ PG }} для подключения к кластеру БД.
    - Максимальный размер WAL для слота репликации.
    - В поле **Схема БД приемника, в которой будет создана техническая таблица __consumer_keeper** введите имя схемы хранения.
    - Для объединения содержимого таблиц выберите опцию **Объединить наследуемые таблицы**.
    - Первичная конфигурация переноса схемы на первичной стадии трансфера.
    - Финальная конфигурация переноса схемы на финальной стадии трансфера.

{% endlist %}
