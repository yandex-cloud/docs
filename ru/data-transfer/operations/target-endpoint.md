# Управление эндпоинтом-приемником

[Эндпоинт](../concepts/index.md#endpoint)-приемник описывает настройки базы данных, в которую будет производиться перенос информации с помощью {{ data-transfer-name }}. Вы можете [создать](#create-endpoint), [изменить](#update-endpoint) или [удалить](#delete-endpoint) такой эндпоинт.

## Создать эндпоинт {#create-endpoint}

{% list tabs %}

* Консоль управления

    1. Перейдите на [страницу каталога]({{ link-console-main }}) и выберите сервис **{{ data-transfer-name}}**.
    1. На вкладке **Эндпоинты** нажмите кнопку **Создать эндпоинт**.
    1. В поле **Направление** выберите **Приемник**.
    1. Укажите имя эндпоинта. Используйте строчные латинские буквы и цифры.
    1. (Опционально) укажите описание эндпоинта.
    1. В поле **Тип базы данных** выберите тип приемника, в который вы хотите передавать данные.
    1. Задайте параметры эндпоинта:

        * [{#T}](#settings-clickhouse).
        * [{#T}](#settings-mongodb).
        * [{#T}](#settings-mysql).
        * [{#T}](#settings-storage).
        * [{#T}](#settings-postgresql).
        * [{#T}](#settings-yandex-database).

    1. Нажмите кнопку **Создать**.

{% endlist %}

## Изменить эндпоинт {#update-endpoint}

{% list tabs %}

* Консоль управления

    1. Перейдите на [страницу каталога]({{ link-console-main }}) и выберите сервис **{{ data-transfer-name }}**.
    1. На вкладке **Эндпоинты** выберите эндпоинт и нажмите кнопку ![pencil](../../_assets/pencil.svg) **Редактировать** на панели сверху.
    1. Отредактируйте параметры эндпоинта:

        * [{#T}](#settings-clickhouse).
        * [{#T}](#settings-mongodb).
        * [{#T}](#settings-mysql).
        * [{#T}](#settings-storage).
        * [{#T}](#settings-postgresql).
        * [{#T}](#settings-yandex-database).

    1. Нажмите кнопку **Применить**.

{% endlist %}

## Удалить эндпоинт {#delete-endpoint}

{% include [delete-endpoint](../../_includes/delete-endpoint.md) %}

## Параметры эндпоинтов {#endpoint-settings}

### {{ CH }} {#settings-clickhouse}

* **Тип подключения** — выбор типа подключения к БД:

    {% include [ch-connection-necessary-settings.md](../../_includes/data-transfer/ch-connection-necessary-settings.md) %}

* Дополнительные настройки:

    * **Имя кластера ClickHouse**.
    * **Переопределение имен таблиц**.
    * **Колонка шардирования**.
    * **Шардирование по идентификатору трансфера**.

        {% note warning %}

        Если одновременно включены настройки **Колонка шардирования** и **Шардирование по идентификатору трансфера**, то шардирование будет осуществляться только по идентификатору трансфера.

        {% endnote %}

    * **Мапинг шардов**.

        Если используется шардирование по колонке, настройте распределение значений по шардам кластера-приемника.

    * **Загружать данные в JSON формате** — для необязательных полей будут использованы значения по умолчанию, если они определены. Включите эту настройку, если трансфер будет подключаться к приемнику через HTTP-порт, а не нативный.

    * **Интервал записи**.
    * **Политика очистки** при активации, повторной активации или перезагрузке трансфера. Используются настройки `DISABLED`, `DROP` и `TRUNCATE`.

### {{ MG }} {#settings-mongodb}

* **Настройки подключения** — выбор типа подключения к БД:

    {% include  [mongodb-connection-necessary-settings.md](../../_includes/data-transfer/mongodb-connection-necessary-settings.md) %}

* Дополнительные настройки:

    * **Идентификатор подсети** — выберите подсеть, через которую сервис должен соединяться с кластером-приемником.
    * Для шифрования передаваемых данных в поле **PEM-сертификат** нажмите кнопку **Загрузить файл**.
        Загрузите файл [PEM-сертификата](../../managed-mongodb/operations/connect.md#get-ssl-cert) или добавьте его содержимое в текстовом виде.
    * **Политика очистки** данных в базе-приемнике перед переносом:
        * `DISABLED` — не очищать;
        * `DROP` — полная очистка базы;
        * `TRUNCATE` — удалить только данные, но оставить схему.

### {{ MY }} {#settings-mysql}

* **Настройки подключения** — выбор типа подключения к БД:

    {% include  [mysql-connection-necessary-settings.md](../../_includes/data-transfer/mysql-connection-necessary-settings.md) %}

* Дополнительные настройки:

    * [Режим sql_mode](https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html).

    * Отключение проверки внешних ключей на приемнике. Используются настройки `FOREIGN_KEY_CHECKS=0` и `UNIQUE_CHECKS=0`.

      {% note warning %}

      Отключение проверки внешних ключей (`FOREIGN_KEY_CHECKS=0`) ускорит репликацию, но может привести к нарушению целостности данных при использовании каскадных операций.

      {% endnote %}

    * **Часовой пояс базы**, указывается как идентификатор [IANA Time Zone Database](https://www.iana.org/time-zones). По умолчанию используется UTC+0.

### {{ objstorage-name }} {#settings-storage}

* **Бакет** — имя [бакета](../../storage/concepts/bucket.md), в который будут загружаться данные из источника.

* **SA Аккаунт** — [сервисный аккаунт](../../iam/concepts/users/service-accounts.md) с ролью `storage.uploader`, под которым будет осуществляться доступ к [{{ yds-full-name }}](../../data-streams).

* **Выходной формат** — формат, в котором данные будут записаны в бакет, `JSON` или `CSV`.

* **Паттерн раскладки данных** — путь к каталогу в бакете, в который будут сохранены данные.

* **Размер файла** — разделение данных на файлы указанного размера.

* **Интервал отправки** — интервал отправки данных в бакет, в секундах.

* **Формат сжатия** — сжатие выходных данных, `GZIP` или `UNCOMPRESSED` (отключено).

### {{ PG }} {#settings-postgresql}

**Настройки подключения** — выбор типа подключения к БД:

{% include [pg-connection-necessary-settings.md](../../_includes/data-transfer/pg-connection-necessary-settings.md) %}

### {{ ydb-name }} {#settings-yandex-database}

Для подключения настройте обязательные параметры:

{% include [yd-connection-necessary-settings.md](../../_includes/data-transfer/ydb-connection-necessary-settings.md) %}

Дополнительные настройки:

* **Количество шардов для разделения трафика**.

    Если эта настройка задана, в таблицу добавляется колонка <q>_shard_col</q>. Ее значение вычисляется как остаток от деления H/N, где H — результат хеш-функции от текущего времени, а N — указанное настройкой количество шардов.

* **Ротация таблиц**:

    * **Единица измерения** — час, день или месяц.
    * **Размер таблицы** в выбранных единицах измерения.
    * **Количество таблиц**.
    * **Разбивать по колонке** — по значениям какой колонки разбивать таблицу. Колонка должна иметь тип <q>время</q>.

    Если используется эта настройка, в базе-приемнике создается указанное количество таблиц для данных за различные интервалы времени. Имя каждой таблицы выбирается автоматически по дате и времени начала интервала. В зависимости от значений в указанной колонке таблицы-источника, исходные строки распределяются по соответствующим таблицам базы-приемника.

* **Переопределение имен таблиц**.
* **Поддиректория куда разместить таблицы**.

    Итоговый путь размещения таблицы: `<Путь в Yandex Database>/<Поддиректория>/<Таблица>`.

* **Политика очистки** при активации, повторной активации или перезагрузке трансфера. Используются настройки `DISABLED` и `DROP`. Значение по умолчанию — `DROP`.
