# Настройка эндпоинта-приемника YT

При [создании](../index.md#create) или [изменении](../index.md#update) эндпоинта вы можете задать:

* Настройки подключения к [кластеру YT](#cluster). Эти параметры обязательные.
* [Расширенные настройки](#additional-settings).


## Кластер YT {#cluster}

{% list tabs %}

- Консоль управления

  * **Кластер YT** — имя кластера источника YT, например, `HAHN`, `ARNOLD`, или `FREUD`.

  * **Путь** — пути к таблицам с данными.
  
  * **Тип таблиц** — тип таблиц, которые будут создаваться во время трансфера: `Статические таблицы`, `Динамические таблицы`, `Упорядоченные динамические таблицы` или `Версионированные динамические таблицы`
    
    - Для статических таблиц:
    
      * **Формат чанка** — `Построчный` (значение **scan** используется для оптимизации сканирования) или `Поколоночный` (значение **lookup** — для оптимизации поиска).
  
    - Для динамических таблиц:
  
      * **Таблет-селл бандл** — ячейки таблетов для учета квот.
    
      * **Медиум** — место хранения данных. Выберите `HDD`, `SDD`, `SDD для журналов` или `RAM`.
      
      * **Формат чанка** — `Построчный` (значение **scan** используется для оптимизации сканирования) или `Поколоночный` (значение **lookup** — для оптимизации поиска).
    
      * **Разрешить изменения схемы** — при выборе этой опции схемы таблицы будет автоматически изменяться всякий раз при изменении схемы источника.
      
      * **Атомарные транзакции** — использование свойства `automicity=full` для таблиц.
      
      * **TTL** — время жизни записей в миллисекундах.
  
      * **Расширенные настройки динамических таблиц**:
      
        * **Хранить необработанные данные** — при выборе этой опции все необработанные изменения будут храниться в таблице с постфиксом `_wal`.
        
        * **Архив** — при выборе этой опции все удаления будут помещаться в архивированную таблицу.
        
        * **Колонка с индексом шарда** — количество шардов и имя колонки для шардирования, чтобы записать в этой колонке значение, рассчитанное исходя из значения другой колонки.
        
        * **Дополнительные индексы** — укажите колонку, для которой будет создана таблица, в которой эта колонка будет являться первичным ключом.
    
    - Для упорядоченных динамических таблиц:
    
        * **Таблет-селл бандл** — ячейки таблетов для учета квот.
      
        * **Медиум** — место хранения данных. Выберите `HDD`, `SDD`, `SDD для журналов` или `RAM`.
        
        * **Формат чанка** — `Построчный` (значение **scan** используется для оптимизации сканирования) или `Поколоночный` (значение **lookup** — для оптимизации поиска).
    
        * **Атомарные транзакции** — использование свойства `automicity=full` для таблиц.
      
        * **TTL** — время жизни записей в миллисекундах.

        * **Расширенные настройки динамических таблиц**:
      
          * **Хранить необработанные данные** — при выборе этой опции все необработанные изменения будут храниться в таблице с постфиксом `_wal`.
          
          * **Начальное количество таблетов** — опция определяет сколько таблетов будет создано по умолчанию.
  
    - Для версионированных динамических таблиц:
    
        * **Таблет-селл бандл** — ячейки таблетов для учета квот.
    
        * **Медиум** — место хранения данных. Выберите `HDD`, `SDD`, `SDD для журналов` или `RAM`.
    
        * **Формат чанка** — `Построчный` (значение **scan** используется для оптимизации сканирования) или `Поколоночный` (значение **lookup** — для оптимизации поиска).
      
        * **Разрешить изменения схемы** — при выборе этой опции схема таблицы будет автоматически изменяться всякий раз при изменении схемы источника.
      
        * **Атомарные транзакции** — использование свойства `automicity=full` для таблиц.**
        
        * **TTL** — время жизни записей в миллисекундах.
      
        * **Колонка с версией** - при каждом изменении строки в таблице производится поиск строки с таким первичным ключом. Если версия в найденной строке больше, чем во входящей строке, входящая строка игнорируется.
      
        * **Расширенные настройки версионированных динамических таблиц**:
      
          * **Хранить необработанные данные** — при выборе этой опции все необработанные изменения будут храниться в таблице с постфиксом `_wal`.
          
          * **Колонка с индексом шарда** — количество шардов и имя колонки для шардирования, чтобы записать в этой колонке значение, рассчитанное исходя из значения другой колонки.
  
  * **Политика очистки** — политика очистки для процессов активации, повторной активации и перезагрузки. Значение по умолчанию: `Drop`.

{% endlist %}

## Расширенные настройки {#additional-settings}

{% list tabs %}

- Консоль управления

  * **Переименование таблиц** — используется для переименования таблиц, созданных при трансфере.
  
  * **Ротация таблиц** — разбиение входящего потока данных по времени. Укажите имя колонки для разбиения, тип партиции (час, день, месяц), максимальное количество таблиц для ротации, количество партиций в таблице и шаблон именования таблиц (<name>/<partition>, где <name> - имя таблицы, а <partition> - имя партиции на основе времени.)
  
  * **Максимальное число строк в запросе в YT** — значение по умолчанию: 90000.
  
  * **Переопределение спецификации таблиц** — пользовательская спецификация для записи таблиц в формате JSON. Нажмите **Загрузить файл** для добавления спецификации.

{% endlist %}

## Необходимые права для записи в кластер YT {#roles}

Для настройки трансфера в статические таблицы достаточно прав на создание и запись в таблицы (разрешение `write` на директорию с таблицами). Если активирована очистка перед трансфером, то потребуется разрешение `remove`. Также для трансфера потребуется право `use` на аккаунт, ассоциированный с директорией, в которой будут находиться таблицы.

Для настройки трансфера в динамические таблицы, помимо прав `write`, `remove` и `use`, потребуется разрешение на `mount` таблиц и разрешение `use` на используемый для таблиц таблет-селл бандл (имя бандла указывается в [настройках приемника](#cluster)).
Если при этом включена ротация таблиц по времени, то потребуются права на удаление таблиц.

На текущий момент все операции осуществляются от имени робота `robot-lf-dyn-push`.

