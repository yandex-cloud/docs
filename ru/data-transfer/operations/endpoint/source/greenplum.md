# Настройка эндпоинта-источника {{ GP }}

При [создании](../index.md#create) или [изменении](../index.md#update) эндпоинта вы можете задать:

* Настройки подключения к [кластеру {{ mgp-full-name }}](#managed-service) или [пользовательской инсталляции](#on-premise), в т. ч. на базе виртуальных машин {{ compute-full-name }}. Эти параметры обязательные.
* [Дополнительные параметры](#additional-settings).

## Кластер {{ mgp-name }} {#managed-service}

Подключение к БД с указанием идентификатора кластера в {{ yandex-cloud }}. Доступно только для кластеров, развернутых в сервисе [{{ mgp-full-name }}](../../../../managed-greenplum/).

{% list tabs %}

- Консоль управления

    {% include [Managed Greenplum](../../../../_includes/data-transfer/necessary-settings/ui/managed-greenplum.md) %}

{% endlist %}

## Пользовательская инсталляция {#on-premise}

Подключение к БД с явным указанием сетевых адресов и портов.

{% list tabs %}

- Консоль управления

    {% include [On premise Greenplum UI](../../../../_includes/data-transfer/necessary-settings/ui/on-premise-greenplum.md) %}

{% endlist %}

## Дополнительные настройки {#additional-settings}

{% list tabs %}

- Консоль управления

    * **Список включенных таблиц** — будут передаваться данные только из таблиц этого списка.

      Если таблица партиционирована, в этом поле можно указать как всю таблицу, так и отдельные ее партиции.

      Также убедитесь, что для включаемых в список таблиц [выданы необходимые привилегии](../../../../data-transfer/operations/prepare.md#source-gp) пользователю, от имени которого будет осуществляться трансфер.

    * **Список исключенных таблиц** — данные таблиц из этого списка передаваться не будут.

      Если таблица партиционирована, то для исключения таблицы из этого списка необходимо перечислить все ее партиции.

      Для обоих списков поддерживаются выражения вида:

      * `<имя схемы>.<имя таблицы>` — полное имя таблицы;
      * `<имя схемы>.*` — все таблицы в указанной схеме;
      * `<имя таблицы>` — таблица в схеме по умолчанию.

    * **Обеспечивать строгую консистентность снапшота** — при включении {{ data-transfer-name }} выполнит дополнительные действия с источником для обеспечения [консистентности снапшота](#snapshot-consistency).

    * **Схема служебных объектов** — схема, которая будет использоваться для размещения служебных объектов трансфера.

{% endlist %}

## Особенности работы с источником Greenplum {#advanced}

{{ data-transfer-name }} поддерживает только {{ GP }} версии 6. {{ GP }} версий 4 и 5 не поддерживается.

Сервис выполняет операции с кластером {{ GP }} в транзакциях с [уровнем изоляции](https://gpdb.docs.pivotal.io/6-19/ref_guide/sql_commands/SET_TRANSACTION.html) `READ COMMITTED`.

{{ data-transfer-name }} поддерживает работу с включённым [шардированным копированием](../../../concepts/sharded.md) для источника {{ GP }}.

Во время работы с включённым шардированным копированием {{ data-transfer-name }} удерживает открытую транзакцию на хосте-мастере {{ GP }}. При прерывании этой транзакции трансфер завершится с ошибкой.

При отключённом шардированном копировании трансфер переносит данные объектов {{ GP }} `TABLE`, `VIEW`, `FOREIGN TABLE`, и `EXTERNAL TABLE`. Данные из этих объектов трактуются как данные из обыкновенных таблиц и обрабатываются приёмником соответственно. При включённом шардированном копировании трансфер переносит только таблицы (объекты `TABLE`), причём таблицы с [политикой распределения](https://gpdb.docs.pivotal.io/6-19/admin_guide/distribution.html) `DISTRIBUTED REPLICATED` не переносятся.

### Консистентность снапшота {#snapshot-consistency}

При запуске трансфера с отключённым шардированным копированием (по умолчанию) сервис выполняет копирование, взаимодействуя только с [хостом-мастером](../../../../managed-greenplum/concepts/index.md) кластера {{ GP }}. Доступ к копируемым таблицам осуществляется в [режиме блокировки](https://docs.vmware.com/en/VMware-Tanzu-Greenplum/6/greenplum-database/GUID-ref_guide-sql_commands-LOCK.html) `ACCESS SHARE`. Консистентность снапшота обеспечивается средствами {{ GP }}.

При запуске трансфера с включённым шардированным копированием сервис выполняет копирование, взаимодействуя как с хостом-мастером, так и в режиме прямого доступа (utility mode) с [хостами-сегментами](../../../../managed-greenplum/concepts/index.md) кластера {{ GP }}. Доступ к копируемым таблицам осуществляется с блокировкой таблицы в режиме `ACCESS SHARE` или `SHARE`, зависящем от настройки "Обеспечивать строгую консистентность снапшота".

Трансферу с включённым шардированным копированием для обеспечения консистентности снапшота требуется обеспечить неизменность данных в переносимых таблицах. При блокировке в режиме `ACCESS SHARE` (по умолчанию) неизменность данных не обеспечивается сервисом и должна быть обеспечена извне. При блокировке в режиме `SHARE` неизменность данных в исходных таблицах обеспечивается механизмами {{ GP }}.

{% include [greenplum-trademark](../../../../_includes/mdb/mgp/trademark.md) %}
