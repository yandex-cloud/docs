# Хранилище в {{ mmg-name }}


{{ mmg-name }} позволяет использовать сетевые и локальные диски для организации хранилища кластеров баз данных. Сетевые диски реализованы на базе сетевых блоков — виртуальных дисков в инфраструктуре {{ yandex-cloud }}. Локальные диски физически размещаются в серверах хостов БД.

{% include [storage-type](../../_includes/mdb/mmg/storage-type.md) %}

## Особенности хранилища на локальных SSD-дисках {#Local-storage-features}

Хранилище на локальных SSD-дисках не обеспечивает отказоустойчивости хранения данных, а также влияет на тарификацию кластера в целом:

* Такое хранилище в кластере из одного хоста не обеспечивает отказоустойчивости: при отказе диска данные теряются безвозвратно. Поэтому при создании нового кластера {{ mmg-name }} с использованием этого типа диска автоматически настраивается отказоустойчивая конфигурация из трех хостов.
* Кластер с таким хранилищем тарифицируется, даже если он остановлен. Подробнее — в [правилах тарификации](../pricing.md).

## Особенности хранилища на нереплицируемых SSD-дисках {#network-nrd-storage-features}

{% include [nrd-storage-details](../../_includes/mdb/nrd-storage-details.md) %}

## Выбор типа диска при создании кластера {#storage-type-selection}

Количество хостов, которые можно создать вместе с {{ MG }}-кластером, зависит от выбранного типа диска:

* При использовании хранилища на локальных SSD-дисках (`local-ssd`) или на нереплицируемых SSD-дисках (`network-ssd-nonreplicated`) вы можете создать кластер из трех или более хостов (минимум три хоста необходимо, чтобы обеспечить отказоустойчивость).

* При использовании хранилища на сетевых HDD-дисках (`network-hdd`) или сетевых SSD-дисках (`network-ssd`) вы можете добавить любое количество хостов в пределах [текущей квоты](./limits.md).

Подробнее об ограничениях на количество хостов в кластере или [шарде](./sharding.md) см. в разделе [{#T}](./limits.md).


## Управление дисковым пространством {#manage-storage-space}

{% include [mmg-readonly-safeguard.md](../../_includes/mdb/mmg-readonly-safeguard.md) %}

При переходе в режим read-only:

* На хосте запрещаются операции записи, возможны только операции чтения.
* Если хост до перевода в read-only был [первичной репликой](replication.md), то эта роль будет автоматически назначена другому хосту кластера, т. к. роль первичной реплики требует возможности записи на диск.

Если объем данных в кластере продолжает увеличиваться, то в read-only перейдут один за другим все хосты, и кластер перестанет принимать данные на запись.

### Поддержка работоспособности кластера {#read-only-solutions}

Чтобы сохранить работоспособность кластера при переходе хоста в read-only:
* [Увеличьте объем диска на хосте](../operations/update.md#change-disk-size). Если на хосте станет достаточно места, {{ yandex-cloud }} снимет режим read-only автоматически.
* [Добавьте в кластер дополнительные шарды](../operations/shards.md#add-shard). Режим read-only на этом хосте не снимется, но кластер сможет продолжить нормальную работу — при условии, что на остальных шардах есть свободное дисковое пространство.
* Попросите [техническую поддержку]({{ link-console-support }}) о временном снятии режима read-only с этого хоста, чтобы вручную удалить часть данных. 

   {% note alert %}

   Если свободное дисковое пространство снизится до нуля, {{ MG }} аварийно завершит работу и кластер станет неработоспособным.
  
   {% endnote %}

* [Принудительно синхронизируйте](../operations/hosts.md#resetup) данные между хостами. Это поможет, если из кластера был удален большой объем данных, но дисковое пространство не было освобождено (т. е. помечено как доступное к переиспользованию).
