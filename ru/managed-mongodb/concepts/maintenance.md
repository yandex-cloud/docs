# Техническое обслуживание в {{ mmg-name }}

Под техническим обслуживанием понимается:

* автоматическая установка обновлений и исправлений СУБД для хостов (в т. ч. для выключенных кластеров);
* изменение класса хостов и размера хранилища;
* другие сервисные работы.

Изменение мажорной версии СУБД не включено в техническое обслуживание. Подробнее о переходе между мажорными версиями см. в разделе [{#T}](../operations/cluster-version-update.md).

## Окно обслуживания {#maintenance-window}

Предпочтительное время технического обслуживания можно задать при [создании кластера](../operations/cluster-create.md) или [изменении его настроек](../operations/update.md):

* **{{ ui-key.yacloud.mdb.forms.value_maintenance-type-anytime }}** (по умолчанию) — разрешает проведение технического обслуживания в любое время.
* **{{ ui-key.yacloud.mdb.forms.value_maintenance-type-weekly }}** — укажите предпочтительное время начала обслуживания: нужные день недели и час дня по UTC. Например, можно выбрать время, когда кластер наименее загружен.

## Порядок обслуживания {#maintenance-order}

Порядок технического обслуживания кластеров {{ mmg-name }} определяется количеством хостов и наличием [шардов](sharding.md).

### Нешардированный кластер

Техническое обслуживание проводится в следующем порядке:

1. [Вторичные реплики](replication.md) последовательно проходят техническое обслуживание. Порядок хостов в очереди определяется случайным образом. Если во время технического обслуживания потребуется перезагрузка вторичной реплики, она станет недоступной на это время.
1. Первичная реплика (мастер) проходит техническое обслуживание. Если во время технического обслуживания потребуется перезагрузка первичной реплики и она станет недоступной, ее роль возьмет на себя одна из вторичных реплик. Кластер, состоящий из одного хоста, во время его технического обслуживания станет недоступным.

### Шардированный кластер

В шардированных кластерах техническое обслуживание проходит в следующем порядке:

1. Балансировщик останавливает свою работу.
1. Хосты с ролью `MONGOINFRA` при стандартном шардировании или `MONGOCFG` при расширенном последовательно проходят техническое обслуживание. В хостах c ролью `MONGOINFRA` обслуживается только сервис MongoCFG. Техническое обслуживание хостов происходит так же, как и в нешардированных кластерах:

    1. Вторичные реплики последовательно проходят техническое обслуживание. Порядок хостов в очереди определяется случайным образом. Если во время технического обслуживания потребуется перезагрузка вторичной реплики, она станет недоступной на это время.
    1. Первичная реплика проходит техническое обслуживание. Если во время технического обслуживания потребуется перезагрузка первичной реплики и она станет недоступной, ее роль возьмет на себя одна из вторичных реплик.

1. Шарды последовательно проходят техническое обслуживание в порядке возрастания номера шарда. Техническое обслуживание хостов в каждом шарде происходит так же, как и в нешардированных кластерах:

    1. Вторичные реплики последовательно проходят техническое обслуживание. Порядок хостов в очереди определяется случайным образом. Если во время технического обслуживания потребуется перезагрузка вторичной реплики, она станет недоступной на это время.
    1. Первичная реплика проходит техническое обслуживание. Если во время технического обслуживания потребуется перезагрузка первичной реплики и она станет недоступной, ее роль возьмет на себя одна из вторичных реплик. Шард, состоящий из одного хоста, во время его технического обслуживания станет недоступным.

1. Хосты с ролью `MONGOINFRA` при стандартном шардировании или `MONGOS` при расширенном последовательно проходят техническое обслуживание. В хостах c ролью `MONGOINFRA` обслуживается сервис MongoS. Порядок хостов в очереди определяется случайным образом. Если во время технического обслуживания потребуется перезагрузка хоста, он станет недоступным на это время.
1. Балансировщик возобновляет работу.
