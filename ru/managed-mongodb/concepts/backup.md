---
title: "Резервные копии MongoDB"
description: "{{ mmg-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных MongoDB. Резервные копии занимают место в объеме хранилища, выделенном для кластера. Поддерживается восстановление состояния кластера на заданный момент времени (Point-in-Time-Recovery, PITR)."
keywords:
  - бекап
  - backup
  - резервное копирование
  - резервное копирование MongoDB
  - backup MongoDB
  - MongoDB
---

# Резервные копии в {{ mmg-name }}

{{ mmg-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных.

{{ mmg-name }} позволяет восстановить состояние кластера _на любой момент времени_ (Point-in-Time-Recovery, PITR) после создания самой старой резервной копии до момента, когда была заархивирована самая свежая коллекция oplog. Это достигается за счет дополнения данных резервной копии, выбранной в качестве начальной точки для восстановления, записями из коллекции oplog кластера.

При создании резервных копий и восстановлении из них на заданный момент времени учитывайте, что:

* Коллекция oplog архивируется в работающем кластере несколько раз в минуту, после чего загружается в объектное хранилище.

* На создание и загрузку архива коллекции oplog в объектное хранилище требуется некоторое время. Из-за этого состояние кластера, хранящееся в объектном хранилище, может отличаться от реального.

Для использования PITR кластер должен удовлетворять следующим условиям:

* Версия {{ MG }} в кластере — 4.2 и выше.
* Выключенный механизм [шардирования](../tutorials/sharding.md). PITR работает только для кластера с единичным набором реплик (replica set).

Чтобы восстановить кластер из резервной копии, [следуйте инструкциям](../operations/cluster-backups.md#restore).

## Создание резервной копии {#size}

Резервные копии могут быть созданы автоматически или вручную, в обоих случаях создается полная резервная копия всех баз данных.

Резервная копия всех данных кластера автоматически создается раз в день. Отключить автоматическое создание резервной копии невозможно. Однако при [создании](../operations/cluster-create.md) или [изменении](../operations/update.md#change-additional-settings) кластера для таких резервных копий можно задать:

* [Срок их хранения](#storage).
* Время начала резервного копирования. По умолчанию время начала — 22:00 UTC (Coordinated Universal Time). Резервное копирование начнется в течение получаса от указанного времени.

После создания резервная копия сжимается для дальнейшего хранения. Чтобы узнать ее точный размер, запросите [список резервных копий](../operations/cluster-backups.md#list-backups).

Резервные копии создаются только на работающих кластерах. Если вы используете кластер {{ mmg-short-name }} не круглосуточно, проверьте [настройки времени начала резервного копирования](../operations/update.md#change-additional-settings).

О том, как вручную создать резервную копию, читайте в разделе [{#T}](../operations/cluster-backups.md).

## Хранение резервной копии {#storage}

Особенности хранения резервных копий в {{ mmg-name }}:

* Резервные копии хранятся во внутреннем хранилище Яндекса в виде логических дампов и шифруются с помощью [GPG]{% if lang == "ru" %}(https://ru.wikipedia.org/wiki/GnuPG){% endif %}{% if lang == "en" %}(https://en.wikipedia.org/wiki/GNU_Privacy_Guard){% endif %}. У каждого кластера свои ключи шифрования.

* Срок хранения резервных копий существующего кластера зависит от способа их создания:

    * Автоматические резервные копии по умолчанию хранятся {{ mmg-backup-retention }} дней. При [создании](../operations/cluster-create.md) кластера или [изменении](../operations/update.md#change-additional-settings) его настроек можно задать другой срок хранения в диапазоне от {{ mmg-backup-retention-min }} до {{ mmg-backup-retention-max }} дней.

    * Резервные копии, созданные вручную, хранятся бессрочно.

* После удаления кластера все его резервные копии хранятся 7 дней.

* {% include [no-quotes-no-limits](../../_includes/mdb/backups/no-quotes-no-limits.md) %}
* {% include [using-storage](../../_includes/mdb/backups/storage.md) %}

    {% if audience != "internal" %}Подробнее см. в разделе [Правила тарификации для {{ mmg-name }}](../pricing.md#rules-storage).{% endif %}

## Проверка резервной копии {#verify}

### Проверка целостности резервной копии {#integrity}

Целостность резервных копий проверяется на синтетических данных интеграционными тестами сервиса.

### Проверка восстановления из резервной копии {#capabilities}

Для проверки возможностей резервного копирования [восстановите кластер из резервной копии](../operations/cluster-backups.md) и проверьте целостность ваших данных.
