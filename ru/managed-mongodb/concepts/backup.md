# Резервные копии

{{ mmg-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных. Резервные копии занимают место в объеме хранилища, выделенном для кластера. Если суммарный объем данных и резервных копий превышает объем хранилища, превышение [тарифицируется](../pricing.md).

Поддерживается восстановление состояния кластера _на заданный момент времени_ (Point-in-Time-Recovery, PITR). Кластер должен удовлетворять следующим условиям:
- Версия {{ MG }} в кластере — 4.2 и выше.
- Выключеннный механизм [шардирования](../tutorials/sharding.md). PITR работает только для кластера с единичным набором реплик (replica set). 
 
{{ mmg-name }} позволяет восстановить состояние такого кластера на любой момент времени, начиная с завершения создания самой старой полной резервной копии до настоящего времени. Это достигается за счет дополнения данных резервной копии, выбранной в качестве начальной точки для восстановления, записями из журналов `oplog` более поздних резервных копий и кластера. 

Подробнее о PITR и его ограничениях см. в [документации {{ MG }}](https://docs.mongodb.com/database-tools/mongodump/#cmdoption-mongodump-oplog). 

Чтобы восстановить кластер из резервной копии, [следуйте инструкциям](../operations/cluster-backups.md#restore).

## Создание резервной копии {#size}

Резервные копии могут быть созданы автоматически или вручную: 
- Первая и каждая седьмая резервные копии — полные резервные копии всех баз данных.  
- Остальные резервные копии — инкрементные, хранится только разница с предыдущей резервной копией, что позволяет экономить хранилище.

Резервная копия всех данных кластера автоматически создается раз в день. Отключить автоматическое создание резервной копии невозможно. Однако при [создании](../operations/cluster-create.md) или [изменении](../operations/update.md#change-additional-settings) кластера для таких резервных копий можно задать:
- [Срок их хранения](#storage).
- Время начала резервного копирования. Резервное копирование начнется в течение получаса от указанного времени. По умолчанию время начала резервного копирования устанавливается на 22:00 UTC (Coordinated Universal Time). 

О том, как вручную создать резервную копию, читайте в разделе [{#T}](../operations/cluster-backups.md).

## Хранение резервной копии {#storage}

Особенности хранения резервных копий в {{ mmg-name }}:
- Резервные копии хранятся во внутреннем хранилище Яндекса в виде логических дампов и шифруются с помощью [GPG](https://ru.wikipedia.org/wiki/GnuPG). У каждого кластера свои ключи шифрования.
- Резервные копии сжимаются для дальнейшего хранения после создания. Занимаемый ими объем хранилища можно посмотреть, запросив [список резервных копий](../operations/cluster-backups.md#list-backups).
- Автоматические резервные копии по умолчанию хранятся {{ mmg-backup-retention }} дней. При [создании](../operations/cluster-create.md) или [изменении](../operations/update.md#change-additional-settings) кластера можно задать другой срок хранения в диапазоне от {{ mmg-backup-retention-min }} до {{ mmg-backup-retention-max }} дней. Автоматические резервные копии удаляются по истечении срока хранения. Эта функциональность находится на стадии [Preview](../../overview/concepts/launch-stages.md).
- Ручные резервные копии хранятся бессрочно. Эта функциональность находится на стадии [Preview](../../overview/concepts/launch-stages.md).

## Проверка резервной копии {#verify}

### Проверка целостности резервной копии {#integrity}

Целостность резервных копий проверяется на синтетических данных интеграционными тестами сервиса. Резервные копии пользовательских кластеров на текущий момент не проверяются. 

### Проверка восстановления из резервной копии {#capabilities}

Для проверки возможностей резервного копирования [восстановите кластер из резервной копии](../operations/cluster-backups.md) и проверьте целостность ваших данных.