# Управление шардами

Вы можете включить шардирование для кластера с версией {{ MG }} начиная с 4.0, а также добавлять и настраивать отдельные шарды.

{% note alert %}

После того, как шардирование включено, обращаться к базе данных правильно только через хосты mongos, которые хранят и актуализируют информацию о шардировании. Не забудьте изменить адреса хостов в коде ваших приложений.

{% endnote %}

Для повышения доступности шарды должны состоять как минимум из 3 хостов. Небольшие коллекции обычно нет смысла шардировать: скорость обработки запросов будет выше в обычном кластере реплик.

## Включите шардирование {#enable}

Через интерфейс {{ mmg-name }} вы можете быстро создать инфраструктуру шардирования {{ MG }}: хосты mongos и mongocfg, которые необходимы для работы шардированной базы данных.

О том, как непосредственно шардировать базу и коллекции {{ MG }}, читайте в разделе [{#T}](../tutorials/sharding.md).

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.

  1. Нажмите на имя нужного кластера, затем выберите вкладку **Шарды**.

  1. Нажмите кнопку **Включить**.

  1. Выберите параметры хостов mongocfg и mongos, которые будут обеспечивать доступ к шардированным данным.

     Чтобы обеспечить бесперебойный доступ к данным, {{ mmg-name }} позволяет содать не меньше 3 хостов mongocfg и не меньше 2 хостов mongos.

  1. Нажмите кнопку **Включить шардирование**.

  Кластер начнет обновляться. В результате операции будут созданы запрошенные хосты mongocfg и mongos, а также первый шард кластера.

- API

  Включить шардирование кластера можно с помощью метода [enableSharding](../api-ref/Cluster/enableSharding.md).

{% endlist %}


## Получите список шардов в кластере {#list-shards}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.

  1. Нажмите на имя нужного кластера, затем выберите вкладку **Шарды**.

- API

  Получить список шардов кластера можно с помощью метода [listShards](../api-ref/Cluster/listShards.md).

{% endlist %}


## Добавьте шард {#add-shard}

Количество шардов в кластерах {{ mmg-short-name }} ограничено квотами на количество CPU и объем памяти, которые доступны кластерам БД в вашем облаке. Чтобы проверить используемые ресурсы, откройте страницу [Квоты]({{ link-console-quotas }}) и найдите блок **{{ mmg-full-name }}**.

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.
  1. Нажмите на имя нужного кластера и перейдите на вкладку **Хосты**.
  1. Нажмите кнопку **Добавить шард**.
  1. Укажите имя шарда и добавьте нужное количество хостов.
  1. Нажмите кнопку **Создать шард**.

- API

  Добавить хост в кластер можно с помощью метода [addShard](../api-ref/Cluster/addHosts.md).

{% endlist %}


## Удалите шард {#delete-shard}

Вы можете удалить шард из {{ MG }}-кластера, если он не является единственным шардом. Чтобы заменить единственный шард, сначала создайте новый шард, а затем удалите старый.

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.

  2. Нажмите на имя нужного кластера и выберите вкладку **Шарды**.

  3. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) в строке нужного хоста и выберите пункт **Удалить**.

- API

  Удалить хост можно с помощью метода [deleteShard](../api-ref/Cluster/deleteShard.md).

{% endlist %}
