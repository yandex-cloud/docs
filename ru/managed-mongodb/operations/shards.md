# Управление шардами

Вы можете включить [шардирование](../concepts/sharding.md) для кластера с версией {{ MG }} 4.0 и выше, а также добавлять и настраивать отдельные шарды.

{% note alert %}

После того, как [шардирование кластера](../concepts/sharding.md) включено:
- Выключить шардирование невозможно, в кластере всегда будет поддерживаться минимальное количество хостов `MONGOS`, `MONGOCFG` или `MONGOINFRA` в зависимости от [типа шардирования](../concepts/sharding.md#shard-management).
- Обращаться к базам данных следует только через хосты `MONGOS` или `MONGOINFRA`, которые маршрутизируют запросы к шардам. Измените адреса хостов в коде ваших приложений соответствующим образом.

{% endnote %}

Для повышения доступности шарды должны состоять как минимум из 3 хостов. Небольшие коллекции обычно нет смысла шардировать: скорость обработки запросов будет выше в обычном кластере реплик.

## Включить шардирование {#enable}

Через интерфейс {{ mmg-name }} вы можете быстро создать [инфраструктуру шардирования {{ MG }}](../concepts/sharding.md#shard-management). 

О том, как непосредственно шардировать базу и коллекции {{ MG }}, читайте в разделе [{#T}](../tutorials/sharding.md).

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.

  1. Нажмите на имя нужного кластера, затем выберите вкладку **Шарды**.

  1. Нажмите кнопку **Включить**.
  
  1. Выберите один из типов шардирования:
     - **Стандартный** — с использованием хостов `MONGOINFRA`.
     
       Чтобы обеспечить бесперебойный доступ к данным, {{ mmg-name }} требует не менее трех хостов `MONGOINFRA`.
     
     - **Расширенный** — с использованием хостов `MONGOS` и `MONGOCFG`.

       Чтобы обеспечить бесперебойный доступ к данным, {{ mmg-name }} требует не менее двух хостов `MONGOS` и не менее трех хостов `MONGOCFG`. 

     Подробнее см. в разделе [{#T}](../concepts/sharding.md). 

     {% note warning %}
  
     После включения шардирования будет невозможно поменять его тип.
  
     {% endnote %} 

  1. Задайте параметры хостов, которые будут обеспечивать доступ к шардированным данным.

  1. Нажмите кнопку **Включить шардирование**.

  Кластер начнет обновляться. В результате операции будут созданы запрошенные хосты, а также первый шард кластера.

- API

  Включить шардирование кластера можно с помощью метода [enableSharding](../api-ref/Cluster/enableSharding.md).

{% endlist %}


## Получить список шардов в кластере {#list-shards}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.

  1. Нажмите на имя нужного кластера, затем выберите вкладку **Шарды**.

- API

  Получить список шардов кластера можно с помощью метода [listShards](../api-ref/Cluster/listShards.md).

{% endlist %}


## Добавить шард {#add-shard}

Количество шардов в кластерах {{ mmg-short-name }} ограничено квотами на количество CPU и объем памяти, которые доступны кластерам БД в вашем облаке. Чтобы проверить используемые ресурсы, откройте страницу [Квоты]({{ link-console-quotas }}) и найдите блок **{{ mmg-full-name }}**.

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.
  1. Нажмите на имя нужного кластера и перейдите на вкладку **Хосты**.
  1. Нажмите кнопку **Добавить шард**.
  1. Укажите имя шарда и добавьте нужное количество хостов.
  1. Нажмите кнопку **Создать шард**.

- API

  Добавить хост в кластер можно с помощью метода [addShard](../api-ref/Cluster/addHosts.md).

{% endlist %}


## Удалить шард {#delete-shard}

Вы можете удалить шард из {{ MG }}-кластера, если он не является единственным шардом. Чтобы заменить единственный шард, сначала создайте новый шард, а затем удалите старый.

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.

  2. Нажмите на имя нужного кластера и выберите вкладку **Шарды**.

  3. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) в строке нужного хоста и выберите пункт **Удалить**.

- API

  Удалить хост можно с помощью метода [deleteShard](../api-ref/Cluster/deleteShard.md).

{% endlist %}
