# Диагностика производительности в {{ mmg-name }}

{{ mmg-name }} предоставляет встроенный инструмент для диагностики производительности кластера СУБД. Этот инструмент помогает анализировать метрики [профилирования {{ MG }}](#get-profiling) и [индексов](#get-indexes).

{% note warning %}


Эта функциональность находится на стадии [Preview](../../overview/concepts/launch-stages.md).


{% endnote %}

## Активировать сбор статистики {#activate-stats-collector}

Чтобы воспользоваться инструментом диагностики, включите опцию **{{ ui-key.yacloud.mdb.forms.field_diagnostics-enabled }}** при [создании кластера](cluster-create.md) или [изменении его настроек](update.md#change-additional-settings) (по умолчанию опция отключена). По умолчанию, статистика собирается только для запросов длительностью более 300 мс. При необходимости [измените в настройках СУБД](update.md#change-mongod-config) временной порог для сбора статистики медленных запросов в [параметре `slowOpThreshold`](../concepts/settings-list.md#setting-slow-op-threshold).

## Получить данные профилирования {#get-profiling}

Для запросов на чтение/запись и некоторых других запросов к базам данных (например, `aggregate`) доступен просмотр данных, собранных [профилировщиком {{ MG }}](tools.md#explore-profiler):

- График показателей для выбранного среза данных. Можно скрыть или показать отдельные категории на графике, нажав на имя категории в легенде графика.
- Таблица со статистикой по типам запросов.

1. Перейдите на [страницу каталога]({{ link-console-main }}) и выберите сервис **{{ ui-key.yacloud.iam.folder.dashboard.label_managed-mongodb }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **{{ ui-key.yacloud.mongodb.cluster.switch_diagnostics }}** → **{{ ui-key.yacloud.mdb.cluster.diagnostics.label_profiling }}**.
1. Задайте интересующий интервал времени, при необходимости настройте фильтры.
1. Выберите:

   * Срез данных:
       *  `FORM` – по типам запросов;
       *  `HOSTNAME` – по [PRIMARY-хостам](../concepts/replication.md) шардов;
       *  `NAMESPACE` – по именам коллекций;
       *  `SHARD` – по [шардам](../concepts/sharding.md);
       *  `USER` – по пользователям.
   * Параметр агрегирования данных.
       * `COUNT` — число запросов;
       * `DOCUMENTS_EXAMINED` — число документов в коллекции, просканированных в ходе выполнения запроса;
       * `DOCUMENTS_RETURNED` – число возвращенных документов;
       * `DURATION` – продолжительность выполнения запросов;
       * `KEYS_EXAMINED` — число индексных ключей, просканированных в ходе выполнения запроса;
       * `RESPONSE_LENGTH` — размер документа, возвращенного в результате запроса.
   * Функцию агрегирования выбранного параметра:
       * `AVG` – среднее значение;
       * `SUM` – сумма.
   
Подробнее про отображаемые сведения см. [в документации {{ MG }}](https://docs.mongodb.com/manual/reference/database-profiler/#output-reference).

## Получить информацию об индексах {#get-indexes}

Для запросов доступна статистика обращений к коллекциям, а также рекомендации создать индексы определенных полей, чтобы ускорить обработку запросов.

1. Перейдите на [страницу каталога]({{ link-console-main }}) и выберите сервис **{{ ui-key.yacloud.iam.folder.dashboard.label_managed-mongodb }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **{{ ui-key.yacloud.mongodb.cluster.switch_diagnostics }}** → **{{ ui-key.yacloud.mdb.cluster.diagnostics.label_indexes }}**.
1. Задайте интересующий интервал времени, при необходимости настройте фильтры.

В таблице отображаются рекомендуемые поля для создания индекса и количество обращений к коллекциям.
