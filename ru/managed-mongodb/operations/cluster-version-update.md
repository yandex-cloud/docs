# Обновление версии {{ MG }}

Вы можете обновить кластер {{ mmg-name }} до версий 4.0 или 4.2.


## Перед обновлением {#before-update}

Перед обновлением кластера убедитесь, что это не нарушит работу ваших приложений:

1. Посмотрите историю изменений для версий [4.0](https://docs.mongodb.com/v4.0/release-notes/4.0/) или [4.2](https://docs.mongodb.com/v4.0/release-notes/) {{ MG }} и проверьте, не повлияют ли какие-то изменения на работу приложений.
1. Попробуйте обновить тестовый кластер (его можно развернуть, например, из резервной копии основного кластера).
1. [Создайте резервную копию](cluster-backups.md#create-backup) основного кластера непосредственно перед обновлением.

## Обновить кластер {#start-update}

Чтобы обновить кластер {{ mmg-name }}:

{% list tabs %}

- Консоль управления
  
  1. Откройте страницу сервиса **{{ mmg-name }}** в каталоге, где находится обновляемый кластер.
  1. Выберите нужный кластер в списке и нажмите кнопку **Изменить кластер**.
  1. В поле **Версия** выберите пункт *4.0* или *4.2*.
  1. Нажмите кнопку **Сохранить изменения**.
  
  После того, как обновление запущено, кластер переходит в статус `UPDATING`. Дождитесь окончания операции и проверьте версию кластера.
  
- CLI
  
  1. Получите список ваших кластеров {{ MG }}:
  
     ```
     $ yc managed-mongodb cluster list
     +----------------------+---------------+---------------------+--------+---------+
     |          ID          |     NAME      |     CREATED AT      | HEALTH | STATUS  |
     +----------------------+---------------+---------------------+--------+---------+
     | c9q8p8j2gaih8iti42mh |   mongodb406  | 2019-04-23 12:44:17 | ALIVE  | RUNNING |
     +----------------------+---------------+---------------------+--------+---------+
     ```
  
  1. Получите информацию о нужном кластере и проверьте версию {{ MG }}, указанную в свойстве `config.version`:
  
     ```
     $ yc managed-mongodb cluster get c9qut3k64b2o9umqogr7
       id: c9qut3k64b2o9umqogr7
       folder_id: b1g0itj57rbjk9thrinv
       created_at: "2019-07-16T09:43:50.393231Z"
       name: mongodb406
       environment: PRODUCTION
       monitoring:
       - name: Console
         description: Console charts
         link: https://console.cloud.yandex.ru/folders/b1g0itj57rbjk9thrinv/managed-mongodb/cluster/c9qut3k64b2o9umqogr7?section=monitoring
       config:
         version: "3.6"
         feature_compatibility_version: "3.6"
         ...
     ```
  
  1. Запустите обновление {{ MG }}:
  
     ```
     $ yc managed-mongodb cluster update c9qutgkd4b2o9umqog97 --mongodb-version=<номер версии>
     ```
  
     После того, как обновление запущено, кластер переходит в статус `UPDATING`. Дождитесь окончания операции и проверьте версию кластера.
  
- API
  
  Обновить версию {{ MG }} для кластера можно с помощью метода API [update](../api-ref/Cluster/update.md): передайте в запросе нужное значение в свойстве `configSpec.version`.
  
{% endlist %}
