# Мониторинг состояния кластера и хостов

Вы можете отслеживать состояние кластера {{ mmg-name }} и отдельных его хостов с помощью инструментов диагностики в консоли управления. Эти инструменты предоставляют диагностическую информацию в виде графиков.

Собирает значения метрик кластера и отображает графики сервис [{{ monitoring-name }}](../../monitoring/concepts/index.md). Чтобы перейти к работе с метриками, дашбордами или алертами в сервисе {{ monitoring-name }}, нажмите кнопку **Открыть в Мониторинге** на панели сверху.

Период обновления графиков:

* Для хостов стандартной конфигурации и хостов с увеличенным соотношением количества гигабайт RAM к количеству vCPU (`memory-optimized`): {{ graph-update }}.
* Для хостов с гарантированной долей vCPU ниже 100% (`burstable`): {{ graph-update-burstable }}.

{% note info %}

На графиках автоматически применяются наиболее подходящие кратные единицы измерения (мегабайты, гигабайты и т. д.).

{% endnote %}

## Мониторинг состояния кластера {#cluster}

Для просмотра детальной информации о состоянии кластера {{ mmg-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **Мониторинг**.

На странице появятся следующие графики:

* **Asserts total** — количество срабатываний [assert](https://docs.mongodb.com/manual/reference/command/serverStatus/#mongodb-serverstatus-serverstatus.asserts) в кластере.
* **Average operation time per host** — среднее время выполнения команд каждым хостом (в микросекундах).
* **Average operations time on primary** — среднее время выполнения команд на первичных репликах (в микросекундах).
* **Average operations time on secondaries** — среднее время выполнения команд на вторичных репликах (в микросекундах).
* **CPU usage per host** — степень использования vCPU на каждом хосте (в тысячных долях).
* **CPU usage per host, top 5 hosts** — первые пять хостов с максимальной нагрузкой на vCPU (в процентах).
* **Configured oplog size per host** — размер журнала операций (oplog) на каждом хосте кластера (в гигабайтах).
* **Connections per host** — среднее количество подключений к каждому хосту.
* **Data size on primary, top 5 collections** — размер пяти самых больших коллекций на первичной реплике (в байтах).
* **Disk read per host, top 5 hosts** — первые пять хостов с максимальной нагрузкой на чтение (байт/с).
* **Disk space usage per host, top 5 hosts** — первые пять хостов с наибольшим использованием места в хранилище (выводится два графика: в байтах и в процентах).
* **Disk usage per host, top 5 hosts** — первые пять хостов с максимальной нагрузкой на подсистему I/O хранилища (байт/с).
* **Disk write per host, top 5 hosts** — первые пять хостов с максимальной нагрузкой на запись (килобайт/с).
* **Documents affected on primary** — среднее количество затронутых запросами документов на первичной реплике.
* **Documents affected on secondaries** — среднее количество затронутых запросами документов на всех вторичных репликах.
* **Documents affected per host** — среднее количество документов, затронутое запросами на каждом хосте.
* **Hosts available for read** — количество хостов, принимающих запросы на чтение.
* **Hosts available for write** — количество хостов, принимающих запросы на запись.
* **Index size on primary, top 5 indexes** — размер пяти самых больших индексов на первичной реплике (в байтах).
* **Memory usage per host** — объем оперативной памяти, использованной каждым хостом (в байтах).
* **Memory usage per host, top 5 hosts** — первые пять хостов с максимальным использованием оперативной памяти (в процентах).
* **Network data received per host, top 5 hosts** — первые пять хостов с наибольшей нагрузкой чтения на сеть (килобайт/с).
* **Network data sent per host, top 5 hosts** — первые пять хостов с наибольшей нагрузкой записи на сеть (килобайт/с).
* **Network usage per host, top 5 hosts** — первые пять хостов с максимальной общей нагрузкой на сеть (килобайт/с).
* **Open cursors total** — количество открытых в кластере курсоров.
* **Page faults per host** — количество ошибок в работе со страницами оперативной памяти на каждом хосте.
* **Queries on secondaries** — среднее количество запросов каждого типа, выполненных на вторичных репликах.
* **Queryes on primary** — среднее количество выполненных на первичных репликах запросов каждого типа.
* **Readers/writers active queue per host, top 5** — первые пять хостов с наибольшим соотношением количества запросов на чтение к количеству запросов на запись, стоящих в очереди.
* **Replicated queries** — среднее количество реплицированных запросов в кластере.
* **Replication lag per host and write_concern wait** — задержки репликации на каждом хосте и ожидание [подтверждения записи](https://docs.mongodb.com/manual/reference/write-concern/) (в секундах).
* **Scan and order per host** — среднее количество операций сканирования и сортировки данных на каждом хосте.
* **Scanned / returned** — показывает соотношения:
    * `scanned_docs / returned_docs` — количество просканированных документов к количеству возвращенных;
    * `scanned_keys / returned_docs` — количество просканированных ключей индекса к количеству возвращенных документов.
* **TTL indexes total** — общее количество [индексов TTL](https://docs.mongodb.com/manual/core/index-ttl/).
* **Total operations count on cluster** — общее количество выполненных в кластере операций.
* **Total operations time on cluster** — общее время выполнения операций в кластере (в миллисекундах).
* **WiredTiger cache pages evicted on primary** — среднее количество страниц оперативной памяти, вытесненных на первичной реплике.
* **WiredTiger cache state on primary** — использование кеша WiredTiger на первичной реплике (в байтах).
* **WiredTiger checkpoint time on primary** — среднее время создания контрольных точек WiredTiger на первичной реплике (в миллисекундах).
* **WiredTiger concurrent transactions on primary** — среднее количество параллельных транзакций на первичной реплике.
* **WiredTiger transactions state on primary** — среднее количество транзакций каждого уровня на первичной реплике.
* **Write conflicts per host** — количество конфликтов записи на каждом хосте.

## Мониторинг состояния хостов {#hosts}

Для просмотра детальной информации о состоянии отдельных хостов {{ mmg-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{ mmg-name }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **Хосты** → **Мониторинги**.
1. Выберите нужный хост из выпадающего списка. Возле имени хоста будет показана его роль (`PRIMARY` или `SECONDARY`) и тип (`MONGOCFG`, `MONGOD`, `MONGOINFRA`, `MONGOS`).

На этой странице выводятся графики, показывающие нагрузку на отдельный хост кластера:

* **CPU** — загрузка процессорных ядер. При повышении нагрузки значение **Idle** уменьшается.
* **Disk Bytes** — скорость дисковых операций (байт/с).
* **Disk IOPS** — интенсивность дисковых операций (операций/с).
* **Memory** — использование оперативной памяти (в байтах). При высоких нагрузках значение параметра **Free** уменьшается, остальные — растут.
* **Network Bytes** — скорость обмена данными по сети (байт/с).
* **Network Packets** — интенсивность обмена данными по сети (пакетов/с).

## Состояния кластера и хостов
Для просмотра детальной информации о состоянии кластера {{ mch-name }}:

1. Перейдите на страницу каталога и выберите **{{ mch-name }}**.
2. Выберите нужный кластер из списка.

### Состояния кластера

{% include [monitoring-cluster-state](../../_includes/mdb/monitoring-cluster-state.md) %}


### Статусы кластера

{% include notitle [monitoring-cluster-status](../../_includes/mdb/monitoring-cluster-status.md) %}
