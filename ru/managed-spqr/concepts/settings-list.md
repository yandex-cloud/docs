# Настройки {{ SPQR }}

Для кластера {{ mpg-name }} с помощью консоли управления можно задать настройки, которые относятся к {{ SPQR }}. Настройки задаются на уровне кластера.

Настройки роутера (**Router** → **Config**):

* **Show Notice Messages**

    Определяет, выводить ли дополнительную информацию в ответе на запрос (например, имя шарда, адрес хоста, имя пользователя, статус транзакции и т. д.).

    По умолчанию настройка выключена (дополнительная информация не выводится).

    Подробнее см. описание настройки `show_notice_messages` в [документации {{ SPQR }}]({{ spqr.docs }}/configuration/router#debug-settings).

* **Time Quantiles**

    Список временных квантилей для отображения статистики времени выполнения запросов. Значения временных квантилей — числа с плавающей запятой. Если список пуст, статистика не собирается.

    По умолчанию используется множество: [`0.5`, `0.75`, `0.9`, `0.95`, `0.99`, `0.999`, `0.9999`].

    Подробнее см. описание настройки `time_quantiles` в [документации {{ SPQR }}]({{ spqr.docs }}/configuration/router#statistics-settings).

* **Default Route Behavior**

    Определяет, разрешены ли мультишардовые запросы:

    * `block` (по умолчанию) — отклоняет запросы, которые необходимо выполнять на нескольких шардах (безопаснее для обеспечения согласованности данных);
    * `allow` — разрешает выполнение запросов на нескольких шардах (полезно для DDL и административных запросов).

    Подробнее см. описание настройки `query_routing.default_route_behaviour` в [документации {{ SPQR }}]({{ spqr.docs }}/configuration/router#query-routing-settings).

* **Prefer Same Availability Zone**

    Если настройка включена, то запросы только на чтение данных по возможности будут отправляться к хостам-репликам, расположенным в той же зоне доступности, что и роутер.

    По умолчанию настройка включена.

* **Enhanced Multishard Processing**

    Определяет, включать ли расширенную обработку для мультишардовых запросов.

    Подробнее см. описание настройки `query_routing.enhanced_multishard_processing` в [документации {{ SPQR }}]({{ spqr.docs }}/configuration/router#query-routing-settings).

    По умолчанию настройка выключена (расширенная обработка не выполняется).

* **Default Target Session Attrs**

    Определяет значение по умолчанию для [параметра {{ PG }} `target_session_attrs`]({{ pg.docs.org }}/current/libpq-connect.html#LIBPQ-CONNECT-TARGET-SESSION-ATTRS), который указывает предпочтительное состояние сеанса при подключении к базе данных.

    Возможные значения:

    * `any` — подключение к любому доступному хосту, независимо от его состояния.
    * `prefer standby` — предпочтительно подключение к хостам-репликам. Если они все недоступны, происходит подключение к хосту-мастеру.
    * `read only` — подключение только к хостам-репликам. Если они все недоступны, подключение не выполняется.
    * `read write` (по умолчанию) — подключение только к хосту-мастеру. Если он недоступен, подключение не выполняется.
    * `smart read write` — подключение к хосту-мастеру. Если он недоступен, подключение не выполняется. Если в файле конфигурации для настройки `query_routing.auto_route_ro_on_standby` установлено значение `true`, то запросы только на чтение данных автоматически перенаправляются к хостам-репликам (с семантикой `prefer standby`).

    Подробнее см. описание настроек `query_routing.default_target_session_attrs` и `query_routing.auto_route_ro_on_standby` в [документации {{ SPQR }}]({{ spqr.docs }}/configuration/router#query-routing-settings).

* **Default Commit Strategy**

    Определяет стратегию фиксации для распределенных транзакций:

    * `best effort` — одноэтапная фиксация без координации между шардами.
    * `one pc` (по умолчанию) — псевдоним для `best-effort`.
    * `two pc` — двухэтапная фиксация с гарантиями атомарности между шардами.

    Подробнее см. описание настройки `default_commit_strategy` в [документации {{ SPQR }}]({{ spqr.docs }}/configuration/router#transaction-settings).
