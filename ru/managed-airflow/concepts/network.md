# Сеть в {{ maf-name }}

При создании кластера вы можете задать следующие сетевые настройки:

* [Зоны доступности](../../overview/concepts/geo-scope.md), где могут размещаться [компоненты кластера](index.md#components).
* [Сеть и подсети](../../vpc/concepts/network.md) в ее пределах. Подсети соответствуют выбранным зонам доступности.

   Для подсетей действуют определенные [требования](#subnet-requirements), так как кластер выделяет специальные [сетевые адреса](#addresses).

* [Группы безопасности](#security-groups) для разрешения строго определенного исходящего трафика.

## Сетевые адреса кластера {#addresses}

Кластер {{ maf-name }} выделяет специальные сетевые адреса в своих подсетях. С них кластер устанавливает подключения к ресурсам {{ yandex-cloud }} (подключения указаны в [направленных ациклических графах DAG](index.md#about-the-service)). Например, можно [настроить подключение к базе данных](../operations/lockbox-secrets-in-maf-cluster.md) в кластере {{ mpg-full-name }}.

Выделенные сетевые адреса внутренние: кластер подключается к ресурсам {{ yandex-cloud }} в пределах внутренней сети. Если нужно предоставить доступ кластеру к ресурсам в интернете, [настройте NAT-шлюз](../../vpc/operations/create-nat-gateway.md). Во время настройки привяжите таблицу маршрутизации с NAT-шлюзом ко всем подсетям кластера {{ maf-name }}.

Выделенные кластером сетевые адреса динамические. Они могут меняться, например, во время технического обслуживания. Поэтому вместо конкретных адресов используйте диапазоны подсетей кластера, например, в настройках межсетевого экрана в [вашей собственной инфраструктуре](#on-premise).

## Подключение кластера к ресурсам в вашей собственной инфраструктуре {#on-premise}

Вы можете организовать сетевую связность между кластером {{ maf-name }} в облаке и ресурсами в сети вашей собственной инфраструктуры (on-premise). Тогда кластер сможет подключаться к ресурсам в вашей инфраструктуре.

Ограничьте доступ к ресурсам в собственной инфраструктуре с помощью межсетевого экрана. Чтобы доступ был предоставлен трафику только из кластера {{ AF }}, создайте для него отдельные подсети и укажите их диапазоны в настройках межсетевого экрана. Не размещайте в созданных подсетях какие-либо другие ресурсы.

Подробнее о настройке такой сетевой связности читайте в [документации {{ interconnect-full-name }}](../../interconnect/concepts/index.md).

## Требования к подсетям кластера {#subnet-requirements}

Для каждой подсети кластера {{ maf-name }} должны выполняться следующие условия:

* Диапазон сети кластера не пересекается с диапазоном адресов {{ airflow-service-address }} служебной сети, в которой {{ yandex-cloud }} управляет компонентами кластера {{ maf-name }}.

   Диапазон сети кластера объединяет диапазоны всех подсетей в этой сети. Учитываются в том числе подсети, не назначенные кластеру. Например, если кластер находится в подсети `subnet-a` и в сети также есть подсети `subnet-b` и `subnet-d`, то диапазон каждой из этих подсетей не должен пересекаться с {{ airflow-service-address }}.

   Если условие не выполняется, при создании кластера возникнет ошибка.

   Требование относится в том числе к сетям в [вашей собственной инфраструктуре](#on-premise). Из кластера {{ AF }} не получится установить подключение к ресурсам с IP-адресами из диапазона {{ airflow-service-address }}.

* Диапазон подсети включает не менее `2 × N` свободных IP-адресов, где `N` — это суммарное количество экземпляров всех компонентов. Допустим, кластер состоит из двух веб-серверов, трех планировщиков, пяти воркеров и одной службы Triggerer. Тогда `N = 11`, и в подсети должно быть не меньше `22` свободных адресов.

   Такое количество адресов понадобится для специальных [сетевых адресов](#addresses) кластера. Если свободных адресов в подсети не хватает, кластер не сможет работать корректно.

   Чтобы определить количество свободных IP-адресов в подсети, рассчитайте ее размер по маске и затем [узнайте, сколько адресов занято](../../vpc/operations/subnet-used-addresses.md). Но так как количество использованных адресов может меняться, лучше выбрать подсеть с достаточно большим размером.

## Группы безопасности {#security-groups}

Настройки [групп безопасности](../../vpc/concepts/security-groups.md) не влияют на функции кластера {{ maf-name }} и нужны только для подключений из кластера.

Группы безопасности позволяют ограничить только исходящий трафик для кластера {{ maf-name }}, задавать правила для входящего трафика не нужно. Правила для исходящего трафика разрешают кластеру подключаться строго к определенным ресурсам. Но настройки групп безопасности не влияют на доступ к [веб-интерфейсу {{ AF }}](../operations/af-interfaces.md#web-gui) и входящий трафик, который поступает только на веб-сервер кластера.

Если кластеру {{ maf-name }} не назначить ни одну группу безопасности, ему автоматически назначается группа, используемая по умолчанию в сети кластера. При создании этой сети разрешен весь трафик в группе безопасности по умолчанию.

{% note tip %}

При подключении к ресурсу {{ yandex-cloud }} из облачной сети кластера {{ maf-name }} настройте группы безопасности также для ресурса, к которому кластер подключается.

{% endnote %}
