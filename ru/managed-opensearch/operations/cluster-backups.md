---
title: "Управление резервными копиями (снапшотами) {{ OS }}"
description: "{{ mos-name }} позволяет использовать механизм снапшотов {{ OS }} для управления резервными копиями данных. Для работы со снапшотами используется публичный API {{ OS }}, а для их хранения — бакет в {{ objstorage-name }}."
keywords:
  - резервные копии OpenSearch
  - снапшоты OpenSearch
  - OpenSearch
---

# Управление резервными копиями в {{ mos-name }}

{{ mos-short-name }} позволяет создавать резервные копии [индексов](../concepts/indexing.md) как средствами {{ yandex-cloud }}, так и с помощью механизма [снапшотов](https://cloud.yandex.ru/docs/glossary/snapshot) {{ OS }}. Подробнее о механизме снапшотов см. в [документации {{ OS }}]({{ os.docs }}/opensearch/snapshots/snapshot-restore/).


## Резервное копирование средствами {{ yandex-cloud }} {#cloud-backups}

Вы можете создавать [резервные копии](../concepts/backup.md) и восстанавливать кластеры из имеющихся резервных копий.

Также {{ mos-name }} каждый час создает автоматическую резервную копию.

### Получить список резервных копий {#list-backups}

{% list tabs %}

- Консоль управления

    Чтобы получить список резервных копий кластера:

    1. Перейдите на страницу каталога и выберите сервис **{{ mos-name }}**.
    1. Нажмите на имя нужного кластера и выберите вкладку ![backups](../../_assets/mdb/backup.svg) **Резервные копии**.

    Чтобы получить список всех резервных копий в каталоге:

    1. Перейдите на страницу каталога и выберите сервис **{{ mos-name }}**.
    1. Выберите вкладку ![backups](../../_assets/mdb/backup.svg) **Резервные копии**.

- API

    Чтобы получить список резервных копий кластера, воспользуйтесь методом API [listBackups](../api-ref/Cluster/listBackups.md) и передайте в запросе идентификатор кластера в параметре `clusterId`.

    Идентификатор кластера можно получить со [списком кластеров в каталоге](cluster-list.md#list-clusters).

    Чтобы получить список резервных копий всех кластеров {{ mos-name }} в каталоге, воспользуйтесь методом API [list](../api-ref/Backup/list.md) и передайте в запросе идентификатор каталога в параметре `folderId`.

{% endlist %}

### Получить информацию о резервной копии {#get-backup}

{% list tabs %}

- Консоль управления

    Чтобы получить информацию о резервной копии существующего кластера:

    1. Перейдите на страницу каталога и выберите сервис **{{ mos-name }}**.
    1. Нажмите на имя нужного кластера и выберите вкладку ![backups](../../_assets/mdb/backup.svg) **Резервные копии**.

    Чтобы получить информацию о резервной копии удаленного ранее кластера:

    1. Перейдите на страницу каталога и выберите сервис **{{ mos-name }}**.
    1. Выберите вкладку ![backups](../../_assets/mdb/backup.svg) **Резервные копии**.

- API

    Воспользуйтесь методом API [get](../api-ref/Backup/get.md) и передайте в запросе идентификатор резервной копии в параметре `backupId`.

    Чтобы узнать идентификатор резервной копии, [получите список резервных копий](#list-backups).

{% endlist %}

### Создать резервную копию {#create-backup}

{% list tabs %}

- Консоль управления
  
    1. Перейдите на страницу каталога и выберите сервис **{{ mos-name }}**.
    1. Нажмите на имя нужного кластера и выберите вкладку ![backups](../../_assets/mdb/backup.svg) **Резервные копии**.
    1. Нажмите кнопку ![image](../../_assets/plus-sign.svg) **Создать резервную копию**.

    {% include [no-prompt](../../_includes/mdb/backups/no-prompt.md) %}

- API

    Воспользуйтесь методом API [backup](../api-ref/Cluster/backup.md) и передайте в запросе идентификатор кластера в параметре `clusterId`.

    Идентификатор кластера можно получить со [списком кластеров в каталоге](cluster-list.md#list-clusters).

{% endlist %}

{% include [backup-warning](../../_includes/mdb/backups/backup-create-warning.md) %}

### Восстановить кластер из резервной копии {#restore}

Восстанавливая кластер из резервной копии, вы создаете новый кластер с данными из резервной копии. Если в каталоге не хватает [ресурсов](../concepts/limits.md) для создания такого кластера, восстановиться из резервной копии не получится.

Для нового кластера необходимо задать все параметры, обязательные при его создании.

{% list tabs %}

- Консоль управления

    Чтобы восстановить из резервной копии существующий кластер:

    1. Перейдите на страницу каталога и выберите сервис **{{ mos-name }}**.
    1. Нажмите на имя нужного кластера и выберите вкладку ![backups](../../_assets/mdb/backup.svg) **Резервные копии**.
    1. Нажмите на значок ![image](../../_assets/horizontal-ellipsis.svg) для нужной резервной копии, затем нажмите **Восстановить кластер**.
    1. Задайте настройки нового кластера.
    1. Нажмите кнопку **Восстановить кластер**.

    Чтобы восстановить из резервной копии удаленный ранее кластер:

    1. Перейдите на страницу каталога и выберите сервис **{{ mos-name }}**.
    1. Выберите вкладку ![backups](../../_assets/mdb/backup.svg) **Резервные копии**.
    1. Найдите нужную резервную копию по времени создания и идентификатору кластера. В колонке **Имя** содержатся идентификаторы в формате `<идентификатор кластера>:<идентификатор резервной копии>`.
    1. Нажмите на значок ![image](../../_assets/horizontal-ellipsis.svg) для нужной резервной копии, затем нажмите **Восстановить кластер**.
    1. Задайте настройки нового кластера.
    1. Нажмите кнопку **Восстановить кластер**.

    {{ mos-name }} запустит операцию создания кластера из резервной копии.

- API

  Воспользуйтесь методом API [restore](../api-ref/Cluster/restore.md) и передайте в запросе:

    * Идентификатор нужной резервной копии в параметре `backupId`. Чтобы узнать идентификатор, [получите список резервных копий в кластере](#list-backups).
    * Имя нового кластера, который будет содержать восстановленные из резервной копии данные, в параметре `name`. Имя кластера должно быть уникальным в рамках каталога.
    * Конфигурацию кластера в параметре `configSpec`.
    * Идентификатор сети в параметре `networkId`.
    * Идентификатор каталога, в котором должен быть размещен кластер, в параметре `folderId`.

{% endlist %}

## Резервное копирование с помощью снапшотов {#snapshot-backups}

Для работы со снапшотами используется [публичный API {{ OS }}]({{ os.docs }}/api-reference/index/), а для их хранения — бакет в {{ objstorage-name }}.

### Получить список снапшотов {#list-snapshots}

1. Найдите в списке репозиториев {{ OS }} тот, который содержит в себе резервные копии в виде снапшотов:

    ```http
    GET https://admin:<пароль>@<идентификатор хоста {{ OS }} с ролью DATA>.{{ dns-zone }}:{{ port-mos }}/_snapshot/_all
    ```

   Если нужного репозитория нет в списке — [подключите его](s3-access.md).

1. Получите список снапшотов в репозитории:

    ```http
    GET https://admin:<пароль>@<идентификатор хоста {{ OS }} с ролью DATA>.{{ dns-zone }}:{{ port-mos }}/_snapshot/<имя репозитория>/_all
    ```

   Каждой резервной копии соответствует один снапшот.

### Создать снапшот {#create-snapshot}

1. Найдите в списке репозиториев {{ OS }} тот, в котором нужно создать резервную копию в виде снапшота:

    ```http
    GET https://admin:<пароль>@<идентификатор хоста {{ OS }} с ролью DATA>.{{ dns-zone }}:{{ port-mos }}/_snapshot/_all
    ```

    Если нужного репозитория нет в списке — [подключите его](s3-access.md).

1. [Создайте снапшот]({{ os.docs }}/opensearch/snapshots/snapshot-restore/#take-snapshots) нужных данных или целого кластера в выбранном репозитории:

    ```http
    PUT https://admin:<пароль>@<идентификатор хоста {{ OS }} с ролью DATA>.{{ dns-zone }}:{{ port-mos }}/_snapshot/<имя репозитория>/<имя снапшота>
    ```

### Восстановить кластер из снапшота {#restore-from-snapshot}

{% note warning %}

При восстановлении из снапшота версия {{ OS }} в кластере должна быть не ниже версии {{ OS }}, в которой был сделан снапшот.

{% endnote %}

1. [Создайте новый кластер {{ OS }}](cluster-create.md) в нужной конфигурации, но не наполняйте его данными.

    При создании кластера выберите:

    * Количество и класс хостов, размер и тип хранилища исходя из размера снапшота и требований к быстродействию.

    * Версию {{ OS }}, в которой был создан снапшот, или более новую.

1. Закройте открытые индексы с помощью [{{ OS }} API]({{ os.docs }}/api-reference/index-apis/close-index/):

    ```http
    POST: https://admin:<пароль>@<идентификатор хоста {{ OS }} с ролью DATA>.{{ dns-zone }}:{{ port-mos }}/<имя индекса>/_close
    ```

    Для восстановления всего кластера закройте все открытые индексы. Для восстановления отдельных индексов закройте только их.

1. [Получите список резервных копий](#list-snapshots) и найдите нужный снапшот.
1. [Запустите операцию восстановления]({{ os.docs }}/opensearch/snapshots/snapshot-restore/#restore-snapshots) из нужного снапшота всего кластера или отдельных индексов и потоков данных.
