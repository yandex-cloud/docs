---
title: Высокая доступность кластера {{ mch-full-name }}
description: Высокая доступность — это способность системы продолжать работу при отказе одного или нескольких компонентов. Высокая доступность кластера {{ mch-name }} определяется количеством и расположением его хостов, настройками репликации и шардирования, а также другими параметрами кластера.
---

# Высокая доступность кластера {{ mch-full-name }}

[Высокая доступность кластера](../../architecture/fault-tolerance.md#mdb-ha) {{ mch-name }} определяется количеством и расположением его хостов, настройками репликации и шардирования, а также другими параметрами кластера.

## Количество и расположение хостов кластера {#host-configuration}

Кластер {{ mch-name }} состоит из одного или нескольких шардов, каждый из которых включает в себя один или несколько хостов.

### Кластер из одного хоста {#one-host}

Кластер из одного хоста {{ CH }} не обеспечивает высокую доступность. При выходе из строя виртуальной машины хоста такой кластер будет недоступен до окончания работ по восстановлению ВМ. На кластер из одного хоста не распространяется [Соглашение об уровне обслуживания (SLA)](https://yandex.ru/legal/cloud_sla_mdb/).

### Кластер из двух или более хостов {#two-hosts}

В соответствии с [Соглашением об уровне обслуживания (SLA)](https://yandex.ru/legal/cloud_sla_mdb/), высокодоступным считается кластер с конфигурацией из двух или более хостов {{ CH }}, расположенных в разных [зонах доступности](../../overview/concepts/geo-scope.md).

В кластере, состоящем из двух или более хостов, работает [репликация](replication.md): хосты {{ CH }} могут заменять друг друга в качестве основной реплики. Репликацией и распределением запросов по хостам управляет [сервис координации](replication.md) — {{ CK }} или {{ ZK }}. Сервис координации можно выбрать при [создании кластера](../operations/cluster-create.md) или добавить его позднее. В соответствии с SLA, сервис координации высокодоступного кластера должен размещаться на отдельных хостах. Конфигурация, в которой {{ CH }} и {{ CK }} размещены на одних хостах, не является высокодоступной.

В кластере может быть от трех до пяти хостов сервиса координации. Оптимальная конфигурация для высокодоступного кластера — три хоста сервиса координации. Увеличение числа хостов {{ ZK }} или {{ CK }} влияет на доступность кластера следующим образом:

* Четыре хоста сервиса координации  — доступность ниже, чем при использовании трех хостов, так как вероятность отказа двух из четырех хостов выше вероятности отказа двух из трех хостов.
* Пять хостов сервиса координации — кластер остается высокодоступным, так как одновременное отключение двух хостов сервиса координации не приводит к отказу кластера.

В сервисе не поддерживается использование более пяти хостов сервиса координации.

### Кластер из нескольких шардов {#shards}

Шардирование повышает доступность кластера, но кластер, состоящий из нескольких однохостовых шардов, не является высокодоступным. В соответствии с SLA, для высокой доступности шардированного кластера необходимо:

* не менее двух хостов {{ CH }} в каждом шарде, расположенных в разных [зонах доступности](../../overview/concepts/geo-scope.md);
* не менее трех хостов {{ ZK }} или {{ CK }}, расположенных в разных [зонах доступности](../../overview/concepts/geo-scope.md).

[Подробнее о влиянии шардирования на доступность кластера](sharding.md#high-availability).

## Настройки хранилища {#storage-settings}

Если в хранилище заканчивается свободное место, выполнение запросов на вставку (`INSERT`), фоновых мержей и мутаций приостанавливается. [Настройте алерты в {{ monitoring-full-name }}](../operations/monitoring.md#monitoring-integration), чтобы отслеживать степень заполнения хранилища, или включите [автоматическое увеличение размера хранилища](storage.md#autoscaling).

## Настройки обслуживания {#maintenance-settings}

Во время технического обслуживания может потребоваться перезагрузка хостов. Кластер, состоящий из единственного хоста {{ CH }}, во время перезагрузки будет недоступен.

Если кластер состоит из нескольких хостов или шардов, то хосты становятся недоступны по очереди. Чтобы ваши приложения работали бесперебойно, используйте для подключения к кластеру или шарду [особый FQDN](../operations/connect/fqdn.md#auto), всегда указывающий на доступный хост.

[Подробнее о порядке технического обслуживания](maintenance.md).

## Прочие параметры {#other-settings}

На доступность кластера также могут влиять:

* [настройки резервного копирования](backup.md);
* выбранный [тип дисков хранилища](storage.md);
* [классы хостов](instance-types.md);
* [квоты и лимиты](limits.md).
* [настройка групп безопасности](../operations/connect/index.md#configuring-security-groups).

{% include [clickhouse-disclaimer](../../_includes/clickhouse-disclaimer.md) %}
