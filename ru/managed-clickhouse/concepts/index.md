---
title: Взаимосвязь ресурсов сервиса {{ mch-full-name }}
description: Основная сущность, которой оперирует сервис {{ mch-name }}, — кластер баз данных. Каждый кластер состоит из одного или нескольких хостов БД — виртуальных машин с развернутыми серверами СУБД. Хосты кластера могут находиться в разных зонах доступности. Кластер из нескольких хостов автоматически отказоустойчив — один из хостов-реплик возьмет на себя роль мастера, если текущий хост-мастер выйдет из строя.
---

# Взаимосвязь ресурсов в {{ mch-name }}

Основная сущность, которой оперирует сервис {{ mch-name }}, — _[кластер](../../glossary/cluster.md) баз данных_.

Каждый кластер состоит из одного или нескольких _хостов БД_ — виртуальных машин с развернутыми серверами СУБД {{ CH }}. Хосты кластера могут находиться в разных зонах и даже разных регионах доступности. Подробнее о географии {{ yandex-cloud }} см. в разделе [Обзор платформы](../../overview/concepts/geo-scope.md).

Кластер из нескольких хостов {{ CH }} автоматически отказоустойчив — хосты {{ CH }} могут заменять друг друга в качестве основной [реплики](replication.md) кластера. Репликацией и распределением запросов по хостам {{ CH }} управляет {{ CK }} или хосты {{ ZK }}. В зависимости от выбранного механизма кластер будет состоять:

* Только из хостов {{ CH }} с поддержкой {{ CK }}.

* Из хостов {{ CH }} и отдельных хостов {{ ZK }}.


На минимальное количество хостов {{ CH }} в кластере влияют:
    
  * Тип используемого [хранилища](storage.md):

    * Минимум три хоста — для нереплицируемых SSD-дисков (`network-ssd-nonreplicated`).

    * Минимум два хоста — для локальных SSD-дисков (`local-ssd`).

    * Минимум один хост — для следующих дисков:

      * сетевые HDD-диски (`network-hdd`);
      * сетевые SSD-диски (`network-ssd`);
      * сверхбыстрые сетевые SSD-диски с тремя репликами (`network-ssd-io-m3`).

  * Шардирование кластера. При включенном шардировании минимальное количество хостов для выбранного типа диска нужно умножить на количество шардов.

    Подробнее об особенностях и ограничениях шардирования в {{ CH }} см. в [соответствующем разделе](sharding.md).


Кластер из одного хоста {{ CH }} не обеспечивает отказоустойчивость.

Если вам нужно обеспечить отказоустойчивость имеющегося кластера из одного хоста {{ CH }}:

1. [Добавьте в кластер не менее трех хостов {{ ZK }}](../operations/zk-hosts.md#add-zk) для управления репликацией.
1. [Добавьте в кластер хосты {{ CH }}](../operations/hosts.md#add-host), между которыми будут распределяться реплики.

Таким образом кластер станет отказоустойчивым.

При создании кластера необходимо указывать:
* _Класс хостов_ — шаблон виртуальной машины, по которому будут развертываться хосты кластера. Список доступных классов хостов и их характеристики см. в разделе [Классы хостов](instance-types.md).

* _Окружение_ — среду, в которой будет развертываться кластер:
   *  `PRODUCTION` — для стабильных версий ваших приложений.
   *  `PRESTABLE` — для тестирования. Prestable-окружение аналогично Production-окружению и на него также распространяется SLA, но при этом на нем раньше появляются новые функциональные возможности, улучшения и исправления ошибок. В Prestable-окружении вы можете протестировать совместимость новых версий с вашим приложением.

Класс хостов также необходимо указывать при создании [шарда](sharding.md).


Созданный в каталоге кластер доступен по сети для всех виртуальных машин, подключенных к этой же облачной сети. Подробнее о работе сети см. в [документации {{ vpc-name }}](../../vpc/).


{% include [monitoring-access](../../_includes/mdb/monitoring-access.md) %}

{% include [clickhouse-disclaimer](../../_includes/clickhouse-disclaimer.md) %}
