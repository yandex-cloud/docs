# Управление пользователями ClickHouse

Вы можете добавлять и удалять пользователей, а также управлять их индивидуальными настройками.

Вы можете управлять пользователями кластера одним из двух способов:

- С помощью стандартных интерфейсов {{ yandex-cloud }} (CLI, API, консоль управления). Способ подходит, если вы хотите воспользоваться всеми возможностями managed-сервиса {{ yandex-cloud }}.
- С помощью SQL-запросов к кластеру. Способ подходит, если вы хотите использовать уже существующее у вас решение для создания и управления пользователями или если вам требуется поддержка [RBAC](https://ru.wikipedia.org/wiki/Управление_доступом_на_основе_ролей).

## Управление пользователями с помощью SQL {#sql-user-management}

Чтобы управлять пользователями с помощью SQL, [создайте кластер через API](cluster-create.md) с включенной настройкой **sqlUserManagement**. В таком кластере:
- Пользователями можно управлять только с помощью SQL.
- Невозможно включить управление с помощью стандартных интерфейсов {{ yandex-cloud }} (CLI, API, консоль управления).
- Управление осуществляется с помощью учетной записи `admin`. Пароль для нее задается при создании кластера.

Подробнее об управлении пользователями с помощью SQL см. в [документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/access-rights).

## Получить список пользователей {#list-users}

{% list tabs %}

- Консоль управления
  
  1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
  1. Нажмите на имя нужного кластера, затем выберите вкладку **Пользователи**.
  
- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы получить список пользователей кластера, выполните команду:
  
  ```
  $ {{ yc-mdb-ch }} user list
       --cluster-name=<имя кластера>
  ```
  
  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).

- SQL

  1. [Подключитесь](connect.md) к кластеру, используя [учетную запись `admin`](#sql-user-management).
  1. Получите список пользователей:

      ```sql
      SHOW USERS;
      ```

{% endlist %}

## Добавить пользователя {#adduser}

{% list tabs %}

- Консоль управления
  
  Чтобы создать пользователя в кластере:
  1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите кнопку **Добавить**.
  1. Введите имя пользователя базы данных и пароль (от 8 до 128 символов).
  1. Выберите одну или несколько баз данных, к которым должен иметь доступ пользователь:
     1. Выберите базу данных из выпадающего списка **База данных**.
     1. Нажмите кнопку **Добавить** справа от выпадающего списка.
     1. Повторите два предыдущих шага, пока не будут выбраны все требуемые базы данных.
     1. Чтобы удалить базу, добавленную по ошибке, нажмите значок ![image](../../_assets/cross.svg) справа от имени базы в перечне **Права**.
  1. Задайте [дополнительные настройки](#advanced-settings) для пользователя:
     1. Настройте [квоты](#quota-settings) в разделе **Дополнительные настройки → Quota**:
        1. Чтобы добавить квоту, нажмите значок ![image](../../_assets/plus.svg) или кнопку **+ Quotas**. Вы можете добавить несколько квот, которые будут действовать одновременно.
        1. Чтобы удалить квоту, нажмите значок ![image](../../_assets/vertical-ellipsis.svg) справа от имени квоты и выберите пункт **Удалить**.
        1. Чтобы изменить квоту, задайте требуемые [значения настроек](#quota-settings) для неё.
     1. Настройте [{{ CH }}](#clickhouse-settings) в разделе **Дополнительные настройки → Settings**.
  1. Нажмите кнопку **Добавить**.
  
  См. также: [пример создания пользователя с правами «только чтение»](#example-create-readonly-user).
     
- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы создать пользователя в кластере, выполните команду:
  
  ```
  $ {{ yc-mdb-ch }} user create <имя пользователя>
       --cluster-name=<имя кластера>
       --password=<пароль пользователя>
       --permissions=<список баз, к которым пользователь должен иметь доступ>
       --quota=<список настроек одной квоты для пользователя>
       --settings=<список настроек {{ CH }} для пользователя>
  ```
    
  Подробнее о [квотах](#quota-settings) и [настройках {{ CH }}](#clickhouse-settings) читайте в разделе [Дополнительные настройки](#advanced-settings).
  
  Чтобы задать несколько квот, перечислите их, используя требуемое количество параметров `--quota` в команде:
  
  ```
  $ {{ yc-mdb-ch }} user create <имя пользователя>
      ...
      --quota="<настройки квоты 0>"
      --quota="<настройки квоты 1>"
      ...
  ```
  
  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).
  
  См. также: [пример создания пользователя с правами «только чтение»](#example-create-readonly-user).

- SQL

  1. [Подключитесь](connect.md) к кластеру, используя [учетную запись `admin`](#sql-user-management).
  1. Создайте пользователя:

      ```sql
      CREATE USER <имя пользователя> IDENTIFIED WITH sha256_password BY '<пароль пользователя>';
      ```

  Подробнее о создании пользователей см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/sql-reference/statements/create/user/).

{% endlist %}

## Изменить пароль {#updateuser}

{% list tabs %}

- Консоль управления

  Чтобы изменить пароль пользователя:
  1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/vertical-ellipsis.svg) и выберите пункт **Изменить пароль**.
  1. Задайте новый пароль и нажмите кнопку **Изменить**.
  
- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
   
  Чтобы изменить пароль пользователя, выполните команду:

  ```
  $ {{ yc-mdb-ch }} user update <имя пользователя>
       --cluster-name=<имя кластера>
       --password=<новый пароль>
  ```
  
  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).
   
- SQL

  1. [Подключитесь](connect.md) к кластеру, используя [учетную запись `admin`](#sql-user-management).
  1. Измените пароль пользователя:

      ```sql
      ALTER USER <имя пользователя> IDENTIFIED BY '<новый пароль>';
      ```

  Подробнее об изменении пользователей см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/sql-reference/statements/alter/user/).

{% endlist %}

## Изменить настройки пользователя {#update-settings}

{% list tabs %}

- Консоль управления
  
  Чтобы изменить настройки пользователя:
  1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/vertical-ellipsis.svg) и выберите пункт **Настройки**.
  1. Настройте права пользователя на доступ к определенным базам данных:
     1. Чтобы предоставить доступ к требуемым базам данных:
        1. Выберите базу данных из выпадающего списка **База данных**.
        1. Нажмите кнопку **Добавить** справа от выпадающего списка.
        1. Повторите два предыдущих шага, пока не будут выбраны все требуемые базы данных.
     1. Чтобы отозвать доступ к определенной базе, удалите ее из перечня **Права**, нажав значок ![image](../../_assets/cross.svg) справа от имени базы.
  1. Настройте [квоты](#quota-settings) для пользователя в разделе **Дополнительные настройки → Quotas**:
     1. Чтобы добавить квоту, нажмите значок ![image](../../_assets/plus.svg) или кнопку **+ Quotas**. Вы можете добавить несколько квот, которые будут действовать одновременно.
     1. Чтобы удалить квоту, нажмите значок ![image](../../_assets/vertical-ellipsis.svg) справа от имени квоты и выберите пункт **Удалить**.
     1. Чтобы изменить квоту, задайте требуемые [значения настроек](#quota-settings) для неё.
  1. Измените [настройки {{ CH }}](#clickhouse-settings) для пользователя в разделе **Дополнительные настройки → Settings**.   
  1. Нажмите кнопку **Сохранить**.
  
- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Из интерфейса командной строки можно изменить настройки пользователя:
  1. Чтобы настроить права пользователя на доступ к определенным базам данных, выполните команду, перечислив список имен баз данных с помощью параметра `--permissions`:
  
     ```
     $ {{ yc-mdb-ch }} user update <имя пользователя>
          --cluster-name=<имя кластера>
          --permissions=<список баз, к которым пользователь должен иметь доступ>
     ```
  
     Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).
     
     Эта команда предоставляет пользователю доступ к базам данных, указанным в списке.
  
     Чтобы отозвать доступ к определенной базе, исключите ее имя из списка и передайте команде обновленный список.
  
  1. Чтобы изменить [настройки квот](#quota-settings) для пользователя, выполните команду, перечислив список всех квот, с помощью параметров `--quota` (один параметр на каждую квоту):
  
     ```
     $ {{ yc-mdb-ch }} user update <имя пользователя>
          --cluster-name=<имя кластера>
          --quota=<настройки квоты 0 (без изменений)>
          --quota=<настройки квоты 1 (без изменений)>
          --quota=<настройки квоты 2 (с изменениями)>
          --quota=<настройки квоты 3 (без изменений)>
          --quota=<настройки квоты 4 (с изменениями)>
          --quota=<настройки квоты 5 (новая квота)>       
         ...
     ```
     
     Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).
     
     Эта команда перезаписывает все существующие настройки квот пользователя новыми настройками, набор которых был передан команде. 
     Перед выполнением команды убедитесь, что вы включили в этот набор как настройки новых и измененных квот, так и настройки существующих квот, которые не изменялись.
  
     Чтобы удалить одну или несколько квот пользователя, исключите настройки этих квот из набора и передайте команде обновленный набор параметров `--quota`.
    
  1. Чтобы изменить [настройки {{ CH }}](#clickhouse-settings) для пользователя, выполните команду, перечислив измененные настройки с помощью параметра `--settings`:
  
     ```
     $ {{ yc-mdb-ch }} user update <имя пользователя>
          --cluster-name=<имя кластера>
          --settings=<список настроек {{ CH }}>    
     ```
     
     Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).
     
     Команда изменит только те настройки, которые явно указаны в параметре `--settings`. Например, команда с параметром `--settings="readonly=1"` изменит только настройку `readonly` и не сбросит значения остальных. Этим изменение настроек {{ CH }} отличается от изменения настроек квот.
     
     С помощью этой команды невозможно удалить сделанную настройку, допустимо только явно присвоить ей значение по умолчанию (оно указано для [каждой настройки](#clickhouse-settings)).

- SQL

  1. [Подключитесь](connect.md) к кластеру, используя [учетную запись `admin`](#sql-user-management).
  1. Чтобы изменить набор привилегий и ролей пользователя, используйте запросы [GRANT](https://clickhouse.tech/docs/ru/sql-reference/statements/grant/) и [REVOKE](https://clickhouse.tech/docs/ru/sql-reference/statements/revoke/). Например, выдайте пользователю права на чтение всех объектов в определенной базе данных:

      ```sql
      GRANT SELECT ON <имя базы данных>.* TO <имя пользователя>;
      ```

  1. Чтобы изменить [настройки квот](#quota-settings) для пользователя, используйте запросы [CREATE QUOTA](https://clickhouse.tech/docs/en/sql-reference/statements/create/quota/#create-quota-statement), [ALTER QUOTA](https://clickhouse.tech/docs/en/sql-reference/statements/alter/quota/#alter-quota-statement) и [DROP QUOTA](https://clickhouse.tech/docs/en/sql-reference/statements/drop/#drop-quota-statement). Например, ограничьте суммарное количество запросов пользователя за период 15 месяцев:

      ```sql
      CREATE QUOTA <название квоты> FOR INTERVAL 15 MONTH MAX QUERIES 100 TO <имя пользователя>;
      ```

  1. Чтобы изменить учетную запись пользователя, используйте запрос [ALTER USER](https://clickhouse.tech/docs/ru/sql-reference/statements/alter/user/). Например для изменения [настроек {{ CH }}](#clickhouse-settings) выполните следующую команду, перечислив настройки подлежащие изменению:

      ```sql
      ALTER USER <имя пользователя> SETTINGS <список настроек {{ CH }}>;
      ```

{% endlist %}

## Удалить пользователя {#removeuser}

{% list tabs %}

- Консоль управления
  
  1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
  1. Нажмите на имя нужного кластера и выберите вкладку **Пользователи**.
  1. Нажмите значок ![image](../../_assets/vertical-ellipsis.svg) и выберите пункт **Удалить**.
  
- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы удалить пользователя, выполните команду:
  
  ```
  $ {{ yc-mdb-ch }} user delete <имя пользователя>
       --cluster-name=<имя кластера>
  ```
  
  Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md#list-clusters).

- SQL

  1. [Подключитесь](connect.md) к кластеру, используя [учетную запись `admin`](#sql-user-management).
  1. Удалите пользователя:

      ```sql
      DROP USER <имя пользователя>;
      ```

  Подробнее об удалении объектов см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/sql-reference/statements/drop/).

{% endlist %}

## Примеры

### Создание пользователя с настройкой «только чтение» {#example-create-readonly-user}

Допустим, нужно добавить в существующий кластер с именем `mych` нового пользователя `ro-user` с паролем `Passw0rd`, причем:
- пользователь должен иметь доступ к базе данных `db1` кластера;
- доступ должен осуществляться в режиме «только чтение» (readonly), без возможности изменения настроек.

{% list tabs %}

- Консоль управления
 
  1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
  1. Нажмите на кластер с именем `mych` и выберите вкладку **Пользователи**.
  1. Нажмите кнопку **Добавить**.
  1. Введите имя пользователя базы данных `ro-user` и пароль `Passw0rd`.
  1. Выберите базу данных `db1` из выпадающего списка **База данных** и нажмите кнопку **Добавить** справа от выпадающего списка.
  1. Выберите **Дополнительные настройки → Settings → Readonly**.
  1. В поле **Readonly** укажите значение `1`.
  1. Нажмите кнопку **Добавить**.

- CLI

  Запустите следующую команду:

  ```
  $ {{ yc-mdb-ch }} user create "ro-user" \
       --cluster-name="mych" \
       --password="Passw0rd" \
       --permissions="db1" \
       --settings="readonly=1"
  ```
  
    После создания пользователя проверьте, что он действительно работает в режиме «только чтение»:
    1. [Подключитесь к кластеру {{ CH }}](connect.md) `mych`, используя созданного пользователя `ro-user`.
    1. Попытайтесь изменить какую-нибудь настройку, например, попытайтесь отключить режим «только чтение»:
       
       ```
       SET readonly=0
       ```
       
       В результате выполнения команды должно отобразиться сообщение о невозможности изменения настройки в режиме «только чтение»:
       
       ```
       DB::Exception: Cannot modify 'readonly' setting in readonly mode.
       ```

- SQL

  1. [Подключитесь](connect.md) к кластеру `mych`, используя [учетную запись `admin`](#sql-user-management).
  1. Создайте пользователя:

      ```sql
      CREATE USER ro-user IDENTIFIED WITH sha256_password BY 'Passw0rd';
      ```

  1. Выдайте пользователю права на чтение всех объектов базы данных `db1`:

      ```sql
      GRANT SELECT ON db1.* TO ro-user;
      ```

{% endlist %}


## Дополнительные настройки {#advanced-settings}

### Настройки квот {#quota-settings}

Квота позволяет ограничить потребление ресурсов {{ CH }} пользователем в течение заданного интервала времени. 

Если пользователь превысил одно из ограничений квоты в рамках интервала, то он больше не сможет выполнять новые запросы до того, как истечет интервал.
{{ CH }} выведет сообщение о превышении квоты и укажет, когда начнется следующий интервал, с началом которого запрет на выполнение запросов будет снят, а счетчики ограничений — сброшены.

{{ CH }} также использует квоты для учета потребления ресурсов.
Для каждого пользователя есть квота по умолчанию, которая учитывает потребление всех ресурсов за каждый час, но не накладывает никаких ограничений.
Сведения об уровне потребления ресурсов записываются в лог сервера {{ CH }}.

Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/quotas/). 

{% list tabs %}

- Консоль управления

  Доступны следующие настройки: 
  - **Interval duration** — задает интервал для квоты в миллисекундах. 
    
    Минимальное значение - `1000` (одна секунда).
    
  - **Errors** — ограничивает суммарное количество запросов, которые завершились с ошибкой. 
      
    Минимальное значение — `0` (нет ограничений).
    
  - **Execution time** — ограничивает суммарное время выполнения запросов в миллисекундах. 
    
    Минимальное значение — `0` (нет ограничений).
    
  - **Queries** — ограничивает суммарное количество запросов. 
      
    Минимальное значение — `0` (нет ограничений). 
    
  - **Read rows** — ограничивает суммарное число исходных строк, считанных из таблиц для выполнения запросов (включая строки, считанные на удаленных серверах). 
      
    Минимальное значение — `0` (нет ограничений).
    
  - **Result rows** — ограничивает суммарное число строк в результатах запроса. 
      
    Минимальное значение — `0` (нет ограничений). 

- CLI
  
  Доступны следующие настройки: 
  - **`interval`** — задает интервал для квоты в миллисекундах. 
  
    Допустимо использовать запись с указанием единиц измерения: часов (`h`), минут (`m`), секунд (`s`) и миллисекунд (`ms`). Пример такой записи: `3h20m10s7000ms` (итоговое значение представляется по-прежнему в миллисекундах: `12017000`). Обратите внимание, что итоговое значение интервала должно быть кратно 1000 миллисекунд (значение вида `1s500ms` является некорректным).
    
    Минимальное значение - `1000` (одна секунда). 
    
  - **`errors`** — ограничивает суммарное количество запросов, которые завершились с ошибкой.
      
    Минимальное значение — `0` (нет ограничений).
    
  - **`execution-time`** — ограничивает суммарное время выполнения запросов в миллисекундах. 
  
    Допустимо использовать запись с указанием единиц измерения: часов (`h`), минут (`m`), секунд (`s`) и миллисекунд (`ms`). Например, `3h20m10s7000ms` (итоговое значение представляется по-прежнему в миллисекундах: `12017000`). 
    
    Обратите внимание, что итоговое значение интервала должно быть кратно 1000 миллисекунд (значение вида `1s500ms` является некорректным).
    
    Минимальное значение — `0` (нет ограничений). 
    
  - **`queries`** — ограничивает суммарное количество запросов. 
      
    Минимальное значение — `0` (нет ограничений). 
    
  - **`read-rows`** — ограничивает суммарное число исходных строк, считанных из таблиц для выполнения запросов (включая строки, считанные на удаленных серверах).
      
    Минимальное значение — `0` (нет ограничений).
    
  - **`result-rows`** — ограничивает суммарное число строк в результатах запроса. 
      
    Минимальное значение — `0` (нет ограничений). 

- SQL

  Полный синтаксис команды создания новой квоты:

  ```
  CREATE QUOTA [IF NOT EXISTS | OR REPLACE] name
      [KEYED BY {'none' | 'user name' | 'ip address' | 'client key' | 'client key or user name' | 'client key or ip address'}]
      [FOR [RANDOMIZED] INTERVAL number {SECOND | MINUTE | HOUR | DAY | WEEK | MONTH | QUARTER | YEAR}
          {MAX { {QUERIES | ERRORS | RESULT ROWS | RESULT BYTES | READ ROWS | READ BYTES | EXECUTION TIME} = number } [,...] |
           NO LIMITS | TRACKING ONLY} [,...]]
      [TO {role [,...] | ALL | ALL EXCEPT role [,...]}]
  ```

  - **`INTERVAL`** — задает интервал для квоты. После указания значения необходимо указать единицы измерения.

    Минимальное значение — одна секунда.

  - **`ERRORS`** — ограничивает суммарное количество запросов, которые завершились с ошибкой.

    Минимальное значение — `0` (нет ограничений).

  - **`EXECUTION TIME`** — ограничивает суммарное время выполнения запросов в секундах.

    Минимальное значение — `0` (нет ограничений).

  - **`QUERIES`** — ограничивает суммарное количество запросов.

    Минимальное значение — `0` (нет ограничений).

  - **`READ ROWS`** — ограничивает суммарное число исходных строк, считанных из таблиц для выполнения запросов (включая строки, считанные на удаленных серверах).

    Минимальное значение — `0` (нет ограничений).

  - **`RESULT ROWS`** — ограничивает суммарное число строк в результатах запроса.

    Минимальное значение — `0` (нет ограничений).

  Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/en/operations/access-rights/#quotas-management).

{% endlist %}

### Настройки ClickHouse {#clickhouse-settings}

Эти настройки влияют на поведение {{ CH }} при работе с запросами пользователя.

{% list tabs %}

- Консоль управления
   
  Доступны следующие настройки:
  - **Add HTTP CORS header**{#setting-add-http-cors-header} — включает заголовок CORS в HTTP-ответы. 
  
    По умолчанию заголовок CORS не включается в HTTP-ответы.
 
  - **Allow DDL**{#setting-allow-ddl} — разрешает или запрещает выполнять DDL-запросы (например, `CREATE`, `ALTER`, `RENAME` и другие).
  
    По умолчанию выполнение DDL-запросов разрешено.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/permissions-for-queries/#settings_allow_ddl).
    
    См. также: настройка [Readonly](#setting-readonly).
    
  - **Compile**{#setting-compile} — включает или выключает компиляцию запросов. Если вы выполняете большое количество структурно идентичных запросов, то при включенной компиляции такие запросы могут выполняться быстрее за счет использования скомпилированных частей запроса.
  
    Используется вместе с настройкой [Min count to compile](#setting-min-count-to-compile).
  
    По умолчанию компиляция выключена.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#compile).
    
  - **Compile expressions**{#setting-compile-expressions} — включает или выключает компиляцию выражений. Если вы выполняете большое количество запросов, в которых используются идентичные выражения, то при включенной компиляции выражений такие запросы могут выполняться быстрее за счет использования скомпилированных выражений.
  
    Используется вместе с настройкой [Min count to compile expression](#setting-min-count-to-compile-expression).
  
    По умолчанию компиляция выражений выключена.
    
  - **Connect timeout**{#setting-connect-timeout} — задает время ожидания соединения в миллисекундах. 
  
    Значение должно быть больше нуля (по умолчанию — `10000`, 10 секунд). 
  
  - **DISTINCT overflow mode**{#setting-distinct-overflow-mode} — определяет поведение {{ CH }} в ситуации, когда количество данных при выполнении запроса `SELECT DISTINCT` [превысило ограничения](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#ogranicheniia-na-slozhnost-zaprosa) — `throw` (прервать выполнение, вернуть ошибку) или `break` (вернуть неполный результат).
  
    Значение по умолчанию — не выбрано (эквивалентно `throw`).
  
  - **Distributed aggregation memory efficient**{#setting-distributed-aggregation-memory-efficient} — включает или выключает режим экономии памяти при распределенной агрегации. 
    
    При распределённой обработке запроса [внешняя агрегация](#setting-max-bytes-before-external-group-by) производится на удалённых серверах. Для того чтобы на сервере-инициаторе запроса использовалось немного оперативной памяти, нужно включить эту настройку.
    
    По умолчанию режим экономии памяти выключен.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/sql-reference/statements/select/group-by/#select-group-by-in-external-memory).
    
  - **Distributed product mode**{#setting-distributed-product-mode} — изменяет поведение распределенных подзапросов, когда запрос содержит произведение распределённых таблиц:
    - `deny` — запрещает использование таких подзапросов.
    - `local` — заменяет базу данных и таблицу в подзапросе на локальные для конечного сервера (шарда), оставив обычный `IN/JOIN`.
    - `global` — заменяет запрос `IN/JOIN` на `GLOBAL IN/GLOBAL JOIN`.
    - `allow` — разрешает использование таких подзапросов.
  
    Значение по умолчанию — не выбрано (эквивалентно `deny`).
  
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#distributed-product-mode).
  
  - **Empty result for aggregation by empty set**{#setting-empty-result-for-aggregation-by-empty-set} — определяет формат возвращаемого результата при выполнении агрегации данных без ключей (без `GROUP BY`) для пустого множества (например, `SELECT count(*) FROM table WHERE 0`):
    - опция выключена (по умолчанию) — {{ CH }} вернет результат, состоящий из одной строки со значениями `NULL` для агрегатных функций, в соответствии со стандартом SQL.
    - опция включена — {{ CH }} вернет пустой результат. 

  - **Enable HTTP compression**{#setting-enable-http-compression} — включает или выключает сжатие данных в ответе на HTTP-запрос.
  
    По умолчанию {{ CH }} хранит данные в сжатом виде. При выполнении запроса его результат представлен в несжатом виде. С помощью этой настройки вы можете указать {{ CH }} сжимать результат запроса при отправке по HTTP. 
    
    Чтобы {{ CH }} сжал ответ при включенной настройке, добавьте в запрос заголовок `Accept-Encoding: <метод сжатия>`. 
  
    Поддерживаются следующие методы сжатия: `gzip`, `br` и `deflate`.
  
    По умолчанию сжатие данных в ответе на HTTP-запрос выключено.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/interfaces/http/).
    
  - **Fallback to stale replicas for distributed queries**{#setting-fallback-to-stale-replicas-for-distributed-queries} — включает или выключает форсирование запроса в устаревшую реплику в случае, если актуальные данные недоступны. Из устаревших реплик таблицы {{ CH }} выбирает наиболее актуальную. Используется при выполнении `SELECT` из распределенной таблицы, которая указывает на реплицированные таблицы. 
  
    По умолчанию форсирование запроса включено. 
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-fallback_to_stale_replicas_for_distributed_queries).
    
    См. также настройку [Max replica delay for distributed queries](#setting-max-replica-delay-for-distributed-queries).
    
  - **Force index by date**{#setting-force-index-by-date} — запрещает выполнение запросов, если использовать индекс по дате невозможно. Работает с таблицами семейства MergeTree.
    
    По умолчанию опция выключена (выполнение запросов разрешено).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-force_index_by_date).
    
  - **Force primary key**{#setting-force-primary-key} — запрещает выполнение запросов, если использовать индекс по первичному ключу невозможно. Работает с таблицами семейства MergeTree.
  
    По умолчанию опция выключена (выполнение запросов разрешено).
  
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-force_primary_key).
    
  - **GROUP BY overflow mode**{#setting-group-by-overflow-mode} — определяет поведение {{ CH }} в ситуации, когда количество уникальных ключей при агрегации [превысило ограничение](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#ogranicheniia-na-slozhnost-zaprosa):
    - `throw` — прервать выполнение, вернуть ошибку.
    - `break` — вернуть неполный результат.
    - `any` — выполнить `GROUP BY` приближённо. Качество такого приближённого вычисления сильно зависит от статистических свойств данных.

    Значение по умолчанию — не выбрано (эквивалентно `throw`).
  
  - **GROUP BY two level threshold**{#setting-group-by-two-level-threshold} — определяет порог количества ключей, при достижении которого начинается двухуровневая агрегация. 
    
    Значение `0` — порог не установлен (по умолчанию — `10000`).
  
  - **GROUP BY two level threshold bytes**{#setting-group-by-two-level-threshold-bytes} — определяет порог количества байт в агрегате, при достижении которого начинается двухуровневая агрегация. 
  
    Значение `0` — порог не установлен (по умолчанию — `100000000`).
  
  - **HTTP connection timeout**{#setting-http-connection-timeout} — задает время ожидания установления HTTP-соединения в миллисекундах. 
  
    Значение должно быть больше нуля (по умолчанию — `1000`, 1 секунда). 
  
  - **HTTP headers progress interval**{#setting-http-headers progress interval} — задает минимальный интервал (в миллисекундах) между уведомлениями о ходе выполнения запроса с помощью HTTP-заголовка `X-ClickHouse-Progress`. 
  
    Значение должно быть больше нуля (по умолчанию — `100`). 
  
  - **HTTP receive timeout**{#setting-http-receive-timeout} — задает время ожидания приема данных через HTTP-соединение в миллисекундах. 
  
    Значение должно быть больше нуля (по умолчанию — `1800000`, 1800 секунд, 30 минут).
  
  - **HTTP send timeout**{#setting-http-send-timeout} — задает время ожидания отправки данных через HTTP-соединение в миллисекундах. 
    
    Значение должно быть больше нуля (по умолчанию — `1800000`, 1800 секунд, 30 минут).
  
  - **Input format defaults for omitted fields**{#setting-input-format-defaults-for-omitted-fields} — включает или выключает замену пропущенных полей значениями по умолчанию для типа данных столбца при вставке данных запросом `INSERT`. 
  
    По умолчанию замена включена. 
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#session_settings-input_format_defaults_for_omitted_fields).
    
  - **Input format values interpret expressions**{#setting-input-format-values-interpret-expressions} — включает или выключает парсер SQL, если потоковый парсер не может проанализировать данные. Используйте эту настройку, если значения, которые вы хотите вставить в таблицу, содержат в себе выражения SQL.
  
    Например, при вставке в таблицу значения, содержащего в себе выражение `now()`, потоковый парсер не сможет распознать это выражение , в то время как при включенном парсере SQL выражение будет распознано корректно и в качестве значения будет вставлен результат выполнения SQL-функции `now()` (текущая дата и время).
    
    Эта опция используется только для формата [Values](https://clickhouse.tech/docs/ru/interfaces/formats/#data-format-values) при вставке данных.
    По умолчанию парсер SQL включен. 
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-input_format_values_interpret_expressions).
    
  - **Insert quorum**{#setting-insert-quorum} — включает или выключает кворумную запись в кластере {{ CH }}:
    - Если значение меньше `2`, то кворумная запись выключена.
    - Если значение больше либо равно `2`, то кворумная запись включена.
    
    Кворумная запись позволяет гарантировать, что за время, не большее чем [Insert quorum timeout](#setting-insert-quorum-timeout), {{ CH }} смог без ошибок записать данные в кворум из Insert quorum реплик. Все реплики в кворуме консистентны, т.е. содержат данные всех более ранних запросов `INSERT`. Использование кворума при записи позволяет гарантировать, что данные не потеряются при выходе из строя одной или нескольких реплик.
  
    При чтении данных, записанных с помощью Insert quorum, можно использовать настройку [Select sequential consistency](#setting-select-sequential-consistency).
  
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-insert_quorum).
  
  - **Insert quorum timeout**{#setting-insert-quorum-timeout} — задает время ожидания [кворумной записи](#setting-insert-quorum) в миллисекундах. Если время прошло, а запись так не состоялась, то {{ CH }} прервет выполнение `INSERT`-запроса, вернет ошибку, и клиент должен повторить запрос на запись того же блока на эту же или любую другую реплику. 
  
    Минимальное значение — `1000` (1 секунда), по умолчанию — `60000` (1 минута).
  
  - **Join use nulls**{#setting-join-use-nulls} — устанавливает тип поведения `JOIN`. При объединении таблиц могут появляться пустые ячейки. Если опция включена, то тип присоединяемого поля преобразуется в `Nullable`, а пустая ячейка заполняется значением `NULL`. В противном случае, пустая ячейка заполняется значением по умолчанию для данного типа поля.
    
    По умолчанию опция выключена.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#join_use_nulls).

  - **Joined subquery requires alias**{#setting-joined-subquery-requires-alias} — требует наличия псевдонимов для подзапросов при выполнении операции `JOIN`.

    При включенной настройке подобный запрос не будет выполнен:

    ```sql
    SELECT col1, col2 FROM table1 JOIN (SELECT col3 FROM table2)
    ```

    При этом запрос с заданным псевдонимом будет выполнен успешно:

    ```sql
    SELECT col1, col2 FROM table1 JOIN (SELECT col3 FROM table2) AS MyQuery
    ```
    
    По умолчанию опция выключена.
    
  - **Low cardinality allow in native format**{#setting-low-cardinality-allow-in-native-format} — определяет, использовать ли тип LowCardinality в native-формате: 
    - опция включена — да, использовать.
    - опция выключена — конвертировать столбцы LowCardinality в обычные столбцы для запроса `SELECT`, и конвертировать обычные столбцы в требуемый LowCardinality-столбец для запроса `INSERT`.
    
    Столбцы этого типа, также известные как «разреженные столбцы», позволяют более эффективно хранить данные в виде хэш-таблиц. Если данные это позволяют, {{ CH }} использует столбец типа LowCardinality.
    
    Если вы используете сторонний клиент для {{ CH }}, который не умеет работать со столбцами типа LowCardinality, то такой клиент не сможет правильно интерпретировать результат запроса, если в запросе будет присутствовать столбец типа LowCardinality. Выключите эту настройку, чтобы включать в результат столбец в обычном формате и позволить сторонним клиентам обработать результат.
    
    Официальный клиент {{ CH }} умеет работать со столбцами типа LowCardinality.
     
    По умолчанию опция включена.
  
  - **Max AST depth**{#setting-max-ast-depth} — ограничивает максимальную глубину вложенности синтаксического дерева. 
  
    Для больших и сложных запросов может быть построено синтаксическое дерево очень большой глубины. При помощи этой настройки вы можете запретить выполнение излишне больших или неоптимальных запросов для больших таблиц.
  
    Например, запрос `SELECT *` в большинстве случаев породит более сложное и глубокое синтаксическое дерево, чем запрос `SELECT ... WHERE ...` с ограничениями и условиями. Наложение ограничения с помощью настройки может побудить пользователя оптимизировать излишне сложные запросы.
  
    Значение должно быть больше нуля (по умолчанию — `1000`). Слишком маленькое значение может привести к невозможности выполнения большинства запросов.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#max-ast-depth). 
    
  - **Max AST elements**{#setting-max-ast-elements} — ограничивает максимальное количество элементов синтаксического дерева запроса (количество узлов дерева). 
  
    Для больших и сложных запросов может быть построено синтаксическое дерево c очень большим количеством элементов. При помощи этой настройки вы можете запретить выполнение излишне больших или неоптимальных запросов для больших таблиц.
  
    Значение должно быть больше нуля (по умолчанию — `50000`). Слишком маленькое значение может привести к невозможности выполнения большинства запросов. 
  
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#max-ast-elements).
    
  - **Max block size**{#setting-max-block-size} — данные в {{ CH }} обрабатываются по блокам (наборам кусочков столбцов). Внутренние циклы обработки для одного блока достаточно эффективны, но есть заметные издержки на каждый блок. Эта настройка — рекомендация, какой размер блока (в количестве строк) загружать из таблиц. 
    
    Значение должно быть больше нуля (по умолчанию — `65536`).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#setting-max_block_size).
    
  - **Max bytes before external `GROUP BY`**{#setting-max-bytes-before-external-group-by} — задает порог потребления оперативной памяти (в байтах), по достижению которого временные данные, накопленные при выполнении операции агрегации `GROUP BY`, сбрасываются на диск для экономии оперативной памяти.
    
    По умолчанию агрегирование выполняется в памяти с помощью хэш-таблицы. Если запрос приводит к необходимости агрегации больших объемов данных, которые могут не поместиться в оперативную память и вызвать ошибку при выполнении запроса (см. настройку [Max memory usage](#setting-max-memory-usage)) — используйте эту настройку, чтобы {{ CH }} сбрасывал данные на диск и успешно выполнял агрегацию.
     
    Минимальное значение и значение по умолчанию — `0` (`GROUP BY` во внешней памяти отключен). 
    
    При использовании агрегации во внешней памяти рекомендуется задать значение этой настройки в два раза меньше значения настройки [Max memory usage](#setting-max-memory-usage) (по умолчанию максимальное использование памяти ограничено десятью гигабайтами).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/sql-reference/statements/select/group-by/#select-group-by-in-external-memory).
    
    См. также настройку [Distributed aggregation memory efficient](#setting-distributed-aggregation-memory-efficient).
    
  - **Max bytes before external sort**{#setting-max-bytes-before-external-sort} — настройка аналогична [предыдущей](#setting-max-bytes-before-external-group-by), за исключением того, что она применяется для операции сортировки (`ORDER BY`).
   
  - **Max bytes in DISTINCT**{#setting-max-bytes-in-distinct} — ограничивает максимальное количество байт (несжатых данных), занимаемых хэш-таблицей, при использовании `DISTINCT`. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max bytes to read**{#setting-max-bytes-to-read} — ограничивает максимальное количество байт (несжатых данных), которое можно прочитать из таблицы при выполнении запроса. 
    
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max bytes to sort**{#setting-max-bytes-to-sort} — ограничивает максимальное количество байт (несжатых данных), которое можно прочитать из таблицы до сортировки. Позволяет ограничить потребление оперативной памяти при сортировке.
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max bytes to transfer**{#setting-max-bytes-to-transfer} — ограничивает максимальное количество байт (несжатых данных), которых можно передать на удалённый сервер или сохранить во временную таблицу, при использовании `GLOBAL IN`. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max columns to read**{#setting-max-columns-to-read} — ограничивает максимальное количество столбцов, которое можно читать из таблицы в одном запросе. Если запрос требует чтения большего количества столбцов — он будет завершен с ошибкой.
    
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max execution time**{#setting-max-execution-time} — ограничивает максимальное время выполнения запроса в миллисекундах. На данный момент не проверяется при одной из стадий сортировки а также при слиянии и финализации агрегатных функций. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения). 
  
  - **Max expanded AST elements**{#setting-max-expanded-ast-elements} — ограничивает максимальное количество элементов синтаксического дерева запроса (количество узлов дерева) после раскрытия псевдонимов и звездочки. 
  
    Для больших и сложных запросов может быть построено синтаксическое дерево c очень большим количеством элементов. При помощи этой настройки вы можете запретить выполнение излишне больших или неоптимальных запросов для больших таблиц.
  
    Значение должно быть больше нуля (по умолчанию — `500000`). Слишком маленькое значение может привести к невозможности выполнения большинства запросов.
  
  - **Max INSERT block size**{#setting-max-insert-block-size} — позволяет формировать блоки указанного размера (в байтах) при вставке в таблицу. Эта настройка действует только в тех случаях, когда сервер сам формирует такие блоки. 
  
    Значение должно быть больше нуля (по умолчанию — `1048576`).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-max_insert_block_size).
    
  - **Max memory usage**{#setting-max-memory-usage} — ограничивает максимально возможный объём оперативной памяти (в байтах) для выполнения запроса на одном сервере. Настройка не учитывает объём свободной памяти или общий объём памяти на машине. Ограничение действует на один запрос, в пределах одного сервера. 
  
    Минимальное значение — `0` (нет ограничения). В конфигурационном файле по умолчанию ограничение равно `10737418240` (10 ГБ).
    
    Если вы также используете настройки [Max bytes before external `GROUP BY`](#setting-max-bytes-before-external-group-by) или [Max bytes before external sort](#setting-max-bytes-before-external-sort), рекомендуется, чтобы их значения были в два раза меньше значения Max memory usage.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#settings_max_memory_usage).
    
  - **Max memory usage for user**{#setting-max-memory-usage-for-user} — ограничивает максимально возможный объём оперативной памяти (в байтах) для выполнения запросов пользователя на одном сервере. Настройка не учитывает объём свободной памяти или общий объём памяти на машине. Ограничение действует на все  запросы пользователя, которые выполняются одновременно в пределах одного сервера. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max network bandwidth**{#setting-max-network-bandwidth} — ограничивает скорость обмена данными по сети (байт в секунду) при выполнении одного запроса. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max network bandwidth for user**{#setting-max-network-bandwidth-for-user} — ограничивает скорость обмена данными по сети (байт в секунду). Эта настройка, в отличие от предыдущей, влияет на все одновременно выполняющиеся запросы пользователя. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max query size**{#setting-max-query-size} — ограничивает размер наибольшей части запроса (в байтах), которая может быть передана в оперативную память для разбора с помощью парсера SQL. 
  
    Значение должно быть больше нуля (по умолчанию — `262144`).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-max_query_size).
    
  - **Max replica delay for distributed queries**{#setting-max-replica-delay-for-distributed-queries} — ограничивает максимальную задержку реплики в миллисекундах. Если реплика отстает на значение больше установленного, реплика перестает использоваться. 
  
    Минимальное значение — `1000` (1 секунда). Значение по умолчанию — `300000` (300 секунд или 5 минут).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-max_replica_delay_for_distributed_queries).
    
    См. также описание настройки [Fallback to stale replicas for distributed queries](#setting-fallback-to-stale-replicas-for-distributed-queries).
    
  - **Max result bytes**{#setting-max-result-bytes} — ограничивает количество несжатых байт результата. Это ограничение проверяется также для подзапросов и на удалённых серверах при выполнении части распределённого запроса. 
    
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max result rows**{#setting-max-result-rows} — ограничивает количество строк результата. Это ограничение проверяется также для подзапросов и на удалённых серверах при выполнении части распределённого запроса. 
    
    Минимальное значение и значение по умолчанию — `0` (нет ограничения). 
  
  - **Max rows in DISTINCT**{#setting-max-rows-in-distinct} — ограничивает максимальное количество различных строк при использовании `DISTINCT`. 
    
    Минимальное значение и значение по умолчанию — `0` (нет ограничения). 
  
  - **Max rows to group by**{#setting-max-rows-to-group-by} — ограничивает максимальное количество уникальных ключей, получаемых в процессе агрегации. Позволяет ограничить потребление оперативной памяти при агрегации. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max rows to read**{#setting-max-rows-to-read} — ограничивает максимальное количество строк, которое можно прочитать из таблицы при выполнении запроса.
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#max-rows-to-read).
    
  - **Max rows to sort**{#setting-max-rows-to-sort} — ограничивает максимальное количество строк для сортировки. Позволяет ограничить потребление оперативной памяти при сортировке. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max rows to transfer**{#setting-max-rows-to-transfer} — ограничивает максимальное количество строк, которое можно передать на удалённый сервер или сохранить во временную таблицу, при использовании `GLOBAL IN`. 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max temporary columns**{#setting-max-temporary-columns} — ограничивает максимальное количество временных столбцов, которое должно храниться в оперативной памяти одновременно при выполнении запроса (с учетом постоянных столбцов). 
  
    Минимальное значение и значение по умолчанию — `0` (нет ограничения). 
  
  - **Max temporary non const columns**{#setting-max-temporary-non-const-columns} — ограничивает максимальное количество временных столбцов, которое должно храниться в оперативной памяти одновременно при выполнении запроса (без учета постоянных столбцов). 
    
    Минимальное значение и значение по умолчанию — `0` (нет ограничения).
  
  - **Max threads**{#setting-max-threads} — ограничивает максимальное количество потоков обработки запроса (без учёта потоков для чтения данных с удалённых серверов). Этот параметр относится к потокам, которые выполняют параллельно одни стадии конвейера выполнения запроса. 
  
    Минимальное значение и значение по умолчанию — `0` (значение вычисляется автоматически — это количество процессорных ядер без учёта Hyper-Threading).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-max_threads).
    
  - **Merge tree max bytes to use cache**{#setting-merge-tree-max-bytes-to-use-cache} — ограничивает максимальный размер запроса в байтах для использования кэша несжатых данных. Кэш не используется для запросов, превышающих указанный размер. 
  
    Эта настройка используется совместно с [Use uncompressed cache](#setting-use-uncompressed-cache).
  
    Значение должно быть больше нуля (по умолчанию: 192x10x1024x1024). 
  
  - **Merge tree max rows to use cache**{#setting-merge-tree-max-rows-to-use-cache} —  ограничивает максимальный размер запроса в строках для использования кэша несжатых данных. Кэш не используется для запросов, превышающих указанный размер. 
  
    Эта настройка используется совместно с [Use uncompressed cache](#setting-use-uncompressed-cache).
  
    Значение должно быть больше нуля (по умолчанию: 128x8192). 
    
  - **Merge tree min bytes for concurrent read**{#setting-merge-tree-min-bytes-for-concurrent-read} — ограничивает минимальное количество байт, которое надо прочитать из файла, чтобы использовать одновременное чтение. Если количество байт, прочитанных из файла, превышает заданное значение, то {{ CH }} пытается выполнить одновременное чтение из этого файла в несколько потоков. 
  
    Значение должно быть больше нуля (по умолчанию: 24x10x1024x1024). 
  
  - **Merge tree min rows for concurrent read**{#setting-merge-tree-min-rows-for-concurrent-read} — ограничивает минимальное количество строк, которое надо прочитать из файла, чтобы использовать одновременное чтение. Если количество строк, прочитанных из файла, превышает заданное значение, то {{ CH }} пытается выполнить одновременное чтение из этого файла в несколько потоков. 
  
    Значение должно быть больше нуля (по умолчанию: 20x8192). 
  
  - **Min bytes to use Direct I/O**{#setting-merge-tree-min-bytes-to-use-direct-io} — ограничивает минимальный объём данных в байтах, необходимый для прямого (небуферизованного) чтения (Direct I/O) на диск. {{ CH }} использует этот параметр при чтении данных из таблиц. 
  
    По умолчанию {{ CH }} читает данные не напрямую с диска, а полагается на файловую систему и её кэш. Такое чтение эффективно при небольших объемах данных. Если данные читаются в больших объемах, эффективнее читать их с диска напрямую, минуя кэш файловой системы. 
    
    Если общий объём хранения всех данных для чтения превышает заданное значение настройки, тогда {{ CH }} читает данные с диска напрямую. 
  
    Минимальное значение и значение по умолчанию — `0` (прямой ввод/вывод отключен). 
  
  - **Min count to compile**{#setting-min-count-to-compile} — определяет, после какого количества структурно идентичных запросов начать [компиляцию](#setting-compile).
  
    Минимальное значение — `0`. Значение по умолчанию — `3`.
    
    Для значения `0` компиляция выполняется синхронно: запрос ожидает окончания процесса компиляции перед продолжением выполнения. Рекомендуется использовать это значение только в целях тестирования.
    
    Для всех других значений компиляция выполняется асинхронно, в отдельном потоке: когда результат будет готов, он сразу же будет использован, в том числе уже выполняющимися в данный момент запросами. 
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#min-count-to-compile). 
    
  - **Min count to compile expression**{#setting-min-count-to-compile-expression} — определяет, после какого количества идентичных выражений начать [компиляцию выражений](#setting-compile-expressions).
    
    Минимальное значение — `0`. Значение по умолчанию — `3`.
    
    Для значения `0` компиляция выполняется синхронно: выражение ожидает окончания процесса компиляции перед продолжением выполнения запроса. Рекомендуется использовать это значение только в целях тестирования.
    
    Для всех других значений компиляция выполняется асинхронно, в отдельном потоке: когда результат будет готов, он сразу же будет использован, в том числе уже выполняющимися в данный момент запросами. 
    
  - **Min INSERT block size bytes**{#setting-min-insert-block-size-bytes} — ограничивает минимальное количество байтов в блоке, который может быть вставлен в таблицу запросом `INSERT`. Блоки меньшего размера склеиваются в блоки большего размера. 
    
    Минимальное значение — `0` (склейка блоков выключена). Значение по умолчанию — `‭268435456‬‬` (256 МБ).
  
  - **Min INSERT block size rows**{#setting-min-insert-block-size-rows} — ограничивает минимальное количество строк в блоке, который может быть вставлен в таблицу запросом `INSERT`. Блоки меньшего размера склеиваются в блоки большего размера. 
    
    Минимальное значение — `0` (склейка блоков выключена). Значение по умолчанию — `1048576`.
  
  - **Output format JSON quote denormals**{#setting-output-format-json-quote-denormals} —  включает или выключает вывод специальных значений для чисел с плавающей запятой (`+nan`, `-nan`, `+inf` и `-inf`) при выводе в JSON. 
    
    По умолчанию специальные значения не выводятся.
  
  - **Output format JSON quote_64bit integers**{#setting-output-format-json-quote-64bit-integers} — определяет формат чисел в JSON-выводе. Если опция включена, то при выводе в JSON 64-битные числа (`UInt64` и `Int64`) выводятся в кавычках (из соображений совместимости с большинством реализаций JavaScript), иначе — без кавычек. 
    
    По умолчанию вывод 64-битных целых чисел в кавычках выключен.
  
  - **Priority**{#setting-priority} — определяет приоритет запроса:
    - `0` — приоритет не используется.
    - `1` — наивысший приоритет.
    - далее — чем выше число, тем ниже приоритет.
    
    Эта настройка выставляется для каждого запроса по отдельности. 
    
    Если {{ CH }} в текущий момент времени выполняет запросы с более высокими приоритетами, чем приоритет поступившего запроса, то выполнение такого запроса приостанавливается до завершения выполнения более приоритетных запросов.
  
    Минимальное значение и значение по умолчанию — `0`.
  
  - **Quota mode**{#setting-quota-mode} —  задает режим учёта потребляемых ресурсов при включенных квотах:
    - `default` — режим по умолчанию, ключи не используются.
    - `keyed` — в параметре пользовательского запроса передаётся ключ `quota_key`, и квота считается по отдельности для каждого значения ключа.
    - `keyed_by_ip` — аналогично предыдущему, только в качестве ключа выступает IP-адрес пользователя (стоит учесть, что пользователь может достаточно легко менять IPv6-адрес).
    
    Значение по умолчанию — не выбрано (эквивалентно `default`).
  
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/quotas/).
  
  - **Read overflow mode**{#setting-read-overflow-mode} — определяет поведение {{ CH }} в ситуации, когда количество прочитанных данных [превысило одно из ограничений](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#ogranicheniia-na-slozhnost-zaprosa) — `throw` (прервать выполнение, вернуть ошибку) или `break` (вернуть неполный результат). 
  
    Значение по умолчанию — не выбрано (эквивалентно `throw`).
  
  - **Readonly**{#setting-readonly} — ограничивает разрешения для выполнения запросов на чтение данных, запись данных и изменение параметров:
    - `0` — разрешено выполнять все типы запросов, нет ограничений (значение по умолчанию).
    - `1` — разрешено выполнять только запросы на чтение данных.
    - `2` — разрешено выполнять запросы на чтение данных и изменение настроек.
    
    Настройка не влияет на возможность выполнения DDL-запросов. Чтобы разрешить или запретить выполнение DDL-запросов, используйте настройку [Allow DDL](#setting-allow-ddl). 
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/permissions-for-queries/#settings_readonly).
    
    См. также: [пример создания пользователя с правами «только чтение»](#example-create-readonly-user).
    
  - **Receive timeout**{#setting-receive-timeout} — задает время ожидания приема данных в миллисекундах. 
  
    Значение должно быть больше нуля (по умолчанию — `300000`, 300 секунд, 5 минут).
  
  - **Replication ALTER partitions sync**{#setting-replication-alter-partitions-sync} — задает условия ожидания завершения асинхронных действий на репликах для запросов `ALTER ... ATTACH | DETACH | DROP`:
    - `0` — не ждать.
    - `1` — ждать выполнения только у себя (значение по умолчанию).
    - `2` — ждать всех.
     
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/sql-reference/statements/alter/#sinkhronnost-zaprosov-alter).
     
  - **Result overflow mode**{#setting-result-overflow-mode} — определяет поведение {{ CH }} в ситуации, когда объём результата превысил одно из ограничений — `throw` (прервать выполнение, вернуть ошибку) или `break` (вернуть неполный результат). 
    
    Значение по умолчанию — не выбрано (эквивалентно `throw`).
  
  - **SELECT sequential consistency**{#setting-select-sequential-consistency} — включает или выключает последовательную консистентность для запросов `SELECT`. 
  
    По умолчанию последовательная консистентность выключена.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-select_sequential_consistency).
  
  - **Send progress in HTTP headers**{#setting-send-progress-in-http-headers} — включает или выключает отсылку уведомления о ходе выполнения с использованием заголовков `X-ClickHouse-Progress`. 
    
    По умолчанию отсылка уведомлений выключена.
    
  - **Send timeout**{#setting-send-timeout} — задает время ожидания отправки данных в миллисекундах. 
  
    Значение должно быть больше нуля (по умолчанию — `300000`, 300 секунд, 5 минут).
  
  - **Skip unavailable shards**{#setting-skip-unavailable-shards} — включает или выключает тихий пропуск недоступных шардов (шард считается недоступным, если все его реплики недоступны).
    
    По умолчанию тихий пропуск недоступных шардов выключен.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#settings-skip_unavailable_shards).
    
  - **Sort overflow mode**{#setting-sort-overflow-mode} — определяет поведение {{ CH }} в ситуации, когда количество строк, полученных перед сортировкой, [превысило одно из ограничений](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#ogranicheniia-na-slozhnost-zaprosa) — `throw` (прервать выполнение, вернуть ошибку) или `break` (вернуть неполный результат).
    
    Значение по умолчанию — не выбрано (эквивалентно `throw`).
  
  - **Timeout overflow mode**{#setting-timeout-overflow-mode} — определяет поведение {{ CH }} в ситуации, когда запрос выполняется дольше `max_execution_time` — `throw` (прервать выполнение, вернуть ошибку) или `break` (вернуть неполный результат).
  
    Значение по умолчанию — не выбрано (эквивалентно `throw`).
    
  - **Transfer overflow mode**{#setting-transfer-overflow-mode} — определяет поведение {{ CH }} в ситуации, когда количество данных для передачи на другой сервер [превысило одно из ограничений](https://clickhouse.tech/docs/ru/operations/settings/query-complexity/#ogranicheniia-na-slozhnost-zaprosa) — `throw` (прервать выполнение, вернуть ошибку) или `break` (вернуть неполный результат).
  
    Значение по умолчанию — не выбрано (эквивалентно `throw`).
  
  - **Transform null in**{#setting-transform-null-in} - при включенной опции сравнение `NULL = NULL` вернет `true` в операторе `IN`.
  
    По умолчанию опция выключена (это сравнение вернет `false` в операторе `IN`).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#transform_null_in).
  
  - **Use uncompressed cache**{#setting-use-uncompressed-cache} — определяет, использовать ли кэш разжатых блоков. Использование кэша несжатых блоков (только для таблиц семейства MergeTree) может существенно сократить задержку и увеличить пропускную способность при работе с большим количеством коротких запросов. Включите эту настройку для пользователей, от которых идут частые короткие запросы.
    
    По умолчанию кэш не используется.
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/#setting-use_uncompressed_cache).

    См. также настройки [Merge tree max bytes to use cache](#setting-merge-tree-max-bytes-to-use-cache) и [Merge tree max rows to use cache](#setting-merge-tree-max-rows-to-use-cache).

- CLI

  Полный список доступных настроек {{ CH }} смотрите в справке команды:
  
  ```
  $ yc managed-clickhouse user create --help
  ```
  
  Основные настройки:
  
  - **`allow_ddl`**{#setting-cli-allow-ddl} — разрешает или запрещает выполнять DDL-запросы (например, `CREATE`, `ALTER`, `RENAME` и другие).
  
    Значение по умолчанию — `false` (выполнение DDL-запросов запрещено).
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/permissions-for-queries/#settings_allow_ddl).
  
  - **`readonly`**{#setting-cli-readonly} — ограничивает разрешения для выполнения запросов на чтение данных, запись данных и изменение параметров:
    - `0` — разрешено выполнять все типы запросов, нет ограничений (значение по умолчанию).
    - `1` — разрешено выполнять только запросы на чтение данных.
    - `2` — разрешено выполнять запросы на чтение данных и изменение настроек.
    
    Настройка не влияет на возможность выполнения DDL-запросов. Чтобы разрешить или запретить выполнение DDL-запросов, используйте настройку [Allow DDL](#setting-cli-allow-ddl). 
    
    Подробнее см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/permissions-for-queries/#settings_readonly). 
  
    См. также: [пример создания пользователя с правами «только чтение»](#example-create-readonly-user).

- SQL

  Полный список доступных настроек см. [в документации {{ CH }}](https://clickhouse.tech/docs/ru/operations/settings/settings/).

{% endlist %}
