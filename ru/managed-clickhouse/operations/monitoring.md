# Мониторинг состояния кластера и хостов

Вы можете отслеживать состояние кластера {{ mch-name }} и отдельных его хостов с помощью инструментов мониторинга в консоли управления. Эти инструменты предоставляют диагностическую информацию в виде графиков.

Собирает значения метрик кластера и отображает графики сервис [{{ monitoring-name }}](../../monitoring/concepts/index.md). Чтобы перейти к работе с метриками, дашбордами или алертами в сервисе {{ monitoring-name }}, нажмите кнопку **Открыть в Мониторинге** на панели сверху.

Период обновления графиков:

* Для хостов стандартной конфигурации и хостов с увеличенным соотношением количества гигабайт RAM к количеству vCPU (`memory-optimized`): {{ graph-update }}.
* Для хостов с гарантированной долей vCPU ниже 100% (`burstable`): {{ graph-update-burstable }}.

{% note info %}

На графиках автоматически применяются наиболее подходящие кратные единицы измерения (мегабайты, гигабайты и т. д.).

{% endnote %}

## Мониторинг состояния кластера {#monitoring-cluster}

Для просмотра детальной информации о состоянии кластера {{ mch-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **Мониторинг**.

Если в кластере используется механизм репликации и распределения запросов с использованием [{{ ZK }}](../concepts/replication.md#zk), на вкладке **Мониторинг** появляются две вкладки:

* **Clickhouse** — графики, которые показывают работу всего кластера и хостов {{ CH }}.
* **Zookeeper** — графики, которые характеризуют работу хостов {{ ZK }}.

Если репликация не используется или использует механизм [{{ CK }}](../concepts/replication.md#ck), графики с вкладки **Clickhouse** показываются на общей вкладке **Мониторинг**.

{% list tabs %}

* Clickhouse

  * **Active locks per host** — количество активных блокировок, для каждого хоста.
  * **Average insert query time per host** — среднее время исполнения запросов вставки, для каждого хоста.
  * **Average query time per host** — среднее время исполнения запросов, для каждого хоста.
  * **Average select query time per host** — среднее время исполнения запросов выборки, для каждого хоста.
  * **Connections per host** — количество подключений, для каждого хоста.
  * **CPU cores usage** — количество занятых процессорных ядер.
  * **CPU cores usage per host** — количество занятых процессорных ядер, для каждого хоста.
  * **CPU usage per host** — загрузка процессорных ядер, для каждого хоста.
  * **Disk read per host** — скорость чтения с диска, для каждого хоста (байт/с).
  * **Disk space usage** — занятое дисковое пространство (в байтах).
  * **Disk space usage per host** — занятое дисковое пространство, для каждого хоста (выводится два графика: в байтах и в процентах).
  * **Disk usage per host** — скорость дисковых операций, для каждого хоста (байт/с).
  * **Disk write per host** — скорость записи на диск, для каждого хоста (байт/с).
  * **Failed insert queries per host** — количество неуспешных запросов вставки в секунду, для каждого хоста.
  * **Failed queries per host** — общее количество неуспешных запросов в секунду, для каждого хоста.
  * **Failed select queries per host** — количество неуспешных запросов выборки в секунду, для каждого хоста.
  * **Inserted data** — скорость вставки данных (байт/с).
  * **Inserted data per host** — скорость вставки данных, для каждого хоста (байт/с).
  * **Inserted rows per host** — скорость вставки данных, для каждого хоста (строк/с).
  * **Insert queries** — количество запросов вставки в секунду.
  * **Insert queries per host** — количество запросов вставки в секунду, для каждого хоста.
  * **Max data parts per partition** — количество кусков данных в партиции, наибольшее среди всех таблиц. Лимит для этой величины определяется [настройками СУБД](../concepts/settings-list#setting-merge-tree). Приближение к лимиту указывает на чрезмерную нагрузку или низкую эффективность вставки данных.
  * **Max replication delay across tables** — задержка репликации, наибольшая среди всех таблиц. Значения больше нескольких секунд могут указывать на чрезмерную нагрузку или проблемы в работе репликации.
  * **Max replication queue across tables** — максимальная длина очереди репликации таблиц. Значения больше нескольких единиц могут указывать на чрезмерную нагрузку или проблемы в работе репликации.
  * **Memory usage** — использование оперативной памяти (в байтах).
  * **Memory usage per host** — использование оперативной памяти, для каждого хоста (выводится два графика: в байтах и в процентах).
  * **Merged data** — скорость слияния данных (байт/с).
  * **Merged data per host** — скорость слияния данных, для каждого хоста (байт/с).
  * **Merged rows per host** — скорость слияния данных, для каждого хоста (строк/с).
  * **Network data received per host** — скорость приема данных из сети, для каждого хоста (байт/с).
  * **Network data sent per host** — скорость отправки данных в сеть, для каждого хоста (байт/с).
  * **Network usage per host** — скорость обмена данными по сети, для каждого хоста (байт/с).
  * **Read data** — скорость чтения данных (байт/с).
  * **Read data per host** — скорость чтения данных, для каждого хоста (байт/с).
  * **Read parts per host** — скорость чтения кусков данных, для каждого хоста (строк/с).
  * **Select queries** — количество запросов выборки в секунду.
  * **Select queries per host** — количество запросов выборки в секунду, для каждого хоста.
  * **Total queries** — общее количество запросов в секунду.
  * **Total queries per host** — общее количество запросов в секунду, для каждого хоста.
  * **Waiting locks per host** — количество ожидающих блокировок, для каждого хоста.

* Zookeeper

  * **Average latency per ZooKeeper host** — средняя задержка ответа, для каждого хоста ZooKeeper.
  * **Average transaction time per ClickHouse host** — среднее время транзакции, для каждого хоста ClickHouse. Характеризует время, затрачиваемое ClickHouse на обращения к ZooKeeper.
  * **Connections per ZooKeeper host** — количество подключений, для каждого хоста ZooKeeper.
  * **CPU cores usage** — количество занятых процессорных ядер.
  * **CPU cores usage per host** — количество занятых процессорных ядер, для каждого хоста.
  * **CPU usage per host** — загрузка процессорных ядер, для каждого хоста.
  * **Disk read per host** — скорость чтения с диска, для каждого хоста (байт/с).
  * **Disk space usage** — занятое дисковое пространство (в байтах). Выводится два графика: для каждого хоста и для всех хостов.
  * **Disk space usage per host** — использование дискового пространства, для каждого хоста (в процентах).
  * **Disk usage per host** — скорость дисковых операций, для каждого хоста (байт/с).
  * **Disk write per host** — скорость записи на диск, для каждого хоста (байт/с).
  * **Ephemeral nodes** — количество объектов Ephemeral node.

  {% note info %}

  Подробнее об объектах Znode, Ephemeral node и Watch см. в [документации {{ ZK }}](https://zookeeper.apache.org/doc/current/zookeeperOver.html). {#zookeeper-objects}

  {% endnote %}

  * **Memory usage** — использование оперативной памяти (в байтах).
  * **Memory usage per host** — использование оперативной памяти, для каждого хоста (выводится два графика: в байтах и в процентах).
  * **Network data received per host** — скорость приема данных из сети, для каждого хоста (байт/с).
  * **Network data sent per host** — скорость отправки данных в сеть, для каждого хоста (байт/с).
  * **Network usage per host** — скорость обмена данными по сети, для каждого хоста (байт/с).
  * **Outstanding requests per ZooKeeper host** — количество запросов, находящихся в обработке, для каждого хоста ZooKeeper.
  * **Transactions** — количество транзакций в секунду.
  * **Transactions per ClickHouse host** — количество транзакций в секунду, для каждого хоста ClickHouse.
  * **Watches** — количество объектов Watch.
  * **Znodes** — количество объектов Znode.

{% endlist %}

## Мониторинг состояния хостов {#monitoring-hosts}

Для просмотра детальной информации о состоянии отдельных хостов {{ mch-name }}:

1. Перейдите на страницу каталога и выберите сервис **{{ mch-name }}**.
1. Нажмите на имя нужного кластера и выберите вкладку **Хосты** → **Мониторинги**.
1. Выберите нужный хост из выпадающего списка. Возле имени хоста будет показан его тип: `CLICKHOUSE` или `ZOOKEEPER`.

На этой странице выводятся графики, показывающие нагрузку на отдельный хост кластера:

* **CPU** — загрузка процессорных ядер. При повышении нагрузки значение **Idle** уменьшается.
* **Disk Bytes** — скорость дисковых операций (байт/с).
* **Disk IOPS** — интенсивность дисковых операций (операций/с).
* **Memory** — использование оперативной памяти (в байтах). При высоких нагрузках значение параметра **Free** уменьшается, остальные — растут.
* **Network Bytes** — скорость обмена данными по сети (байт/с).
* **Network Packets** — интенсивность обмена данными по сети (пакетов/с).

## Состояние и статус кластера {#cluster-health-and-status}

{% include [health-and-status](../../_includes/mdb/monitoring-cluster-health-and-status.md) %}

Для просмотра состояния и статуса кластера:

1. Перейдите на страницу каталога и выберите **{{ mch-name }}**.
1. Наведите курсор на индикатор в столбце **Статус** в строке нужного кластера.

### Состояния кластера {#cluster-health}

{% include [monitoring-cluster-health](../../_includes/mdb/monitoring-cluster-health.md) %}

### Статусы кластера {#cluster-status}

{% include [monitoring-cluster-status](../../_includes/mdb/monitoring-cluster-status.md) %}

