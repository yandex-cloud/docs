# Подключение к серийной консоли виртуальной машины по SSH

После [включения доступа](index.md), вы можете подключиться к серийной консоли для взаимодействия с виртуальной машиной. Перед подключением к серийной консоли внимательно ознакомьтесь с разделом [[!TITLE]](#security).

## Безопасность {#security}

> [!IMPORTANT]
>
> Включенный доступ к серийной консоли небезопасен: злоумышленники могут получить доступ к вашей виртуальной машине. Отключайте доступ после работы с серийной консолью: установите в метаданных параметр `serial-port-enable=0`.

Важным моментом при удаленном доступе является защита от [MITM-атак](https://en.wikipedia.org/wiki/Man-in-the-middle_attack). Защититься от MITM-атак можно, используя шифрование между клиентом и сервером.

Установить безопасное подключение можно следущими способами:

- Вы можете скачивать текущий [SHA256 Fingerprint](https://storage.yandexcloud.net/cloud-certs/serialssh-fingerprint.txt) (отпечаток) ключа перед каждым подключением к виртуальной машине.

    При первом подключении к виртуальной машине клиент сообщает отпечаток ключа и ожидает решения по установке соединения:

    - YES — установить соединение.
    - NO — отказаться.

    Убедитесь, что отпечаток по ссылке совпадает с отпечатком, полученным от клиента.

- Вы можете скачивать публичный [ключ](https://storage.yandexcloud.net/cloud-certs/serialssh-knownhosts) хоста перед каждым подключением к серийной консоли.

    Используйте полученный публичный ключ при подключении к серийной консоли.

    Рекомендуемые параметры запуска:

    ```bash
    $ ssh -o ControlPath=none -o IdentitiesOnly=yes -o CheckHostIP=no -o StrictHostKeyChecking=yes -o UserKnownHostsFile=./serialssh-knownhosts -p 9600 -i ~/.ssh/<имя закрытого ключа> <ID виртуальной машины>.<имя пользователя>@serialssh.cloud.yandex.net
    ```

    Публичный ключ хоста в будущем может быть изменен.

Чаще сверяйтесь с указанными файлами. Скачивайте данные файлы только по протоколу HTTPS, предварительно убедившись в валидности сертификата сайта `https://storage.yandexcloud.net`. Если из-за проблем с сертификатом сайт не может обеспечить безопасное шифрование ваших данных, браузер предупреждает об этом.

## Подключиться к серийной консоли

> [!NOTE]
>
> Работа серийной консоли зависит от настроек используемой операционной системы. Сервис [!KEYREF compute-full-name] опеспечивает канал между пользователем и COM-портом виртуальной машины и не гарантирует стабильность работы консоли со стороны операционной системы.

Чтобы подключиться к серийной консоли:

---

**[!TAB CLI]**

[!INCLUDE [cli-install](../../../_includes/cli-install.md)]

[!INCLUDE [default-catalogue](../../../_includes/default-catalogue.md)]

1. Получите список виртуальных машин в каталоге по умолчанию:

    [!INCLUDE [compute-instance-list](../../_includes_service/compute-instance-list.md)]

1. Выберите `ID` нужной машины, например `fhm0b28lgfp4tkoa3jl6`.
1. Подключитесь к серийной консоли:

    ```bash
    $ ssh -t -p 9600 -o IdentitiesOnly=yes -i ~/.ssh/<имя закрытого ключа> <ID виртуальной машины>.<имя пользователя>@serialssh.cloud.yandex.net
    ```

    Пример для пользователя `yc-user`:

    ```bash
    $ ssh -t -p 9600 -o IdentitiesOnly=yes -i ~/.ssh/id_rsa fhm0b28lgfp4tkoa3jl6.yc-user@serialssh.cloud.yandex.net
    ```

Доступ к серийной консоли предоставляется пользователям с установленным в метаданных параметром `serial-port-enable=1` и настроенной авторизацией по SSH-ключу:

- Если после подключения к серийной консоли на экране ничего не отображается, нажмите на клавиатуре клавишу `Enter`. Если проблема сохранилась, перезапустите виртуальную машину. Виртуальные машины, созданные до 22 февраля 2019, также необходимо перезапустить.
- Если система запрашивает данные пользователя для доступа на виртуальную машину, укажите имя пользователя (логин) и пароль.
- Если при подключении возникает ошибка `Warning: remote host identification has changed!`, выполните команду `ssh-keygen -R <IP виртуальной машины>`.

---

## Отключиться от серийной консоли

Чтобы отключиться от серийной консоли:

1. Нажмите на клавиатуре клавишу `Enter`.
1. Введите последовательно символы `~.`.
