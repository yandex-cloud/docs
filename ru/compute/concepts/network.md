# Сеть на виртуальной машине

При создании виртуальной машины необходимо задать настройки сетевого интерфейса, подключенного к ней: выбрать [подсеть](../../vpc/concepts/network.md#subnet), к которой будет подключена виртуальная машина, настроить [внутренний](#internal-ip) и [публичный IP-адрес](#public-ip), добавить необходимые [группы безопасности](../../vpc/concepts/security-groups.md). Это позволит виртуальной машине взаимодействовать с другими сервисами во внутренней сети и в сети Интернет.

{% include [security-groups-note](../_includes_service/security-groups-note.md) %}

После подключения сетевого интерфейса виртуальной машине будет присвоен внутренний IP-адрес в подсети и [внутренний FQDN](#hostname). Публичный IP-адрес будет присвоен только если это было указано при создании виртуальной машины.

IP-адреса, FQDN и другую информацию можно узнать в консоли управления, в блоке **Сеть** на странице виртуальной машины. Эти данные можно использовать для подключения к виртуальной машине.

На виртуальных машинах, созданных из публичных образов Linux, IP-адрес и имя хоста (FQDN) не прописываются автоматически в файл `/etc/hosts`. Это может повлиять на работу команды `sudo`.

Вы можете изменить настройки сетевых интерфейсов на остановленных ВМ: привязать публичный IP-адрес, сменить подсеть, выбрать другие группы безопасности или задать настройки DNS.

## Внутренний IP-адрес {#internal-ip}

Вы можете указать внутренний IP-адрес, по которому будет доступна виртуальная машина после создания. Если внутренний IP-адрес не был указан, он будет назначен автоматически.

{% note info %}

На данный момент поддерживаются только IPv4-адреса. Для виртуальных машин {{ compute-full-name }} и хостов баз данных доступ из интернета и в интернет открыт только через публичные IP-адреса.

{% endnote %}

Внутренний IP-адрес можно использовать для доступа с одной виртуальной машины на другую. Подключение по внутреннему IP-адресу возможно только с виртуальных машин, которые принадлежат к одной [облачной сети](../../vpc/concepts/network.md#network).

Внутренний IP-адрес нельзя изменить.

## Публичный IP-адрес {#public-ip}

Вы можете получить публичный IP-адрес, чтобы иметь доступ к виртуальной машине из сети Интернет.

Публичный IP-адрес назначается автоматически, выбрать его нельзя. Адрес выделяется из пула адресов {{ yandex-cloud }}.

{% include notitle [public-ip-reset](../../_includes/public-ip-reset.md) %}

Публичный IP-адрес виртуальной машины сопоставляется ее внутреннему IP-адресу с использованием NAT. Поэтому все запросы к виртуальной машине по внешнему IP-адресу передаются на внутренний IP-адрес. Подробнее о NAT читайте в [RFC 3022](https://www.ietf.org/rfc/rfc3022.txt).

## Имя хоста и внутренний FQDN {#hostname}

При создании виртуальной машине присваивается имя хоста и внутренний FQDN, который можно использовать для доступа с одной ВМ на другую в рамках одной [облачной сети](../../vpc/concepts/network.md).

Имя хоста и внутренний FQDN нельзя поменять после создания ВМ.

Присвоенный FQDN зависит от заданного имени хоста `(CreateInstanceSpec.hostname)`. Имя хоста должно быть уникальным в вашей виртуальной сети.

1. В консоли управления невозможно ввести параметр `hostname` для новой ВМ. В качестве имени хоста используется имя ВМ, указанное пользователем:

	* Если поле **Имя** при создании ВМ оставить пустым — будет присвоен внутренний FQDN `<ID виртуальной машины>.auto.internal`.
	* Если в поле **Имя** ввести имя ВМ — будет присвоен внутренний FQDN `<имя виртуальной машины>.<регион>.internal`.

1. При работе с CLI, API и {{ TF }} внутренний FQDN создается по следующим правилам:

	* Если `hostname` не указать, то ВМ присвоится уникальный FQDN вида `<ID виртуальной машины>.auto.internal`.
	* Если указан `hostname`, и он не содержит символа "`.`", то он считается префиксом FQDN. ВМ присвоится внутренний FQDN вида `<hostname>.<регион>.internal`.
	* Если указан `hostname`, и он содержит символ "`.`" в середине или в конце, то считается, что это FQDN. ВМ присвоится внутренний FQDN, совпадающий с `hostname`. Нельзя указать FQDN, начинающийся с "`.`" или содержащий только "`.`".

### Примеры {#examples}

Заданное имя хоста (hostname) | FQDN виртуальной машины
:--- | :---
`<не указано>` | `<ID виртуальной машины>.auto.internal`
`breathtaking` | `breathtaking.{{ region-id }}.internal`
`this-is-sparta` | `this-is-sparta.{{ region-id }}.internal`
`hello.world` или `hello.world.` | `hello.world`
`breathtaking.` | `breathtaking`
<span style="color: red">`.why`</span> | <span style="color: red">ошибка (FQDN начинается с ".")</span>
<span style="color: red">`.`</span> | <span style="color: red">ошибка (FQDN содержит только ".")</span>


## MAC-адрес {#mac-address}

После подключения сетевого интерфейса к виртуальной машине, ему будет присвоен MAC-адрес устройства.

Вы можете узнать MAC-адрес изнутри виртуальной машины или в информации о ресурсе через API {{ yandex-cloud }}.
