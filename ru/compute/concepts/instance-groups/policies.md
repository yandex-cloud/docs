# Политики

При создании группы необходимо определить _политики_, которые описывают в каких зонах, как развертывать, проверять и масштабировать виртуальные машины в группе.

В CLI описание политик передается вместе с описанием [шаблона виртуальной машины](instance-template.md) в виде YAML-файла при создании или изменении группы ВМ с помощью флага `--file`. Таким образом, удобно передать значение из нескольких строк. Подробнее читайте в разделе [{#T}](../../operations/instance-groups/create-fixed-group.md).

## Политика распределения {#allocation-policy}

При создании группы виртуальных машин можно выбрать в каких регионах, зонах доступности Яндекс.Облака будут размещаться виртуальные машины.

Регион — это определенное географическое расположение, в котором можно развертывать виртуальные машины. Каждый регион имеет одну или несколько зон. На данный момент доступен только один регион. [Подробнее о географии Облака](../../../overview/concepts/geo-scope.md).

Регион | Зоны | Географическая привязка
----- | ----- | -----
`ru-central1` | `ru-central1-a`<br/>`ru-central1-b`<br/>`ru-central1-c` | Владимирская, Московская и Рязанская области.

Переместить виртуальные машины в другие зоны доступности невозможно, но вы можете [обновить группу](../../operations/instance-groups/deploy/rolling-update.md) с новыми значениями зон.

Политика распределения определяется в YAML-файле, в ключе `allocation-policy`. Значением может быть список зон, определенных в ключе `zones`. Вы можете указывать любые доступные зоны, между которыми будут равномерно распределяться виртуальные машины в группе.

Пример записи в YAML-файле:

```
...
allocation_policy:
    zones:
        - zone_id: ru-central1-a
        - zone_id: ru-central1-b
        - zone_id: ru-central1-c
...
```

Ключи:

Ключ | Значение
----- | -----
`zones` | Список зон. Каждая зона задается в ключе `zone_id`, в виде пары `ключ:значение`.
`zone_id` | Идентификатор зоны.

## Политика развертывания {#deploy-policy}

При создании группы виртуальных машин можно выбрать, каким образом будут развертываться виртуальные машины в группе.

Политика развертывания представляет собой набор ограничений и определяется в YAML-файле, в ключе `deploy_policy`. Каждое ограничение задается в собственном ключе, в виде пары `ключ:значение`.

Пример записи в YAML-файле:

```
...
deploy_policy:
    max_creating: 10
    max_deleting: 10
    max_unavailable: 10
    max_expansion: 0
    startup_duration: 30s
...
```

Ключи:

Ключ | Значение
----- | -----
`max_creating` | Максимальное количество создаваемых одновременно виртуальных машин.<br>Допустимые значения — от 0 до 100. Значение 0 — любое количество виртуальных машин в рамках допустимых значений.
`max_deleting` | Максимальное количество удаляемых одновременно виртуальных машин.<br>Допустимые значения — от 0 до 100. Значение 0 — любое количество виртуальных машин в рамках допустимых значений.
`max_unavailable` | Максимальное количество виртуальных машин в статусе `RUNNING`, на которое можно уменьшить целевой размер группы.<br>Допустимые значения — от 0 до 100.
`max_expansion` | Максимальное количество виртуальных машин, на которое можно превысить целевой размер группы. Если ключ `max_unavailable` не указан или равен нулю, ключу `max_expansion` должно быть установлено ненулевое значение.<br>Допустимые значения — от 0 до 100.
`startup_duration` | Время запуска виртуальной машины в группе. Виртуальная машина начнет получать нагрузку только после того, как истечет время запуска, и будут пройдены все проверки состояния.<br>Допустимые значения — от 0 до 3600 секунд.

## Политика масштабирования {#scale-policy}

При создании группы виртуальных машин можно выбрать каким образом увеличивать и уменьшать число виртуальных машин в группе.

Политика определяется в YAML-файле, в ключе `scale_policy`.

#### fixed_scale {#fixed-scale-policy}

Ключ `fixed_scale` определяет группу виртуальных машин фиксированного размера. Размер группы определяется в ключе `size`. Вы можете создать группу с необходимым вам количеством виртуальных машин в рамках доступных [квот и лимитов](../limits.md).

Пример записи в YAML-файле:

```
...
scale_policy:
    fixed_scale:
        size: 3
...
```

Ключи:

Ключ | Значение
----- | -----
`fixed_scale` | Группа виртуальных машин фиксированного размера.
`size`* | Количество виртуальных машин в группе.<br>Допустимые значения — от 0 до 100.

\* Обязательное поле.

#### auto_scale {#auto-scale-policy}

Ключ `auto_scale` определяет автоматически масштабируемую группу виртуальных машин. Начальный размер группы определяется в ключе `initial_size`. Вы можете создать группу с необходимым вам количеством виртуальных машин в рамках доступных [квот и лимитов](../limits.md).

Пример записи в YAML-файле:

```
scale_policy:
    auto_scale:
        initial_size: 5
        max_size: 15
        min_zone_size: 3
        measurement_duration: 30
        warmup_duration: 60
        stabilization_duration: 120
        cpu_utilization_rule:
            utilization_target: 75
```

Ключи:

Ключ | Значение
----- | -----
`auto_scale` | Автоматически масштабируемая группа виртуальных машин.
`initial_size`* | Начальное количество виртуальных машин в группе.<br>Допустимые значения — от 1 до 100.
`max_size` | Максимальное количество виртуальных машин в группе.<br>Допустимые значения — от 0 до 100.
`min_zone_size` | Минимальное количество виртуальных машин в одной зоне доступности.<br>Допустимые значения — от 0 до 100.
`measurement_duration`* | Время в секундах, за которое происходит усреднение метрик по нагрузке CPU. Если средняя нагрузка по окончании интервала оказывается выше значения `cpu_utilization_rule.utilization_target`, то {{ ig-name }} увеличит количество виртуальных машин в группе.<br>Допустимые значения — от 60 до 600 секунд.
`warmup_duration`* | Время прогрева виртуальной машины. В течение этого времени на виртуальную машину подается трафик, но метрики по нагрузке CPU не учитываются.<br>Допустимые значения — от 0 до 600 секунд.
`stabilization_duration`* | Минимальный временной интервал для мониторинга нагрузки перед тем как {{ ig-name }} может уменьшить количество виртуальных машин в группе. В течение этого времени группа не будет уменьшаться даже если средняя нагрузка упадет ниже значения `cpu_utilization_rule.utilization_target`.<br>Допустимые значения — от 60 до 1800 секунд.
`cpu_utilization_rule`* | Задает целевой уровень нагрузки CPU, который позволяет выполнять масштабирование, основываясь на средней нагрузке CPU для группы виртуальных машин.
`utilization_target`* | Целевой уровень нагрузки CPU, который должен поддерживать {{ ig-name }}.<br>Если средний уровень нагрузки CPU ниже целевого значения, {{ ig-name }} будет сокращать количество виртуальных машин, пока не достигнет значения `min_zone_size` в каждой зоне доступности.<br>Если средний уровень нагрузки CPU выше целевого значения, {{ ig-name }} будет создавать виртуальные машины, пока не достигнет значения `max_size`.<br>Допустимые значения — от 10 до 100.

\* Обязательное поле.
