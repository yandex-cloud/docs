# Правила обновления группы виртуальных машин

Обновление группы виртуальных машин выполняется с минимально возможными последствиями для машин, которыми группа управляет.

В порядке возрастания опасности, группы виртуальных машин могут выполнить следующие действия:
* обновление виртуальной машины без остановки;
* обновление виртуальной машины с перезапуском — остановка и последующий запуск машины;
* пересоздание виртуальной машины — удаление и создание машины;
* удаление виртуальной машины.

{% note alert %}

При удалении виртуальной машины удаляются все связанные с ней ресурсы, такие как загрузочный диск, дополнительные диски и динамические IP-адреса.

{% endnote %}

## Последствия изменения настроек группы виртуальных машин {#change-gr}

Изменения настроек группы виртуальных машин могут по-разному влиять на виртуальные машины в этой группе.

### Изменения, не затрагивающие виртуальные машины {#ch-gr-not-affect}

* Изменение метаданных группы виртуальных машин (`name`, `description`, `labels`, `service_account_id`).

* Изменение политики развертывания группы (`deploy_policy`).

* Изменение спецификации [проверки состояния](../../../operations/instance-groups/enable-autohealing.md) (`health_checks_spec`).

* Изменение спецификаций целевых групп [сетевого балансировщика нагрузки](../../../../network-load-balancer/concepts/index.md) (`load_balancer_spec`) и [L7-балансировщика нагрузки](../../../../application-load-balancer/concepts/index.md) (`application_load_balancer_spec`) — но не добавление или удаление этих спецификаций.

### Изменения, приводящие к перезапуску или пересозданию виртуальных машин {#ch-gr-affect}

* Смена политики масштабирования группы (`scale_policy`).

  Если пользователь изменил размер группы в параметре или включил автоматическое масштабирование, изменившее размер группы, то может произойти удаление старых или создание новых виртуальных машин.

* Смена политики распределения (`allocation_policy`).

  При смене политики распределения виртуальных машин между зонами машины могут быть удалены перманентно. Также машины могут быть удалены из одной зоны и созданы в другой, так как перемещение виртуальных машин между зонами невозможно.

* Добавление или удаление спецификаций целевых групп сетевого балансировщика нагрузки (`load_balancer_spec`) и L7-балансировщика нагрузки (`application_load_balancer_spec`).

## Изменение шаблона виртуальной машины {#change-temp}

В некоторых случаях изменение шаблона виртуальной машины (`instance_template`) приводит к ее перезапуску или пересозданию.  

### Изменения, не затрагивающие виртуальную машину {#ch-temp-not-restart}

* Изменение имени виртуальной машины, описания, меток (`name`, `description`, `labels`).
* Изменение сервисного аккаунта виртуальной машины (не группы) (`service_account_id`).

### Параметры, изменение которых приводит к перезапуску виртуальной машины {#ch-temp-with-restart}

* `platform_id`— аппаратная платформа.
* `resources_spec.{memory,cores,core_fraction,gpus}` — объем памяти, CPU, [% гарантии CPU](../../performance-levels.md), [количество GPU](../../gpus.md). 
* `boot_disk_spec` — загрузочный диск.
* `metadata` — метаданные виртуальной машины.

### Параметры, изменение которых приводит к пересозданию виртуальной машины {#ch-temp-with-recreate}

* `network_interface_specs`— сетевые интерфейсы нельзя обновлять без пересоздания виртуальной машины.
* `secondary_disk_specs` — дополнительные диски нельзя обновлять без пересоздания виртуальной машины. Диски сохраняются по возможности.
* `scheduling_policy` — превратить обычную виртуальную машину в прерываемую и наоборот нельзя без пересоздания.
