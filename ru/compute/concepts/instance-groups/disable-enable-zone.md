---
title: Временное отключение зоны доступности для группы ВМ {{ compute-full-name }}
description: Вы можете временно отключить зону доступности для группы виртуальных машин.
---

# Временное отключение зон доступности для групп ВМ {{ compute-full-name }}

{% include [disable-enable-zone-intro](../../../_includes/instance-groups/disable-enable-zone-intro.md) %}

Подробнее см. на странице [{#T}](../../operations/instance-groups/disable-enable-zone.md).

При временном отключении зоны доступности группа ВМ работает в следующем режиме:
* ВМ из отключенной зоны [не будут обновляться](disable-enable-zone.md#update) при обновлении группы.
* ВМ из отключенной зоны [не будут автоматически восстанавливаться](disable-enable-zone.md#autohealing).
* При ручном или автоматическом увеличении размера группы [новые ВМ будут создаваться](disable-enable-zone.md#increase-size) только во включенных зонах.
* ВМ из отключенной зоны [можно остановить или удалить вручную](disable-enable-zone.md#manual-stop-delete).
* Операции, которые приводят к созданию, запуску или обновлению ВМ в отключенной зоне, [будут завершены](disable-enable-zone.md#operation-completion) только после ее обратного включения.

## Обновление ВМ в группе {#update}

В отключенной зоне не будет происходить [обновление](./deploy/index.md) ВМ до момента обратного включения зоны. В остальных зонах ВМ будут обновляться как обычно. Целевое состояние ВМ в отключенной зоне будет достигнуто после возврата зоны доступности в нормальное состояние.

{% note warning %}

Чтобы обезопасить группу от полной потери всех ВМ при обновлении, ВМ из отключаемой зоны учитываются в квоте `max_unavailable` [политики развертывания](./policies/deploy-policy.md). Поэтому для обновления ВМ в группе при отключенной зоне следует увеличивать значение параметра `max_expansion`.

{% endnote %}

## Автоматическое восстановление ВМ в группе {#autohealing}

В отключенной зоне перестает работать механизм [автоматического восстановления](autohealing.md#healthcheck-cases) ВМ, для остальных зон механизм автоматического восстановления продолжает функционировать как обычно:
* ВМ, считающиеся неработоспособными по [статусу в {{ compute-name }}](autohealing.md#auto-healthcheck), по-прежнему будут восстанавливаться вне какой-либо квоты.
* ВМ, считающиеся неработоспособными по [состоянию приложения](autohealing.md#functional-healthcheck), будут восстанавливаться в рамках квоты `max_unavailable`, отвечающей в [политике развертывания](policies/deploy-policy.md) за максимальное количество ВМ, которые могут быть недоступны при обновлении группы. ВМ из отключенной зоны не учитываются в квоте `max_unavailable` при работе механизма автоматического восстановления, поэтому процесс восстановления в оставшихся зонах функционирует штатно.

## Увеличение размера группы ВМ {#increase-size}

### Группы ВМ с автоматическим масштабированием {#increase-scalable}

Вне зависимости от [типа автоматического масштабирования](scale.md#auto-scale-type) количество ВМ в отключенной зоне перестает изменяться. При отключенной зоне ВМ создаются только в оставшихся включенных зонах до исчерпания квоты `max_size` [политики масштабирования](policies/scale-policy.md#auto-scale-policy).

_Зональный_ тип автоматического масштабирования не предполагает равномерного распределения ВМ по зонам. В оставшихся включенных зонах ВМ создаются в зависимости от нагрузки.

_Региональный_ тип автоматического масштабирования предполагает равномерное распределение ВМ по зонам. Во время отключения зоны может возникнуть дисбаланс в этом распределении.

После обратного включения зоны ВМ автоматически перераспределяются по всем зонам в зависимости от выбранного типа автоматического масштабирования.

{% note warning %}

Если вы используете сетевой или L7-балансировщик в связке с группой ВМ с автоматическим масштабированием, перед выключением зоны в балансировщике сначала [выключите](../../operations/instance-groups/disable-enable-zone.md#disable) эту зону для группы ВМ. Если этого не сделать, группа ВМ продолжит создавать ВМ в зоне, в которую не будет поступать трафик.

Перед включением зоны в балансировщике сначала [включите](../../operations/instance-groups/disable-enable-zone.md#enable) зону в группе ВМ, чтобы количество ВМ предварительно распределилось по зонам.

{% endnote %}

### Группы ВМ фиксированного размера {#increase-fixed-size}

В группах фиксированного размера ВМ распределяются по зонам доступности строго равномерно. Это поведение сохраняется и во время отключения зоны.

Новые ВМ в работающих зонах будут созданы сразу, новые ВМ в отключенной зоне будут созданы после ее включения.

## Ручное удаление и остановка ВМ {#manual-stop-delete}

Чтобы сохранить работоспособность сервиса, вы можете удалять ВМ в отключенной зоне с помощью метода REST API [DeleteInstances](../../instancegroup/api-ref/InstanceGroup/deleteInstances.md) для ресурса [InstanceGroup](../../instancegroup/api-ref/InstanceGroup/index.md) или вызова gRPC API [InstanceGroupService/DeleteInstances](../../instancegroup/api-ref/grpc/InstanceGroup/deleteInstances). 

Также вы можете останавливать ВМ в отключенной зоне с помощью метода REST API [StopInstances](../../instancegroup/api-ref/InstanceGroup/stopInstances) для ресурса [InstanceGroup](../../instancegroup/api-ref/InstanceGroup/index.md) или вызова gRPC API [InstanceGroupService/StopInstances](../../instancegroup/api-ref/grpc/InstanceGroup/stopInstances). 

Когда зона снова будет включена, группа ВМ запустит остановленные ВМ и создаст недостающие. При этом, если в методе `DeleteInstances` был выставлен параметр `createAnother`, создание ВМ не будет выполнено до включения зоны.

## Завершение операций в группе ВМ {#operation-completion}

Операции, которые приводят к созданию, запуску или обновлению ВМ в отключенной зоне, будут выполнены только после включения зоны. К таким операциям относятся создание, обновление и запуск группы ВМ, а также поэтапное пересоздание и перезапуск ВМ в группе.

Операции, которые приводят к остановке или удалению ВМ в отключенной зоне, будут выполнены как обычно. К таким операциям относятся остановка и удаление группы ВМ, а также остановка и удаление ВМ в группе.

## Поведение группы ВМ при временном отключении зоны и инциденте в этой же зоне {#zonal-inc-shift}

При зональном инциденте [поведение группы ВМ автоматически изменяется](zonal-inc/multi-zonal.md). Ограничения на действия группы над ВМ в зоне инцидента более строгие, чем ограничения при самостоятельном отключении зоны, поэтому отключение зоны никак не повлияет на работу группы ВМ.

{% note tip %}

Во время инцидента вы можете отключить для группы ВМ зону, в которой он произошел. Это позволит продлить ограничения на создание, запуск и обновление ВМ в группе после завершения инцидента. Таким образом вы сможете контролируемо ввести ВМ из пораженной зоны в эксплуатацию при выходе из инцидента.

{% endnote %}

### См. также {#see-also}

* [{#T}](../../operations/instance-groups/disable-enable-zone.md)
* [Отключить и включить зоны доступности в {{ network-load-balancer-full-name }}](../../../network-load-balancer/operations/manage-zone/disable-enable-zone.md)
* [Отключить и включить зоны доступности в {{ alb-full-name }}](../../../application-load-balancer/operations/manage-zone/start-and-cancel-shift.md)
* [{#T}](./zonal-inc/overview.md)