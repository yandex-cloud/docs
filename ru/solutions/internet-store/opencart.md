# Интернет-магазин на платформе OpenCart

[OpenCart](https://ru.wikipedia.org/wiki/OpenCart) — это платформа, предназначенная для создания собственного интернет-магазина. Платформа бесплатна и имеет открытый исходный код. С помощью OpenCart можно создать интернет-магазин любой сложности с помощью большого количества поддерживаемых сообществом дополнений.

В этой инструкции будет создан и настроен интернет-магазин на базе OpenCart. Для этого будет развернута виртуальная машина с предустановленной платформой OpenCart и требуемыми для ее работы программами, в частности, сервером {{ MY }}.
 
В сценарии описана как настройка локального сервера {{ MY }}, так и развертывание кластера БД {{ mmy-name }} на тот случай, если вам не хватает производительности или функциональности локальной СУБД. Если необходимости в кластере нет, пропустите этот шаг.

Чтобы настроить свой интернет-магазин на OpenCart:

1. [Подготовьте облако к работе](#before-you-begin)
1. [Создайте виртуальную машину с платформой OpenCart](#create-vm)
1. [(опционально) Создайте кластер баз данных MySQL](#create-mysql)
1. [Настройте OpenCart](#configure-opencart)


## Подготовьте облако к работе {#before-you-begin}

Перед тем, как разворачивать сервер, нужно войти в {{ yandex-cloud }} и создать платежный аккаунт:

{% include [prepare-register-billing](../_solutions_includes/prepare-register-billing.md) %}

Если у вас есть активный платежный аккаунт, вы можете создать или выбрать каталог, в котором будет работать ваша виртуальная машина. Перейдите на [страницу облака](https://console.cloud.yandex.ru/cloud) и выберите или создайте каталог, в котором вы хотите создать ВМ для вашего сервера. [Подробнее об иерархии ресурсов {{ yandex-cloud }}](../../resource-manager/concepts/resources-hierarchy.md).


### Необходимые платные ресурсы

В стоимость поддержки инфраструктуры для OpenCart входит:

* плата за постоянно запущенную виртуальную машину (см. [тарифы {{ compute-full-name }}](../../compute/pricing.md));
* плата за использование динамического или статического внешнего IP-адреса (см. [тарифы {{ vpc-full-name }}](../../vpc/pricing.md)).
* если планируется настройка управляемой базы данных, в стоимость также войдет плата за кластер БД (см. [тарифы {{ mmy-name }}](../../managed-mysql/pricing.md)).


## Создайте виртуальную машину с платформой OpenCart {#create-vm}

Чтобы создать виртуальную машину:

1. На странице каталога в [консоли управления]({{ link-console-main }}) нажмите кнопку **Создать ресурс** и выберите пункт **Виртуальная машина**.
1. В поле **Имя** введите имя виртуальной машины, например, `opencart`.

   {% include [name-format](../../_includes/name-format.md) %}

1. Выберите [зону доступности](../../overview/concepts/geo-scope.md), в которой должна находиться виртуальная машина.
1. В блоке **Образы из {{ marketplace-name }}** нажмите кнопку **Выбрать**. Выберите публичный образ **OpenCart**.

   На загрузочном диске будет предустановлена платформа OpenCart и необходимые для ее работы компоненты, включая PHP и MySQL.

1. В блоке **Диски** выберите жесткий диск SSD размером 13 ГБ.
1. В блоке **Вычислительные ресурсы** укажите следующую конфигурацию:
   * **Платформа** — Intel Cascade Lake.
   * **Гарантированная доля vCPU** — 20%.
   * **vCPU** — 2.
   * **RAM** — 4 ГБ.

1. В блоке **Сетевые настройки**:
   - Выберите сеть и подсеть, к которым нужно подключить виртуальную машину. Если у вас еще нет сети или подсети, вы можете создать их прямо на странице создания ВМ: нажмите кнопку **Создать новую сеть** или **Создать новую подсеть**.
   - В поле **Публичный адрес** оставьте значение **Автоматически**, чтобы назначить виртуальной машине случайный внешний IP-адрес из пула {{ yandex-cloud }}, или выберите статический адрес из списка, если вы зарезервировали его заранее.

1. В блоке **Доступ** укажите данные для доступа к виртуальной машине:
   - В поле **Логин** введите предпочтительное имя пользователя, который будет создан на виртуальной машине, например, `ubuntu`.
   - В поле **SSH-ключ** скопируйте ваш открытый SSH-ключ. Пару ключей для подключения по SSH необходимо создать самостоятельно, см. [раздел о подключении к виртуальным машинам по SSH](../../compute/operations/vm-connect/ssh.md).

1. Нажмите кнопку **Создать ВМ**.


## Создайте кластер баз данных {{ MY }} {#create-mysql}

Если вы рассчитываете на существенную нагрузку на базу данных, или хотели бы использовать сервис управляемых СУБД, разверните кластер БД с помощью сервиса {{ mmy-name }}. Сервис берет на себя поддержку и обслуживание СУБД, в том числе мониторинг ее состояния и текущей активности, автоматическое создание резервных копий и легко настраиваемую отказоустойчивость.

Чтобы создать кластер баз данных:

1. На странице каталога в [консоли управления]({{ link-console-main }}) нажмите кнопку **Создать ресурс** и выберите пункт **Кластер MySQL**.
1. Укажите имя кластера, например, `opencart`.
1. В блоке **Класс хоста** выберите **s2.micro**. Данных характеристик хватит для работы системы без особых нагрузок.
1. В блоке **База данных** укажите:
   - **Имя БД** — оставьте значение по умолчанию, `db1`.
   - **Имя пользователя** для подключения к базе данных — оставьте значение по умолчанию, `user1`.
   - **Пароль**, который OpenCart будет использовать для доступа к базе данных {{ MY }}.

1. В блоке **Хосты**, при необходимости, поменяйте **Зону доступности**, в которой должна находиться база данных. Для этого нажмите значок ![pencil](../../_assets/pencil.svg) справа от текущей выбранной зоны доступности и выберите из выпадающего списка нужную.

   {% note tip %}

   Рекомендуется выбрать ту же зону доступности, которую вы выбрали при создании виртуальной машины. Это позволит уменьшить задержку (latency) между виртуальной машиной и базой данных.

   {% endnote %}

1. (опционально) Если вы хотите обеспечить отказоустойчивость базы данных, добавьте дополнительные хосты в кластер: для этого нажмите **Добавить хост** и укажите, в какой зоне доступности он должен быть размещен.
1. Остальные поля оставьте без изменений.
1. Нажмите кнопку **Создать кластер**.

Создание кластера БД может занять несколько минут.

## Настройте OpenCart {#configure-opencart}

1. Откройте веб-интерфейс интернет-магазина OpenCart. Для этого откройте в браузере адрес `http://<публичный-IP-адрес-ВМ>/`. Откроется страница настройки OpenCart.

1. Ознакомьтесь с лицензией и нажмите **Continue**.

   ![Шаг 1](../_assets/opencart/opencart1.png)

1. Убедитесь, что все строки с требованиями к системе отмечены с зелеными галочками, и нажмите кнопку **Continue**.

   ![Шаг 2](../_assets/opencart/opencart2.png)

1. Настройте доступ к базе данных:

   {% list tabs %}
   
   - Локальный сервер {{ MY }}
   
   Атрибуты подключения к БД генерируются в специальном файле при создании виртуальной машины:
     1. Зайдите по SSH на созданную виртуальную машину.
     1. Перейдите в режим администратора `sudo -i`.
     1. Откройте файл `default_passwords.txt` в домашней директории администратора:
        ```bash
        root@opencart:~# cat default_passwords.txt
        MYSQL_USER=opencart
        MYSQL_PASS=qDbvN1R6tA6ET
        MYSQL_ROOT_PASS=5DiVb80l1kXVz
        MYSQL_DB=opencart
        ```
     1. На странице настройки OpenCart в секции базы данных, введите соответствующие данные:
        - **Username** — значение переменной `MYSQL_USER`.
        - **Database** — значение переменной `MYSQL_DB`.
        - **Password** — значение переменной `MYSQL_PASS`.
        Остальные поля оставьте без изменения.
   
   - Кластер {{ mmy-name }}
   
     Если вы используете кластер {{ mmy-name }}, введите нужные атрибуты кластера:
       - **Hostname** — укажите полное доменное имя (FQDN) созданной базы данных. Чтобы его узнать:
         1. Перейдите в новой вкладке браузера на страницу каталога в [консоли управления]({{ link-console-main }}).
         1. Выберите раздел **{{ mmy-name }}**.
         1. В таблице выберите созданный вами кластер.
         1. В меню слева выберите вкладку **Хосты**.
         1. Подведите курсор к полю **Имя хоста** (например, `rc1c-vok617m35g3dj23i`) и скопируйте полное доменное имя базы данных, нажав на значок ![copy](../../_assets/copy.svg).
       - **Username** — имя пользователя (в примере `user1`).
       - **Database** — имя БД (в примере `db1`).
       - **Password** — указанный вами пароль пользователя.
       Остальные поля оставьте без изменения.
   
   {% endlist%}

1. Задайте имя администратора, его пароль и актуальный электронный адрес. После этого нажмите кнопку **Continue**.

   ![Шаг 3](../_assets/opencart/opencart3.png)

1. Откроется страница с уведомлением о том, что система настроена. Чтобы настроить интернет-магазин, нажмите кнопку **Login to your administration** и введите логин и пароль администратора.

   ![Шаг 4](../_assets/opencart/opencart4.png)

1. После завершения установки зайдите на виртуальную машину по SSH и удалите ненужные установочные файлы:

   ```
   user@opencart:~$ sudo -i
   root@opencart:~# rm -rf /var/www/opencart/install/
   ```

1. Чтобы проверить главную страницу сайта, перейдите по адресу `http://<публичный-IP-адрес-ВМ>/`. Вы увидите главную страницу сайта глазами пользователя, посетившего ваш интернет-магазин.

   ![Шаг 5](../_assets/opencart/opencart5.png)


## Как удалить созданные ресурсы {#clear-out}

Чтобы перестать платить за развернутый сервер, достаточно удалить созданную виртуальную машину и кластер базы данных, если вы его создавали:
  * [удалите виртуальную машину](../../compute/operations/vm-control/vm-delete.md) (в примере виртуальная машина создается с именем `opencart`).
  * [удалите кластер {{ mmy-name }}](../../managed-mysql/operations/cluster-delete.md) (в примере кластер БД создается с именем `opencart`).

Если вы зарезервировали статический публичный IP-адрес специально для этой ВМ:

1. Откройте сервис **Virtual Private Cloud** в вашем каталоге.
1. Перейдите на вкладку **IP-адреса**.
1. Найдите нужный адрес, нажмите значок ![ellipsis](../../_assets/options.svg) и выберите пункт **Удалить**.
