# Веб-сайт на LAMP- или LEMP-стеке

[LAMP](https://ru.wikipedia.org/wiki/LAMP) (Linux, Apache HTTP Server, MySQL, PHP) и его вариация LEMP (в которой веб-сервер Apache заменяется на Nginx) — популярные наборы компонентов для развертывания веб-приложений и динамических сайтов.

С помощью этой инструкции вы научитесь разворачивать LAMP в инфраструктуре Яндекс.Облака: в результате вы запустите виртуальную машину, на которой будет работать веб-сервер вашего сайта.

Чтобы настроить LAMP- или LEMP-сайт:
1. [Подготовьте облако к работе](#before-you-begin).
1. [Создайте виртуальную машину с предустановленным веб-сервером](#create-vm).
1. [Загрузите файлы веб-сайта](#upload-files).
1. [Настройте DNS](#configure-dns).
1. [Проверьте работу сайта](#test-site).

Если сайт вам больше не нужен, [удалите все используемые им ресурсы](#clear-out).


## Подготовьте облако к работе {#before-you-begin}

Перед тем, как разворачивать сервер, нужно зарегистрироваться в Облаке и создать платежный аккаунт:

{% include [prepare-register-billing](../_solutions_includes/prepare-register-billing.md) %}

Если у вас есть активный платежный аккаунт, вы можете создать или выбрать каталог, в котором будет работать ваша виртуальная машина, на [странице облака](https://console.cloud.yandex.ru/cloud).

[Подробнее об облаках и каталогах](../../resource-manager/concepts/resources-hierarchy.md).


### Необходимые платные ресурсы {#paid-resources}

В стоимость поддержки LAMP-сервера входит:

* плата за постоянно запущенную виртуальную машину (см. [тарифы {{ compute-full-name }}](../../compute/pricing.md));
* плата за использование динамического или статического внешнего IP-адреса (см. [тарифы {{ vpc-full-name }}](../../vpc/pricing.md)).


## Создайте виртуальную машину с предустановленным веб-сервером {#create-vm}

Чтобы создать виртуальную машину:

1. На странице каталога в [консоли управления]({{ link-console-main }}) нажмите кнопку **Создать ресурс** и выберите пункт **Виртуальная машина**.
1. В поле **Имя** введите имя виртуальной машины — `lamp-vm` или `lemp-vm`.

    {% include [name-format](../../_includes/name-format.md) %}

1. Выберите [зону доступности](../../overview/concepts/geo-scope.md), в которой должна находиться виртуальная машина. Если вы не знаете, какая зона доступности вам нужна, оставьте выбранную по умолчанию.
1. В блоке **Публичные образы** нажмите кнопку **Выбрать** и выберите образ виртуальной машины с нужным набором компонентов:
   * **LAMP** для Linux, Apache, MySQL, PHP.
   * **LEMP** для Linux, Nginx, MySQL, PHP.
   
   LEMP рекомендуется использовать для статических сайтов.

1. В блоке **Вычислительные ресурсы**:
    - Выберите [платформу](../../compute/concepts/vm-platforms.md) виртуальной машины.
    - Укажите необходимое количество vCPU и объем RAM.

   Для функционального тестирования сайта хватит минимальной конфигурации:
   * **Платформа** — Intel Cascade Lake.
   * **Гарантированная доля vCPU** — 5%.
   * **vCPU** — 2.
   * **RAM** — 1 ГБ.

1. В блоке **Сетевые настройки** нужно выбрать сеть и подсеть, к которым нужно подключить виртуальную машину. Если нужной сети или подсети еще нет, вы можете создать их прямо на странице создания ВМ.

1. В поле **Публичный адрес** оставьте значение **Автоматически**, чтобы назначить виртуальной машине случайный внешний IP-адрес из пула Яндекс.Облака, или выберите статический адрес из списка, если вы зарезервировали его заранее.

1. Укажите данные для доступа на виртуальную машину:
    - В поле **Логин** введите имя пользователя.
    - В поле **SSH-ключ** вставьте содержимое файла открытого ключа.
      
      Пару ключей для подключения по SSH необходимо создать самостоятельно, см. [раздел о подключении к виртуальным машинам по SSH](../../compute/operations/vm-connect/ssh.md).
      
    {% note alert %}
    
     IP-адрес и имя хоста (FQDN) для подключения к машине назначатся ей при создании. Если вы выбрали вариант **Без адреса** в поле **Публичный адрес**, вы не сможете обращаться к ВМ из интернета.
    
    {% endnote %}

1. Нажмите кнопку **Создать ВМ**.

Создание виртуальной машины может занять несколько минут. Когда виртуальная машина перейдет в статус `RUNNING`, вы можете [загрузить на нее файлы веб-сайта](#upload-files).

![vm-running](../../_assets/solutions/lamp-lemp/vm-running.png)


## Загрузите файлы веб-сайта {#upload-files}

Чтобы проверить работу веб-сервера, загрузите на виртуальную машину файл `index.html`. Можно использовать [тестовый файл](https://storage.yandexcloud.net/doc-files/index.html.zip), не забудьте только распаковать его.

{% include [upload-files](../_solutions_includes/upload-web-site-files.md) %}


## Настройте DNS (если есть доменное имя) {#configure-dns}

Если вы хотите связать какое-то доменное имя с развернутым сервером, отредактируйте DNS-записи вашего домена.

{% include [configure-a-record-and-cname](../_solutions_includes/configure-a-record-and-cname.md) %}


## Проверьте работу сайта {#test-site}

Чтобы проверить работу сайта, откройте его адрес в браузере: `http://<публичный IP-адрес виртуальной машины>`.

Проверить работу доменного имени аналогичным образом можно будет только через 15-20 минут после того, как вы изменили DNS-записи.


## Как удалить созданные ресурсы {#clear-out}

Чтобы перестать платить за развернутый сервер, достаточно [удалить](../../compute/operations/vm-control/vm-delete.md) виртуальную машину `lamp-vm` или `lemp-vm`.

Если вы зарезервировали статический публичный IP-адрес специально для этой ВМ:

1. Откройте сервис **Virtual Private Cloud** в вашем каталоге.
1. Перейдите на вкладку **IP-адреса**.
1. Найдите нужный адрес, нажмите значок ![ellipsis](../../_assets/options.svg) и выберите пункт **Удалить**. 
