# Установка виртуального роутера Mikrotik CHR

В Яндекс.Облаке можно развернуть виртуальный роутер Mikrotik Cloud Hosted Router из готового образа ВМ. Чтобы установить Mikrotik Cloud Hosted Router и проверить его работу:

1. [Подготовьте облако к работе](#before-you-begin).
1. [Создайте ВМ с Mikrotik Cloud Hosted Router](#create-router).
1. [Зайдите на ВМ и смените пароль](#change-password).
1. [Создайте тестовую ВМ](#create-test-vm).
1. [Проверьте связь роутера и тестовой ВМ](#test-connection).

Если созданные ресурсы вам больше не нужны, [удалите их](#clear-out).

## Подготовьте облако к работе {#before-you-begin}

{% include [before-you-begin](../_solutions_includes/before-you-begin.md) %}

### Необходимые платные ресурсы {#paid-resources}

{% note alert %}

Пропускная способность роутера при использовании образа Mikrotik Cloud Hosted Router без лицензии ограничена 1 Мбит/с. Чтобы снять ограничение, [установите лицензию](https://wiki.mikrotik.com/wiki/Manual:CHR#CHR_Licensing).

{% endnote %}

В стоимость использования виртуального роутера и тестовой ВМ входят:

* плата за диски и постоянно запущенные виртуальные машины (см. [тарифы {{ compute-full-name }}](../../compute/pricing.md));
* плата за использование публичного IP-адреса (см. [тарифы {{ vpc-full-name }}](../../vpc/pricing.md));

## Создайте ВМ с Mikrotik Cloud Hosted Router {#create-router}

1. Откройте ваш каталог и нажмите кнопку **Создать ресурс**. Выберите пункт **Виртуальная машина**.
1. Укажите имя виртуальной машины, например `mikrotik-router`.
1. Выберите [зону доступности](../../overview/concepts/geo-scope.md), в которой есть подсеть. Если вы не знаете, какая зона доступности вам нужна, оставьте выбранную по умолчанию.
1. В блоке **Публичные образы** нажмите кнопку **Выбрать** и выберите образ **Cloud Hosted Router**.
1. В блоке **Вычислительные ресурсы**:
    - Выберите [платформу](../../compute/concepts/vm-platforms.md) виртуальной машины.
    - Укажите необходимое количество vCPU и объем RAM:
      * **Платформа** — Intel Cascade Lake.
      * **Гарантированная доля vCPU** — 100%.
      * **vCPU** — 2.
      * **RAM** — 2 ГБ.
1. В блоке **Сетевые настройки** выберите требуемую сеть, подсеть и назначьте ВМ публичный IP-адрес из списка или автоматически. Если у вас нет сети и подсети, их можно создать на экране создания ВМ.
1. В поле **Доступ** укажите логин и SSH-ключ для доступа к ВМ. Обратите внимание, что эти данные нужны только для создания ВМ, их нельзя использовать для доступа к роутеру.
1. Нажмите кнопку **Создать ВМ**.

Создание виртуальной машины может занять несколько минут. Когда виртуальная машина перейдет в статус `RUNNING`, вы можете зайти на нее.

{% note alert %}

Сразу после создания ВМ задайте сложный пароль администратора.

{% endnote %}

## Смените на роутере пароль администратора {#change-password}

Роутер создается с публичным IP-адресом, поэтому для безопасности необходимо изменить пароль администратора, установленный по умолчанию.

1. Откройте страницу ВМ `mikrotik-router` в [консоли управления]({{ link-console-main }}).
1. Скопируйте публичный адрес ВМ и откройте его в браузере. Откроется экран первоначальной настройки роутера.
1. В поле **IP Address** введите внутренний IP-адрес виртуальной машины. 
1. На открывшейся странице введите новый пароль администратора, подтвердите его, и нажмите кнопку **Apply Configuration**. Все остальные настройки можно задать позже.

## Создайте тестовую ВМ {#create-test-vm}

Создайте тестовую ВМ в одной подсети с роутером, чтобы проверить возможность подключения между роутером и ВМ.

1. На странице каталога в [консоли управления]({{ link-console-main }}) нажмите кнопку **Создать ресурс** и выберите пункт **Виртуальная машина**.
1. В поле **Имя** введите имя виртуальной машины — `test-vm`.
1. Выберите ту же [зону доступности](../../overview/concepts/geo-scope.md), в которой находится ВМ `mikrotik-router`. 
1. В блоке **Публичные образы** выберите образ **Ubuntu**.
1. В блоке **Вычислительные ресурсы**:
    - Выберите [платформу](../../compute/concepts/vm-platforms.md) виртуальной машины.
    - Укажите необходимое количество vCPU и объем RAM.
     * **Платформа** — Intel Cascade Lake.
     * **Гарантированная доля vCPU** — 5%.
     * **vCPU** — 2.
     * **RAM** — 0.5 ГБ.

1. В блоке **Сетевые настройки** нужно выбрать сеть и подсеть, в которых находится ВМ `mikrotik-router`.
1. В поле **Публичный адрес** выберите **Без адреса**.
1. В блоке **Доступ** укажите логин и SSH-ключ для доступа к ВМ.
1. Нажмите кнопку **Создать ВМ**.

### Проверьте связь роутера и тестовой ВМ {#test-connection}

{% note alert %}

Если вы используете для доступа к роутеру программу WinBox, подключайтесь к роутеру через IP-адрес ВМ. Доступ через MAC-адрес не поддерживается в Яндекс.Облаке.

{% endnote %}

Убедитесь, что есть сетевое соединение между роутером и тестовой ВМ:

1. Откройте административный интерфейс роутера в браузере.
1. Нажмите кнопку **Terminal**.
1. В открывшемся терминале выполните команду `ping <внутренний IP-адрес тестовой ВМ>`.

Если пакеты доходят до тестовой ВМ, можно переходить к настройке роутера. О работе с роутером читайте в [документации Mikrotik](https://wiki.mikrotik.com/wiki/Main_Page).

## Удалите созданные ресурсы {#clear-out}

Чтобы перестать платить за развернутые ресурсы, [удалите](../../compute/operations/vm-control/vm-delete.md) виртуальные машины `mikrotik-router` и `test-vm`. 

Если вы зарезервировали публичный статический IP-адрес, [удалите его](../../vpc/operations/address-delete.md).
