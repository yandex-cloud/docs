# Настройка хостинга

{{ objstorage-name }} позволяет настроить бакет:

- Для [хостинга статического сайта](#hosting).
- Для [переадресации всех запросов](#redirects).
- Для [условной переадресации запросов](#redirects-on-conditions).

## Хостинг статического сайта {#hosting}

{% list tabs %}

- Консоль управления

  1. В консоли управления перейдите в бакет, для которого хотите настроить хостинг.
  1. Убедитесь, что для бакета установлен публичный доступ. Если нет, то воспользуйтесь инструкцией [{#T}](../buckets/bucket-availability.md).
  1. В левой панели выберите пункт **Веб-сайт**.
  1. В разделе **Хостинг** укажите:
      - Главную страницу сайта.
      - Страницу, которая будет отображаться пользователю при ошибках 4хх. Необязательно.     

- Terraform

  Если у вас ещё нет Terraform, [установите его и настройте провайдер {{ yandex-cloud }}](../../../solutions/infrastructure-management/terraform-quickstart.md#install-terraform).

  Перед началом работы, получите [статические ключи доступа](../../../iam/operations/sa/create-access-key.md) — секретный ключ и идентификатор ключа, используемые для аутентификации в {{ objstorage-short-name }}.

  1. Опишите в конфигурационном файле параметры ресурсов, которые необходимо создать:
     * `access_key` — идентификатор статического ключа доступа.
     * `secret_key` — значение секретного ключа доступа.
     * `bucket` — имя бакета.
     * `acl` — параметры управления доступом [ACL](../../concepts/acl.md#predefined-acls).
     * `website` — параметры веб-сайта:

       * `index_document` — абсолютный путь к файлу главной страницы сайта. Обязательный параметр.
       * `error_document` — абсолютный путь к файлу, который будет отображаться пользователю при ошибках `4хх`. Необязательный параметр.

     ```
     provider "yandex" {
       token     = "<OAuth>"
       cloud_id  = "<идентификатор облака>"
       folder_id = "<идентификатор каталога>"
       zone      = "ru-central1-a"
     }

     resource "yandex_storage_bucket" "test" {
       access_key = "<идентификатор статического ключа>"
       secret_key = "<секретный ключ>"
       bucket = "<имя бакета>"
       acl    = "public-read"
     
       website {
         index_document = "index.html"
         error_document = "error.html"
       }
     
     }
     ```

  1. Проверьте корректность конфигурационных файлов.

     1. В командной строке перейдите в папку, где вы создали конфигурационный файл.
     1. Выполните проверку с помощью команды:
        ```
        terraform plan
        ```

     Если конфигурация описана верно, в терминале отобразится список создаваемых ресурсов и их параметров. Если в конфигурации есть ошибки, Terraform на них укажет. 

  1. Разверните облачные ресурсы.

     1. Если в конфигурации нет ошибок, выполните команду:
     ```
     terraform apply
     ```
   
     1. Подтвердите создание ресурсов.

     После этого в указанном каталоге будут созданы все требуемые ресурсы. Проверить появление ресурсов и их настройки можно в [консоли управления]({{ link-console-main }}).

{% endlist %}

## Переадресация всех запросов {#redirects}

{% list tabs %}

- Консоль управления

  1. В консоли управления перейдите в бакет, для которого хотите настроить переадресацию.
  1. Убедитесь, что для бакета установлен публичный доступ. Если нет, то воспользуйтесь инструкцией [{#T}](../buckets/bucket-availability.md).
  1. В левой панели выберите пункт **Веб-сайт**.
  1. В разделе **Переадресация** укажите:
      - Доменное имя хоста, на который будут перенаправляться все запросы к текущему бакету.
      - Протокол, если указанный хост принимает запросы строго по определенному протоколу.

{% endlist %}

## Условная переадресация запросов {#redirects-on-conditions}

{% list tabs %}

- Консоль управления

  1. В консоли управления перейдите в бакет, для которого хотите настроить условную переадресацию запросов.
  1. Убедитесь, что для бакета установлен публичный доступ. Если нет, то воспользуйтесь инструкцией [{#T}](../buckets/bucket-availability.md).
  1. В левой панели выберите пункт **Веб-сайт**.
  1. В разделе **Хостинг** добавьте правило переадресации и в нем укажите условие для выполнения переадресации и новый адрес.
      - Условие. Например, можно выполнить переадресацию при получении заданного кода ответа или если начало ключа объекта в запросе совпадает с указанным.
      - Переадресация:
        - Доменное имя хоста, на который должны перенаправляться запросы, удовлетворившие условию.
        - Протокол, по которому должен быть отправлен переадресованный запрос.
        - Код состояния HTTP 3xx для определения типа редиректа.
        - Замена всего ключа или только его начала, указанного в условии.
        
{% endlist %}
