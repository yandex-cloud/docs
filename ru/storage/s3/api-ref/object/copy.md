# Метод copy

Создает копию объекта, хранящегося в {{ objstorage-name }}. Объекты, размером до 5 ГБ можно скопировать одной операцией `copy`, если объект больше, чем 5 ГБ, то необходимо применять операцию [copyPart](../multipart/copypart.md).

Чтобы указать источник для копирования, используйте заголовок `x-amz-copy-source`. Запрос на копирование не должен передавать каких-либо данных, кроме заголовков.

{% note info %}

{{ objstorage-name }} не блокирует объект на запись и может одновременно принять несколько запросов, копирующих объекты в один и тот же результирующий объект. После завершения всех запросов результирующим объектом окажется тот, чья операция копирования запустилась последней.

{% endnote %}

Метаданные объекта копируются вместе с объектом. При необходимости их можно изменить, задав в явном виде соответствующие заголовки.

Также с помощью заголовков можно:

- Изменить класс хранилища объекта.
- Добавить условия для копирования объекта.

Пользователь должен иметь разрешение на чтение исходного объекта и разрешение на запись в результирующий бакет.

## Запрос {#request}

```
PUT /{bucket}/{key} HTTP/2
```

### Path параметры {#path-parameters}

Параметр | Описание
----- | -----
`bucket` | Имя результирующего бакета.
`key` | Ключ результирующего объекта. Идентификатор, под которым объект сохраняется в {{ objstorage-name }}.


### Заголовки {#request-headers}

Обязательные заголовки перечислены в таблице ниже.

Заголовок | Описание
----- | -----
`x-amz-copy-source` | Имя бакета и ключ объекта, который будет копироваться, разделенные символом `/`.<br/><br/>Например, `x-amz-copy-source: /source_bucket/sourceObject`.<br/><br/>Если в бакете включено [версионирование](../../../../storage/concepts/versioning.md), то вы можете скопировать определенную версию объекта. Для этого укажите в заголовке идентификатор версии объекта — добавьте `?versionId=<version-id>` к значению заголовка, например: `/mybucket/image.png?versionId=0005E4A66AD990A4`. Если не указывать идентификатор версии, то будет скопирована последняя версия объекта.

Также используйте необходимые [общие заголовки](../common-request-headers.md).

Заголовки, описанные в таблице ниже используйте, если вам необходимо изменить поведение метода `copy` по умолчанию.

Заголовок | Описание
----- | -----
`x-amz-metadata-directive` | Режим копирования метаданных.<br/><br/>Если значение заголовка `COPY`, то метаданные объекта копируются, а все заголовки `x-amz-meta-*` игнорируются. Это поведение метода `copy` по умолчанию.<br/><br/>Если значение заголовка `REPLACE`, то метаданные объекта подменяются указанными в запросе.<br/><br/>Заголовок `x-amz-storage-class` не копируется, добавьте его в запрос, если это необходимо.
`x-amz-copy-source-if-match` | Условие для копирования объекта.<br/><br/>Если `ETag` объекта равен заданному в заголовке, то объект копируется.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `x-amz-copy-source-if-unmodified-since`.
`x-amz-copy-source-if-none-match` | Условие для копирования объекта.<br/><br/>Если `ETag` объекта не равен заданному в заголовке, то объект копируется.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `x-amz-copy-source-if-modified-since`.
`x-amz-copy-source-if-unmodified-since` | Условие для копирования объекта.<br/><br/>Объект копируется, если он не изменялся с указанного времени.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `x-amz-copy-source-if-match`.
`x-amz-copy-source-if-modified-since` | Условие для копирования объекта.<br/><br/>Объект копируется, если он изменился с указанного времени.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `x-amz-copy-source-if-none-match`.
`x-amz-server-side-encryption` | Алгоритм шифрования, используемый по умолчанию для шифрования новых объектов.
`x-amz-server-side-encryption-aws-kms-key-id` | Идентификатор {% if audience != "internal" %}[ключа {{ kms-short-name }}](../../../../kms/concepts/key.md){% else %}ключа {{ kms-short-name }}{% endif %}, используемый по умолчанию для шифрования новых объектов.
`x-amz-storage-class` | Класс хранения объекта.<br/><br/>Может иметь любое из значений:<br/>- `STANDARD` для загрузки объекта в стандартное хранилище.<br/>- `COLD`, `STANDARD_IA` и `NEARLINE` для загрузки объекта в холодное хранилище.<br/><br/>Если заголовок не указан, то объект сохраняется в хранилище, установленном в настройках бакета.
`x-amz-meta-*` | Пользовательские метаданные объекта.<br/><br/>Все заголовки, начинающиеся с `x-amz-meta-` {{ objstorage-name }} воспринимает как пользовательские, не обрабатывает их и сохраняет в том виде, в котором они переданы.<br/><br/>Общий размер пользовательских заголовков не должен превышать 2KB. Размер пользовательских данных определяется как длина строки в кодировке UTF-8. В размере учитываются и названия заголовков и их значения.<br/><br/>Если `x-amz-metadata-directive: COPY`, то эти заголовки игнорируются.


## Ответ {#response}

### Заголовки {#response-headers}

Ответ может содержать [общие заголовки](../common-response-headers.md), а также заголовки, перечисленные в таблице ниже.

Заголовок | Описание
----- | -----
`x-amz-storage-class` | Класс хранения объекта.<br/><br/>Может иметь значения:<br/>- `STANDARD` для объекта, сохраненного в Стандартном хранилище.<br/>- `COLD` для объекта, сохраненного в Холодном хранилище.

### Коды ответов {#response-codes}

Перечень возможных ответов смотрите в разделе [{#T}](../response-codes.md).

### Схема данных {#response-scheme}

```
<CopyObjectResult>
   <LastModified>2019-02-15T14:32:00</LastModified>
   <ETag>"9bgh7535f2734ec974343yuc93985328"</ETag>
</CopyObjectResult>
```

Элемент | Описание
----- | -----
`CopyObjectResult` | Содержит элементы ответа.<br/><br/>Путь: `/CopyObjectResult`.
`ETag` | `ETag` результитрующего объекта. Поскольку при вычислении `ETag` не учитываются метаданные, то `ETag` исходного и результирующего объекта должны быть равны.<br/><br/>Путь: `/CopyObjectResult/ETag`.
`LastModified` | Дата последнего изменения объекта.<br/><br/>Путь: `/CopyObjectResult/LastModified`.
