# Метод copy

Создает копию объекта, хранящегося в {{ objstorage-name }}. Объекты, размером до 5 ГБ можно скопировать одной операцией `copy`, если объект больше, чем 5 ГБ, то необходимо применять операцию [copyPart](../multipart/copypart.md).

Чтобы указать источник для копирования, используйте заголовок `X-Amz-Copy-Source`. Запрос на копирование не должен передавать каких-либо данных, кроме заголовков.

{% note info %}

{{ objstorage-name }} не блокирует объект на запись и может одновременно принять несколько запросов, копирующих объекты в один и тот же результирующий объект. После завершения всех запросов результирующим объектом окажется тот, чья операция копирования запустилась последней.

{% endnote %}

Метаданные объекта копируются вместе с объектом. При необходимости их можно изменить, задав в явном виде соответствующие заголовки.

Также с помощью заголовков можно:

- Изменить класс хранилища объекта.
- Добавить условия для копирования объекта.

Пользователь должен иметь разрешение на чтение исходного объекта и разрешение на запись в результирующий бакет.

## Запрос {#request}

```
PUT /{bucket}/{key} HTTP/2
```

### Path параметры {#path-parameters}

Параметр | Описание
----- | -----
`bucket` | Имя результирующего бакета.
`key` | Ключ результирующего объекта. Идентификатор, под которым объект сохраняется в {{ objstorage-name }}.


### Заголовки {#request-headers}

Обязательные заголовки перечислены в таблице ниже.

Заголовок | Описание
----- | -----
`X-Amz-Copy-Source` | Имя бакета и ключ объекта, который будет копироваться, разделенные символом `/`.<br/><br/>Например, `X-Amz-Copy-Source: /source_bucket/sourceObject`.<br/><br/>Если в бакете включено [версионирование](../../../../storage/concepts/versioning.md), то вы можете скопировать определенную версию объекта. Для этого укажите в заголовке идентификатор версии объекта — добавьте `?versionId=<version-id>` к значению заголовка, например: `/mybucket/image.png?versionId=0005E4A66AD990A4`. Если не указывать идентификатор версии, то будет скопирована последняя версия объекта.

Также используйте необходимые [общие заголовки](../common-request-headers.md).

Заголовки, описанные в таблице ниже используйте, если вам необходимо изменить поведение метода `copy` по умолчанию.

Заголовок | Описание
----- | -----
`X-Amz-Metadata-Directive` | Режим копирования метаданных.<br/><br/>Если значение заголовка `COPY`, то метаданные объекта копируются, а все заголовки `X-Amz-Meta-*` игнорируются. Это поведение метода `copy` по умолчанию.<br/><br/>Если значение заголовка `REPLACE`, то метаданные объекта подменяются указанными в запросе.<br/><br/>Заголовок `X-Amz-Storage-Class` не копируется, добавьте его в запрос, если это необходимо.
`X-Amz-Copy-Source-If-Match` | Условие для копирования объекта.<br/><br/>Если `ETag` объекта равен заданному в заголовке, то объект копируется.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `X-Amz-Copy-Source-If-Unmodified-Since`.
`X-Amz-Copy-Source-If-None-Match` | Условие для копирования объекта.<br/><br/>Если `ETag` объекта не равен заданному в заголовке, то объект копируется.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `X-Amz-Copy-Source-If-Modified-Since`.
`X-Amz-Copy-Source-If-Unmodified-Since` | Условие для копирования объекта.<br/><br/>Объект копируется, если он не изменялся с указанного времени.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `X-Amz-Copy-Source-If-Match`.
`X-Amz-Copy-Source-If-Modified-Since` | Условие для копирования объекта.<br/><br/>Объект копируется, если он изменился с указанного времени.<br/><br/>Если условие не выполнено, то {{ objstorage-name }} вернет ошибку 412.<br/><br/>Можно использовать вместе с заголовком `X-Amz-Copy-Source-If-None-Match`.
`X-Amz-Server-Side-Encryption` | Алгоритм шифрования, используемый по умолчанию для шифрования новых объектов.
`X-Amz-Server-Side-Encryption-Aws-Kms-Key-Id` | Идентификатор [ключа {{ kms-short-name }}](../../../../kms/concepts/key.md), используемый по умолчанию для шифрования новых объектов.
`X-Amz-Storage-Class` | [Класс хранилища](../../../concepts/storage-class.md) объекта.<br/><br/>Может иметь любое из значений:<ul><li>`STANDARD` — стандартное хранилище.</li><li>`COLD`, `STANDARD_IA` или `NEARLINE` — холодное хранилище.</li><li>`ICE` или `GLACIER` — ледяное хранилище.</li></ul>Если заголовок не указан, то объект сохраняется в хранилище, установленном в настройках бакета.
`X-Amz-Meta-*` | Пользовательские метаданные объекта.<br/><br/>Все заголовки, начинающиеся с `X-Amz-Meta-`, {{ objstorage-name }} преобразует по правилу: `X-Amz-Meta-foo-bar_baz` → `X-Amz-Meta-Foo-Bar_baz`.<br/><br/>Общий размер пользовательских заголовков не должен превышать 2KB. Размер пользовательских данных определяется как длина строки в кодировке UTF-8. В размере учитываются и названия заголовков и их значения.<br/><br/>Если `X-Amz-Metadata-Directive: COPY`, то эти заголовки игнорируются.


## Ответ {#response}

### Заголовки {#response-headers}

Ответ может содержать [общие заголовки](../common-response-headers.md), а также заголовки, перечисленные в таблице ниже.

Заголовок | Описание
----- | -----
`X-Amz-Storage-Class` | [Класс хранилища](../../../concepts/storage-class.md) объекта.<br/><br/>Может иметь значения:<ul><li>`STANDARD` — стандартное хранилище.</li><li>`COLD` — холодное хранилище.</li><li>`ICE` — ледяное хранилище.</li></ul>

### Коды ответов {#response-codes}

Перечень возможных ответов смотрите в разделе [{#T}](../response-codes.md).

### Схема данных {#response-scheme}

```
<CopyObjectResult>
   <LastModified>2019-02-15T14:32:00</LastModified>
   <ETag>"9bgh7535f2734ec974343yuc93985328"</ETag>
</CopyObjectResult>
```

Элемент | Описание
----- | -----
`CopyObjectResult` | Содержит элементы ответа.<br/><br/>Путь: `/CopyObjectResult`.
`ETag` | `ETag` результитрующего объекта. Поскольку при вычислении `ETag` не учитываются метаданные, то `ETag` исходного и результирующего объекта должны быть равны.<br/><br/>Путь: `/CopyObjectResult/ETag`.
`LastModified` | Дата последнего изменения объекта.<br/><br/>Путь: `/CopyObjectResult/LastModified`.
