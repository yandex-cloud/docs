# GeeseFS

[GeeseFS](https://github.com/yandex-cloud/geesefs) — программа для монтирования бакетов {{ objstorage-name }} через [FUSE](https://ru.wikipedia.org/wiki/FUSE_(модуль_ядра)) в системах Linux, macOS и Windows. Разработана командой {{ yandex-cloud }} как ответвление от [goofys](goofys.md). Она обеспечивает высокую производительность и POSIX-совместимость.

## Функциональность {#features}

### Производительность {#performance}

По сравнению с goofys и [s3fs](s3fs.md) GeeseFS работает с большими количествами малых файлов (размером до 1 МБ) на порядки быстрее, а с большими файлами — на аналогичной скорости или быстрее. Подробнее о тестах производительности см. в [репозитории GeeseFS на GitHub](https://github.com/yandex-cloud/geesefs/tree/master/bench).

Чтобы GeeseFS работала быстрее, в ней реализованы:

* Параллельное опережающее чтение (parallel readahead).
* Эвристическое опережающее чтение при случайном доступе: если размер нескольких запрошенных подряд блоков ниже порога, для следующих запросов GeeseFS будет скачивать из хранилища меньшие блоки.
* Параллельная [составная загрузка](../concepts/multipart.md) объектов в хранилище (parallel multipart upload).
* Оптимизированное изменение объектов: клиент и хранилище обмениваются только измененными частями объекта.
* Фоновая загрузка малых деревьев объектов и [папок](../concepts/object.md#folder): при запросе папки GeeseFS скачает все дерево за одно обращение к хранилищу.
* Асинхронная запись, переименование и удаление объектов.
* Использование дискового кеша для чтения и записи.

### POSIX-совместимость {#posix-compatibility}

Помимо базовых функций из стандартов POSIX (`open`, `read`, `write`, `close` и т. д.), GeeseFS поддерживает следующие возможности:

* Корректное чтение объектов сразу после записи в них (read-after-write consistency).
* Частичная запись (обратите внимание: в [версионируемых](../concepts/versioning.md) бакетах при частичной записи могут появляться промежуточные версии объекта).
* `fsync` — синхронизация содержимого объекта или папки между памятью машины и хранилищем.
* `truncate` — произвольное изменение размера объекта.
* Символические (мягкие) ссылки.
* `xattr` — расширенные атрибуты файлов.
* Переименование папок.
* `readdir` — чтение метаинформации о папках.

### Частичное изменение и дозапись объектов {#patch}

В GeeseFS поддерживается [частичное изменение и дозапись объектов](../concepts/object-patch.md) в бакеты {{ objstorage-name }}.

Чтобы включить частичное изменение объектов, используйте опцию `--enable-patch`.

Подробнее в репозитории GeeseFS на GitHub:
* [Partial object updates](https://github.com/yandex-cloud/geesefs#partial-object-updates-patch) — описание частичного изменения и дозаписи объектов.
* [Concurrent Updates](https://github.com/yandex-cloud/geesefs#concurrent-patch) — описание частичного изменения объекта одновременно несколькими запросами.

### Ограничения {#restrictions}

В GeeseFS не поддерживаются:

* Работа с правами доступа к файлам и папкам, в том числе команды `chmod` и `chown`. 

  При монтировании файловой системы вы можете указать:

  * Права доступа ко всем файлам или папкам в значениях опций `--file-mode` и `--dir-mode` соответственно.
  * Идентификатор пользователя — владельца всех файлов и папок в значении опции `--uid`.
  * Идентификатор группы, к которой относятся все файлы и папки, в значении опции `--gid`.

  Например:

  ```bash
  geesefs \
    --file-mode=0666 \
    --dir-mode=0777 \
    --uid=1000 \
    <имя_бакета> <точка_монтирования>
  ```

* Жесткие ссылки.
* Блокировка файлов.
* Корректное время последнего доступа к файлу (`atime`) и последнего изменения атрибутов файла (`ctime`). В обоих полях всегда содержится время последнего изменения файла — то же, что и в поле `mtime`.
* Создание файлов размером больше 1 ТБ.

## Подготовка к работе {#before-you-begin}

{% include [aws-tools-prepare](../../_includes/aws-tools/aws-tools-prepare.md) %}

{% include [access-bucket-sa](../../_includes/storage/access-bucket-sa.md) %}

## Установка {#installation}

{% include [geesefs-installation](../../_includes/storage/geesefs-installation.md) %}

## Аутентификация {#authentication}


GeeseFS использует статический ключ доступа к {{ objstorage-name }}, [полученный ранее](#before-you-begin). Он задается несколькими способами:

{% include [geesefs-authentication](../../_includes/storage/geesefs-authentication.md) %}

## Монтирование бакета {#bucket-mounting}

Выберите каталог или диск для монтирования бакета. Убедитесь, что у вас достаточно прав для этой операции.

При монтировании бакета также можно задать настройки GeeseFS связанные с [производительностью](#performance) и правами доступа к объектам. Чтобы посмотреть список опций и их описания, выполните команду `geesefs --help`.

{% include [geesefs-bucket-mounting](../../_includes/storage/geesefs-bucket-mounting.md) %}
