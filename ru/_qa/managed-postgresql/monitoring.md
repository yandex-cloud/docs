# Мониторинг и логи в {{ mpg-name }}

#### Где я могу отслеживать использование дискового пространства, чтобы не превысить лимит в 95% для перехода в read-only? {#disk-space}

Отслеживать использование дискового пространства можно:
* в консоли управления с помощью инструментов [мониторинга состояния кластера](../../managed-postgresql/operations/monitoring.md#monitoring-cluster);
* в сервисе [{{ monitoring-full-name }}]({{ link-monitoring }}) с возможностью [настроить алерты](../../managed-postgresql/operations/monitoring.md#monitoring-integration) по заданным метрикам.

#### Логи хранятся на том же диске, что и данные {{ PG }}? Как они тарифицируются? {#logs-storage}

Логи хранятся отдельно от диска с данными и ротируются автоматически. Посмотреть информацию о логах можно командой [CLI](../../cli/):

```
yc managed-postgresql cluster list-logs <идентификатор кластера>
```

Использование хранилища с логами кластера не тарифицируется.

{% include [log-duration](../../_includes/mdb/log-duration-qa.md) %}

#### Что такое WAL и для чего они нужны? {#wal}

[Журналы Write-Ahead Log](https://postgrespro.ru/docs/postgresql/12/wal-intro) нужны для записи данных на диск и их репликации. Они создаются при запросах на запись и занимают место на диске до момента полной записи информации с журналов на диски хостов — это обеспечивает отказоустойчивость и надежность СУБД.

Подробнее о принципах работы {{ PG }} см. в [официальной документации](https://postgrespro.ru/docs/postgresql/12).

#### Что означает параметр Cached в мониторинге RAM хоста кластера {{ PG }}? {#cached}

В Cached помещаются кешированные данные. Большинство операций выполняется на уровне оперативной памяти, так как вся информация базы данных хранится именно там. Кеширование происходит не только для баз данных, но и для диска — из-за этого объём кешированных данных может превышать размер хранилища.

В случае увеличения потребления оперативной памяти приложениями часть памяти с кешем может высвобождаться.

Подробнее о кешировании данных дисков в Linux см. в [документации](https://www.linuxatemyram.com/).


#### Как получать алерты о критических показателях кластера {{ PG }}? {#notifications}

Воспользуйтесь сервисом [{{ monitoring-full-name }}]({{ link-monitoring }}) и [настройте алерты](../../managed-postgresql/operations/monitoring.md#monitoring-integration) по критичным для вас параметрам.


#### Как настроить алерт, который срабатывает при заполнении определенного процента дискового пространства? {#disk-space-percentage}

[Создайте алерт](../../managed-postgresql/operations/monitoring.md#monitoring-integration) с метрикой `disk.used_bytes` в сервисе {{ monitoring-full-name }}. Метрика показывает размер использованного дискового пространства в кластере {{ mpg-name }}.

Для `disk.used_bytes` используются пороги для оповещения. Их рекомендуемые значения:

* `Alarm` — 90% дискового пространства.
* `Warning` — 80% дискового пространства.

Значения порогов задаются только в байтах. Например, рекомендуемые значения для диска размером в 100 ГБ:

* `Alarm` — `96636764160` байтов (90%).
* `Warning` — `85899345920` байтов (80%).
