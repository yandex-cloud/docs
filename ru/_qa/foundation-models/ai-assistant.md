# AI-ассистент

## Общие вопросы о работе AI-ассистентов {#general}

#### Как правильно сформулировать инструкцию для AI-ассистента? {#assistant-instruction}

При создании ассистента в поле `instruction` максимально подробно и естественным языком напишите, что требуется от ассистента. Например:

```
Ты — сотрудник технической поддержки. Твоя задача — отвечать на вопросы по теме. 
Если ответ не содержится в контексте, то не придумывай. 
Отвечай строго по переданному контексту. 
Ответы должны быть короткими, но информативными.
```

#### Ожидает ли ассистент завершения ответа модели перед переходом к следующему событию? {#does-assistant-wait-for-models-response}

Да. Один запуск ассистента — одно обращение к модели. Модель получает [промт](../../foundation-models/concepts/index.md#prompt), вызывает инструменты, дожидается результата и делает генерацию.

#### Можно ли отменить запрос и прервать ответ модели? {#cancel-request}

Нет, отменить отправленный запрос нельзя. Если вы хотите ограничить длину ответа модели, используйте параметр `maxTokens`.

#### Можно ли параллельно отправлять несколько запросов к одному треду от разных ассистентов? {#send-multiple-requests-to-same-thread}

Да, ограничений на одновременное использование нет.

#### Как избежать переноса контекста из предыдущего запроса? {#avoid-context-transfer}

Вы можете указать количество сообщений из треда, которые передаются в модель при каждом новом запросе, с помощью параметра `thread_num_messages`. Он позволяет контролировать объем контекста, учитываемого при генерации ответа. При этом учитываются сообщения от пользователя и от модели.

Также вы можете для каждого запроса создавать новый тред и удалять старый.

#### Может ли ассистент обнаружить в текстовых файлах изображение? {#detect-image-in-text-files}

Мы планируем добавить поддержку работы с изображениями.

#### Имеются ли в {{ ai-studio-name }} инструменты мониторинга и оценки качества? {#monitoring-tool}

Мы работаем над развитием {{ ai-studio-name }} и планируем добавить инструменты для мониторинга и оценки качества.

#### Какие языки поддерживает AI-ассистент? {#languages}

Основные языки {{ gpt-pro }} — русский и английский. В ближайшее время у нас появятся новые опенсорс-модели большого размера, которые будут хорошо работать с другими языками.

#### В чем отличия между версиями RC и Latest? {#difference-between-rc-and-latest}

Мы постоянно работаем над качеством ответом и функциональностью наших моделей. Когда внутренние метрики показывают, что новая версия модели готова, мы публикуем изменения для тестирования в ветку RC и сообщаем об этом в [истории изменений](../../foundation-models/release-notes/index.md) сервиса. 

Подробнее о жизненном цикле модели см. в разделе [{#T}](../../foundation-models/concepts/generation/models.md#model-lifecycle).


## Токены и тарификация {#tokens-and-billing}

#### На что расходуются токены при работе с AI-ассистентом? {#tokens-spend}

Как и при работе с моделями генерации, тарифицируются [токены](../../foundation-models/concepts/generation/tokens.md) текста запроса и ответа модели. Кроме того, учитывается также контекст из базы знаний и история переписки. Вы можете использовать параметр `maxTokens`, чтобы ограничить количество токенов в ответе модели.

#### Как предварительно оценить количество токенов в текстовых файлах? {#pre-estimate-number-of-tokens}

Оценить размер текста в токенах можно с помощью токенизатора. Подробнее см. в разделе [{#T}](../../foundation-models/operations/generation/evaluate-request.md).

#### Тарифицируется ли ответ модели, на который сработал встроенный фильтр этики? {#is-triggered-response-charged}

Нет, не тарифицируется.

#### Тарифицируются ли создание поисковых индексов, загрузка файлов через Files API, хранение файлов и индексов? {#is-until-ttl-expires-charged}

{{ assistant-api }} находится на стадии [Preview](../../overview/concepts/launch-stages.md). Создание и хранение файлов, тредов и индексов не тарифицируется.

## Работа с индексами {#indexes}

#### Как реализовать базу знаний для работы с ассистентом? {#implement-knowledge-base}

Чтобы создать базу знаний для работы с AI-ассистентом:

* Используйте Markdown-файлы для оформления документации.
* Старайтесь, чтобы как можно больше информации было представлено в виде текста.
* Уберите из текста все сноски и комментарии, чтобы он был более лаконичным и понятным.
* Если в документах есть таблицы, переведите их в формат Markdown.
* Подбирайте размер блоков текста (чанков) так, чтобы в них помещались самые большие таблицы из ваших документов.

#### Как реализовать ассистента, который может искать по набору документов, генерировать ответ на их основе и предоставлять релевантные ссылки?{#assistant-which-can-search-through-set-of-articles}

Загрузите ваши документы в [поисковый индекс](../../foundation-models/concepts/assistant/search-index.md) ассистента. Тогда вместе с ответом ассистента будут возвращаться ссылки на документы, откуда была взята информация, и фрагменты текста, на которые опиралась модель.

Подробнее см. в разделе [{#T}](../../foundation-models/operations/assistant/create-with-searchindex.md).

#### Как добавить, изменить или удалить документы из индекса? {#add-update-delete-operations}

Добавить новый документ в индекс можно с помощью операции `append`.

Обновить документ можно только через перестроение всего индекса.


#### Как загружать файлы напрямую из объектного хранилища без скачивания файлов на локальную машину? {#download-files-directly-from-s3}

Вы можете написать скрипт, который будет брать данные из хранилища и подгружать их сразу в ассистента, используя метод `sdk.files.upload_bytes()`.

#### Какой метод использовать для загрузки файлов из оперативной памяти? {#method-to-use-when-download-files-from-ram}

Для такой задачи лучше использовать метод `sdk.files.upload_bytes()`.

#### Что произойдет при удалении файла, используемого в индексе? {#auto-deletion}

После создания [поисковый индекс](../../foundation-models/concepts/assistant/search-index.md) не зависит от файла. При удалении файла AI-ассистент будет работать корректно, но возвращать ответ будет без ссылки на этот файл.

#### Можно ли настроить ассистента так, чтобы при отсутствии релевантной информации в индексе он не возвращал ссылок? {#set-assistant-to-not-provide-links-if-no-relevant-info}

На данный момент настроить ассистента таким образом нельзя.


#### Можно ли подключить несколько индексов к одному ассистенту? {#connect-set-of-indexes}

На данный момент к ассистенту можно подключить только один [поисковый индекс](../../foundation-models/concepts/assistant/search-index.md).

Вы можете обновлять ассистента и менять индекс или создать сразу двух ассистентов с двумя индексами.

#### Можно ли при обращении к ассистенту указать, в каком файле искать ответ? {#specify-search-for-answer}

Чтобы ассистент отвечал по какому-то конкретному файлу, создайте для него отдельный [поисковый индекс](../../foundation-models/concepts/assistant/search-index.md), а затем подключите его к ассистенту через обновление ассистента.

Также вы можете [создать](../../foundation-models/operations/assistant/create-with-searchindex.md) несколько ассистентов с разными индексами.

## Работа функций и взаимодействие с инструментами {#functions-and-tools}

#### Умеет ли модель работать с цепочкой инструментов? {#can-model-work-with-tool-chain}

Для работы с цепочкой инструментов понадобится обертка, например [LangGraph](https://www.langchain.com/langgraph). Сценарий работы с цепочкой инструментов с использованием LangGraph см. в [репозитории](https://github.com/yandex-datasphere/advanced-assistant/blob/main/langgraph-agent.ipynb).

#### Как повысить качество вызова функций? {#improve-function-calls-quality}

Чтобы повысить качество вызова функций:

* Добавьте примеры использования в описание функций. 
* Пропишите в ассистенте, в каких случаях нужно вызывать каждую функцию. 
* Расширьте описания параметров, указав типичные значения. 

#### Как управлять выбором функций и условиями их вызова на уровне ассистента? {#manage-function-selection}

Реализуйте fallback-логику, если функция не выбрана явно, но в сообщении есть ключевые слова. Подключите внешний анализатор намерений, если нужно повысить качество распознавания.