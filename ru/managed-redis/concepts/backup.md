---
title: Резервные копии Redis
description: {{ mrd-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных Redis. Резервная копия всех данных кластера (снимок в формате RDB) автоматически создается раз в день. Время начала резервного копирования задается при создании или изменении кластера Redis.
keywords:
  - бекап
  - backup
  - резервное копирование
  - резервное копирование Redis
  - backup Redis
  - Redis
---

# Резервные копии

{{ mrd-short-name }} обеспечивает автоматическое и ручное резервное копирование баз данных. Резервные копии занимают место в объеме хранилища, выделенном для кластера. Если суммарный объем данных и резервных копий превышает объем хранилища, превышение [тарифицируется](../pricing.md).

## Настройки резервного копирования {{ mrd-short-name }} {#backup-settings}

{{ mrd-short-name }} использует AOF (Append Only File) с форсированной записью на диск каждую секунду — выставлен параметр [appendfsync everysec](http://download.redis.io/redis-stable/redis.conf).

Резервная копия всех данных кластера (снимок в формате RDB) автоматически создается раз в день. Отключить автоматическое создание резервной копии невозможно, и изменить промежуток хранения автоматических копий (по умолчанию 7 дней) пока тоже нельзя.

Время начала резервного копирования задается при создании или изменении кластера. Резервное копирование начнется в течение получаса от указанного времени. По умолчанию начало резервного копирования устанавливается на 22:00 UTC (Coordinated Universal Time).

Резервные копии в {{ mrd-name }} создаются на основе консистентного снимка образа памяти процесса, который получается копированием с помощью системного вызова `fork()` исходного процесса  {{ RD }}. Из-за особенностей реализации `fork()` в Linux, запись данных на хост кластера {{ mrd-name }} в момент резервного копирования приведет к увеличению потребления памяти, т.к. к общему объему памяти процесса будут добавляться новые, измененные данные (механизм [**Copy-on-Write**](https://en.wikipedia.org/wiki/Copy-on-write)).

{% note alert %}

Это может привести к исчерпанию памяти хостов {{ mrd-name }}: хосты будут перезагружены и процесс резервного копирования будет прерван.  Рекомендуется [выбирать](../operations/update.md#change-additional-settings) такое время начала резервного копирования, чтобы кластер был наименее нагружен, или нарастить оперативную память, [увеличив класс хостов](../operations/update.md#change-resource-preset).

{% endnote %}

## Создание резервной копии {#size}

Резервные копии могут быть автоматическими и ручными, но вне зависимости от типа, резервные копии создаются по следующей схеме:
* Первая и каждая седьмая резервные копии — полные резервные копии всех баз данных.
* Остальные резервные копии — инкрементные, хранится только разница с предыдущей резервной копией, что позволяет экономить хранилище.

После создания резервная копия сжимается для дальнейшего хранения. На текущий момент отображение точного размера резервной копии недоступно.

## Хранение резервной копии {#storage}

Резервные копии хранятся во внутреннем хранилище Яндекса в виде логических дампов и шифруются с помощью [GPG](https://ru.wikipedia.org/wiki/GnuPG). У каждого кластера свои ключи шифрования.

Все резервные копии (автоматические и ручные) хранятся 7 дней.

## Проверка резервной копии {#verify}

### Проверка целостности резервной копии {#integrity}

Целостность резервных копий проверяется на синтетических данных интеграционными тестами сервиса. Резервные копии пользовательских кластеров на текущий момент не проверяются.

### Проверка восстановления из резервной копии {#capabilities}

Для проверки возможностей резервного копирования [восстановите кластер из резервной копии](../operations/cluster-backups.md) и проверьте целостность ваших данных.