---
title: Как подключиться к нешардированному кластеру {{ VLK }} в {{ mrd-full-name }}
description: Следуя данной инструкции, вы сможете подключиться к нешардированному кластеру {{ VLK }}.
---

# Подключение к нешардированному кластеру {{ VLK }}

К нешардированному кластеру {{ VLK }} можно подключиться:

* С помощью {{ VLK }} Sentinel.

    {{ VLK }} Sentinel — это система управления хостами {{ VLK }}, позволяющая проводить мониторинг, отправлять уведомления о состояниях хостов, [переключать мастер](../failover.md) и передавать клиентам актуальные адреса хостов.

    Поддерживается нешифрованное соединение через порт `{{ port-mrd-sentinel }}` для кластеров с любой версией {{ VLK }}.

    Если клиентское приложение не поддерживает подключение через Sentinel, подключитесь напрямую к мастеру. Если в прямом подключении нет необходимости, используйте Sentinel для более надежной работы с хостами кластера.

    Подробнее о Sentinel см. в разделе [{#T}](../../concepts/replication.md) и [документации {{ VLK }}](https://valkey.io/topics/sentinel).

* Напрямую к мастеру.

    Поддерживаются шифрованное соединение через порт `{{ port-mrd-tls }}` и нешифрованное через порт `{{ port-mrd }}`.

    {% include [How to use TLS](../../../_includes/mdb/mrd/connect/how-to-use-tls.md) %}

    Чтобы всегда подключаться к мастеру в нешардированном кластере, воспользуйтесь [особым FQDN](#special-fqdns), который всегда указывает на мастер, либо отслеживайте роли всех хостов кластера самостоятельно.

## Особый FQDN {#special-fqdns}

{{ mrd-name }} предоставляет особый FQDN, который можно использовать вместо [обычных FQDN хостов](index.md#fqdn) для подключения к нешардированному кластеру.

FQDN вида `c-<идентификатор_кластера>.rw.{{ dns-zone }}` в нешардированном кластере всегда указывает на текущий хост-мастер. Идентификатор кластера можно запросить со [списком кластеров в каталоге](../cluster-list.md#list-clusters). При подключении к этому FQDN разрешено выполнять операции чтения и записи.

В кластерах из нескольких хостов особый FQDN может некоторое время (до 10 минут) указывать на хост-реплику. Это связано с тем, что на обновление DNS-записей для особых FQDN требуется время. Если запрос на запись завершился ошибкой, повторите его позднее.

{% note warning %}

Если при [автоматической смене мастера](../../concepts/replication.md#master-failover) новым мастером станет хост без публичного доступа, подключиться к нему из интернета будет невозможно. Чтобы этого избежать, [включите публичный доступ](../hosts.md#update) для всех хостов кластера.

{% endnote %}

Пример подключения с SSL-шифрованием к хосту-мастеру для кластера с идентификатором `c9qash3nb1v9********`:

```bash
redis-cli -h c-c9qash3nb1v9********.rw.{{ dns-zone }} \
  -p 6380 \
  --tls \
  --cacert ~/.redis/{{ crt-local-file }} \
  -a <пароль_{{ VLK }}>
```

{% include [special-fqdns-warning](../../../_includes/mdb/special-fqdns-warning.md) %}

## Подключение из графических IDE {#connection-ide}

{% include [IDE environment settings](../../../_includes/mdb/mrd/ide-envs.md) %}

Подключаться из графических IDE к хостам кластера можно только через [SSH-туннель](../../../glossary/ssh-keygen.md) с помощью [созданной ВМ](./index.md#connect). Перед подключением [подготовьте сертификат](./index.md#get-ssl-cert).

{% include [note-connection-ide](../../../_includes/mdb/note-connection-ide.md) %}

{% list tabs group=ide %}

- DBeaver {#dbeaver}

    Поддержка подключения к кластеру {{ VLK }} доступна только в [коммерческих редакциях DBeaver](https://dbeaver.com/buy/).

    Чтобы подключиться к кластеру:

    1. Создайте новое соединение с БД:
        1. Выберите в меню **База данных** пункт **Новое соединение**.
        1. Выберите из списка БД **{{ VLK }}**.
        1. Нажмите кнопку **Далее**.
        1. Укажите параметры подключения на вкладке **Главное**:
            * **Хост** — [FQDN хоста-мастера](./index.md#fqdn) или [особый FQDN](./non-sharded.md#special-fqdns), всегда указывающий на текущий хост-мастер.
            * **Порт** — `{{ port-mrd }}` для обычного кластера или `{{ port-mrd-tls }}` для кластера с включенным SSL-шифрованием.
            * В блоке **Аутентификация** укажите пароль от кластера.
        1. На вкладке **SSH**:
            1. Включите настройку **Использовать туннель SSH**.
            1. Укажите параметры SSH-туннеля:
                * **Хост/IP** — публичный IP-адрес [ВМ для подключения](./index.md#connect);
                * **Имя пользователя** — логин для подключения к ВМ;
                * **Метод аутентификации** — `Публичный ключ`;
                * **Секретный ключ** — путь к файлу закрытого ключа для подключения к ВМ;
                * **Passphrase** — пароль от закрытого ключа.
        1. На вкладке **SSL**:
            1. Включите настройки **Использовать SSL** и **Пропустить валидацию имени хоста**.
            1. В блоке **Параметры**:
                1. Выберите **Способ** — **Набор сертификатов**.
                1. В поле **Корневой сертификат** укажите путь к сохраненному файлу [SSL-сертификата](./index.md#get-ssl-cert).
    1. Нажмите кнопку **Тест соединения ...** для проверки соединения с БД. При успешном подключении будет выведен статус подключения, информация о СУБД и драйвере.
    1. Нажмите кнопку **Готово**, чтобы сохранить настройки соединения с БД.

{% endlist %}

{% include [How to connect from a Dockerfile](../../../_includes/mdb/mrd/connect/docker-and-redis.md) %}

## Примеры строк подключения {#connection-string}

{% include [Environment settings](../../../_includes/mdb/mdb-conn-strings-env.md) %}

{% include [How to see FQDN](../../../_includes/mdb/see-fqdn-in-console.md) %}

{% include [Connection strings for non-sharded cluster](../../../_includes/mdb/mrd/conn-strings-non-sharded.md) %}
