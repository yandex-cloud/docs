# Обновление версии {{ RD }}

Вы можете обновить кластер {{ mrd-name }} до любой поддерживаемой версии.

Обновление доступно только на следующую версию относительно текущей, например, с версии 5.0 на 6.0. Обновление до более поздних версий производится поэтапно. Например, обновление версии {{ RD }} с 5.0 до 6.2 выполняется в такой последовательности: 5.0 → 6.0 → 6.2.

## Перед обновлением {#before-update}

Перед обновлением кластера убедитесь, что это не нарушит работу ваших приложений:

1. Посмотрите [историю изменений](https://docs.redis.com/latest/rs/release-notes/) для версий {{ RD }}, до которых вы собираетесь обновить кластер, и проверьте, не повлияют ли какие-то изменения на работу приложений.
1. Попробуйте обновить тестовый кластер (его можно [развернуть](cluster-backups.md#restore), например, из резервной копии основного кластера).
1. [Выполните резервное копирование](cluster-backups.md#create-backup) основного кластера непосредственно перед обновлением.

## Обновить кластер {#start-update}

{% note alert %}

* После обновления СУБД до выбранной версии вернуть кластер к предыдущей версии невозможно.
* Успешность обновления версии {{ RD }} зависит от многих факторов, в том числе от настроек кластера и данных, хранящихся в базах. Рекомендуется сначала [обновить тестовый кластер](#before-update), который использует те же данные и настройки.

{% endnote %}

{% list tabs %}

- Консоль управления

  1. В [консоли управления]({{ link-console-main }}) перейдите в каталог с кластером, который нужно обновить.
  1. Выберите сервис **{{ mrd-name }}**.
  1. Выберите нужный кластер в списке и нажмите кнопку **Изменить кластер**.
  1. В поле **Версия** выберите новую версию.
  1. Нажмите кнопку **Сохранить изменения**.

  После запуска обновления кластер переходит в статус **UPDATING**. Дождитесь окончания операции и проверьте версию кластера.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  1. Получите список ваших кластеров {{ RD }} командой:

     ```bash
     {{ yc-mdb-rd }} cluster list
     ```

  1. Получите информацию о нужном кластере и проверьте версию {{ RD }}, указанную в свойстве `config.version`:

     ```bash
     {{ yc-mdb-rd }} cluster get <идентификатор или имя кластера>
     ```

  1. Запустите обновление {{ RD }}:

     ```bash
     {{ yc-mdb-rd }} cluster update <идентификатор или имя кластера> \
       --redis-version <номер новой версии>
     ```

     После запуска обновления кластер переходит в статус **UPDATING**. Дождитесь окончания операции и проверьте версию кластера.

- API

  Воспользуйтесь методом API [update](../api-ref/Cluster/update.md) и передайте в запросе:

  * Идентификатор кластера в параметре `clusterId`. Его можно получить со [списком кластеров в каталоге](./cluster-list.md#list-clusters).
  * Номер версии {{ RD }} в параметре `configSpec.version`.
  * Список полей конфигурации кластера, подлежащих изменению, в параметре `updateMask`.

      {% include [updateMask note](../../_includes/mdb/note-api-updatemask.md) %}

{% endlist %}


## Примеры {#examples}

Допустим, нужно обновить кластер с версии 5.0 до версии 6.0.

{% list tabs %}

- CLI

   1. Чтобы получить список кластеров и узнать их имена и идентификаторы, выполните команду:

      ```bash
      {{ yc-mdb-rd }} cluster list
      ```
      
	  Результат:
	  
      ```text
      +----------------------+---------------+---------------------+--------+---------+
      |          ID          |     NAME      |     CREATED AT      | HEALTH | STATUS  |
      +----------------------+---------------+---------------------+--------+---------+
      | c9q8p8j2gaih8iti42mh |   redis406    | 2021-11-23 12:44:17 | ALIVE  | RUNNING |
      +----------------------+---------------+---------------------+--------+---------+
      ```

   1. Чтобы получить информацию о кластере с именем `redis406`, выполните команду:

      ```bash
      {{ yc-mdb-rd }} cluster get redis406
      ```

      Результат:

      ```text
      id: c9q8p8j2gaih8iti42mh
      ...
      config:
        version: "5.0"
        ...
      ```

   1. Для обновления кластера с именем `redis406` до версии 6.0, выполните команду:

      ```bash
      {{ yc-mdb-rd }} cluster update redis406 --redis-version 6.0
      ```

{% endlist %}
