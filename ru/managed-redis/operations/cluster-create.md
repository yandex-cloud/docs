# Создание {{ RD }}-кластера

{{ RD }}-кластер — это один или несколько хостов базы данных, между которыми можно настроить репликацию. Репликация работает по умолчанию в любом кластере из более чем 1 хоста: хост-мастер принимает запросы на запись, асинхронно дублируя изменения в репликах.

Количество хостов, которые можно создать вместе с {{ RD }}-кластером, зависит от выбранного типа хоста:

* В кластере с типом хостов **high-memory** можно создать неограниченное число хостов (от 1 до пределов текущей [квоты](../concepts/limits.md)).

* В кластере с типом хостов **burstable** можно создать только один хост.

## Как создать кластер {{ RD }} {#create-cluster}

{% list tabs %}

- Консоль управления
  
  1. В консоли управления выберите каталог, в котором нужно создать кластер БД.
  1. Выберите сервис **{{ mrd-name }}**.
  1. Нажмите кнопку **Создать кластер**.
  1. Введите имя кластера в поле **Имя кластера**. Имя кластера должно быть уникальным в Облаке.
  1. Выберите окружение, в котором нужно создать кластер (после создания кластера окружение изменить невозможно):
      - <q>production</q> — для стабильных версий ваших приложений.
      - <q>prestable</q> — для тестирования, в том числе самого сервиса {{ mrd-short-name }}. Prestable-окружение обновляется чаще, из-за чего в нем раньше исправляются уже известные проблемы, но могут происходить обратно несовместимые изменения.
  1. Выберите версию СУБД.
  1. Если требуется, включите [шардирование кластера](../concepts/sharding.md).

     {% note important %}

     Включить шардирование можно только при создании нового кластера. Шардировать уже созданный нешардированный кластер невозможно, как и отключить шардирование кластера, для которого оно включено.
    
     {% endnote %}

  1. В блоке **Класс хоста**:
      - Выберите тип хостов — он определяет уровень [производительности](../../compute/concepts/performance-levels) ядер процессора. Хосты типа **high-memory** работают с полным использованием ядра, а **burstable** — с частичным.
  
      - Выберите объем оперативной памяти для хоста.
  
      - Выберите размер диска.
  1. В блоке **Настройки кластера** в поле **Пароль** укажите пароль пользователя, от 8 до 128 символов.
  1. В блоке **Сеть** выберите сеть, к подсетям которой будут подключены хосты.
  1. В блоке **Хосты** нажмите на кнопку **Добавить хост** и выберите зону доступности и подсеть, к которой будет подключен хост. Создайте необходимое количество хостов. Для изменения зоны доступности и добавленного хоста нажмите на значок карандаша в строке хоста.

     Если вы включили шардирование, укажите названия шардов.
  1. Нажмите кнопку **Создать кластер**.
  
- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы создать кластер:
  
  {% if audience != "internal" %} 1. Проверьте, есть ли в каталоге подсети для хостов кластера:
  
     ```
     $ yc vpc subnet list
     ```
  
     Если ни одной подсети в каталоге нет, [создайте нужные подсети](../../vpc/operations/subnet-create.md) в сервисе {{ vpc-short-name }}. {% endif %}
  
  1. Посмотрите описание команды CLI для создания кластера:
  
      ```
      $ {{ yc-mdb-rd }} cluster create --help
      ```
  
  1. Посмотрите доступные классы хостов:
  
     ```
     $ {{ yc-mdb-rd }} resource-preset list
     ```
  
  1. Укажите параметры кластера в команде создания (в примере приведены не все флаги):
  
      ```bash
      $ {{ yc-mdb-rd }} cluster create \
         --name <имя кластера> \
         --environment <окружение, prestable или production> \
         --network-name <имя сети> \
         --host zone-id=<зона доступности>,subnet-id=<идентификатор подсети> \
         --resource-preset <класс хоста> \
         --disk-size <размер хранилища в гигабайтах> \
         --password=<пароль пользователя> \
         --backup-window-start <время начала резервного копирования в формате ЧЧ:ММ:СС>
      ```
  
      Идентификатор подсети `subnet-id` необходимо указывать, если в выбранной зоне доступности создано 2 и больше подсетей.
  
  
{% endlist %}


## Примеры

### Создание кластера с одним хостом

Чтобы создать кластер с одним хостом, следует передать один параметр `--host`.

Допустим, нужно создать {{ RD }}-кластер со следующими характеристиками:

- С именем `myredis`.
- В окружении `production`.
- В сети `default`.
- С одним хостом класса `b1.nano` в подсети `b0rcctk2rvtr8efcch64`, в зоне доступности `ru-central1-c`.
- С хранилищем объемом 20 ГБ.
- C паролем `user1user1`.

Запустите следующую команду:

```
$ {{ yc-mdb-rd }} cluster create \
     --name myredis \
     --environment production \
     --network-name default \
     --resource-preset b1.nano \
     --host zone-id=ru-central1-c,subnet-id=b0rcctk2rvtr8efcch64 \
     --disk-size 20 \
     --password=user1user1
```
