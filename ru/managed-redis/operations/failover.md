# Переключение мастера

В отказоустойчивом кластере {{ mrd-name }} из нескольких хостов вы можете переключить роль мастера с текущего хоста-мастера на хост-реплику. После этой операции текущий хост-мастер станет хостом-репликой для нового мастера.

Переключение в среднем занимает несколько минут, кластер в это время доступен.

[Шардированный кластер](../concepts/sharding.md) содержит три и более хоста-мастера — по одному на каждый [шард](../concepts/sharding.md#redis-cluster-structure). Переключение мастера для шардированного кластера осуществляется поочередно для каждого шарда.

{% list tabs %}

- Консоль управления

    * Чтобы переключить мастер в нешардированном кластере:

        1. Перейдите на страницу каталога и выберите сервис **{{ mrd-name }}**.
        1. Нажмите на имя нужного кластера, затем выберите вкладку **Хосты**.
        1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) напротив хоста с ролью `MASTER` и выберите опцию **Переключение мастера**.
        1. В открывшемся окне выберите опцию **Я хочу переключить мастер** и нажмите кнопку **Переключить**.

    * Чтобы переключить мастер в шардированном кластере:

        1. Перейдите на страницу каталога и выберите сервис **{{ mrd-name }}**.
        1. Нажмите на имя нужного кластера, затем выберите вкладку **Хосты**.
        1. Нажмите значок ![image](../../_assets/horizontal-ellipsis.svg) напротив хоста с ролью `MASTER` нужного вам шарда и выберите опцию **Переключение мастера**.
        1. В открывшемся окне нажмите кнопку **Переключить**.

- CLI

    {% include [cli-install](../../_includes/cli-install.md) %}

    {% include [default-catalogue](../../_includes/default-catalogue.md) %}

    * Чтобы переключить мастер в нешардированном кластере, выполните команду:

        ```bash
        {{ yc-mdb-rd }} cluster start-failover \
           --name <имя кластера>
        ```

    * Чтобы переключить мастер в шардированном кластере, выполните команду:

        ```bash
        {{ yc-mdb-rd }} cluster start-failover \
           --name <имя кластера> \
           --hostnames <имя текущего мастера>
        ```

    Имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md), имя мастера для нужного вам шарда — со [списком хостов в кластере](hosts.md#list).

- API

    Воспользуйтесь методом API [startFailover](../api-ref/Cluster/startFailover.md) и передайте в запросе:

    * Идентификатор кластера, в котором нужно переключить мастер, в параметре `clusterId`. Чтобы узнать идентификатор, получите [список кластеров в каталоге](cluster-list.md).
    * Только для шардированного кластера: имя текущего мастера нужного вам шарда в параметре `hostNames`. Чтобы узнать имя, получите [список хостов в кластере](hosts.md#list).

{% endlist %}
