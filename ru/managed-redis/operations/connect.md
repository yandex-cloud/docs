# Подключение к базе данных в кластере {{ RD }}

## Способы подключения {#connection-methods}

К базе данных {{ RD }} можно подключиться двумя способами: напрямую или с использованием Redis Sentinel. 

[Redis Sentinel](https://redis.io/topics/sentinel) — это система управления хостами {{ RD }} с возможностями мониторинга, отправки уведомлений о состояниях хостов, переключения мастера и передачи клиентам актуальных адресов хостов. 

Не все клиенты {{ RD }} поддерживают подключение через Sentinel. В этом случае вы можете подключиться к хосту напрямую. Обратите внимание, что при этом вам придется самостоятельно отслеживать роли всех хостов. Если в прямом подключении нет необходимости, используйте Sentinel для более надежной работы с хостами.

{% note info %}

При подключении к хосту через Sentinel используйте порт `26379`, а при подключении напрямую — `6379`. 

{% endnote %}

Хостам кластера Redis нельзя назначать публичные IP-адреса. Доступ к хостам возможен только из той же подсети, в которой находится хост.

## Подключение к базе данных {#connect-to-db}

В этом примере подключение к хосту {{ RD }} устанавливается с виртуальной машины, подключенной к той же подсети, что и хост.

1. [Создайте виртуальную машину](../../compute/operations/vm-create/create-linux-vm.md) с публичным IP-адресом в той же подсети, где находится хост Redis.

1. Подключитесь к созданной ВМ [через SSH](../../compute/operations/vm-connect/ssh.md).

   ```
   $ ssh <логин>@<публичный IP-адрес ВМ>
   ```

1. Установите инструменты Redis на ВМ с помощью пакетного менеджера:

   {% list tabs %}

   - Ubuntu
  
     ```
     $ sudo apt update
     $ sudo apt-get install redis
     ```
  
   - CentOS
  
     ```
     $ sudo yum update
     $ sudo yum install redis
     ```
  
   {% endlist %}

1. Установите сертификат для доступа к базе данных:

   ```
   $ sudo mkdir -p /usr/local/share/ca-certificates/Yandex
   $ sudo wget "https://storage.yandexcloud.net/cloud-certs/CA.pem" -O /usr/local/share/ca-certificates/Yandex/YandexInternalRootCA.crt
   ```

1. Создайте переменную, содержащую имя и порт хоста, а также имя мастера БД.

   ```
   $ host=$(redis-cli -h <адрес хоста> -p 26379 sentinel get-master-addr-by-name <имя кластера> | head -n 1)
   ```

1. Проверьте соединение с хостом:

   ```
   $ redis-cli -h $host -a <пароль БД> ping
   ```

   Если вернется ответ `PONG`, то соединение устанавливается успешно.

