# Подключение к базе данных в кластере {{ RD }}

## Способы подключения {#connection-methods}

К хосту базы данных {{ RD }} можно подключиться двумя способами: 
- Напрямую через порт `6379`.
- C использованием [{{ RD }} Sentinel](https://redis.io/topics/sentinel) через порт `26379`. Это система управления хостами {{ RD }} с возможностями мониторинга, отправки уведомлений о состояниях хостов, переключения мастера и передачи клиентам актуальных адресов хостов. 

Не все клиентские приложения {{ RD }} поддерживают подключение через Sentinel. В этом случае вы можете подключиться к хосту напрямую. Обратите внимание, что при этом вам придется самостоятельно отслеживать роли всех хостов. Если в прямом подключении нет необходимости, используйте Sentinel для более надежной работы с хостами кластера.

## Подключение к кластеру {#connect}

Хостам кластера {{ RD }} нельзя назначать публичные IP-адреса. Доступ к хостам возможен только из той же [виртуальной сети](../../vpc/concepts/network.md), в которой находится хост.

Чтобы подключиться к хосту кластера {{ RD }}:
1. [Создайте виртуальную машину](../../compute/operations/vm-create/create-linux-vm.md) с публичным IP-адресом в той же виртуальной сети, что и хост.
1. Подключитесь к созданной виртуальной машине через [через SSH](../../compute/operations/vm-connect/ssh.md) и из нее подключитесь к {{ RD }} с помощью одного из [примеров строк подключений](#connection-string).

## Настройка групп безопасности {#configuring-security-groups}

{% include [sg-rules](../../_includes/mdb/sg-rules-connect.md) %}

Настройки правил будут различаться в зависимости от выбранного способа подключения:

1. [Настройте все группы безопасности](../../vpc/operations/security-group-update.md#add-rule) кластера так, чтобы они разрешали входящий трафик из группы безопасности, в которой находится ВМ, на порт `6379` для подключения напрямую или `26379` при подключении с помощью Sentinel. Для этого в этих группах создайте следующее правило для входящего трафика:

    - протокол: `TCP`;
    - диапазон портов: `6379` (`26379` для Sentinel);
    - тип источника: `Группа безопасности`;
    - источник: группа безопасности, в которой находится ВМ. Если она совпадает с настраиваемой группой, то укажите **Текущая**.

1. [Настройте группу безопасности](../../vpc/operations/security-group-update.md#add-rule), в которой находится ВМ так, чтобы можно было подключаться к ВМ и был разрешен трафик между ВМ и хостами кластера.

    Пример правил для ВМ:

    - Для входящего трафика:
        - протокол: `TCP`;
        - диапазон портов: `22`;
        - тип источника: `CIDR`;
        - источник: `0.0.0.0/0`.

        Это правило позволяет подключаться к ВМ по протоколу SSH.

    - Для исходящего трафика:
        - протокол: `Any`;
        - диапазон портов: `0-65535`;
        - тип назначения: `CIDR`;
        - назначение: `0.0.0.0/0`.

        Это правило разрешает любой исходящий трафик, что позволяет не только подключаться к кластеру, но и устанавливать сертификаты и утилиты, необходимые для подключения к кластеру.

{% note info %}

Вы можете задать более детальные правила для групп безопасности, например, разрешающие трафик только в определенных подсетях.

Группы безопасности должны быть корректно настроены для всех подсетей, в которых будут размещены хосты кластера. При неполных или некорректных настройках групп безопасности можно потерять доступ к кластеру, если произойдет [ручная](failover.md) или [автоматическая](../concepts/replication.md) смена мастера.

{% endnote %}

Подробнее о группах безопасности см. в разделе [{#T}](../concepts/network.md#security-groups).

## Примеры строк подключения {#connection-string}

{% include [conn-strings-environment](../../_includes/mdb/mdb-conn-strings-env.md) %}

Приведены примеры строк как для подключения с Sentinel, так и для подключения напрямую.

{% include [see-fqdn-in-console](../../_includes/mdb/see-fqdn-in-console.md) %}

{% include [mrd-connection-strings](../../_includes/mdb/mrd-conn-strings.md) %}

При успешном подключении к кластеру и выполнении тестового запроса будет выведена строка `bar`.

