# Управление шардами кластера

{% if audience != "internal"%}
{% note info %}

Возможность использования Redis Cluster находится на [стадии Preview](../../overview/concepts/launch-stages.md). Обратитесь в [поддержку Яндекс.Облака](https://cloud.yandex.ru/support), если вам требуется получить доступ к возможностям шардирования.

{% endnote %}
{% endif %}

Вы можете добавлять и удалять шарды кластера, запрашивать список шардов  в выбранном кластере, а также выполнять ребалансировку кластера.

{% note important %}

Управлять шардами можно только в шардированном кластере. Шардировать существующий нешардированный кластер невозможно. Как создать шардированный кластер см. в разделе [Создание кластера](cluster-create.md#create-cluster).

{% endnote %}

## Получить список шардов в кластере {#list}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mrd-name }}**.

  2. Нажмите на имя нужного кластера, затем выберите вкладку **Шарды**.

- CLI

  {% include [cli-install](../../_includes/cli-install.md) %}

  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы получить список баз данных в кластере, выполните команду:
  
  ```
  $ yc managed-redis shards list --cluster-name <имя кластера>
  +--------------+
  |     NAME     |
  +--------------+
  | test-shard-1 |
  | test-shard-2 |
  | test-shard-3 |
  | test-shard-4 |
  | test-shard-5 |
  +--------------+
  ```

{% endlist %}

## Получить детальную информацию о шарде {#get}
  
{% include [cli-install](../../_includes/cli-install.md) %}

{% include [default-catalogue](../../_includes/default-catalogue.md) %}

Чтобы получить информацию о шарде, выполните команду:

```
$ {{ yc-mdb-rd }} shards get <имя шарда> --cluster-name <имя кластера>
```

Идентификатор и имя кластера можно запросить со [списком кластеров в каталоге](cluster-list.md).
  
## Добавить шард {#add}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mrd-name }}**.
  1. Нажмите на имя нужного кластера и перейдите на вкладку **Шарды**.
  1. Нажмите кнопку **Добавить шард**.

  1. Укажите параметры шарда:
      * имя шарда;
      * зоны доступности;
      * если требуется, добавьте дополнительные хосты в шард.
  1. Нажмите кнопку **Создать шард**.

  После добавления нового шарда необходимо выполнить [ребалансировку кластера](../concepts/sharding.md#scaling): 

  1. Дождитесь, когда кластер перейдет в статус `Running`.
  1. Откройте вкладку **Хосты** и нажмите кнопку **Ребалансировать кластер**. Нажмите кнопку **Ок**.

- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}
  
  Чтобы добавить шард c двумя хостами в кластер:

  ```
  $ yc managed-redis shards add --name <имя нового шарда> --cluster-name <имя кластера> \
    --host zone-id=<зона доступности>,subnet-name=<имя подсети> \
    --host zone-id=<зона доступности>,subnet-name=<имя подсети>
  ```

  После добавления нового шарда необходимо выполнить ребалансировку кластера: 

  ```
  $ yc managed-redis cluster --name test-sharding-2 rebalance 
  ```

{% endlist %}

## Удалить шард {#remove}

{% note alert %}

Вместе с шардом удаляются все находящиеся в нем хосты.

{% endnote %}

{% list tabs %}

- Консоль управления

  1. Перейдите на страницу каталога и выберите сервис **{{ mrd-name }}**.

  2. Нажмите на имя нужного кластера и выберите вкладку **Шарды**.

  3. Нажмите значок ![image](../../_assets/options.svg) в строке нужного шарда и в открывшемся меню нажмите кнопку **Удалить**.

  4. В открывшемся окне нажмите кнопку **Удалить**.

- CLI
  
  {% include [cli-install](../../_includes/cli-install.md) %}
  
  {% include [default-catalogue](../../_includes/default-catalogue.md) %}

  Чтобы удалить шард из кластера, выполните команду:

  ```
  $ {{ yc-mdb-rd }} shards delete <имя шарда>
       --cluster-name=<имя кластера>
  ```

  Имя шарда можно запросить со [списком шардов в кластере](#list), имя кластера — со [списком кластеров в каталоге](cluster-list.md).

{% endlist %}
