{% include [gpu-cluster-deepseek](../../_tutorials/infrastructure/gpu-cluster-deepseek.md) %}
# –ó–∞–ø—É—Å–∫ —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏ DeepSeek-R1 –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ GPU Yandex Compute Cloud

{% note info %}

–ö–ª–∞—Å—Ç–µ—Ä—ã GPU —Å–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ `ru-central1-a` –∏ `ru-central1-d`. –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (–í–ú) –≤ –∫–ª–∞—Å—Ç–µ—Ä GPU –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∏–∑ —Ç–æ–π –∂–µ –∑–æ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.

{% endnote %}

–° –ø–æ–º–æ—â—å—é —ç—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä GPU –∏–∑ –¥–≤—É—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ –Ω–µ–º —è–∑—ã–∫–æ–≤—É—é –º–æ–¥–µ–ª—å DeepSeek-R1.

–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —è–∑—ã–∫–æ–≤—É—é –º–æ–¥–µ–ª—å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:
1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –æ–±–ª–∞–∫–æ –∫ —Ä–∞–±–æ—Ç–µ.
2. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä GPU –∏–∑ –¥–≤—É—Ö –í–ú.
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞.
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —è–∑—ã–∫–æ–≤—É—é –º–æ–¥–µ–ª—å.
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –º–æ–¥–µ–ª–∏.
6. –ï—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤–∞–º –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã, —É–¥–∞–ª–∏—Ç–µ –∏—Ö.

## –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –æ–±–ª–∞–∫–æ –∫ —Ä–∞–±–æ—Ç–µ

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ Yandex Cloud –∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç:
   * –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [–∫–æ–Ω—Å–æ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è](https://console.cloud.yandex.ru) –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å.
   * –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ **Yandex Cloud Billing** —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –ø–æ–¥–∫–ª—é—á–µ–Ω –ø–ª–∞—Ç–µ–∂–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç, –∏ –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `ACTIVE` –∏–ª–∏ `TRIAL_ACTIVE`. –ï—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –∏ –ø—Ä–∏–≤—è–∂–∏—Ç–µ –∫ –æ–±–ª–∞–∫—É.
2. –í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞—à–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –æ–±–ª–∞–∫–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–≤–æ—Ç –Ω–∞ —Å—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ GPU, GPU –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Gen2, –æ–±—ä–µ–º RAM, vCPU –∏ –æ–±—ä–µ–º SSD-–¥–∏—Å–∫–æ–≤. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Yandex Cloud Quota Manager**.

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–ª–∞—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
–í —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Ö–æ–¥–∏—Ç –ø–ª–∞—Ç–∞ –∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –í–ú –∏ –¥–∏—Å–∫–∏ (—Å–º. [—Ç–∞—Ä–∏—Ñ—ã Yandex Compute Cloud](#)).

## –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä GPU –∏–∑ –¥–≤—É—Ö –í–ú

### 1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä GPU
1. –í –∫–æ–Ω—Å–æ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞.
2. –í —Å–ø–∏—Å–∫–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤—ã–±–µ—Ä–∏—Ç–µ **Compute Cloud**.
3. –ù–∞ –ø–∞–Ω–µ–ª–∏ —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **–ö–ª–∞—Å—Ç–µ—Ä—ã GPU**.
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä GPU**.
5. –í –ø–æ–ª–µ **–ò–º—è** —É–∫–∞–∂–∏—Ç–µ `test-gpu-cluster`.
6. –í –ø–æ–ª–µ **–ó–æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** –≤—ã–±–µ—Ä–∏—Ç–µ `ru-central1-d`.
7. –ù–∞–∂–º–∏—Ç–µ **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å**.

### 2. –î–æ–±–∞–≤—å—Ç–µ –í–ú –≤ –∫–ª–∞—Å—Ç–µ—Ä
–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É:
1. –ù–∞ –ø–∞–Ω–µ–ª–∏ —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã** –∏ –Ω–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É**.
2. –í –±–ª–æ–∫–µ **–û–±—Ä–∞–∑ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ –¥–∏—Å–∫–∞** –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –æ–±—Ä–∞–∑ `Ubuntu 20.04 LTS Secure Boot CUDA 12.2`.
3. –í –ø–æ–ª–µ **–ó–æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** –≤—ã–±–µ—Ä–∏—Ç–µ `ru-central1-d`.
4. –í –±–ª–æ–∫–µ **–î–∏—Å–∫–∏ –∏ —Ñ–∞–π–ª–æ–≤—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞** –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–∏—Å–∫–∞ **SSD** –∏ –∑–∞–¥–∞–π—Ç–µ —Ä–∞–∑–º–µ—Ä **800 –ì–ë**.
5. –í –±–ª–æ–∫–µ **–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã** –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **–°–≤–æ—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –∏ —É–∫–∞–∂–∏—Ç–µ:
   * **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞** ‚Äî Gen2.
   * **GPU** ‚Äî 8.
   * **–ö–ª–∞—Å—Ç–µ—Ä GPU** ‚Äî `test-gpu-cluster`.
6. –í –±–ª–æ–∫–µ **–î–æ—Å—Ç—É–ø** –≤—ã–±–µ—Ä–∏—Ç–µ **SSH-–∫–ª—é—á** –∏ —É–∫–∞–∂–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:
   * **–õ–æ–≥–∏–Ω:** `ubuntu`.
   * **SSH-–∫–ª—é—á:** –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª—é—á –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π.
7. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å –í–ú**.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º —Å–æ–∑–¥–∞–π—Ç–µ –≤—Ç–æ—Ä—É—é –í–ú —Å —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º–∏ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

## –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞.
* –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏.
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ç–∏ InfiniBand.

## –ó–∞–ø—É—Å—Ç–∏—Ç–µ —è–∑—ã–∫–æ–≤—É—é –º–æ–¥–µ–ª—å

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH –∫ –æ–±–µ–∏–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –º–∞—à–∏–Ω–∞–º.
2. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `ubuntu` –≤ –≥—Ä—É–ø–ø—É `docker`, –≤—ã–ø–æ–ª–Ω–∏–≤ –Ω–∞ –æ–±–µ–∏—Ö –í–ú:
   ```bash
   sudo groupadd docker
   sudo usermod -aG docker $USER
   newgrp docker
   ```
3. –°–∫–∞—á–∞–π—Ç–µ –æ–±—Ä–∞–∑ SGLang –Ω–∞ –æ–±–µ –º–∞—à–∏–Ω—ã:
   ```bash
   docker pull lmsysorg/sglang:latest
   ```
4. –ù–∞ **–ø–µ—Ä–≤–æ–π –í–ú** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ `<IP_–∞–¥—Ä–µ—Å_1>` –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP –ø–µ—Ä–≤–æ–π –º–∞—à–∏–Ω—ã):
   ```bash
   docker run --gpus all \
     --device=/dev/infiniband \
     --ulimit memlock=-1 \
     --ulimit stack=67108864 \
     --shm-size 32g \
     --network=host \
     -v ~/.cache/huggingface:/root/.cache/huggingface \
     --name sglang_multinode1 \
     -e GLOO_SOCKET_IFNAME=eth0 \
     -it --rm --ipc=host lmsysorg/sglang:latest \
     python3 -m sglang.launch_server \
     --model-path deepseek-ai/DeepSeek-R1 \
     --tp 16 \
     --nccl-init-addr <IP_–∞–¥—Ä–µ—Å_1>:30000 \
     --nnodes 2 \
     --node-rank 0 \
     --trust-remote-code \
     --host 0.0.0.0 \
     --port 30001 \
     --disable-radix \
     --max-prefill-tokens 126000
   ```
5. –ù–∞ **–≤—Ç–æ—Ä–æ–π –í–ú** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –∫–æ–º–∞–Ω–¥—É, –∏–∑–º–µ–Ω–∏–≤ —Ç–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `--node-rank` –Ω–∞ `1`:
   ```bash
   docker run --gpus all \
     --device=/dev/infiniband \
     --ulimit memlock=-1 \
     --ulimit stack=67108864 \
     --shm-size 32g \
     --network=host \
     -v ~/.cache/huggingface:/root/.cache/huggingface \
     --name sglang_multinode2 \
     -e GLOO_SOCKET_IFNAME=eth0 \
     -it --rm --ipc=host lmsysorg/sglang:latest \
     python3 -m sglang.launch_server \
     --model-path deepseek-ai/DeepSeek-R1 \
     --tp 16 \
     --nccl-init-addr <IP_–∞–¥—Ä–µ—Å_1>:30000 \
     --nnodes 2 \
     --node-rank 1 \
     --trust-remote-code \
     --host 0.0.0.0 \
     --port 30001 \
     --disable-radix \
     --max-prefill-tokens 126000
   ```
6. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å—Ç–∞—Ä—Ç–µ: `The server is fired up and ready to roll!`.

## –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—É—é SSH-—Å–µ—Å—Å–∏—é –∫ –ø–µ—Ä–≤–æ–π –í–ú.
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É OpenAI:
   ```bash
   sudo apt update
   sudo apt install python3-pip -y
   pip install openai
   ```
3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test_model.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º –∫–æ–¥–æ–º:
   ```python
   import openai

   client = openai.Client(
       base_url="http://127.0.0.1:30001/v1", 
       api_key="EMPTY"
   )

   response = client.chat.completions.create(
       model="default",
       messages=[
           {"role": "system", "content": "You are a helpful AI assistant"},
           {"role": "user", "content": "List 3 countries and their capitals."},
       ],
       temperature=0.3,
       max_tokens=1024,
   )

   print(response.choices[0].message.content)
   ```
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
   ```bash
   python3 test_model.py
   ```

**–ü—Ä–∏–º–µ—Ä –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:**
```text
Here are three countries and their capitals:

1. **France** - Paris
2. **Japan** - Tokyo
3. **Brazil** - Bras√≠lia

Let me know if you'd like more examples! üòä
```

## –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
–ß—Ç–æ–±—ã –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –ø–ª–∞—Ç–∏—Ç—å –∑–∞ —Ä–µ—Å—É—Ä—Å—ã, –≤ —Å–µ—Ä–≤–∏—Å–µ **Compute Cloud**:
1. –£–¥–∞–ª–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã.
2. –£–¥–∞–ª–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä GPU.
