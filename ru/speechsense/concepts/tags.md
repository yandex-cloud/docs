# Теги в диалогах

_Теги_ создаются и настраиваются на уровне проекта. В каждом проекте может быть разный набор тегов.

{{ speechsense-name }} самостоятельно определяет, встречались ли определенные ключевые фразы или схожие с ними по смыслу фразы в диалоге, и добавляет к нему тег. Например, теги показывают, что оператор поблагодарил клиента за ожидание или что клиент обращается в службу поддержки повторно.

Чтобы диалогу назначались теги, они должны быть активированы. Активация тега происходит автоматически при его создании. После активации тега {{ speechsense-name }} анализирует диалоги и назначает тег, если диалог соответствует заданным условиям.

{% note info %}

Для разметки тегами анализируются диалоги, с даты начала которых прошло не более 60 дней. Отсчет начинается с текущего дня.

{% endnote %}

В {{ speechsense-name }} существуют следующие типы тегов:

* [Смысловые теги](#sense-tags) — основаны на анализе диалогов при помощи [смысловых атрибутов](reports/sense-attributes.md), к которым задаются поисковые запросы.
* [Словарные теги](#dictionary-tags) — основаны на поиске в диалогах конкретных слов и фраз.

Подробнее о создании, изменении и удалении тегов см. в [инструкциях](../operations/index.md#tag).

## Где отображаются теги {#display}

* На вкладке **{{ ui-key.yc-ui-talkanalytics.dialogs.classifiers }}** в проекте.
* В отчетах:
   * В [фильтрах диалогов](dialogs.md#filters), которые доступны на вкладке **{{ ui-key.yc-ui-talkanalytics.projects.dialogs }}**.
   * В списке [параметров оценки](reports/evaluation-form.md#parameters).
* На странице диалога, на который назначен тег.

## Смысловые теги {#sense-tags}

Смысловые теги основаны на анализе диалога при помощи [смысловых атрибутов](reports/sense-attributes.md). При [создании смыслового тега](../operations/project/tag/create-sense-tag.md#new-tag) вы выбираете один из смысловых атрибутов и задаете поисковый запрос к нему. {{ speechsense-name }} анализирует диалоги и присваивает тег, если диалог соответствует по смыслу поисковому запросу в контексте выбранного смыслового атрибута. 

Чтобы точнее управлять назначением тегов, задайте минимальную вероятность соответствия диалога заданным условиям. Теги будут присваиваться только тем диалогам, для которых вероятность соответствия выше или равна заданной.

> Например, вы выбрали смысловой атрибут **{{ ui-key.yc-ui-talkanalytics.neuro-tags.themes-key-value }}**, задали поисковый запрос `Отдых в Сочи` и вероятность совпадения `90%`. {{ speechsense-name }} присвоит тег диалогам, тема которых по смыслу соответствует запросу `Отдых в Сочи` с вероятностью не менее 90%.

В {{ speechsense-name }} доступны следующие смысловые атрибуты:

* **{{ ui-key.yc-ui-talkanalytics.neuro-tags.themes-key-value }}**.
* **{{ ui-key.yc-ui-talkanalytics.neuro-tags.reasons-key-value }}**.
* **{{ ui-key.yc-ui-talkanalytics.neuro-tags.results-key-value }}**.
* **{{ ui-key.yc-ui-talkanalytics.statements.problems }}**.
* **{{ ui-key.yc-ui-talkanalytics.statements.operator_keywords }}**.
* **{{ ui-key.yc-ui-talkanalytics.statements.client_keywords }}**.
* **{{ ui-key.yc-ui-talkanalytics.statements.common_question }}** — предустановленные вопросы с универсальной применимостью.

Смысловым тегам по умолчанию назначаются каналы `Оператор` и `Клиент` одновременно, изменить это нельзя.

### Подсказки {#suggestions}

При [создании смыслового тега](../operations/project/tag/create-sense-tag.md#new-tag) вы можете задать поисковый запрос самостоятельно или воспользоваться подсказками. Доступные подсказки зависят от выбранного смыслового атрибута:

* Для общих вопросов подсказки предустановлены и не зависят от выборки диалогов для анализа.
* Для всех остальных атрибутов подсказки генерируются динамически по заданной выборке диалогов. Если вы измените выборку диалогов для анализа, подсказки будут сгенерированы заново.

При формировании подсказок {{ speechsense-name }} анализирует заданную выборку диалогов и генерирует возможные ключевые фразы для заданного смыслового атрибута. Для этого требуется минимум 100 диалогов, иначе {{ speechsense-name }} не сможет провести достоверный анализ. Ограничения на максимальное количество диалогов нет, но если в выборке будет больше 1000 диалогов, {{ speechsense-name }} отберет для анализа только 1000 диалогов случайным образом.

Если в выборке для анализа больше 1000 диалогов и сгенерированные подсказки вас не устраивают, вы можете нажать кнопку **{{ ui-key.yc-ui-talkanalytics.neuro-tags.refresh-suggestions }}**. {{ speechsense-name }} заново выберет 1000 диалогов случайным образом и сгенерирует новые подсказки.

### Тестирование смысловых тегов {#test-sense-tags}

При создании или изменении смыслового тега вы можете протестировать его на выборке диалогов. Во время тестирования {{ speechsense-name }} оценивает, соответствует ли диалог заданным в теге условиям. В выдаче приводится список диалогов по убыванию вероятности соответствия. Если в выборке больше 1000 диалогов, {{ speechsense-name }} выберет из них 1000 диалогов, которые охватывают весь диапазон вероятности соответствия. Во время тестирования вы можете изменить смысловой атрибут, поисковый запрос или вероятность соответствия в зависимости от результатов тестирования для более точной работы тега.

Подробнее о тестировании тегов см. в [инструкции](../operations/project/tag/test.md).

### Использование смысловых тегов для оценки диалогов {#use-sense-tags-for-dialog-evaluation}

Вы можете использовать смысловые теги для оценки качества работы оператора или поведения клиента, например был ли оператор вежлив, хамил ли клиент оператору и т. д. Для этого создайте смысловой тег с соответствующим смысловым атрибутом и поисковым запросом. {{ speechsense-name }} присвоит тег диалогам, которые соответствуют этой характеристике.

> Например, если вас интересуют диалоги, в которых клиент хамил оператору, при создании тега выберите:
> * Смысловой атрибут — **{{ ui-key.yc-ui-talkanalytics.statements.common_question }}**.
> * Поисковый запрос — **Клиент проявил грубость или агрессию в разговоре хотя бы один раз?**
>
> {{ speechsense-name }} присвоит тег диалогам, в которых клиент проявлял грубость или агрессию в разговоре.

Такое использование смысловых тегов позволяет использовать критерии качества работы оператора и особенности поведения клиента для [фильтрации диалогов](../operations/data/manage-dialogs.md#filter-dialogs), а также в качестве фильтра или параметра при [построении отчетов](../operations/data/manage-reports.md).

## Словарные теги {#dictionary-tags}

Словарные теги основаны на поиске в диалогах заданных ключевых фраз. Ключевые фразы в тегах можно задать списком или переиспользовать из [словарей](dictionaries.md). Словари содержат заранее подготовленный набор ключевых фраз, который можно применять для нескольких тегов и поддерживать в одном месте.

Чтобы точнее настроить поиск ключевых фраз:

* Включите настройку **{{ ui-key.yc-ui-talkanalytics.tags.exact-match-key-value }}**. В таком случае родственные фразы не будут учитываться при поиске ключевых фраз.
* Задайте дистанцию между словами. Эта настройка определяет максимальный разрыв, который допустим между словами в ключевой фразе. Например:

  > {% include [tag-distance-ex.md](../../_includes/speechsense/tag/tag-distance-ex.md) %}

В тексте диалога можно увидеть перечень присвоенных тегов для [каналов](#dictionary-tags-channel) оператора и клиента. Если нажать на название тега, его цветом подсветятся те слова, к которым этот тег был отнесен.

Подробнее о работе со словарными тегами см. в [инструкции](../operations/project/tag/create-dictionary-tag.md).

### Канал словарного тега {#dictionary-tags-channel}

_Канал_ определяет, в какой части диалога {{ speechsense-name }} будет искать ключевые слова. Доступны следующие каналы:

* **{{ ui-key.yc-ui-talkanalytics.tags.channel.operator-and-client }}** — во всем диалоге;
* **{{ ui-key.yc-ui-talkanalytics.tags.channel.operator }}** — только в речи или сообщениях оператора;
* **{{ ui-key.yc-ui-talkanalytics.tags.channel.client }}** — только в речи или сообщениях клиента.

В зависимости от канала {{ speechsense-name }} ищет ключевые слова в различных частях диалога.

> Например, если тегу присвоен канал **{{ ui-key.yc-ui-talkanalytics.tags.channel.client }}**, а ключевое слово тега встречается только в речи или сообщениях оператора, тег не назначается на диалог.

Канал настраивается на уровне [проекта](resources-hierarchy.md#project). Это позволяет гибко управлять назначением тегов в различных проектах. Подробнее о назначении канала словарному тегу см. в [инструкции](../operations/project/tag/change-dictionary-tag.md#tag-channel).

### Ограничение области поиска тегов {#tag-limitations}

С помощью _ограничений_ в {{ speechsense-name }} вы можете сузить область поиска ключевых слов из словарных тегов. При заданном ограничении тег будет срабатывать, только если {{ speechsense-name }} нашел ключевое слово в указанной части диалога.

> Например, задано ограничение со следующими настройками:
> * Вид ограничения — **{{ ui-key.yc-ui-talkanalytics.tags.binding-events.dialog-start-key-value }}**;
> * **{{ ui-key.yc-ui-talkanalytics.tags.search-area-key-value }}** — **{{ ui-key.yc-ui-talkanalytics.tags.search-area.after-key-value }}**;
> * **{{ ui-key.yc-ui-talkanalytics.tags.restrict-search-area-key-value }}** — до трех фраз.
>
> {{ speechsense-name }} будет искать ключевые слова только в первых трех фразах от начала диалога.

Каждое ограничение в {{ speechsense-name }} привязывается к определенному событию, которое служит началом области поиска. Доступны следующие события:

* начало диалога;
* длинная пауза (продолжительность паузы измеряется в секундах и задается вручную);
* оператор перебил клиента;
* клиент перебил оператора;
* конец диалога;
* (для зависимого тега) срабатывание основного тега.

По умолчанию установлен максимальный размер области поиска — 1000 фраз. Чтобы уточнить область поиска, задайте направление поиска от события (вперед, назад, в обе стороны) и количество фраз в области поиска.

Вы можете добавить несколько ограничений для одного тега. Ограничения суммируются по правилам логического И.

### Фразы-исключения {#exclusion-phrases}

Чтобы повысить точность словарного тега, добавьте к нему _фразы-исключения_. Если в диалоге есть фразы-исключения, тег не будет на них срабатывать.

Вы можете добавить фразы-исключения вручную или загрузить словарь с фразами.

> Например, создадим тег `Пожар` и добавим в него ключевую фразу `загорелась`.
> Тег сработает на фразе `Лампочка загорелась красным`, однако такая фраза не обозначает пожар. Это ложное срабатывание. Чтобы избавиться от него, добавим фразу-исключение `лампочка загорелась`.
> Теперь тег не сработает на фразе `Лампочка загорелась красным`, но сработает на фразе `Загорелся утюг`.

Чтобы точнее настроить фразу-исключение:

* Включите настройку **{{ ui-key.yc-ui-talkanalytics.tags.exact-match-key-value }}**. В таком случае родственные фразы не будут учитываться при поиске фраз-исключений.
* Задайте дистанцию между словами. Эта настройка определяет максимальный разрыв, который допустим между словами во фразе-исключении.

### Тестирование словарных тегов {#test-dictionary-tags}

При создании или изменении словарного тега вы можете протестировать его на выборке диалогов. Во время тестирования {{ speechsense-name }} проанализирует диалоги в заданной выборке и выведет список диалогов, которым может быть присвоен этот тег.

Подробнее о тестировании тегов см. в [инструкции](../operations/project/tag/test.md).

## Зависимые теги {#dependent-tags}

Для любого тега {{ speechsense-name }} можно [создать](../operations/project/tag/create-dependent-tag.md) _зависимый тег_.  Зависимым называется тег, который срабатывает только при срабатывании _основного_ тега. Основным называется тег, для которого был создан зависимый тег. 

Основными и зависимыми могут быть как словарные, так и смысловые теги, в любой комбинации. Глубина вложенности зависимых тегов не ограничена.

Зависимость словарных тегов реализована при помощи [ограничения](#tag-limitations) **{{ ui-key.yc-ui-talkanalytics.tags.binding-events.classifier }}**, которое добавляется в зависимый тег автоматически. Удалить это ограничение нельзя. При этом, если для смыслового тега создается зависимый словарный тег, то для этого словарного тега нельзя указать ограничение.

Зависимые теги редактируются в соответствии с их типом как обычные [смысловые](../operations/project/tag/change-sense-tag.md) или [словарные](../operations/project/tag/change-dictionary-tag.md) теги.

При удалении основного тега удалятся все зависимые от него теги.
