# Потоковый режим распознавания речи

Потоковый режим позволяет одновременно отправлять аудио на распознавание и получать результаты распознавания в рамках одного соединения. 

В отличие от других [способов распознавания](./index.md#stt-ways), вы сможете получать промежуточные результаты распознавания, пока фраза еще не закончена. После паузы сервис вернет финальные результаты и начнет распознавание новой фразы.

> Например, как только пользователь начинает говорить с [Яндекс.Станцией](https://station.yandex.ru/), она начинает передавать его речь на сервер для распознавания. Сервер обрабатывает данные и возвращает промежуточные и финальные результаты распознавания каждой фразы. Промежуточные результаты используются, чтобы показать пользователю ход распознавания, а после финальных результатов Яндекс.Станция выполняет действие, например включает фильм.

Чтобы использовать сервис, создайте приложение, которое будет осуществлять потоковое распознавания речи: отправлять аудиофрагменты и обрабатывать ответ с результатами распознавания.

{% note warning %}

Потоковый режим предназначен для распознавания аудио в режиме реального времени. Для распознавания уже записанного аудиофайла используйте [синхронный режим распознавания](request.md) или [асинхронный режим распознавания](transcribation.md) аудиозаписей.

{% endnote %}

## Использование сервиса {#service-use}

### Создание клиентского приложения {#create-client-app}

Для распознавания речи приложение сначала должно отправить [сообщение с настройками распознавания](api/streaming-api.md#specification-msg), а потом отправлять [сообщения с аудиофрагментами](api/streaming-api.md#audio-msg).

Параллельно с тем как отправляются аудиофрагменты, в ответ сервис будет возвращать [фрагменты распознанного текста](api/streaming-api.md#response), которые необходимо обрабатывать, например выводить их в консоль.

Чтобы приложение смогло обращаться к сервису, необходимо сгенерировать код интерфейса клиента для используемого языка программирования. Сгенерируйте этот код из файла [stt_service.proto](https://github.com/yandex-cloud/cloudapi/blob/master/yandex/cloud/ai/stt/v2/stt_service.proto) из репозитория [Yandex.Cloud API](https://github.com/yandex-cloud/cloudapi).

Примеры клиентских приложений см. на странице [{#T}](api/streaming-examples.md). Помимо этого, в [документации gRPC](https://grpc.io/docs/tutorials/) вы можете найти подробные инструкции по генерации интерфейсов и реализации клиентских приложений для различных языков программирования.

### Авторизация в сервисе {#auth}

В каждом запросе приложение должно передавать [идентификатор каталога](../../resource-manager/operations/folder/get-id.md), на который у вас есть роль `editor` или выше. Подробнее в разделе [Управление доступом](../security/index.md).

Также приложение должно аутентифицироваться при каждом запросе, например при помощи IAM-токена. [Подробнее об аутентификации в сервисе](../concepts/auth.md).

### Результат распознавания {#results}

В каждом [сообщении с результатами распознавания](api/streaming-api.md#response) сервер возвращает один или несколько фрагментов речи, которые он успел распознать за этот промежуток (`chunks`). Для каждого фрагмента речи указывается список вариантов распознанного текста (`alternatives`).

В процессе распознавания речь делится на фразы, а конец фразы помечается флагом `endOfUtterance`. По умолчанию сервер возвращает ответ только после распознавания всей фразы. С помощью флага `partialResults` вы можете указать, чтобы сервер возвращал и промежуточные результаты распознавания. Получение промежуточных результатов позволит быстрее реагировать на распознаваемую речь, не дожидаясь окончания фразы.

### Ограничения сессии распознавания речи {#session-restrictions}

После получения сообщения с настройками распознавания сервис начнет сессию распознавания. Для каждой сессии действуют следующие ограничения:

* Нельзя отправлять аудиофрагменты слишком часто или редко. Время между отправкой сообщений в сервис должно примерно совпадать с длительностью отправляемых аудиофрагментов, но не должно превышать 5 секунд.

    Например, каждые 400 мс отправляйте на распознавание 400 мс аудио.
* Максимальная длительность переданного аудио за всю сессию — {{ stt-streaming-audioLength }}.
* Максимальный размер переданных аудиоданных — {{ stt-streaming-fileSize }}.

Если в течение 5 секунд в сервис не отправлялись сообщения или достигнут лимит по длительности или размеру данных, сессия обрывается. Чтобы продолжить распознавание речи, надо заново установить соединение и отправить новое сообщение с настройками распознавания.


