# Функция

_Функция_ позволяет вам размещать код в {{ yandex-cloud }}, который можно запускать по запросу или триггеру.

Сразу после создания функция содержит только метаинформацию о себе: имя, описание, уникальный идентификатор и т. д. Для начала работы с функцией необходимо [создать версию функции](../operations/function/version-manage.md). Выполнить функцию можно с помощью HTTPS API или CLI.

Перед написанием функции, ознакомьтесь с [моделью программирования](#programming-model).

## Версия функции {#version}

_Версия_ содержит код функции, параметры запуска и все необходимые зависимости. Вы можете работать с разными версиями одной функции на разных стадиях процесса разработки, например, версия в разработке, альфа-версия, бета-версия. При внесении каких-либо изменений всегда создается новая версия с [тегом](#tag) по умолчанию — `$latest`, при этом не имеет значения, загрузили вы совершенно новый код или внесли только незначительные правки.

### Формат загрузки кода {#upload}

Для [создания версии](../operations/function/version-manage.md) вы можете воспользоваться редактором кода или загрузить код и необходимые зависимости, используя один из форматов, описанных в таблице ниже. После создания функции объект с кодом больше не нужен. Его можно удалить из хранилища.

| Формат | Консоль управления | YC CLI |
|----|----|----|
|ZIP-архив с вашего ПК| ![image](../../_assets/common/yes.svg) | ![image](../../_assets/common/yes.svg) |
|ZIP-архив из [S3](../../glossary/s3.md) с указанием бакета и объекта| ![image](../../_assets/common/yes.svg) | ![image](../../_assets/common/yes.svg) |
|Директория| ![image](../../_assets/common/no.svg) | ![image](../../_assets/common/yes.svg) |
|Файл| ![image](../../_assets/common/no.svg) | ![image](../../_assets/common/yes.svg) |

{% include [upload-limits](../../_includes/functions/upload-limits.md) %}

Подробнее о том, как создать версию, читайте в разделе [{#T}](../operations/function/version-manage.md).

### Тег версии {#tag}

Теги используются для вызова определенной версии функции. Каждый тег должен быть уникален в рамках функции. У одной версии может быть несколько тегов.

{% note info %}

При создании новой версии ей присваивается тег по умолчанию — `$latest`.

{% endnote %}

## Модель программирования {#programming-model}

{{ sf-name }} поддерживает разные языки программирования. Вне зависимости от выбранного вами языка, при написании кода необходимо опираться на принятую в сервисе модель программирования. В ней есть как элементы, которые необходимо реализовать пользователю, так и механизмы, которые уже реализованы на стороне сервиса и могут быть использованы по необходимости.

### Описание модели {#model-desc}

Чтобы функция запустилась, опишите в ней _обработчик_. Он определяется при написании кода и обрабатывает поступающие данные, вызывая необходимые функции и методы в коде. Обработчик должен принимать данные, которые приходят с запросами функции, и контекст, который передает {{ sf-name }}.

_Контекст_ обеспечивает взаимодействие кода вашей функции с {{ sf-name }}. Например, с его помощью функция может узнать, сколько времени осталось до момента, когда {{ sf-name }} завершит ее выполнение.

Поступающие запросы обрабатываются функцией по одному. Чтобы функция обрабатывала несколько запросов сразу, используйте возможности _асинхронного выполнения кода_, которые предоставляет [среда выполнения](runtime/index.md).

Чтобы сообщить сервису об ошибке при выполнении функции, обрабатывайте ошибки с помощью _исключений_.

Выполнение функции _журналируется_ сервисом, но при необходимости вы можете реализовать в коде вашей функции дополнительное ведение журналов.

### Масштабирование функции {#scaling}

Экземпляр функции обрабатывает один ее вызов в один момент времени. Если функция вызывается быстрее, чем экземпляр успевает обработать запрос, сервис масштабирует функцию — запускает ее дополнительные экземпляры. Таким образом обеспечивается _параллельная обработка запросов_. В {{ sf-name }} можно задать:

{% include [scaling](../../_includes/functions/scaling.md) %}

{% note info %}

Вызовы распределяются по зонам доступности случайным образом. {{ sf-name }} не гарантирует равномерное распределение вызовов по зонам. Например, все вызовы вне зависимости от их количества могут попасть в одну зону.

{% endnote %}

#### Лимиты {#limits}

Когда количество экземпляров функции достигает значения `zone_instances_limit`, {{ sf-name }} перестает ее масштабировать. Если вызовов функции больше, чем доступных экземпляров, вызов становится в очередь, но при этом считается выполняемым. Когда количество выполняемых вызовов достигает значения `zone_requests_limit`, сервис перестает ставить вызовы в очередь и возвращает ошибку `429 TooManyRequests`.

#### Подготовленные экземпляры {#provisioned-instances}

_Подготовленный экземпляр_ — это экземпляр функции, при запуске которого гарантированно нет холодного старта. В подготовленном экземпляре до вызова функции:
* запускается интерпретатор;
* инициализируются компоненты среды выполнения {{ sf-name }};
* загружается и инициализируется пользовательский код.

{% include [provisioned-instances-price](../../_includes/functions/provisioned-instances-price.md) %}

Если количество вызовов функции превышает количество подготовленных экземпляров, {{ sf-name }} масштабирует функцию в пределах [квот](limits.md#functions-quotas), но в неподготовленных экземплярах при их первом запуске происходит холодный старт.

Подготовленные экземпляры расходуют следующие [квоты](limits.md), даже если не запущены:
* Количество экземпляров функций в каждой зоне доступности.
* Суммарный объем RAM для всех запущенных функций в каждой зоне доступности.
* Количество подготовленных экземпляров функций в одном облаке.

#### См. также

* [Создать версию функции](../operations/function/version-manage.md).
* [Добавить настройки масштабирования](../operations/function/scaling-settings-add.md).
