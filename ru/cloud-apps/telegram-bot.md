# Demo Telegram Bot

Telegram-бот на serverless-стеке {{ yandex-cloud }}, который возвращает пользователю отправленное сообщение. Реализован с помощью библиотеки [Telegraf](https://telegraf.js.org/) на Node.js.

Навыки Telegram-бота можно менять по своему усмотрению.

## Необходимые платные ресурсы {#paid-resources}

В стоимость ресурсов для приложения входят:

* Плата за количество вызовов функции, вычислительные ресурсы, выделенные для выполнения функции, и исходящий трафик (см. [тарифы {{ sf-full-name }}](../functions/pricing.md)).
* Плата за количество запросов к API-шлюзу и исходящий трафик (см. [тарифы {{ api-gw-full-name }}](../api-gateway/pricing.md)).
* Плата за количество запросов к стандартной очереди (см. [тарифы {{ message-queue-full-name }}](../message-queue/pricing.md)).
* Плата за хранение и запрос секретов (см. [тарифы {{ lockbox-full-name }}](../lockbox/pricing.md)).

## Перед началом работы {#before-begin}

Зарегистрируйте вашего бота в Telegram и получите токен:

1. Запустите бота `BotFather` и отправьте ему команду `/newbot`.
1. Укажите имя вашего бота, например `Serverless Echo Telegram Bot`. Это имя будут видеть пользователи при общении с ботом.
1. Укажите имя пользователя вашего бота, например `ServerlessHelloTelegramBot`. По имени пользователя можно будет найти бота в Telegram. Имя пользователя должно оканчиваться на `...Bot` или `..._bot`.

На экране появится токен Telegram-бота.

[Создайте](../lockbox/operations/secret-create.md) секрет {{ lockbox-full-name }}. В поле **Ключ** укажите `TG_TOKEN`, в поле **Значение** — полученный токен Telegram-бота.

## Разверните приложение {#deploy-app}

1. В [консоли управления]({{ link-console-main }}) выберите каталог, в котором хотите развернуть приложение.
1. Выберите сервис **{{ cloud-apps-name }}**.
1. На панели слева выберите **Магазин приложений**.
1. Выберите **Demo Telegram Bot** и нажмите кнопку **Использовать**.
1. Укажите:
    * Имя приложения.
    * (Опционально) Описание приложения.
    * Сервисный аккаунт с ролью `admin` на каталог или выберите **Автоматически**, чтобы нужный сервисный аккаунт создался при установке приложения. От имени этого сервисного аккаунта будут создаваться ресурсы приложения.
    * Идентификатор секрета {{ lockbox-full-name }}, который создали ранее.
1. Нажмите кнопку **Установить** и дождитесь, пока приложение установится.
1. На странице **Обзор**, в разделе **Ресурсы приложения**, найдите API-шлюз, перейдите на его страницу и скопируйте ссылку на служебный домен.
1. Чтобы настроить связь между функцией и Telegram-ботом, выполните запрос. Вместо `<токен бота>` укажите токен Telegram-бота, вместо `<домен API-шлюза>` — ссылку на служебный домен API-шлюза.

    {% list tabs group=operating_system %}

    - Linux/macOS {#linux-macos}

        ```bash
        curl \
          --request POST \
          --url https://api.telegram.org/bot<токен бота>/setWebhook?url=https://<Домен API-шлюза>/echo
        ```

    - Windows (cmd) {#windows-cmd}

        ```bash
        curl ^
          --request POST ^
          --url "https://api.telegram.org/bot<токен бота>/setWebhook?url=https://<Домен API-шлюза>/echo"
        ```

    - Windows (PowerShell) {#windows-powershell}

        ```powershell
        curl.exe `
          --request POST `
          --url https://api.telegram.org/bot<токен бота>/setWebhook?url=https://<Домен API-шлюза>/echo
        ```

    {% endlist %}

    Результат:

    ```
    {"ok":true,"result":true,"description":"Webhook was set"}
    ```

## Проверьте работу {#check-result}

Напишите боту в Telegram.
