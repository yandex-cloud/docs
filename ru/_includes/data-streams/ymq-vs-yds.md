# Сравнение шин обмена данными и потоков передачи данных

В {{ yandex-cloud }} для обмена данными используются сервисы {{ message-queue-full-name }} и {{ yds-full-name }}. Оба сервиса решают похожие задачи, но предназначены для разных сценариев использования:

* {{ message-queue-full-name }} ориентирован на передачу сообщений между компонентами распределенных приложений.
* {{ yds-full-name }} предназначен для передачи потоков данных (например, журналов работы приложений или действий пользователей, CDC-потоков изменений БД, данных с устройств) для их обработки приложениями.

## {{ message-queue-full-name }}

Шины обмена сообщениями ориентированы на доставку отдельных, независимых сообщений компонентам приложений (обработчикам) и реализуют сценарий очереди обработки задач. Задачи записываются в очередь, а приложение-обработчик получает их из этой очереди и исполняет. Из одной очереди сообщения считывает только одно приложение. Обработчик может состоять из нескольких одновременно работающих экземпляров.

Шины обмена сообщениями подходят для обработки набора независимых задач, каждая из которых может быть выполнена любым обработчиком. Главное, чтобы событие было обработано, порядок обработки не важен.

Например, очереди сообщений используют [поисковые роботы](https://ru.wikipedia.org/wiki/Поисковый_робот). Обходчик интернета находит URL страниц и складывает их в очередь. Процессы-парсеры получают эти URL, скачивают страницы и выполняют обработку. Очередь сообщений выступает как очередь задач, повышая отказоустойчивость и масштабируемость такой системы.

## {{ yds-full-name }}

{{ yds-full-name }} предназначен для того, чтобы передавать в приложения не отдельные сообщения, а потоки данных. Пропускная способность обрабатываемых потоков может быть от килобайтов до терабайтов в час и более.

Данные в {{ yds-full-name }} передаются через потоки, которые состоят из сегментов. У всех входящих записей есть ключи, которые определяют в какой сегмент попадут данные. В пределах одного сегмента данные считываются в порядке записи.

В {{ yds-full-name }}, в отличие от {{ message-queue-full-name }}, несколько разных приложений могут одновременно считывать данные из одного потока. При этом каждое приложение может читать данные с произвольной позиции.

Считывать данные одновременно разными приложениями может быть необходимо в следующих случаях:

* Когда одни и те же данные нужно обработать сразу несколькими приложениями.
* Для защиты от ошибок. Если в обработчике была ошибка, то можно исправить ошибку и пересчитать хранимые в очереди данные заново, уже правильным способом.
* При запуске нового приложения. При разработке новой версии приложения его можно запустить параллельно с основным и проверить в работе над реальными данными.

Через шины данных можно передавать любые данные, но чаще всего передают журналы работы приложений, журналы действий пользователей или данные с устройств. Для этого {{ yds-full-name }} поддерживает HTTP API.

## Сравнение {{ message-queue-full-name }} и {{ yds-full-name }}

Параметр | {{ message-queue-full-name }} | {{ yds-full-name }}
--|--|--
Основной сценарий | Очередь задач между компонентами приложения | Пересылка данных между приложениями, поставка данных в системы хранения {{ yandex-cloud }}
Кто получает данные| Компоненты одного приложения | Независимые приложения
Гарантии | [At least once](https://www.cloudcomputingpatterns.org/at_least_once_delivery/) для обычной очереди, [exactly once](https://www.cloudcomputingpatterns.org/exactly_once_delivery/) для FIFO-очереди | At least once
Порядок получения сообщений | Гарантируется для FIFO-очереди, не гарантируется для обычной очереди | Гарантируется
Пропускная способность | До 300 сообщений в секунду для обычной очереди, до 30 сообщений в секунду для FIFO-очереди | Не ограничена, определяется числом сегментов
Что тарифицируется | За запросы на запись и чтение сообщений | За сегменты, их скорость и объем хранимых данных
Поддерживаемый протокол | [Amazon SQS API](../../message-queue/api-ref/index.md) | [Amazon Kinesis Data Streams API](../../data-streams/kinesisapi/api-ref.md)
С какими сервисами {{ yandex-cloud }} есть интеграция | [{{ sf-full-name }}](../../functions/), [{{ api-gw-full-name }}](../../api-gateway/) | [{{ sf-full-name }}](../../functions/), [{{ api-gw-full-name }}](../../api-gateway/), [{{ data-transfer-full-name }}](../../data-transfer/)
Надежность | Данные хранятся во всех зонах доступности | Данные хранятся во всех зонах доступности
Масштабируемость на чтение | Серверная | Клиентская ([KCL](https://docs.aws.amazon.com/streams/latest/dev/shared-throughput-kcl-consumers.html)). Поддерживаются версии KCL 1.x
