## 3.11.2023 — CVE-2023-5043 Nginx ingress controller for Kubernetes vulnerabilities {#CVE-2023-5043}

CVE ID: CVE-2023-5043 , CVE-2023-5044 и CVE-2022-4886

Ссылки на CVE:

<https://nvd.nist.gov/vuln/detail/CVE-2023-5043>
<https://nvd.nist.gov/vuln/detail/CVE-2023-5044>
<https://nvd.nist.gov/vuln/detail/CVE-2022-4886>

### Исходный отчет {#original-report-CVE-2023-5043}

<https://github.com/kubernetes/ingress-nginx/issues/10571>
<https://github.com/kubernetes/ingress-nginx/issues/10572>
<https://github.com/kubernetes/ingress-nginx/issues/10570>

### Краткое описание {#brief-description-CVE-2023-5043}

Первые две бреши, CVE-2023-5043 и CVE-2023-5044, связаны с недостаточной проверкой входных данных и могут привести к внедрению произвольного кода, получению привилегированных учётных данных и краже всех секретов кластера. Обе проблемы имеют оценку уязвимости 7,6 из 10 по шкале CVSS.

Третья уязвимость, CVE-2022-4886, оценивается более высоко — 8,8 по шкале CVSS. Эта проблема может быть эксплуатирована при создании или обновлении объектов Ingress, позволяя злоумышленникам получить доступ к учётным данным Kubernetes API из контроллера Ingress и, следовательно, украсть все секреты кластера. Она затрагивает версии до 1.8.0 включительно.

### Затронутые технологии {#technologies-affected-CVE-2023-5043}

NGINX

### Уязвимые продукты и версии {#vulnerable-products-and-versions-CVE-2023-5043}

NGINX до версии 1.9.0.

### Рекомендации по обнаружению уязвимости и дополнительные материалы {#recommendations-for-vulnerability-detection-CVE-2023-5043}

Наши рекомендации для предотвращения использования данных уязвимостей:

1. Обновить NGINX Ingress контролер до версии 1.9.0, с этой версии добавлена валидация аннотаций и отключены пользовательские сниппеты по умолчанию.

1. Добавить к опциям запуска контроллера аргумент `--enable-annotation-validation`.

1. Добавить в конфигурацию (Configmap) контроллера опцию `strict-validate-path-type`.

1. Использовать Policy Engine, например [Kyverno](https://yandex.cloud/ru/marketplace/products/yc/kyverno) для валидации путей, используемых в правилах Ingress. [Подходящую политику](https://kyverno.io/policies/nginx-ingress/restrict-ingress-paths/restrict-ingress-paths/) можно найти на сайте Kyverno.

### Безопасная версия уязвимого продукта или патч {#safe-version-CVE-2023-5043}

Уязвимость устранена в версии 1.9.0.

### Влияние на сервисы {{ yandex-cloud }} {#impact-on-yandex-cloud-services-CVE-2023-5043}

В случае использования ALB Ingress контроллера от {{ yandex-cloud }} данные уязвимости не применимы, так как он строится на других технологиях и не имеет аннотаций и настроек, необходимых для реализации уязвимостей.
