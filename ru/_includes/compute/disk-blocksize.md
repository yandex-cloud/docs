Диски состоят из блоков. По умолчанию размер блоков всех создаваемых дисков равен 4 КБ, однако для дисков больше 8 ТБ этого недостаточно. Вы можете задать размеры блока при создании пустого диска. При этом сразу будет виден максимальный размер диска. Изменить размеры блока после создания диска нельзя.

Максимальный размер диска зависит от заданного размера блока. Размер создаваемого диска должен быть кратен 4 МБ.

Размер блока | Максимальный размер диска
--- | ---
4 КБ | 8 ТБ
8 КБ | 16 ТБ
16 КБ | 32 ТБ
32 КБ | 64 ТБ
64 КБ | 128 ТБ
128 КБ | 256 ТБ

{% note alert %}

Выбранный физический размер блока может влиять на производительность.

{% endnote %}

Как правило, логический размер блока равен 512 байтам. Несмотря на то, что гостевая ОС старается выравнивать ввод-вывод на физический размер блока, это возможно не всегда. В случае, когда программное обеспечение выполняет много операций чтения и записи размером меньше физического блока, эти маленькие операции могут достичь дисковой подсистемы. При чтении в этом случае приходится читать больше, чем запрошено — минимум один физический блок. В случае записи ситуация сложнее — чтобы записать объем данных, меньший, чем физический размер блока, сначала нужно прочитать весь физический блок, обновить в нем нужные байты, затем записать весь физический блок (операция read-modify-write). Если при этом запись не выровнена на физический размер блока, то может понадобиться прочитать и перезаписать 2 физических блока. Таким образом, одна логическая запись может превратиться в 2 операции чтения и 2 операции записи на уровне дисковой подсистемы. Эта избыточная нагрузка не будет видна в метриках на уровне гостевой ОС, но будет учитываться при оценке близости нагрузки к лимитам диска и будет влиять на производительность.

Выбирайте большой размер блока только тогда, когда вы уверены, что ваше программное обеспечение работает с файловой системой или диском большими запросами — не менее физического размера блока.