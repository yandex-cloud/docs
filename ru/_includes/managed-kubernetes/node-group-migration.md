{% list tabs group=instructions %}

- CLI {#cli}

   1. Создайте подсеть:
      
      ```bash
      yc vpc subnet create \
         --name <название_подсети> \
         --zone <зона_доступности> \
         --network-id <идентификатор_сети> \
         --range <CIDR_подсети>
      ```

      Где:

      * `--name` — название подсети.
      * `--zone` — зона доступности: `{{ region-id }}-a`, `{{ region-id }}-b` или `{{ region-id }}-d`.
      * `--network-id` — идентификатор сети, в которую входит новая подсеть.
      * `--range` — список IPv4-адресов, откуда или куда будет поступать трафик. Например, `10.0.0.0/22` или `192.168.0.0/16`. Адреса должны быть уникальными внутри сети. Минимальный размер подсети — `/28`, а максимальный размер подсети — `/16`. Поддерживается только IPv4.

   1. Перенесите группу узлов:

      ```bash
      {{ yc-k8s }} node-group update \
         --id <идентификатор_группы_узлов> \
         --location zone=<зона_доступности>,subnet-id=<идентификатор_подсети> \
         --network-interface subnets=<идентификатор_подсети>
      ```

      Команда пересоздает узлы внутри их группы в указанной зоне доступности и подсети. При пересоздании учитываются настройки развертывания — максимальное количество узлов, на которое разрешается увеличить или уменьшить размер группы по сравнению с исходным количеством узлов.

      В команде укажите значения параметров:

      * `--id` — идентификатор группы узлов, которую вы переносите в другую зону доступности.
      * `zone` — зона доступности, в которую вы переносите группу узлов: `{{ region-id }}-a`, `{{ region-id }}-b` или `{{ region-id }}-d`.
      * `subnet-id` и `subnets` — идентификатор новой подсети, созданной ранее.

- {{ TF }} {#tf}

   {% note alert %}

   Чтобы убедиться, что группа узлов не будет пересоздана (если вы не делаете это намеренно), изучите вывод команд `terraform plan` и `terraform apply` перед применением конфигурации.

   Перенести группу узлов в другую зону доступности без пересоздания можно только при наличии в конфигурационном файле блока `allocation_policy`.

   {% endnote %}

   1. В файл с конфигурацией кластера добавьте манифест новой подсети и измените местоположение группы узлов:

      ```hcl
      resource "yandex_vpc_subnet" "my-new-subnet" {
         name           = "<название_подсети>"
         zone           = "<зона_доступности>"
         network_id     = "<идентификатор_сети>"
         v4_cidr_blocks = ["<CIDR_подсети>"]
      }
      ...
      resource "yandex_kubernetes_node_group" "k8s-node-group" {
         allocation_policy {
            location {
               zone = "<зона_доступности>"
            }
         }
         ...
         instance_template {
            network_interface {
               subnet_ids = [yandex_vpc_subnet.my-new-subnet.id]
               ...
            }
            ...
         }
         ...
      }
      ```

      Где:

      * `name` — название подсети.
      * `zone` — зона доступности, в которую вы переносите группу узлов: `{{ region-id }}-a`, `{{ region-id }}-b` или `{{ region-id }}-d`.
      * `network_id` — идентификатор сети, в которую входит новая подсеть.
      * `v4_cidr_blocks` — список IPv4-адресов, откуда или куда будет поступать трафик. Например, `10.0.0.0/22` или `192.168.0.0/16`. Адреса должны быть уникальными внутри сети. Минимальный размер подсети — `/28`, а максимальный размер подсети — `/16`. Поддерживается только IPv4.
      * `subnet_ids` — идентификатор новой подсети.

   1. Проверьте корректность конфигурационного файла.

      {% include [terraform-validate](../mdb/terraform/validate.md) %}

   1. Подтвердите изменение ресурсов.

      {% include [terraform-apply](../mdb/terraform/apply.md) %}

   Узлы группы будут пересозданы в указанной зоне доступности и подсети. При пересоздании учитываются настройки развертывания — максимальное количество узлов, на которое разрешается увеличить или уменьшить размер группы по сравнению с исходным количеством узлов.

{% endlist %}