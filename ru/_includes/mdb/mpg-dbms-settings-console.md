Доступны следующие настройки:

- **Conn limit** — максимальное допустимое количество соединений для пользователя.

  В сессионном пулинге (session pooling) эта настройка ограничивает количество соединений пользователя к каждому хосту в {{ PG }}-кластере.
  При использовании этого типа пулинга необходимо, чтобы значение настройки было не меньше суммы всех соединений, которые могут быть открыты бэкендами сервиса, использующего {{ PG }}. При этом важно помнить, что каждое открытое серверное соединение немного замедляет работу {{ PG }} на OLTP-нагрузке (Online Transaction Processing).

  В транзакционном пулинге (transaction pooling) эта настройка ограничивает количество соединений пользователя, которые одновременно находятся в транзакции. При использовании этого типа пулинга пользователь может открыть тысячи соединений, но одновременно работать смогут только `N` соединений, где `N` — значение настройки.

  Все, описанное ниже, справедливо для сессионного пулинга:
  - При добавлении пользователя {{ mpg-name }} по умолчанию резервирует для него 50 подключений к каждому хосту в {{ PG }}-кластере. Минимальное количество подключений на пользователя — 10.
  - Суммарное количество подключений, зарезервированных для пользователей, не должно превышать значение параметра `max_connections`, который был указан [при создании кластера](../../managed-postgresql/operations/cluster-create.md). При этом нужно учитывать, что {{ mpg-name }} резервирует 15 подключений для служебных пользователей на каждом {{ PG }}-хосте. Например, если для кластера задан параметр `"max_connections": 100`, то вы можете зарезервировать не больше 85 подключений на каждый хост кластера для пользователей.
  - Рекомендуется разнести разные сервисы, использующие {{ PG }}, по разным пользователям и задать нужное значение настройки для каждого пользователя.
  Таким образом, если при проблемах в одном сервисе начнет создаваться большое количество соединений, другие сервисы не будут затронуты и смогут создавать соединения к {{ PG }}.

- **Default transaction isolation** — для каждой транзакции в SQL устанавливается уровень изоляции. Эта настройка определяет уровень изоляции, который будет устанавливаться по умолчанию для новых транзакций SQL.

  Допустимые значения:
  - `read committed` (по умолчанию) — запрос видит только те строки, которые были зафиксированы до начала его выполнения.
  
  - `read uncommitted` — поведение этого уровня изоляции в {{ PG }} идентично `read committed`.
  
  - `repeatable read` — все запросы в текущей транзакции видят только те строки, которые были зафиксированы перед первым выполненным в этой транзакции запросом на выборку или изменение данных.
  
  - `serializable` — обеспечивает самый строгий уровень изоляции из всех приведенных выше. 
  
    Все запросы в текущей транзакции видят только те строки, которые были зафиксированы перед первым выполненным в этой транзакции запросом на выборку или изменение данных. Если наложение операций чтения и записи параллельных сериализуемых транзакций может привести к ситуации, невозможной при последовательном их выполнении, произойдет откат одной из транзакций с ошибкой «сбой сериализации». 
  
  Подробнее об уровнях изоляции см. [в документации {{ PG }}](https://www.postgresql.org/docs/current/transaction-iso.html).
 
- **Synchronous commit** — эта настройка определяет, будет ли СУБД выполнять операцию подтверждения транзакции синхронно.
 
  Синхронность операции означает, что кластер будет ждать выполнения синхронных операций, гарантирующих различные уровни сохранности и видимости данных в кластере, прежде чем подтвердить транзакцию клиенту.
 
  Допустимые значения:
  - `off` — транзакция подтверждается, даже если данные еще не попали в WAL (Write Ahead Log). Синхронной записи нет, данные о транзакции могут буть потеряны в результате сбоя дисковой подсистемы.
  - `on` (по умолчанию) — транзакция подтверждается, если WAL записан на диск мастера и на диск синхронной реплики.
  - `local` — транзакция подтверждается, если WAL записан на диск мастера.
  - `remote_apply` — транзакция подтверждается, если WAL записан на диск мастера, синхронная реплика приняла WAL и применила изменения из него.
  - `remote_write` — транзакция подтверждается, если WAL записан на диск мастера, синхронная реплика приняла WAL и передала его операционной системе для записи на диск. В случае потери дисковой системы мастера и сбоя операционной системы на реплике данные транзакции с таким уровнем синхронизации могут быть утеряны.
  
  Подробнее см. [в документации {{ PG }}](https://www.postgresql.org/docs/current/runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT).

- **Lock timeout** — максимальная длительность ожидания (в миллисекундах) любым оператором получения блокировки таблицы, индекса, строки или другого объекта базы данных. Если ожидание не закончилось за указанное время, оператор прерывается.

  Минимальное значение и значение по умолчанию: `0` (контроль длительности отключен, ожидать получения блокировки можно сколь угодно долго).

- **Log statement** — фильтр команд SQL, которые должны записываться в лог для указанного пользователя:
  - `none` (по умолчанию) — фильтр отключен, команды SQL не записываются в лог.
  - `ddl` — в лог записываются команды SQL, которые позволяют изменять определения данных (такие как `CREATE`, `ALTER`, `DROP` и другие).
  - `mod` — в лог записываются команды SQL, попадающие под фильтр `ddl`, и команды, позволяющие изменять данные (такие как `INSERT`, `UPDATE` и другие).
  - `all` — в лог записываются все команды SQL.

  Подробнее см. [в документации {{ PG }}](https://www.postgresql.org/docs/current/runtime-config-logging.html).

- **Log min duration statement** — настройка логирования длительности выполнения команд SQL.

  В лог записывается продолжительность выполнения всех команд, время обработки которых равно или превышает указанное в значении настройки количество миллисекунд. Например, при значении настройки `500` в лог не попадет выражение, выполнявшееся 300 миллисекунд, а выражение, выполнявшееся 2000 миллисекунд — попадет.
  
  Значение `0` заставляет записывать продолжительность работы всех команд.
  
  Значение `-1` (по умолчанию) отключает запись продолжительности выполнения команд.
  
  Рекомендуется определить для каждого сервиса и соответствующего ему пользователя, что считается медленным выполнением запроса, и задать соответствующее значение настройки, чтобы логировать «тяжелые» запросы от сервиса. Например, для веб-сервиса медленным может считаться запрос, выполняющийся более одной секунды, а для сервиса построения отчетов — запрос, выполняющийся более 10 минут.
  
  Подробнее см. [в документации {{ PG }}](https://www.postgresql.org/docs/current/runtime-config-logging.html).

- **Temp file limit** — максимальный объем дискового пространства (в килобайтах), который один процесс сможет использовать для временных файлов. Транзакция, которая попытается превысить этот предел, будет отменена.

   Большие запросы из-за их размера выполняются не в оперативной памяти, а на диске. Слишком большие запросы могут нагрузить диск и помешать выполнению других запросов. Эта настройка предотвращает выполнение запросов, которые могут сильно повлиять на производительность, ограничивая размер временных файлов. 

  Значение по умолчанию: `-1` (нет ограничений).
  
  Подробнее см. [в документации {{ PG }}](https://www.postgresql.org/docs/current/runtime-config-resource.html).