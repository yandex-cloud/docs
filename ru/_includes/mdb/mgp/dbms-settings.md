### Контексты параметров

Контекст параметра определяет, на каком уровне и в каком интерфейсе параметр может быть определен.

Для {{ GP }} используются следующие контексты параметров:

| Контекст | Позволяет задавать параметр через `SET` | Требует перезапуска | Описание | Интерфейс |
| --- | --- | --- | --- | --- |
| `user` | Да | Нет | Эти параметры можно задать для кластера или в рамках сессии с помощью команды `SET`. Любой пользователь может изменить значение параметра для своей сессии. Изменения на уровне кластера повлияют на существующие сессии только в том случае, если с помощью команды `SET` не было установлено локальное для сессии значение. | {{ tag-con }} {{ tag-cli }} {{ tag-tf }} {{ tag-api }} |
| `backend` | Да ^*^ | Нет | Эти параметры можно задать для кластера или для конкретной сессии в пакете запроса на подключение (например, через переменную окружения `PGOPTIONS` в `libpq`). | {{ tag-con }} {{ tag-cli }} {{ tag-tf }} {{ tag-api }} |
| `sighup` | Нет | Нет | Эти параметры можно задать только для кластера. | {{ tag-con }} {{ tag-cli }} {{ tag-tf }} {{ tag-api }} |
| `superuser` | Нет | Нет | Эти параметры можно задать только для кластера. | {{ tag-con }} {{ tag-cli }} {{ tag-tf }} {{ tag-api }} |
| `postmaster` | Нет | Да | Эти параметры можно задать только для кластера. | {{ tag-con }} {{ tag-cli }} {{ tag-tf }} {{ tag-api }} |

^*^ Любой пользователь может изменить такие настройки для своей сессии, однако после запуска сессии эти настройки уже не меняются. Новые значения, определенные на уровне кластера, будут применяться только к сессиям, запущенным после применения.

### Параметры, доступные пользователю для глобального управления

Ниже приведены параметры, которыми пользователь может управлять глобально на уровне кластера с помощью консоли управления, YC CLI, Terraform и API. Часть из этих параметров доступна также для локального управления на уровне сессии, пользователя или базы данных (зависит от контекста параметра).

#### gp_add_column_inherits_table_setting {#setting-gp-add-column-inherits-table-setting}

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст |
|-------------------|---------|--------------------------------|-----------------------|----------|
| 6.25 и выше | Boolean | `true` (`on`), `false` (`off`) | `false` (`off`) | `user` |

При добавлении столбца в оптимизированную для добавления данных колоночную таблицу (`append-optimized`)
С помощью команды `ALTER TABLE` этот параметр определяет, будут ли параметры сжатия данных таблицы для столбца (`compresstype`, `compresslevel` и `blocksize`) унаследованы от значений таблицы.

По умолчанию параметр отключен (`false`/`off`) — настройки сжатия данных таблицы не учитываются при добавлении столбца. Если значение параметра установлено как «включен» (`true`/`on`), то настройки сжатия данных таблицы учитываются.

При создании оптимизированной для добавления данных колоночной таблицы (`append-optimized`) можно задать параметры сжатия данных таблицы (`compresstype`, `compresslevel` и `blocksize`) в предложении `WITH`.
При добавлении столбца СУБД устанавливает каждый параметр сжатия данных на основе одного из следующих значений (в порядке приоритета):

1. Настройка сжатия данных, указанная в предложении `ENCODING` команды `ALTER TABLE`.
1. Если данный параметр конфигурации сервера установлен как включен (`true`/`on`) — настройка сжатия данных, указанная в предложении `WITH` при создании таблицы. В противном случае настройка сжатия данных таблицы игнорируется.
1. Настройка сжатия данных, указанная в параметре конфигурации сервера [gp_default_storage_options](#setting-gp-default-storage-options).
1. Настройка сжатия данных по умолчанию.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_add_column_inherits_table_setting).

#### gp_autostats_mode {#setting-gp-autostats-mode}

| Доступен в версии | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|-------------------------------------|-----------------------|----------|
| 6.25 и выше | `none`, `on_change`, `on_no_stats` | `on_no_stats` | `user` |

Указывает режим запуска автоматического сбора статистики с помощью `ANALYZE`.

Опция `on_no_stats` запускает сбор статистики для операций `CREATE TABLE AS SELECT`, `INSERT` или `COPY` в любых таблицах, для которых еще нет статистики.

Опция `on_change` запускает сбор статистики только в том случае, если количество затронутых строк превышает пороговое значение, определенное параметром [gp_autostats_on_change_threshold](#setting-gp-autostats-on-change-threshold).
Операции, которые могут запустить автоматический сбор статистики с `on_change`:

- `CREATE TABLE AS SELECT`;
- `UPDATE`;
- `DELETE`;
- `INSERT`;
- `COPY`.

{% note info %}

Для партиционированных таблиц автоматический сбор статистики не запускается, если данные вставляются из родительской таблицы верхнего уровня. Автоматический сбор статистики запускается, если данные вставляются напрямую в таблицу, где хранятся данные партиционированной таблицы (статистика собирается только для этой таблицы).

{% endnote %}

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_autostats_mode).

#### gp_autostats_on_change_threshold {#setting-gp-autostats-on-change-threshold}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|----------|
| 6.25 и выше | Integer | от 0 до 2147483647 | 2147483647 | `user` |

Указывает пороговое значение для автоматического сбора статистики, когда параметр [gp_autostats_mode](#setting-gp-autostats-mode) установлен в `on_change`. Если операция с таблицей затрагивает количество строк, превышающее это пороговое значение, выполняется `ANALYZE`, и для таблицы собирается статистика.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_autostats_on_change_threshold).

#### gp_cached_segworkers_threshold {#setting-gp-cached-segworkers-threshold}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|----------|
| 6.25 и выше | Integer | от 1 до 10 | 5 | `user` |

Когда пользователь начинает сессию работы с базой данных и отправляет запрос, система создает группы рабочих процессов (`gangs`) на каждом сегменте для выполнения работы. После завершения работы `worker`-процессы на сегментах уничтожаются, за исключением некоторого количества, которое сохраняется в кэше — оно задается этим параметром.

Более низкое значение параметра позволяет экономить системные ресурсы на хостах с сегментами, но более высокое значение может повысить производительность в сценариях, когда последовательно отправляется множество сложных запросов.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_cached_segworkers_threshold).

#### gp_enable_global_deadlock_detector {#setting-gp-enable-global-deadlock-detector}

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст     |
|-------------------|---------|--------------------------------|-----------------------|--------------|
| 6.25 и выше       | Boolean | `true` (`on`), `false` (`off`) | `true` (`on`)         | `postmaster` |

Включает или выключает глобальный детектор взаимных блокировок (`Global Deadlock Detector`), который используется для управления одновременными операциями `UPDATE` и `DELETE` в таблицах с кучей (`heap tables`) с целью повышения производительности.

Если глобальный детектор взаимных блокировок выключен, база данных выполняет одновременные операции обновления и удаления в таблице с кучей (`heap tables`) последовательно. Если глобальный детектор взаимных блокировок включен,
Одновременные обновления разрешены, и детектор определяет наличие взаимной блокировки и устраняет ее, отменяя один или несколько фоновых процессов, связанных с самыми «молодыми» транзакциями.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_enable_global_deadlock_detector).

#### gp_enable_zstd_memory_accounting {#setting-gp-enable-zstd-memory-accounting}

{% note info %}

Параметр, специфичный для сборки [open-gpdb](https://github.com/open-gpdb/gpdb).

{% endnote %}

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст |
|-------------------|---------|--------------------------------|-----------------------|----------|
| 6.28 и выше       | Boolean | `true` (`on`), `false` (`off`) | `true` (`on`)         | `user`   |

Параметр управляет функциональностью учета памяти `ZSTD`. Включение параметра (`true`/`on`) позволяет избегать выхода `ZSTD` за пределы памяти, доступной ресурсному менеджеру (группе или очереди), благодаря перемещению `ZSTD` в отдельный контекст памяти `zstd_context`. Это приводит к снижению вероятности неконтролируемого падения кластера из-за нехватки памяти.

#### gp_global_deadlock_detector_period {#setting-gp-global-deadlock-detector-period}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|----------|
| 6.25 и выше | Integer | от 5 до 2147483647 | 120 | `sighup` |

Указывает интервал выполнения (в секундах) фонового рабочего процесса глобального детектора взаимных блокировок (`Global Deadlock Detector`, см. параметр [gp_enable_global_deadlock_detector](#setting-gp-enable-global-deadlock-detector)).

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_global_deadlock_detector_period).

#### gp_max_plan_size {#setting-gp-max-plan-size}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|-------------|
| 6.25 и выше | Integer | от 0 до 2147483647 | 0 | `superuser` |

Определяет максимально допустимый суммарный несжатый размер плана выполнения запроса, умноженный на количество операторов `Motion` (слайсов, `slices`) в плане. Если размер плана запроса превышает указанное значение, запрос отменяется и возвращается ошибка. Значение 0 означает, что размер плана не отслеживается. Измеряется в байтах. Значение параметра должно быть кратно 1 МБ.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_max_plan_size).

#### gp_max_slices {#setting-gp-max-slices}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|----------|
| 6.25 и выше       | Integer | от 10 до 100        | 100                   | `user`   |

Указывает максимальное количество слайсов (`slices`), которые могут быть сгенерированы запросом. Если запрос генерирует больше слайсов, чем указано в параметре, база данных возвращает ошибку и не выполняет запрос.

Выполнение запроса, который генерирует большое количество слайсов, может повлиять на производительность базы данных. Например, запрос, содержащий операторы `UNION` или `UNION ALL` для нескольких сложных представлений,
может сгенерировать большое количество слайсов. Чтобы просмотреть статистику срезов для запроса, можно выполнить команду `EXPLAIN`.

{% note warning %}

Допустимые значения на уровне сервиса отличаются от допустимых значений самой СУБД. Это сделано для того, чтобы снизить вероятность неконтролируемого падения кластера из-за нехватки памяти (OOM), вызванной попыткой исполнения «неоптимального» запроса. Данное ограничение можно обойти, переопределив значение параметра на уровне сессии, пользователя или базы данных.

{% endnote %}

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_max_slices).

#### gp_resource_group_memory_limit {#setting-gp-resource-group-memory-limit}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|------|---------------------|-----------------------|--------------|
| 6.25 и выше | Real | от 0.1 до 0.8 | 0.8 | `postmaster` |

{% note info %}

Параметр конфигурации применяется только при активированном управлении ресурсами на основе ресурсных групп.

{% endnote %}

Определяет максимальный процент системных ресурсов памяти, который может быть выделен группам ресурсов на каждом узле сегмента базы данных. Уменьшение значения параметра может быть оправдано в тех случаях, когда нужно выделить больше ресурсов вспомогательным компонентам, находящимся на узле сегмента базы данных (например, `PXF`).

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_resource_group_memory_limit).

#### gp_vmem_protect_segworker_cache_limit {#setting-gp-vmem-protect-segworker-cache-limit}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|------|---------------------|-----------------------|--------------|
| 6.25 и выше       | Real | от 0 до 4096        | 500                   | `postmaster` |


Если процесс выполнения запроса потребляет больше заданного объема памяти, то после завершения этот процесс не будет помещаться в кэш для использования в последующих запросах. В системах с большим количеством подключений или простаивающих процессов можно уменьшить это значение, чтобы освободить больше памяти на сегментах. Измеряется в мегабайтах.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_vmem_protect_segworker_cache_limit).

#### gp_workfile_compression {#setting-gp-workfile-compression}

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст |
|-------------------|---------|--------------------------------|-----------------------|----------|
| 6.25 и выше | Boolean | `true` (`on`), `false` (`off`) | `false` (`off`) | `user` |


Указывает, будут ли сжиматься временные файлы, создаваемые при выгрузке на диск в ходе операций хеширования (агрегации или соединения). В некоторых случаях включение сжатия может помочь избежать перегрузки подсистемы дисков операциями ввода-вывода.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_workfile_compression).

{% include [requires-restart](../note-requires-restart.md) %}

#### gp_workfile_limit_files_per_query {#setting-gp-workfile-limit-files-per-query}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|----------|
| 6.25 и выше | Integer | от 0 до 100000 | 10000 | `user` |


Устанавливает максимальное количество временных рабочих файлов (`workfiles`), разрешенных для одного запроса на каждом сегменте. Рабочие файлы создаются при выполнении запроса, который требует больше памяти, чем выделено.
При превышении установленного лимита текущий запрос завершается. Значение 0 (ноль) обозначает неограниченное количество файлов выгрузки.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_workfile_limit_files_per_query).

#### gp_workfile_limit_per_query {#setting-gp-workfile-limit-per-query} 

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|-----------------------|-----------------------|----------|
| 6.25 и выше       | Integer | от 0 до 1099511627776 | 0                     | `user`   |


Устанавливает максимальный объем дискового пространства, который отдельный запрос может использовать для создания временных рабочих файлов (`workfiles`) на каждом сегменте. Значение 0 — отсутствие ограничения. Задается в байтах. Значение должно быть кратно 1 мегабайту.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_workfile_limit_per_query).

#### gp_workfile_limit_per_segment {#setting-gp-workfile-limit-per-segment}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|-----|----------------------|---------------|--------|
| 6.25 и выше | Integer | от 0 до размера диска на сегменте / 2 | Вычисляется динамически в зависимости от размера диска на сегменте | `postmaster` |


Устанавливает максимальный общий объем дискового пространства, который все выполняющиеся запросы могут использовать для создания временных рабочих файлов (`workfiles`) на каждом сегменте. Значение 0 означает отсутствие ограничения.

Значение по умолчанию [зависит от размера хранилища хостов-сегментов](#settings-instance-dependent) и рассчитывается по формуле:

```text
0.1 × <размер_хранилища_хоста-сегмента> / <количество_сегментов_на_хост>
```

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_workfile_limit_per_segment).

#### idle_in_transaction_session_timeout {#setting-idle-in-transaction-session-timeout}

{% note info %}

Параметр, специфичный для сборки [open-gpdb](https://github.com/open-gpdb/gpdb).

{% endnote %}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|--------------------|-----------------------|----------|
| 6.25 и выше       | Integer | от 0 до 2147483647 | 0                     | `user`   |

Завершает любую сессию, которая бездействует (то есть ожидает запроса от клиента) в рамках открытой транзакции дольше указанного промежутка времени. Измеряется в миллисекундах. Значение 0 отключает таймаут.

Этот параметр можно использовать, чтобы гарантировать, что бездействующие сессии не будут удерживать блокировки неоправданно долго. Даже если значимые блокировки не удерживаются, открытая транзакция препятствует удалению недавно устаревших кортежей, которые могут быть видны только в рамках этой транзакции, а также занимает место в ресурсных группах (параметр `concurrency` ресурсных групп).

#### lock_timeout {#setting-lock-timeout}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|----------|
| 6.25 и выше       | Integer | от 0 до 2147483647  | 0                     | `user`   |

Прерывает любой запрос, который ожидает получения блокировки на таблице, индексе, строке или другом объекте базы данных дольше указанного количества миллисекунд. Лимит времени применяется отдельно к каждой попытке получения блокировки. Ограничение распространяется как на явные запросы на блокировку (например, `LOCK TABLE` или `SELECT FOR UPDATE`), так и на блокировки, приобретаемые неявно.
Если параметр [log_min_error_statement](#setting-log-min-error-statement) установлен на `ERROR` или ниже, база данных записывает в журнал запрос, который не уложился в отведенное время. Значение 0 отключает мониторинг ожидания блокировок.

В отличие от [statement_timeout](#setting-statement-timeout), этот таймаут может возникнуть только во время ожидания блокировок. Обратите внимание: если [statement_timeout](#setting-statement-timeout) имеет ненулевое значение, устанавливать [lock_timeout](#setting-lock-timeout) таким же или большим бессмысленно, поскольку таймаут запроса всегда сработает раньше.

База данных использует параметры [deadlock_timeout](#setting-deadlock-timeout) и [gp_global_deadlock_detector_period](#setting-gp-global-deadlock-detector-period) для запуска локального и глобального обнаружения взаимных блокировок. Обратите внимание: если [lock_timeout](#setting-lock-timeout) включен и установлен на значение, меньшее, чем таймауты обнаружения взаимных блокировок, база данных прервет запрос до того, как в этой сессии будет запущена проверка на взаимную блокировку.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#lock_timeout).

#### log_connections {#setting-log-connections}

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст  |
|-------------------|---------|--------------------------------|-----------------------|-----------|
| 6.25 и выше | Boolean | `true` (`on`), `false` (`off`) | `false` (`off`) | `backend` |

Записывает в журнал сервера строку с подробной информацией о каждом успешном подключении. Некоторые клиентские программы, например `psql`, пытаются подключиться дважды, чтобы определить, требуется ли пароль, поэтому повторяющиеся сообщения «connection received» не всегда указывают на проблему.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_connections).

#### log_disconnections {#setting-log-disconnections}

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст  |
|-------------------|---------|--------------------------------|-----------------------|-----------|
| 6.25 и выше | Boolean | `true` (`on`), `false` (`off`) | `false` (`off`) | `backend` |

Записывает в журнал сервера строку при завершении сессии клиента, включая продолжительность сессии.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_disconnections).

#### log_error_verbosity {#setting-log-error-verbosity}

| Доступен в версии | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|-------------------------------|-----------------------|-------------|
| 6.25 и выше       | `terse`, `default`, `verbose` | `default`             | `superuser` |

Управляет уровнем детализации информации, записываемой в журнал сервера для каждого сообщения.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_error_verbosity).

#### log_hostname {#setting-log-hostname} 

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст |
|-------------------|---------|--------------------------------|-----------------------|----------|
| 6.25 и выше | Boolean | `true` (`on`), `false` (`off`) | `true` (`on`) | `sighup` |

По умолчанию в сообщениях журнала подключений отображается только IP-адрес подключающегося хоста. Включение этой опции приведет к тому, что в журнал будут записываться IP-адрес и имя подключающегося хоста в журнал мастера.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_hostname).

#### log_min_duration_statement {#setting-log-min-duration-statement}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|-------------|
| 6.25 и выше | Integer | от -1 до 2147483647 | -1 | `superuser` |

Записывает в журнал запрос и его продолжительность в одной строке, если продолжительность запроса больше или равна указанному количеству миллисекунд. Установка значения 0 приведет к записи всех запросов и их продолжительности.
Значение -1 отключает эту функцию. Например, если установить значение 250, то в журнал будут записываться все SQL-запросы, выполнение которых занимает 250 мс или дольше.

Включение этой опции может быть полезно для поиска неоптимизированных запросов в ваших приложениях.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_min_duration_statement).

#### log_min_messages {#setting-log-min-messages}

| Доступен в версии | Допустимые значения | Значение по умолчанию | Контекст |
| --- | --- | --- | --- |
| 6.25 и выше | `debug5`, `debug4`, `debug3`, `debug2`, `debug1`, `info`, `notice`, `warning`, `log`, `error`, `fatal`, `panic` | `warning` | `superuser` |

Управляет уровнями сообщений, которые записываются в журнал сервера. Каждый уровень включает в себя все последующие уровни. Чем позже указан уровень в списке, тем меньше сообщений будет отправлено в журнал.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_min_messages).

#### log_statement {#setting-log-statement}

| Доступен в версии | Допустимые значения | Значение по умолчанию | Контекст |
| --- | --- | --- | --- |
| 6.25 и выше | `none`, `ddl`, `mod`, `all` | `ddl` | `superuser` |

Управляет тем, какие SQL-запросы записываются в журнал. Уровень `ddl` регистрирует все команды определения данных, такие как `CREATE`, `ALTER` и `DROP`. Уровень `mod` регистрирует все операторы `DDL`, а также `INSERT`, `UPDATE`, `DELETE`, `TRUNCATE` и `COPY FROM`. Запросы `PREPARE` и `EXPLAIN ANALYZE` также записываются в журнал, если содержащийся в них оператор относится к соответствующему типу.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_statement).

#### log_statement_stats {#setting-log-statement-stat}

| Доступен в версии | Тип     | Допустимые значения            | Значение по умолчанию | Контекст    |
|-------------------|---------|--------------------------------|-----------------------|-------------|
| 6.25 и выше | Boolean | `true` (`on`), `false` (`off`) | `false` (`off`) | `superuser` |

Для каждого запроса записывать в журнал сервера общую статистику производительности парсера, планировщика и исполнителя запроса. Используется в качестве простого инструмента профилирования.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_statement_stats).

#### master_shared_buffers {#setting-master-shared-buffers}

{% note info %}

В самой СУБД есть только один параметр — `shared_buffers`. Со стороны сервиса есть разделение на `shared_buffers` для мастеров и сегментов. Настройка для сегментов в сервисе называется [segment_shared_buffers](#setting-segment-shared-buffers).

{% endnote %}

| Доступен в версии | Тип     | Допустимые значения                 | Значение по умолчанию | Контекст     |
|-------------------|---------|-------------------------------------|-----------------------|--------------|
| 6.25 и выше | Integer | от 1048576 до вычисляемого значения | 134217728 (128 МБ) | `postmaster` |

Задает объем памяти, который экземпляр мастера использует для буферов общей памяти. Значение этого параметра должно быть не меньше 1 МБ и не больше значения следующего выражения (в частности, зависит от [max_connections](#setting-max-connections)):

```text
max(0.24 × объем доступной памяти на мастере, 16384 × max_connections)
```

Измеряется в байтах.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#shared_buffers).

{% include [requires-restart](../note-requires-restart.md) %}

#### max_connections {#setting-max-connections}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|--------------|
| 6.25 и выше | Integer | от 50 до 1000 | 200 | `postmaster` |


Максимальное количество одновременных подключений к кластеру базы данных. При увеличении этого параметра необходимо также увеличить значение [max_prepared_transactions](#setting-max-prepared-transactions). Увеличение этого параметра может привести к тому, что база данных запросит больший объем общей памяти (см. [master_shared_buffers](#setting-master-shared-buffers) и [segment_shared_buffers](#setting-segment-shared-buffers)).

Для сегментов значение параметра `max_connections` вычисляется автоматически по формуле:
```
5 × max_connections (для мастера)
```

При изменении настройки проводится проверка, что объем доступной оперативной памяти на одно подключение (как на мастере, так и на сегменте) будет составлять не меньше 20 МБ. Если это условие не выполняется, возникает [ошибка](../../../managed-greenplum/qa/cluster-hosts.md#memory-limit).

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#max_connections).

#### max_locks_per_transaction {#setting-max-locks-per-transaction}

| Доступен в версии | Тип | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|--------------|
| 6.25 и выше       | Integer | от 128 до 2048      | 128                   | `postmaster` |

Таблица общих блокировок создается с возможностью описать блокировки для [max_locks_per_transaction](#setting-max-locks-per-transaction) × ([max_connections](#setting-max-connections) + [max_prepared_transactions](#setting-max-prepared-transactions)) объектов, поэтому одновременно может быть заблокировано не более этого количества различных объектов. Это не жесткое ограничение на число блокировок, устанавливаемых одной транзакцией, а скорее максимально среднее значение. Возможно, вам потребуется увеличить это значение, если у вас есть клиенты, которые обращаются к множеству различных таблиц в рамках одной транзакции.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#max_locks_per_transaction).

#### max_prepared_transactions {#setting-max-prepared-transactions}

| Доступен в версии | Тип     | Допустимые значения | Значение по умолчанию | Контекст     |
|-------------------|---------|---------------------|-----------------------|--------------|
| 6.25 и выше       | Integer | от 50 до 10000      | 200                   | `postmaster` |

Устанавливает максимальное количество транзакций, которые могут находиться в подготовленном состоянии одновременно. База данных использует подготовленные транзакции внутренне для обеспечения целостности данных на сегментах. Это значение должно быть не меньше значения [max_connections](#setting-max-connections) на мастере.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#max_prepared_transactions).

#### max_slot_wal_keep_size {#setting-max-slot-wal-keep-size}

| Доступен в версии | Тип     | Допустимые значения  | Значение по умолчанию | Контекст |
|-------------------|---------|----------------------|-----------------------|----------|
| 6.25 и выше       | Integer | от 0 до 214748364800 | Вычисляется           | `sighup` |

Устанавливает максимальный размер в байтах файлов упреждающей записи (`WAL`) на диске для каждого экземпляра сегмента, который может быть зарезервирован, когда база данных передает данные на экземпляр зеркального сегмента или резервный мастер для поддержания синхронизации с соответствующим основным экземпляром сегмента или мастером.

Если размер файлов превысит установленный максимальный, они будут освобождены и станут доступны для удаления. В результате зеркало или резервный экземпляр могут потерять возможность продолжать репликацию из-за удаления необходимых файлов WAL.

Если для действующих основных экземпляров установлено нестандартное значение параметра [max_slot_wal_keep_size](#setting-max-slot-wal-keep-size), полное и инкрементное восстановление их зеркал может оказаться невозможным. В зависимости от нагрузки на основной экземпляр, которая действует одновременно с полным восстановлением, процесс восстановления может завершиться ошибкой из-за отсутствия файлов WAL.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#max_slot_wal_keep_size).

#### max_statement_mem {#setting-max-statement-mem}

| Доступен в версии | Тип     | Допустимые значения           | Значение по умолчанию | Контекст    |
|-------------------|---------|-------------------------------|-----------------------|-------------|
| 6.25 и выше       | Integer | от 134217728 до 1099511627776 | 2097152000 (2000 МБ)  | `superuser` |

Устанавливает максимальный лимит памяти для запроса. Помогает избежать ошибок нехватки памяти на хосте сегмента во время обработки запроса из-за слишком высокого значения параметра [statement_mem](#setting-statement-mem).

При изменении параметров [max_statement_mem](#setting-max-statement-mem) и [statement_mem](#setting-statement-mem) сначала необходимо изменить [max_statement_mem](#setting-max-statement-mem).

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#max_statement_mem).

#### runaway_detector_activation_percent {#setting-runaway-detector-activation-percent}

| Доступен в версии | Тип     | Допустимые значения | Значение по умолчанию | Контекст     |
|-------------------|---------|---------------------|-----------------------|--------------|
| 6.25 и выше       | Integer | от 0 до 100         | 90                    | `postmaster` |

Для запросов, которые управляются очередями ресурсов или ресурсными группами, этот параметр определяет, когда база данных завершает выполняющиеся запросы на основе объема используемой ими памяти. Значение 100 отключает автоматическое завершение запросов на основе процента используемой памяти. Может быть активна либо схема управления очередями ресурсов, либо схема управления ресурсными группами; обе схемы не могут быть активны одновременно.

Параметр конфигурации сервера [gp_resource_manager](#setting-gp-resource-manager) определяет, какая схема активна. Когда очереди ресурсов включены — этот параметр устанавливает процент использования памяти `vmem`, при превышении которого запросы завершаются. Если процент использования памяти `vmem` для сегмента превышает указанное значение, база данных начинает завершать запросы, управляемые очередями ресурсов, исходя из потребления памяти, начиная с запроса, который использует наибольший ее объем. Запросы завершаются до тех пор, пока процент использования `vmem` не станет ниже указанного значения.

Например, если объем памяти `vmem` установлен на 10 ГБ, а значение этого параметра — 90 (90 %), база данных начнет завершать запросы, когда используемый объем памяти `vmem` превысит 9 ГБ. Когда включены ресурсные группы — этот параметр устанавливает процент использования общей глобальной памяти ресурсных групп. При превышении это процента завершаются запросы, управляемые ресурсными группами, для которых настроен аудитор памяти `vmtracker`, например `admin_group` и `default_group`. У ресурсных групп есть общий глобальный пул памяти, если сумма значений атрибута `MEMORY_LIMIT`, настроенных для всех групп ресурсов, меньше 100%. Например, если у вас есть три ресурсных группы со значениями `memory_limit` 10, 20 и 30%, то общая глобальная память составит 40% = 100% − (10% + 20% + 30%).

Если процент использования общей глобальной памяти превысит указанное значение, база данных начнет завершать запросы на основе использования памяти, выбирая из запросов, управляемых группами ресурсов с аудитором памяти `vmtracker`. Система начнет с запроса, который потребляет наибольший объем памяти. Запросы будут завершаться до тех пор, пока процент использования общей глобальной памяти не станет ниже указанного значения. Например, если объем общей глобальной памяти составляет 10 ГБ, а значение параметра — 90 (90%), база данных начнет завершать запросы, когда используемый объем общей глобальной памяти превысит 9 ГБ.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#runaway_detector_activation_percent).

#### segment_shared_buffers

{% note info %}

В самой СУБД есть только один параметр – `shared_buffers`. Со стороны сервиса есть разделение на `shared_buffers` для мастеров и сегментов. Настройка для мастеров в сервисе называется [master_shared_buffers](#setting-master-shared-buffers).

{% endnote %}

| Доступен в версии | Тип     | Допустимые значения                 | Значение по умолчанию | Контекст     |
|-------------------|---------|-------------------------------------|-----------------------|--------------|
| 6.25 и выше       | Integer | от 1048576 до вычисляемого значения | 134217728 (128 МБ)    | `postmaster` |


Задает объем памяти, который экземпляр сегмента использует для буферов общей памяти. Значение этого параметра должно быть не менее 1 МБ и не менее более значения следующего выражения (в частности зависит от [max_connections](#setting-max-connections):

```
max(0.2 × объем доступной памяти на сегменте / количество сегментов на хосте), 16384 × 5 × max_connections)
```

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#shared_buffers).

{% include [requires-restart](../note-requires-restart.md) %}


### Параметры доступные пользователю для локального управления {#setting-gp-loca}

В данной секции собраны параметры, которыми пользователь может управлять **только** на уровне сессии, пользователя или базы данных. Этими параметрами **невозможно** управлять на уровне консоли управления, YC CLI, Terraform или API.

#### gp_default_storage_options {#setting-gp-default-storage-options}

| Доступен в версии | Допустимые значения | Значение по умолчанию                                                                    | Контекст |
| --- | --- |------------------------------------------------------------------------------------------| --- |
| 6.25 и выше | `appendoptimized`: `true`, `false`; `blocksize`: [8192; 2097152]; `checksum`: `true`, `false`; `compresstype`: `zlib`, `zstd`, `quicklz`, `rle_type`, `none`; `compresslevel`: [0; 19]; `orientation`: `row`, `column`. | `appendonly=false, blocksize=32768`, `checksum=true, compresstype=none`, `orientation=row` | `user` |

Устанавливает значения по умолчанию для следующих параметров хранения таблиц при создании таблицы с помощью команды `CREATE TABLE`:

* `appendoptimized` — используется синтаксис `appendoptimized=value` для указания типа хранения таблицы, оптимизированного для добавления данных;
   Параметр `appendoptimized` — это сокращенное обозначение устаревшего параметра хранения `appendonly`. База данных сохраняет в каталоге значение `appendonly` и отображает его при перечислении параметров хранения для таблиц, оптимизированных для добавления данных.
* `blocksize`;
* `checksum`;
* `compresstype`;
* `compresslevel`;
* `orientation`.

Несколько значений параметров хранения указываются в виде списка, разделенного запятыми. Можно установить параметры хранения с помощью этого параметра, вместо того чтобы указывать их в предложении `WITH` команды `CREATE TABLE`. Параметры хранения, указанные в команде `CREATE TABLE`, переопределяют значения, заданные этим параметром.

Не все комбинации значений параметров хранения допустимы. Если указанные параметры хранения недопустимы, возвращается ошибка. Информацию о параметрах хранения таблиц можно найти в описании команды `CREATE TABLE`.

Значения по умолчанию можно установить для базы данных и пользователя. Если параметр конфигурации сервера задан на разных уровнях, то порядок приоритета значений параметров для хранения таблицы при входе пользователя в базу данных и создании таблицы следующий (от наивысшего к наименьшему):

1. Значения, указанные в команде `CREATE TABLE` с предложением `WITH` или `ENCODING`.
1. Значение [gp_default_storage_options](#setting-gp-default-storage-options), установленное для пользователя с помощью команды `ALTER ROLE...SET`.
1. Значение [gp_default_storage_options](#setting-gp-default-storage-options), установленное для базы данных с помощью команды `ALTER DATABASE...SET`.
1. Значение [gp_default_storage_options](#setting-gp-default-storage-options), установленное для кластера целиком (значение по умолчанию).

Значение параметра не накапливается. Например, если параметр задает опции `appendoptimized` и `compresstype` для базы данных, а пользователь устанавливает параметр для указания значения опции `orientation`, значения `appendoptimized` и `compresstype`, заданные на уровне базы данных, игнорируются.

В этом примере команда `ALTER DATABASE` задает параметры хранения таблицы по умолчанию `orientation` и `compresstype` для базы данных `mytest`:

```sql
ALTER DATABASE mytest SET gp_default_storage_options = 'orientation=column, compresstype=rle_type'
```

Чтобы создать в базе данных `mytest` таблицу, оптимизированную для добавления данных, с колоночным форматом и сжатием `RLE`, пользователю достаточно указать в предложении `WITH` только `appendoptimized=TRUE`.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_default_storage_options).

#### statement_mem {#setting-statement-mem}

| Доступен в версии | Тип     | Допустимые значения   | Значение по умолчанию | Контекст |
|-------------------|---------|-----------------------|-----------------------|----------|
| 6.25 и выше       | Integer | от 1000 до 2147483647 | 128000 (125 МБ)       | `user`   |

Выделяет память хоста сегмента на каждый запрос. Объем памяти, выделяемый с помощью этого параметра, не может превышать значение [max_statement_mem](#setting-max-statement-mem) или лимит памяти очереди ресурсов либо ресурсных групп, через которые был отправлен запрос. Если для запроса требуется дополнительный объем памяти, используются временные файлы выгрузки на диске.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#statement_mem).

#### statement_timeout {#setting-statement-timeout}

| Доступен в версии | Тип     | Допустимые значения | Значение по умолчанию | Контекст |
|-------------------|---------|---------------------|-----------------------|----------|
| 6.25 и выше       | Integer | от 0 до 2147483647  | 0                     | `user`   |

Прерывает любой запрос, выполнение которого занимает больше указанного количества миллисекунд. Значение 0 отключает ограничение.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#statement_timeout).

### Параметры недоступные пользователю {#setting-gp-unavailable}

В данной секции собраны параметры недоступные пользователю для управления, но на которые ссылаются другие параметры данной документации.

#### deadlock_timeout {#setting-deadlock-timeout}

| Доступен в версии | Тип     | Допустимые значения | Значение по умолчанию | Контекст    |
|-------------------|---------|--------------------|-----------------------|-------------|
| 6.25 и выше       | Integer | от 1 до 214748364  | 1000                  | `superuser` |

Время ожидания блокировки перед проверкой наличия взаимной блокировки. На сильно загруженном сервере может потребоваться увеличить это значение. В идеале настройка должна превышать типичное время транзакции, чтобы повысить вероятность того, что блокировка будет снята до того, как ожидающий процесс решит проверить наличие взаимной блокировки.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#deadlock_timeout).

#### log_min_error_statement {#setting-log-min-error-statement}

| Доступен в версии | Допустимые значения | Значение по умолчанию | Контекст |
| --- | --- | --- | --- |
| 6.25 и выше | `debug5`, `debug4`, `debug3`, `debug2`, `debug1`, `info`, `notice`, `warning`, `error`, `fatal`, `panic` | `error` | `superuser` |


Управляет тем, будет ли SQL-запрос, который приводит к ошибке, записываться в журнал сервера. В журнал записываются все SQL-запросы, которые вызывают ошибку указанного уровня или выше. Чтобы фактически отключить логирование неудачных запросов, установите для этого параметра значение `panic`.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#log_min_error_statement).

#### gp_resource_manager {#setting-gp-resource-manager}

| Доступен в версии | Допустимые значения | Значение по умолчанию | Контекст |
| --- | --- | --- | --- |
| 6.25 и выше | `group`, `queue` | `group` | `postmaster` |

Указывает схему управления ресурсами, которая в настоящее время активирована в кластере. По умолчанию используется схема с ресурсными группами.

Подробнее см. в [документации {{ GP }}]({{ gp.docs.broadcom }}/6/greenplum-database/ref_guide-config_params-guc-list.html#gp_resource_manager).
