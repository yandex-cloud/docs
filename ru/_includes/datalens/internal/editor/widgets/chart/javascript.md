## JavaScript {#javascript}

### Общая информация {#common-javascript}

В результате выполнения вкладки JavaScript должны быть экпортированы данные для отрисовки графика.

### Доступные методы {#available-methods-javascript}

* **`ChartEditor.getParams()`** - возвращает объект с нормализованными параметрами.

* **`ChartEditor.getLoadedData()`** - возвращает объект с данными, запрошенными на вкладке Urls.

* **`ChartEditor.updateConfig(config)`** - доопределяет результат вкладки [Config](#config) аргументом `config`.

* **`ChartEditor.updateHighchartsConfig(config)`** - доопределяет результат вкладки [Highcharts](#highcharts) аргументом `config`.

### Форматы данных {#data-formats-javascript}

#### Временной ряд {#time-row-javascript}

Если по оси X **время**, то доступен один из следующих форматов данных:

* `[x, y]`:
  ```js
  // массив рядов (линий, колонок, областей и т.д.)
  module.exports = [
      // описание ряда
      {
          // идентификатор
          id: 'identifier',
          // заголовок
          title: 'Заголовок',
          // точки в порядке возрастания X
          data: [
              // [x, y]
              [1514764800000, 1],
              [1514851200000, 2],
              [1514937600000, 3]
          ]
      }
  ];
  ```
  **Примечание**: на вкладке Highcharts должно быть указано:
  ```js
  module.exports = {
      xAxis: {
          type: 'datetime'
      }
  };
  ```

* `{x: ..., y: ...}`:
  ```js
  // массив рядов (линий, колонок, областей и т.д.)
  module.exports = [
      // описание ряда
      {
          // идентификатор
          id: 'identifier',
          // заголовок
          title: 'Заголовок',
          // точки в порядке возрастания X
          data: [
              {x: 1514764800000, y: 1},
              {x: 1514851200000, y: 2},
              {x: 1514937600000, y: 3}
          ]
      }
  ];
  ```
  **Примечание**: на вкладке Highcharts должно быть указано:
  ```js
  module.exports = {
      xAxis: {
          type: 'datetime'
      }
  };
  ```

* `graphs/categories_ms`:
  ```js
  module.exports = {
      // массив рядов (линий, колонок, областей и т.д.)
      graphs: [
          // описание ряда
          {
              // идентификатор
              id: 'identifier',
              // заголовок
              title: 'Заголовок',
              // массив данных
              // каждое значение по индексу соответствует временной метке
              // если на какую-либо временную метку значения нет, то в данных по этому индексу должно быть null
              data: [1, 2, 3]
          }
      ],
      // массив временных меток в порядке возрастания
      categories_ms: [1514764800000, 1514851200000, 1514937600000]
  };
  ```

#### Категорийный ряд {#category-row-javascript}

Если по оси X **текстовые метки**, то доступен один из следующих форматов данных:

* `[x, y]`:
  ```js
  // массив рядов (линий, колонок, областей и т.д.)
  module.exports = [
      // описание ряда
      {
          // идентификатор
          id: 'identifier',
          // заголовок
          title: 'Заголовок',
          // точки
          data: [
              // [x, y]
              ['Затраты', 1],
              ['Доход', 2],
              ['Прибыль', 3]
          ]
      }
  ];
  ```
  **Примечание**: на вкладке Highcharts должно быть указано:
  ```js
  module.exports = {
      xAxis: {
          type: 'category'
      }
  };
  ```

* `graphs/categories`:
  ```js
  module.exports = {
      // массив рядов (линий, колонок, областей и т.д.)
      graphs: [
          // описание ряда
          {
              // идентификатор
              id: 'identifier',
              // заголовок
              title: 'Заголовок',
              // точки
              data: [1, 2, 3]
          }
      ],
      // массив текстовых меток
      categories: ['Затраты', 'Доход', 'Прибыль']
  };
  ```

#### Другое {#other-javascript}

Для других типов графиков доступен следующий формат данных:

```js
// массив рядов (линий, колонок, областей и т.д.)
module.exports = [
    // описание ряда
    {
        // тип
        type: 'pie',
        // идентификатор
        id: 'identifier',
        // заголовок
        title: 'Заголовок',
        // точки
        // в формате массива значений
        data: [100, 100],
        // в формате массива объектов
        /*
        data: [
            {
                name: 'First half',
                y: 100
            },
            {
                name: 'Second half',
                y: 100
            }
        ]
        */
    }
];
```

#### Описание ряда {#description-row-javascript}

Описание ряда можно расширить дополнительными свойствами:

```js
{
    // тип (по умолчанию: 'line')
    type: 'pie',
    // идентификатор
    id: 'identifier',
    // заголовок
    title: 'Заголовок',
    // цвет линии
    color: '#ffeba0',
    // включить/исключить ряд из суммы
    useInSum: true,
    // точность
    precision: 3
    // видимость линии на графике
    visible: false,
    // точки
    data: ...
}
```

Полный список дополнительных свойств (для соответствующего `type`) можно найти в [документации](https://api.highcharts.com/highcharts/series).

#### Статичные комментарии {#static-comments-javascript}

График с **временным рядом** можно дополнить статичными комментариями.

```js
module.exports = {
    graphs: ...
    categories_ms: ...,
    // массив комментариев
    comments: [
        {
            // тип комментария: область
            type: 'band-x',
            // начала интервала в миллисекундах
            from: 1514764800000,
            // конец интервала в миллисекундах
            to: 1514851200000,
            // временная метка (если область на одну точку)
            // x: 1514937600000,
            // текст
            text: 'область из editor',
            // цвет
            color: '#f9e79f',
            // показывать ли в полную высоту графика
            visible: true,
        },
        {
            // тип комментария: флаг
            type: 'flag-x',
            // временная метка
            x: 1514764800000,
            // цвет
            color: '#840f3a',
            // текст
            text: 'флаг из editor',
            // форма
            shape: 'flag',
            // высота (указыват отрицательное значение, чтобы поднять выше)
            y: -60
        },
        {
            // тип комментария: линия
            type: 'line-x',
            // временная метка
            x: 1514851200000,
            // стиль начертания
            dashStyle: 'dash',
            // текст
            text: 'линия из editor',
            // цвет
            color: 'red',
            // ширина
            width: 1
        },
        {
            // тип комментария: точка
            type: 'dot-x-y',
            // временная метка
            x: 1514937600000,
            // id ряда
            graphId: 'all-id-and-fname',
            // цвет фона тултипа
            fillColor: '#32426d',
            // цвет текста тултипа
            textColor: '#ffff7f',
            // цвет точки
            color: 'black',
            // текст
            text: 'точка из editor',
            // показывать ли тултип
            visible: true,
        }
    ]
};
```
