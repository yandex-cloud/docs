# Подключение услуги {{ cloud-interconnect-full-name }}

* [Точки присутствия](#pops)
  * [M9. Заказ оптической кроссировки](#m9)
  * [NORD. Заказ оптической кроссировки](#nord)
  * [OST. Заказ оптической кроссировки](#ost)
  * [STD. Заказ оптической кроссировки](#std)
* [Тип трансивера](#trans)
* [Скорость подключения и желаемый пакет трафика](#speed)
* [Настройки физического порта](#phy-cfg)
* [Настройки приватного подключения](#priv-cfg)
* [Параметры для {{ cloud-interconnect-name }} подключения](#yci-params)
  * [cloud_id](#cloud_id)
  * [folder_id](#folder_id)
  * [vlan_id](#vlan_id)
  * [BGP-peering](#bgp)
    * [IPv4 подсеть для BGP-peering](#p2p-subnet)
    * [IPv4 адрес на стороне {{ yandex-cloud }}](#p2p-yc)
    * [IPv4 адрес на стороне клиента](#p2p-client)
    * [BGP ASN](#bgp-asn)
    * [BGP MD5 password](#bgp-md5)
* [Подключение облачных сетей к приватному соединению {{ cloud-interconnect-name }}](#vpc-nets)
  * [network_id](#vpc-net-id)
  * [Список анонсируемых префиксов](#vpc-subnets)
* [Пример заполнения параметров подключения {{ cloud-interconnect-name }}](#yci-form)

## Точки присутствия {#points-of-presence}

Выберите одну или несколько *точек присутствия* (point of presence, POP) куда вы хотите организовать [магистральное подключение](../operations/interconnect-how-to.md). Рекомендуем выбрать хотя бы две точки — это позволит обеспечить географическую отказоустойчивость и резервирование услуги. Каждая из точек присутствия позволяет вам получать доступ к вашим облачным ресурсам в любой из [зон доступности](../../overview/concepts/geo-scope.md) {{ yandex-cloud }}.

Точки присутствия и их обозначения:

* ММТС-9, г. Москва, ул. Бутлерова, д. 7. — `M9`.
* Dataline NORD, г. Москва, Коровинское шоссе, д. 41. — `NORD`.
* Dataline OST, г. Москва, ул. Боровая, д. 7, стр. 10. — `OST`.
* StoreData, г. Москва, ул. Нижегородская, д. 32, стр. А. — `STD`.

В каждой из точек присутствия есть свой процесс по заказу оптической кроссировки:

{% cut "M9" %}

1. Заполните согласительное письмо информацией о стойке с вашим оборудованием. Отправьте письмо вашему менеджеру или архитектору в {{ yandex-cloud }}.

  [Пример заполненного согласительного письма](YandexCloudInterconnect-письмо-M9.docx)

2. В ответ мы пришлем подписанное согласительное письмо с номером порта на стороне {{ yandex-cloud }}.

3. Перешлите подписанноен письмо по адресу `sekretar@mmts9.ru` c темой `Согласительное письмо от <Название вашей компании> — {{ yandex-cloud }}`.

4. Закажите кроссировку у вашего оператора связи, передав ему подписанное согласительное письмо либо самостоятельно закажите кроссировку у `M9`, приложив согласительное письмо.

5. После этого оператор и/или сотрудники площадки `M9` смогут начать прокладку кроссировки и ее подключение к выделенному порту в оборудовании {{ yandex-cloud }}.

{% endcut %}

{% cut "NORD" %}

1. Заполните согласительное письмо информацией о стойке с вашим оборудованием. Отправьте письмо вашему менеджеру или архитектору в {{ yandex-cloud }}.

  [Пример заполненного согласительного письма](YandexCloudInterconnect-письмо-NORD.docx)

2. В ответ мы пришлем подписанное согласительное письмо с номером порта на стороне {{ yandex-cloud }}.

3. Закажите кроссировку у вашего оператора связи передав ему подписанное согласительное письмо либо самостоятельно закажите кроссировку у `Dataline Nord` приложив согласительное письмо.

5. После этого оператор и/или сотрудники площадки `Dataline Nord` смогут начать прокладку кроссировки и ее подключение к выделенному порту в оборудовании {{ yandex-cloud }}.

{% endcut %}

{% cut "OST" %}

1. Заполните согласительное письмо информацией о вашей стойке и отправьте вашему менеджеру или архитектору в {{ yandex-cloud }}.
Пример заполненного согласительного письма `YandexCloudInterconnect-письмо-OST.docx` прилагается.

2. В ответ мы пришлем подписанное согласительное письмо с номером порта на стороне {{ yandex-cloud }}.

3. Закажите кроссировку у вашего оператора связи передав ему подписанное согласительное письмо либо самостоятельно закажите кроссировку у `Dataline Ost` приложив согласительное письмо.

4. После этого оператор и/или сотрудники площадки `Dataline OST` смогут начать прокладку кроссировки и ее подключение в выделенный порт в оборудовании {{ yandex-cloud }}.

{% endcut %}

{% cut "STD" %}

1. Получите от вашего менеджера или архитектора номер порта и координаты стойки {{ yandex-cloud }}

2. Сообщите данную информацию вашему оператору и/или самостоятельно закажите кроссировку силами `StoreData` до выделенного порта.

3. После этого оператор и/или сотрудники площадки `StoreData` смогут начать прокладку кроссировки и ее подключение в выделенный порт в оборудовании {{ yandex-cloud }}.

{% note warning %}

Согласительное письмо для площадки `STD` не требуется. Взаимодействие между оператором, прокладывающим оптический кросс, и {{ yandex-cloud }} ведется через [личный кабинет](https://my.storedata.ru/customer.pl?Lang=ru)

{% endnote %}

{% endcut %}

## Тип трансивера {points-of-presence}

Определившись с точкой присутствия, выберите [Тип трансивера](https://cloud.yandex.ru/docs/interconnect/concepts/#trunk-link) для стыка с оборудованием {{ yandex-cloud }}. Учитывайте возможности вашего оборудования, желаемую пиковую канальную скорость, а также расстояние между вашим оборудованием и точкой присутствия.

## Скорость подключения и желаемый пакет трафика {#bandwidth}

Напишите в [техническую поддержку](https://concole.cloud.yandex.ru/support) или вашему менеджеру о желании подключить услугу {{ cloud-interconnect-name }} самостоятельно. Сообщите о выбранных [точках присутствия](#points-of-presence) и типах трансиверов, а также о **желаемом пакете трафика**.

Желаемый пакет трафика — это единица тарификации сервиса {{ cloud-interconnect-name }}, которая равна объему трафика, передаваемому с указанной скоростью в течение месяца. 

> Например, если вы выбрали скорость `100 Мбит/с`, то ваш пакет трафика составит: `30 ТБ`. Это объем, который можно передать за месяц при 100% утилизации канала с пропускной способностью 100 Мбит/c.

## Настройки физического порта {#physical-port-config}

На вашем оборудовании должны быть выполнены следующие настройки:

* Скорость передачи на порту оборудования клиента должна быть выставлена вручную в соответствии с типом трансивера. Автосогласование не поддерживается.
* Порт должен работать в магистральном режиме (`trunk port`).
* Все фреймы должны иметь теги по стандарту IEEE 802.1Q с идентификатором VLAN (VID) от `1` до `4060`. Native VLAN не поддерживается.
* EtherType — `0x8100`.
* Для передачи Jumbo Frames допускается выставить размер `MTU` 8910 байт.

В рамках одной точки присутствия можно использовать:

* Методы агрегации каналов с помощью [протокола LACP](https://en.wikipedia.org/wiki/Link_aggregation#Link_Aggregation_Control_Protocol) в режиме `Active`.
* Стекирование коммутаторов на стороне клиента при условии, что коммутаторы будут объединены в единое логическое устройство (стек).

## Настройки приватного подключения {{ cloud-interconnect-name }} {#private-connection-config}

Настройука [приватного подключения](../concepts.md#private-connection) происходит в два этапа:

1. Настройка физического порта и BGP-сессии для взаимодействия клиентского устройства и пограничного маршрутизатора {{ yandex-cloud }}.
2. Настройка виртуальных сетей и BGP-анонсов IPv4-префиксов, которые анонсируются в рамках BGP-сессии как со стороны пограничного маршрутизатора {{ yandex-cloud }}, так и со стороны клиентского устройства.

{% note warning %}

Несколько облачных сетей в рамках одного приватного подключения могут располагаться в разных облаках. Так можно в рамках одного приватного подключения обеспечить сетевое взаимодействие с несколькими облаками и сетями в них.

{% endnote %}

## Параметры для подключения {{ cloud-interconnect-name }} {#interconnect-params}

Для настройки физического порта сообщите вашему менеджеру или архитектору следующую информацию:

* `cloud_id` — идентификатор вашего облака, куда следует подключить услугу {{ cloud-interconnect-name }}.
* `folder_id` — идентификатор каталога, куда будут экспортироваться [метрики](../concepts/user-metrics.md) услуги {{ cloud-interconnect-name }}.
* `vlan_id` — идентификатор VLAN для приватного подключения. Допустимы любые значения `1` до `4000`. Вы можете выбрать любой удобный номер. Порт должен быть настроен в режиме `802.1q trunk с тегированием VLAN`. VLAN-тег используется для идентификации логического приватного соединения в рамках отдельного физического порта {{ cloud-interconnect-name }}. 
* IPv4-подсеть для BGP-пиринга. Выберите IPv4-подсеть из диапазонов, определенных в [RFC 1918](https://datatracker.ietf.org/doc/html/rfc1918), для организации BGP-взаимодействия между клиентским устройством и пограничным маршрутизатором {{ yandex-cloud }}. Подсеть может быть размером `/30 или /31`. Один из адресов этой подсети будет назначен пограничному маршрутизатору {{ yandex-cloud }}, а другой адрес — клиентскому устройству. Эти адреса будут использованы для установления BGP сессии между устройствами.
* IPv4-адрес на стороне {{ yandex-cloud }} — IPv4-адрес из подсети для BGP-пиринга на стороне маршрутизатора {{ yandex-cloud }}.
* IPv4-адрес на стороне клиента — IPv4-адрес из подсети для BGP-пиринга на стороне клиентского устройства.
* BGP ASN — при настройке BGP-взаимодействия на клиентском маршрутизаторе в качестве номера автономной системы удаленного соседа (BGP ASN) используйте значение BGP ASN {{ yandex-cloud }} — `200350`. В качестве BGP ASN со стороны клиентского оборудования можно использовать свой публичный BGP ASN (при наличии) или взять любой удобный для вас номер из диапазона приватных BGP ASN номеров (`64512 – 65534`) и настроить его как свой собственный на вашем маршрутизаторе.
* (опционально) BGP MD5 password — используется для повышения уровня защиты BGP-соединения. Вы можете настроить MD5-авторизацию для BGP-сессии с использованием пароля. Рекомендуем использовать сложную случайную строку из 20 и более символов латинскими буквами, цифрами и специальными символами.

## Подключение облачных сетей к приватному соединению {{ cloud-interconnect-name }} {#vpc-networks}

Чтобы подключить одну или несколько сетей к приватному подключению укажите следующую информацию:

* `network_id` — идентификтор виртуальной сети, которую нужно подключить к {{ cloud-interconnect-name }}. Идентификатор сети можно увидеть в консоли управления управления в разделе `Сети` сервиса {{ vpc-name }} или с помощью YC CLI команды `yc vpc network list`.
* Список анонсируемых IPv4-префиксов с указанием зоны доступности. Укажите префиксы, которые нужно анонсировать из указанной сети в сторону вашей инфраструктуры. Обычно префиксы соответствуют подсетям, настроенным в вашем облаке. В таком случае анонсируемые IPv4-префиксы и фактические диапазоны адресов подсети совпадают. 

  Если вы добавите новую подсеть, вам нужно будет обратиться в поддержку с запросом добавить новый анонс для новой подсети в ваше приватное подключение в сервисе {{ cloud-interconnect-name }}. Новые подсети не анонсируются автоматически.

  {% note warning %}

  Адреса внутренних балансировщиков нагрузки анонсируются в виде `/32 хостовых маршрутов`!

  {% endnote %}

  Также можно анонсировать `агрегированные префиксы` — это позволит вам настроить приватное подключение {{ cloud-interconnect-name }} один раз и в дальнейшем добавлять новые подсети в уже существующую сеть автоматически, без обращения в поддержку.

  > Например, при организации приватного подключения вы запросили анонс агрегированных IPv4-префиксов вида:
  >
  > ```
  > ru-central1-a [10.128.0.0/16] 
  > ru-central1-b [10.130.0.0/16] 
  > ru-central1-c [10.140.0.0/16]
  > ```
  >
  > Если позже вы создадите в данной сети в зоне `ru-central1-a` подсеть с префиксом `10.128.15.0/24`, она автоматически будет доступна через {{ cloud-interconnect-name }}, поскольку подсеть `10.128.15.0/24` принадлежит адресному пространству `10.128.0.0/16`, анонс для которой уже был сделан ранее.

## Пример заполнения параметров подключения {{ cloud-interconnect-name }} (YAML) {#yaml-example}

```yml
cloud:
  cloud_id: b1govnk5dup28depow2
  folder_id: b1abh3jf302qederrdap
#
pops:
  # POP-1 == M9
  M9: 
    phy: # L1/L2 параметры
      transceiver_type: SFP-1GBASE-LX
      client_speed: 100Mb
      vlan_id: 750
      # номер кроссировки и прочие детали коммутации на площадке M9
      cross_notes: 1825 1/08/15 <==> 04/15/02
    #
    bgp: # L3 и BGP-peering параметры
      bgp_peering_net: 169.254.1.0/30
      bgp_peering_cloud: 169.254.1.1/30
      bgp_peering_client: 169.254.1.2/30
      bgp_asn_client: 65000
      bgp_md5_password: fH32ekLo_4#3Df # Optional
    #
  #
  # POP-2 == NORD
  NORD: 
    phy: # L1/L2 параметры
      transceiver_type: SFP-1GBASE-LX
      client_speed: 100Mb
      vlan_id: 215
      # номер кроссировки и прочие детали коммутации на площадке NORD
      cross_notes: 3422 5/12/22 <==> 07/08/01
    #
    bgp: # L3 и BGP-peering параметры
      bgp_peering_net: 192.168.250.0/30
      bgp_peering_cloud: 192.168.250.1/30
      bgp_peering_client: 192.168.250.2/30
      bgp_asn_client: 65000
      bgp_md5_password: fH32ekLo_4#3Df # Optional
    #
  #
#
vpc:
  vpc_net_id: enpm1ckr4dsiea23de2w
  # Список сетей анонсируемых в направлении VPC --> client для каждой из зон доступности
  vpc_subnets_ipv4: 
    ru-central1-a: 10.128.0.0/16
    ru-central1-b: 10.130.0.0/16	
    ru-central1-c: 10.140.0.0/16
  # Список сетей анонсируемых в направлении client --> VPC для взаимодействия с облаком
  client_subnets_ipv4:
  - 172.16.10.0/24
  - 172.16.20.0/20
```
