# Создать задачу в {{ tracker-full-name }}

{% if audience == "external" %}

{% note warning %}

Интеграцию с {{ tracker-short-name }} могут настроить пользователи [{{ forms-full-name }} для бизнеса](forms-for-org.md).

{% endnote %}

{% endif %}

В форме можно настроить интеграцию с [{{ tracker-short-name }}]({{link-tracker}}), чтобы автоматически создавать задачи при заполнении формы. Ответы пользователя передаются из формы в {{ tracker-short-name }}, и на их основе создается задача. Например, такие формы удобно использовать для приема заявок на обслуживание или сбора сообщений об ошибках. Подробнее о задачах читайте в [Справке {{ tracker-full-name }}](../tracker/user/create-ticket.md).

## Настроить создание задач в {{ tracker-short-name }} {#setup}

1. Выберите форму и перейдите на вкладку **Интеграция**.

1. Выберите [группу действий](notifications.md#add-integration), в которой вы хотите настроить создание задачи, и внизу группы нажмите кнопку ![](../_assets/forms/tracker-notification-new.png) **{{ tracker-short-name }}**.

1. Введите ключ [очереди](../tracker/queue-intro.md), в которой будет создана задача.

1. Чтобы создать [подзадачу](../tracker/user/create-ticket.md#subtask), включите опцию **Сделать подзадачей** и введите ключ родительской задачи.

    <!--{% note info %}

    В этом случае задача из формы будет создаваться в той же очереди, где находится родительская задача.

    {% endnote %}
    -->
1. Задайте тип, приоритет задачи и настройте другие параметры.
    
    **Формат ввода данных**. В полях **Автор**, **Исполнитель**, **Теги**, **Компоненты** и подобных при вводе значений не работает подсказка.

    - В полях **Автор**, **Исполнитель**, **Наблюдатели** указывайте логин пользователя.
      Чтобы в поле **Наблюдатели** указать несколько пользователей, введите их логины через запятую (например, `ivanov,petrov`). 

    - Значения остальных полей вводите в точности, как они указаны в {{ tracker-short-name }}.

    - Чтобы добавить в поля **Компоненты** или **Теги** несколько значений, введите их через запятую.
    
    **Добавить поле задачи**. Если нужных параметров задачи нет в списке, добавьте их. Нажмите кнопку **Добавить параметр задачи** и начните вводить название, затем в подсказке выберите подходящий параметр.<!--{% if audience == "internal" %} [Локальные поля задач](../tracker/local-fields.md) отображаются в подсказке после названия очереди.{% endif %} --> Подробнее о параметрах задач читайте в [Справке {{ tracker-full-name }}](../tracker/user/create-param.md).
    
    {% if audience == "internal" %}
  
    {% note info %}

    С помощью стандартной интеграции с {{ tracker-short-name }} нельзя добавить в задачу чеклист. Задачу с чеклистом можно создать через API {{ tracker-short-name }} c помощью интеграции [<q>API — Запрос заданным методом</q>](send-request.md#filters).

    {% endnote %}

    {% endif %}

    **Добавить в поле данные из формы**. В поля задачи можно вставить ответ на вопрос или другие данные из формы:
    
    - Выберите поле и справа нажмите кнопку **Переменные**.

    - Выберите в списке [переменную](vars.md), которую нужно добавить в поле.

    {% note warning %}

    Чтобы добавить в поля **Автор**, **Исполнитель**, **Наблюдатели** сотрудника, указанного в ответе на вопрос типа {% if audience == "external" %}<q>Люди</q>,{% else %}<q>Данные Стаффа</q>,{% endif %} добавьте в поле переменную **Идентификатор варианта ответа на вопрос**. Если вы используете переменную **Ответ на вопрос**, интеграция не сработает.

    {% endnote %}

    Например, если с помощью формы вы собираете сообщения об ошибках, вы можете добавить в описание задачи сообщение пользователя и техническую информацию.
        
    ![](../_assets/forms/tracker-var-example-new.png)

1. Чтобы после заполнения формы пользователь получил ссылку на созданную задачу, под заголовком действия включите опцию **Показывать сообщение о результате действия**.

1. Нажмите кнопку **Сохранить**.

Чтобы создать несколько задач одновременно, добавьте новые действия с помощью кнопки ![](../_assets/forms/tracker-notification-new.png) **{{ tracker-short-name }}** внизу страницы.

Если нужно создавать задачу, только когда пользователь ответил на вопросы определенным образом, [задайте условия](notifications.md#section_xlw_rjc_tbb).

> Пример интеграции с {{ tracker-short-name }} для формы с заявкой на закупку оборудования. С помощью такой формы сотрудники смогут оформлять заявки на оборудование в виде задач для отдела закупок.
>
> ![](../_assets/forms/tracker-example-new.png)

{% if audience == "internal" %}

## Встроить форму в интерфейс {{ tracker-full-name }} {#embed}

Во [внутренней админке форм](new-form.md#instance) можно [настроить форму для создания задач](create-task.md#setup) и встроить ее в интерфейс {{ tracker-short-name }}. Такая форма будет отображаться на странице создания задачи рядом со стандартной. Она поможет пользователям создавать задачи по определенному шаблону, не отвлекаясь на лишние поля и параметры. Подробнее о формах в {{ tracker-short-name }} читайте в [Справке {{ tracker-full-name }}](../tracker/manager/attach-form.md).

{% endif %}

## Решение проблем {#troubles}

Если после заполнения формы создание задач в {{ tracker-short-name }} не работает или работает неправильно, проверьте ошибки интеграции:

1. Откройте форму, в которой не работает создание задач, и вверху страницы нажмите **Интеграция**.

1. Проверьте, появилось ли в настройках интеграции с {{ tracker-short-name }} сообщение об ошибке. 

1. Проверьте, есть ли решение вашей проблемы ниже на этой странице. После устранения проблемы попытайтесь [повторно запустить создание задачи](notifications.md#status).

1. Если проблему не удалось решить, [обратитесь в службу поддержки](feedback.md).

### Ошибка в полях Автор, Исполнитель, Наблюдатели

Возможная причина ошибки в том, что из формы в поля задачи **Автор**, **Исполнитель** или **Наблюдатели** передаются неверные данные. Заполните эти поля следующим образом:

- Чтобы добавить сотрудника вручную, указывайте логин пользователя, например `ivanov`.

- Чтобы в поле **Наблюдатели** указать несколько пользователей, введите их логины через запятую (например, `ivanov,petrov`). 

- Чтобы добавить сотрудника, указанного в ответе на вопрос типа {% if audience == "external" %}<q>Люди</q>,{% else %}<q>Данные Стаффа</q>,{% endif %} вставьте в поле [переменную](vars.md) **Идентификатор варианта ответа на вопрос**. Если вы используете переменную **Ответ на вопрос**, интеграция не сработает.

- Чтобы добавить сотрудника, указанного в ответе на вопрос типа <q>Выпадающий список</q> или <q>Несколько вариантов</q>, в качестве вариантов ответов задайте логины пользователей (например, `ivanov`) и используйте [переменную](vars.md) **Ответ на вопрос**.

Если в поле **Автор** возникает ошибка, но поле при этом заполнено верно, убедитесь, что у заполнившего форму пользователя есть [доступ на создание задач в указанной очереди {{ tracker-short-name }}](#access).

### Ошибка: нет прав на запись в очередь {#access}

Причина ошибки в том, что у пользователя, который заполнил форму, нет прав на создание задач в указанной очереди {{ tracker-short-name }}. Попросите владельца очереди [проверить права доступа](../tracker/manager/queue-access.md).

{% if audience == "internal" %}

{% note warning %}

Чтобы предоставить доступ к очереди команде поддержки бизнеса и внешним консультантам, включите опцию **Разрешить доступ внешним сотрудникам**.

{% endnote %}

{% endif %}

<!-- ### Ошибка в поле Тип

Такая ошибка может возникнуть, если вы включили опцию **Сделать подзадачей**. При использовании этой опции задача из формы всегда создается в той же очереди, в которой находится родительская задача. Если эта очередь отличается от указанной в поле **Ключи очереди**, в ней может не оказаться заданного типа задачи.

Чтобы решить проблему, убедитесь, что родительская задача в опции **Сделать подзадачей** находится в очереди, указанной в поле **Ключи очереди**.-->

{% if audience == "internal" %}

### Ошибка при заполнении нестандартных полей задачи

Ошибка может произойти, если вы создали в {{ tracker-short-name }} новое поле задачи и пытаетесь заполнять его значением из ответа на вопрос. Причина в том, что формат данных, передаваемых в поле задачи из формы, не совпадает с форматом данных в {{ tracker-short-name }}. По умолчанию {{ forms-full-name }} передает ответ в виде строки, поэтому интеграция не работает с полями нестандартного формата, такими как список значений с переводами.

### Ошибка: HTTPSConnectionPool(host='st-api.yandex-team.ru', port=443): Read timed out.

Причина ошибки в том, что ответ на запрос к {{ tracker-short-name }} не пришел за установленное время. Попробуйте перезапустить интеграцию: в сообщении об ошибке нажмите кнопку **Показать**, выберите не сработавшие интеграции и нажмите кнопку **Перезапустить все**. 

Проверьте [список задач очереди](../tracker/user/queue.md). Возможно, что задача была создана, несмотря на ошибку.

### Задача создается от имени робота

Задача создается от имени робота, если пользователи заполняют форму по [анонимной ссылке](publish.md#section_link). Чтобы автором задачи был пользователь, который заполнил форму, опубликуйте форму по ссылке на домене `forms.yandex-team.ru`.

### Не получается добавить в задачу чеклист

С помощью стандартной интеграции с {{ tracker-short-name }} нельзя добавить в задачу чеклист. Задачу с чеклистом можно создать через API {{ tracker-short-name }} c помощью интеграции [<q>API — Запрос заданным методом</q>](send-request.md#resolve-problems-checklist).

{% endif %}