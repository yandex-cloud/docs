# Создание кластера

Кластер {{ mes-name }} — это группа из нескольких связанных друг с другом хостов {{ ES }}. Кластер обеспечивает высокую производительность поиска путем распределения задач поиска и индексации по всем хостам кластера с ролью _Data node_. Подробнее о ролях в кластере см. в разделе [{#T}](../concepts/hosts-roles.md).

Количество хостов с ролью _Data node_, которые можно создать вместе с {{ ES }}-кластером, зависит от выбранного [типа хранилища](../concepts/storage.md):

* При использовании **локального хранилища** вы можете создать кластер из трех или более хостов (минимум три хоста необходимо, чтобы обеспечить отказоустойчивость).
* При использовании сетевого хранилища:
    * Если выбрано **стандартное** или **быстрое сетевое хранилище**, вы можете добавить любое количество хостов в пределах [текущей квоты](../concepts/limits.md).
    * Если выбрано **нереплицируемое сетевое хранилище**, вы можете создать кластер из трех или более хостов (минимум три хоста необходимо, чтобы обеспечить отказоустойчивость).
      
После создания кластера в него можно добавить дополнительные хосты, если для этого достаточно [ресурсов каталога](../concepts/limits.md).

## Создать кластер {#create-cluster}

При создании кластера отдельно указываются параметры для хостов, выполняющих роль _Master node_, и отдельно — для хостов, выполняющих роль _Data node_.

Допускается использовать только хосты с ролью _Data node_ и не создавать выделенные хосты для роли _Master node_: в этом случае хосты с ролью _Data node_ будут совмещать две роли.

{% list tabs %}

- Консоль управления

  1. В консоли управления выберите каталог, в котором нужно создать кластер.
  1. Выберите сервис **{{ mes-name }}**.
  1. Нажмите кнопку **Создать кластер**.
  1. В блоке **Базовые параметры**:
     1. Введите имя кластера и, при необходимости, его описание. Имя кластера должно быть уникальным в рамках каталога.
     1. Выберите окружение, в котором нужно создать кластер (после создания кластера окружение изменить невозможно):
        - `PRODUCTION` — для стабильных версий ваших приложений.
        - `PRESTABLE` — для тестирования, в том числе самого сервиса {{ mes-name }}. В Prestable-окружении раньше появляются новая функциональность, улучшения и исправления ошибок. При этом не все обновления обеспечивают обратную совместимость.
     1. Выберите версию {{ ES }}. На текущий момент поддерживается версия `7.6`.
  1. В блоке **Сетевые настройки** выберите [сеть](../../vpc/concepts/network.md).
  1. В блоке **Пользователь** укажите пароль для пользователя `admin`.

     {% include [mes-superuser](../../_includes/mdb/mes-superuser.md)%}

  1. Задайте конфигурацию хостов с ролью _Data node_, выбрав вкладку **Data node**:
     1. В блоке **Класс хоста** выберите платформу, тип хостов и класс хостов.

        Класс хостов определяет технические характеристики виртуальных машин, на которых будут развернуты ноды {{ ES }}. Все доступные варианты перечислены в разделе [{#T}](../concepts/instance-types.md). При изменении класса хостов для кластера меняются характеристики всех уже созданных экземпляров.

     1. В блоке **Хранилище**:
        * Выберите [тип хранилища](../concepts/storage.md) — более гибкое сетевое (`network-hdd`, `network-ssd` или `network-ssd-nonreplicated`) или более быстрое локальное хранилище (`local-ssd`). 

          При выборе типа хранилища обратите внимание, что:
          * Размер локального хранилища можно менять только с шагом 100 ГБ.
          * Размер нереплицируемого сетевого хранилища можно менять только с шагом 93 ГБ.
      
        * Выберите объем хранилища, который будет использоваться для данных.

     1. В блоке **Хосты** укажите конфигурацию хостов, создаваемых вместе с кластером:
        1. Чтобы добавить хост, нажмите кнопку **Добавить хост**.
        1. Чтобы изменить добавленный хост, наведите курсор на строку хоста и нажмите значок ![image](../../_assets/pencil.svg).

          При изменении хоста можно: {#change-data-node-settings}
          1. Выбрать зону доступности и подсеть.
          1. Включить публичный доступ. Если для хоста {{ ES }} с ролью _Data node_ включен публичный доступ, то вы сможете подключиться к этому хосту {{ ES }} или расположенной на нем Kibana через интернет. Подробнее см. в разделе [{#T}](cluster-connect.md).

             {% include [mes-tip-public-kibana](../../_includes/mdb/mes-tip-connecting-to-public-kibana.md) %}
        
        При настройке параметров хостов обратите внимание, что если в блоке **Хранилище** выбран `local-ssd` или `network-ssd-nonreplicated`, то необходимо добавить не менее трех хостов в кластер.

  1. При необходимости задайте конфигурацию хостов с ролью _Master node_, выбрав вкладку **Master node**:
     1. В блоке **Класс хоста** выберите платформу, тип хостов и класс хостов.
     1. В блоке **Хранилище** настройте хранилище по аналогии с хостами с ролью _Data node_.
     1. В блоке **Хосты** нажмите кнопку **Добавить хосты**. Будут добавлены три хоста. Чтобы изменить один из добавленных хостов, наведите курсор на строку хоста и нажмите значок ![image](../../_assets/pencil.svg).

        При изменении хоста можно: {#change-master-node-settings}
          1. Выбрать зону доступности и подсеть.
          1. Включить публичный доступ.

             {% note tip %}

             Не рекомендуется включать публичный доступ для хостов с ролью _Master node_. Изменяйте эту настройку только если вы точно знаете, что хотите сделать.

             {% endnote %}

  1. Нажмите кнопку **Создать**.

- API

  Чтобы создать кластер, воспользуйтесь методом API `create` и передайте в запросе:
    - Идентификатор каталога, в котором должен быть размещен кластер, в параметре `folderId`.
    - Имя кластера в параметре `name`.
    - Конфигурацию кластера в параметре `configSpec`, в том числе:
        - Класс хостов с ролью _Master node_ в параметре `configSpec.elasticsearchSpec.masterNode.resources`. Чтобы не создавать выделенных хостов с ролью _Master node_ — не задавайте значения для группы параметров `configSpec.elasticsearchSpec.masterNode`.
        - Класс хостов с ролью _Data node_ в параметре `configSpec.elasticsearchSpec.dataNode.resources`.
    - Конфигурацию хостов кластера в одном или нескольких параметрах `hostSpecs`.
    - Идентификатор сети в параметре `networkId`.

{% endlist %}
