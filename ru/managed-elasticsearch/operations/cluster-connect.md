---
title: Подключение к кластеру Elasticsearch
description: 'К хостам кластера Elasticsearch с ролью Data node можно подключиться через интернет, если вы настроили публичный доступ для нужного хоста, и с виртуальных машин Yandex Cloud, расположенных в той же виртуальной сети.'
keywords:
  - подключение кластера Elasticsearch
  - кластер Elasticsearch
  - Elasticsearch
---

# Подключение к {{ ES }}-кластеру

К хостам кластера {{ mes-name }} с [ролью _Data node_](../concepts/hosts-roles.md#data-node) можно подключиться:

* Через интернет, если вы настроили публичный доступ для нужного хоста.


* С виртуальных машин {{ yandex-cloud }}, расположенных в той же [виртуальной сети](../../vpc/concepts/network.md).


Вне зависимости от способа подключения, {{ mes-name }} поддерживает только соединения с [SSL-сертификатом](#get-ssl-cert) к хостам кластера.


## Настройка групп безопасности {#configuring-security-groups}

{% include [sg-rules](../../_includes/mdb/sg-rules-connect.md) %}

Настройки правил будут различаться в зависимости от выбранного способа подключения:

{% list tabs %}

- Через интернет

    [Настройте все группы безопасности](../../vpc/operations/security-group-add-rule.md) кластера так, чтобы они разрешали входящий трафик с любых IP-адресов на порты 443 (Kibana GUI и Kibana API) и 9200 ({{ ES }}). Для этого создайте следующие правила для входящего трафика:

    * Диапазон портов — `443`, `9200`.
    * Протокол — `TCP`.
    * Источник — `CIDR`.
    * CIDR блоки — `0.0.0.0/0`.

    На каждый порт создается отдельное правило.

- С ВМ в Облаке

    1. [Настройте все группы безопасности](../../vpc/operations/security-group-add-rule.md) кластера так, чтобы они разрешали входящий трафик из группы безопасности, в которой находится ВМ, на порты 443 (Kibana GUI и Kibana API) и 9200 ({{ ES }}). Для этого создайте в этих группах следующие правила для входящего трафика:

        * Протокол — `TCP`.
        * Диапазон портов — `443`, `9200`.
        * Источник — `Группа безопасности`.
        * Группа безопасности — если кластер и ВМ находятся в одной и той же группе безопасности, выберите значение `Текущая` (`Self`). В противном случае укажите группу безопасности ВМ.

        На каждый порт создается отдельное правило.

    1. [Настройте все группы безопасности](../../vpc/operations/security-group-add-rule.md), в которых находится ВМ так, чтобы можно было подключаться к ВМ и был разрешен трафик между ней и хостами кластера.

        Пример правил для ВМ:

        * Для входящего трафика:

            * Диапазон портов — `22`, `443`, `9200`.
            * Протокол — `TCP`.
            * Источник — `CIDR`.
            * CIDR блоки — `0.0.0.0/0`.

            На каждый порт создается отдельное правило.

        * Для исходящего трафика:

            * Диапазон портов — `{{ port-any }}`.
            * Протокол — `Любой` (`Any`).
            * Назначение — `CIDR`.
            * CIDR блоки — `0.0.0.0/0`.

            Это правило разрешает любой исходящий трафик, что позволяет не только подключаться к кластеру, но и устанавливать на ВМ необходимые для этого сертификаты и утилиты.

{% endlist %}

{% note info %}

Вы можете задать более детальные правила для групп безопасности, например, разрешающие трафик только в определенных подсетях.

Группы безопасности должны быть корректно настроены для всех подсетей, в которых будут размещены хосты кластера. При неполных или некорректных настройках групп безопасности можно потерять доступ к кластеру.

{% endnote %}

Подробнее о группах безопасности см. в разделе [{#T}](../concepts/network.md#security-groups).


## Получение SSL-сертификата {#get-ssl-cert}

Чтобы использовать шифрованное соединение, получите SSL-сертификат:

{% list tabs %}

- Linux (Bash)

  {% include [install-certificate](../../_includes/mdb/mes/install-certificate.md) %}

  Сертификат будет сохранен в каталоге `$HOME/.elasticsearch/root.crt`.

- Windows (PowerShell)

  
  ```powershell
  mkdir $HOME\.elasticsearch; curl -o $HOME\.elasticsearch\root.crt https://{{ s3-storage-host }}{{ pem-path }}
  ```


  Сертификат будет сохранен в каталоге `$HOME\.elasticsearch\root.crt`.

{% endlist %}

## Автоматический выбор хоста для подключения {#automatic-host-selection}

При подключении к кластеру {{ ES }} вы можете:

* Явно задать имена хостов с ролью _Data node_ в строках подключения. 
  
  Этот способ подходит для любого способа подключения. Например, его можно использовать для подключения через интернет в случае, когда только нескольким хостам назначен публичный IP-адрес.
  
* Использовать специальный FQDN вида `c-<идентификатор кластера {{ ES }}>.rw.{{ dns-zone }}` (например, `https://c-e4ut2....rw.{{ dns-zone }}`).

  Этот способ подходит только в том случае, если все хосты с ролью _Data node_ имеют публичный IP-адрес или же подключение осуществляется только с виртуальных машин {{ yandex-cloud }}. Это связано с тем, что хост для подключения, на который указывает этот FQDN, выбирается случайным образом среди все хостов с ролью _Data node_. 

## Примеры строк подключения {#connection-string}

{% include [conn-strings-environment](../../_includes/mdb/mes-conn-strings-env.md) %}

Перед подключением [подготовьте сертификат](#get-ssl-cert).

Для подключения нужно использовать имя пользователя и пароль, которые были заданы при [создании кластера](cluster-create.md#create-cluster).

{% include [see-fqdn-in-console](../../_includes/mdb/see-fqdn-in-console.md) %}

{% include [mes-connection-strings](../../_includes/mdb/mes-conn-strings.md) %}

При успешном подключении будет выведена общая информация о кластере {{ ES }}.
