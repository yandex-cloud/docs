---
title: Подключение к кластеру Elasticsearch
description: 'К хостам кластера Elasticsearch с ролью Data node можно подключиться через интернет, если вы настроили публичный доступ для нужного хоста, и с виртуальных машин Yandex.Cloud, расположенных в той же виртуальной сети.'
keywords:
  - подключение кластера Elasticsearch
  - кластер Elasticsearch
  - Elasticsearch
---

# Подключение к кластеру

К хостам кластера {{ mes-name }} с [ролью _Data node_](../concepts/hosts-roles.md#data-node) можно подключиться:

- Через интернет, если вы настроили публичный доступ для нужного хоста.

- С виртуальных машин {{ yandex-cloud }}, расположенных в той же [виртуальной сети](../../vpc/concepts/network.md).

Вне зависимости от способа подключения, {{ mes-name }} поддерживает только соединения с [SSL-сертификатом](#get-ssl-cert) к хостам кластера.

## Настройка групп безопасности {#configuring-security-groups}


[Группы безопасности](../../vpc/concepts/security-groups.md) могут препятствовать подключению к кластеру. В этом случае внесите изменения в правила групп.

Настройки правил будут различаться в зависимости от выбранного способа подключения:

{% list tabs %}

- Через интернет

    
    [Настройте все группы безопасности](../../vpc/operations/security-group-update.md#add-rule) кластера так, чтобы они разрешали входящий трафик с любых IP-адресов на порты 443 (Kibana) и 9200 ({{ ES }}). Для этого создайте следующие правила для входящего трафика:

    - протокол: `TCP`;
    - диапазон портов: `443`, `9200`;
    - тип источника: `CIDR`;
    - источник: `0.0.0.0/0`.

    На каждый порт создается отдельное правило.

- С ВМ в Облаке

    
    1. [Настройте все группы безопасности](../../vpc/operations/security-group-update.md#add-rule) кластера так, чтобы они разрешали входящий трафик из группы безопасности, в которой находится ВМ, на порты 443 (Kibana) и 9200 ({{ ES }}). Для этого создайте в этих группах следующие правила для входящего трафика:

        - протокол: `TCP`;
        - диапазон портов: `443`, `9200`;
        - тип источника: `Группа безопасности`;
        - источник: группа безопасности, в которой находится ВМ. Если она совпадает с настраиваемой группой, то укажите **Текущая**.

        На каждый порт создается отдельное правило.

    
    1. [Настройте все группы безопасности](../../vpc/operations/security-group-update.md#add-rule), в которых находится ВМ так, чтобы можно было подключаться к ВМ и был разрешен трафик между ней и хостами кластера.

        Пример правил для ВМ:

        - Для входящего трафика:

            - протокол: `TCP`;
            - диапазон портов: `22`, `443`, `9200`;
            - тип источника: `CIDR`;
            - источник: `0.0.0.0/0`.

            На каждый порт создается отдельное правило.

        - Для исходящего трафика:

            - протокол: `Any`;
            - диапазон портов: `0-65535`;
            - тип назначения: `CIDR`;
            - назначение: `0.0.0.0/0`.

            Это правило разрешает любой исходящий трафик, что позволяет не только подключаться к кластеру, но и устанавливать сертификаты и утилиты, необходимые для подключения к кластеру.

{% endlist %}

{% note info %}

Вы можете задать более детальные правила для групп безопасности, например, разрешающие трафик только в определенных подсетях.

Группы безопасности должны быть корректно настроены для всех подсетей, в которых будут размещены хосты кластера. При неполных или некорректных настройках групп безопасности можно потерять доступ к кластеру.

{% endnote %}


Подробнее о группах безопасности см. в разделе [{#T}](../concepts/network.md#security-groups).

## Получение SSL-сертификата {#get-ssl-cert}

Чтобы использовать шифрованное соединение, получите SSL-сертификат:

{% list tabs %}

* Linux (Bash)

  
  ```bash
  mkdir ~/.elasticsearch && \
  wget  "https://{{ s3-storage-host }}{{ pem-path }}" -O ~/.elasticsearch/root.crt && \
  chmod 0600 ~/.elasticsearch/root.crt
  ```

  Сертификат будет сохранен в каталоге `$HOME/.elasticsearch/root.crt`.

* Windows (PowerShell)

  
  ```powershell
  mkdir $HOME\.elasticsearch; curl -o $HOME\.elasticsearch\root.crt https://{{ s3-storage-host }}{{ pem-path }}
  ```

  Сертификат будет сохранен в каталоге `$HOME\.elasticsearch\root.crt`.

## Автоматический выбор хоста для подключения {#automatic-host-selection}

При подключении к кластеру {{ ES }} вы можете:
- Явно задать имена хостов с ролью _Data node_ в строках подключения. 
  
  Этот способ подходит для любого способа подключения. Например, его можно использовать для подключения через интернет в случае, когда только нескольким хостам назначен публичный IP-адрес.
  
- Использовать специальный FQDN вида `c-<идентификатор кластера {{ ES }}>.rw.mdb.yandexcloud.net` (например, `https://c-e4ut2....rw.mdb.yandexcloud.net`).

  Этот способ подходит только в том случае, если все хосты с ролью _Data node_ имеют публичный IP-адрес или же подключение осуществляется только с виртуальных машин {{ yandex-cloud }}. Это связано с тем, что хост для подключения, на который указывает этот FQDN, выбирается случайным образом среди все хостов с ролью _Data node_. 

## Примеры строк подключения {#connection-string}

{% include [conn-strings-environment](../../_includes/mdb/mes-conn-strings-env.md) %}

Перед подключением [подготовьте сертификат](#get-ssl-cert).

Для подключения нужно использовать имя пользователя и пароль, которые были заданы при [создании кластера](cluster-create.md#create-cluster).

{% include [see-fqdn-in-console](../../_includes/mdb/see-fqdn-in-console.md) %}

{% include [mes-connection-strings](../../_includes/mdb/mes-conn-strings.md) %}

При успешном подключении будет выведена общая информация о кластере {{ ES }}.
