# Как начать работать с {{ mes-name }}

Чтобы начать работу с сервисом:

1. [Создайте кластер](#cluster-create).
1. [Подключитесь к кластеру](#connect).
1. [Подключитесь к Kibana](#connect-kibana).

{% if audience == "internal" %}

Для внутреннего сервиса MDB развернут [веб-интерфейс]({{ console-link }}), где кластер БД можно накликать. Подробнее про квоты и соответствие ABC-сервисов облакам и каталогам читайте в разделе [{#T}](../mdb/access.md).

## Доступ к кластерам БД {#access}

В [Панчере](https://puncher.yandex-team.ru/) уже сделаны правила для доступа к кластерам MDB: из [серверных сетей Яндекса](https://puncher.yandex-team.ru/tasks?id=5cb878a6d5626d264a13ff8a), и [для штатных разработчиков](https://puncher.yandex-team.ru/tasks?id=5d0254aad89cb03fee5006d4).

Если этих правил не хватает, запросите доступ к макросу `_PGAASINTERNALNETS_`. Для подключения к {{ ES }} в заявке нужно указать порт 9200 (Elasticsearch) и/или порт 443 (Kibana).

## Настройка CLI

Если вы планируете использовать CLI, установите и настройте его согласно [инструкции](../cli/quickstart.md).

   Если все сделано правильно, должен заработать запрос списка кластеров:

   ```bash
   {{ yc-mdb-es }} cluster list
   ```

{% else %}

## Перед началом работы {#before-you-begin}

1. Войдите в [консоль управления]({{ link-console-main }}) или зарегистрируйтесь, если вы еще не зарегистрированы.
1. Если у вас еще нет каталога, создайте его:

   {% include [create-folder](../_includes/create-folder.md) %}

1. Подключаться к кластеру {{ ES }} можно как изнутри, так и извне {{ yandex-cloud }}:
   - Чтобы подключиться изнутри {{ yandex-cloud }}, создайте виртуальную машину на основе [Linux](../compute/quickstart/quick-create-linux.md) или [Windows](../compute/quickstart/quick-create-windows.md) в той же сети, что и кластер.
   - Чтобы подключиться к кластеру из интернета, [запросите публичный доступ](operations/cluster-create.md#change-data-node-settings) к хостам с ролью _Data node_ при создании кластера.

{% note info %}

Эта инструкция предполагает, что подключение к кластеру производится из интернета.

{% endnote %}

{% endif %}

## Создайте кластер {#cluster-create}

1. В консоли управления выберите каталог, в котором нужно создать кластер.
1. Выберите сервис **{{ mes-name }}**.
1. Нажмите кнопку **Создать кластер**. Процесс подробно рассмотрен в разделе [{#T}](operations/cluster-create.md).
1. Задайте параметры кластера.

   Чтобы получить доступ к веб-интерфейсу Kibana, запросите публичный доступ:
   1. Измените настройки хоста с ролью _Data node_, нажав значок ![image](../_assets/pencil.svg) для хоста.
   1. Выберите опцию **Публичный доступ**.
   1. Нажмите кнопку **Сохранить**.

   Публичный доступ можно запросить для одного или нескольких хостов с такой ролью. После создания кластера станет доступно [подключение к Kibana](#connect-kibana), расположенной на этих хостах.

   {% include [mes-tip-public-kibana](../_includes/mdb/mes-tip-connecting-to-public-kibana.md) %}

1. Нажмите кнопку **Создать кластер**.
1. Дождитесь, когда кластер будет готов к работе: его статус на панели {{ mes-short-name }} сменится на **Running**, а состояние — на **Alive**. Это может занять некоторое время.

## Подключитесь к кластеру {#connect}

Предполагается, что все перечисленные ниже шаги выполняются на Linux.

Чтобы подключиться к кластеру:
1. Установите SSL-сертификат:

   ```
   $ mkdir -p ~/.elasticsearch
   $ wget  "https://{{ s3-storage-host }}{{ pem-path }}" -O ~/.elasticsearch/root.crt
   $ chmod 0600 ~/.elasticsearch/root.crt
   ```

1. Подключитесь к кластеру с помошью утилиты [cURL](https://curl.haxx.se/):

   ```
   $ curl \
     --user <имя пользователя>:<пароль> \
     --cacert ~/.elasticsearch/root.crt \
     -X GET 'https://<FQDN публично доступного хоста {{ ES }} с ролью Data node>:9200'
   ```

   Для подключения нужно использовать имя пользователя и пароль, которые были заданы при [создании кластера](#cluster-create).

   При успешном подключении будет выведено похожее сообщение:

   ```
   {
     "name" : "....mdb.cloud.yandex.net",
     "cluster_name" : "...",
     "cluster_uuid" : "...",
     ...
     "tagline" : "You Know, for Search"
   }
   ```

## Подключитесь к Kibana {#connect-kibana}

1. Подключитесь с помощью браузера к веб-интерфейсу [Kibana](https://www.elastic.co/kibana/features).

   Для подключения:
   1. Установите [SSL-сертификат](https://storage.yandexcloud.net/cloud-certs/CA.pem) в хранилище доверенных корневых сертификатов браузера ([инструкция](https://wiki.mozilla.org/PSM:Changing_Trust_Settings#Trusting_an_Additional_Root_Certificate) для Mozilla Firefox).
   1. Перейдите в браузере по адресу `https://<FQDN публично доступного хоста {{ ES }} с ролью Data node>`.
   1. Введите имя пользователя и пароль, которые были заданы при [создании кластера](#cluster-create).

1. Загрузите в {{ ES }} один или несколько наборов тестовых данных с помощью Kibana:
   1. На приветственном экране Kibana нажмите кнопку **Try our sample data**.
   1. Добавьте данные из одного или нескольких наборов данных, нажав кнопку **Add data** для нужного набора.

1. Исследуйте данные с помощью Kibana и {{ ES }}, нажав кнопку **View data** для интересующего набора данных.

Подробнее о работе с Kibana см. в [документации {{ ES }}](https://www.elastic.co/guide/en/kibana/current/tutorial-sample-data.html).

## Что дальше {#whats-next}

- Изучите [концепции сервиса](concepts/index.md).
- Узнайте подробнее о [создании кластера](operations/cluster-create.md) и [подключении к кластеру](operations/cluster-connect.md).
