---
title: Приложения в {{ org-full-name }}
description: В {{ org-name }} вы можете аутентифицировать пользователей {{ yandex-cloud }} во внешних приложениях с помощью SAML- и OIDC-приложений с использованием технологии единого входа.
---

# Приложения в {{ org-full-name }}

{% include [note-preview](../../_includes/note-preview.md) %}

Пользователи вашей [организации](./organization.md) могут аутентифицироваться во внешних приложениях с помощью [технологии единого входа](https://ru.wikipedia.org/wiki/Технология_единого_входа) (SSO). Для этого {{ org-name }} позволяет создавать _приложения_ — [ресурсы](../../overview/roles-and-resources.md#resources) {{ yandex-cloud }}, которые содержат настройки интеграции {{ org-full-name }} как _поставщика удостоверений_ (Identity Provider, IdP) с одной стороны и стороннего _поставщика услуг_ (Service Provider, SP) — с другой.

{{ org-name }} поддерживает стандарты технологии единого входа [SAML](https://ru.wikipedia.org/wiki/SAML) и [OpenID Connect](https://ru.wikipedia.org/wiki/OpenID#OpenID_Connect) (OIDC).

В качестве поставщика услуг могут выступать различные сервисы, поддерживающие технологию единого входа, которые могут работать как по модели [SaaS](https://ru.wikipedia.org/wiki/Программное_обеспечение_как_услуга), так и по модели [on-premise](https://en.wikipedia.org/wiki/On-premises_software). Например: [{{ yandex-360 }}](https://360.yandex.ru/), [GitHub](https://github.com/), [GitLab](https://about.gitlab.com/), [Jenkins](https://www.jenkins.io/), [Jira](https://www.atlassian.com/software/jira) и множество других.

## SAML-приложения {#saml}

В {{ org-name }} вы можете [создавать](../operations/applications/saml-create.md) SAML-приложения, которые позволяют настроить единый вход по стандарту SAML на стороне {{ org-name }}, а также предоставляют необходимые значения для настройки интеграции на стороне поставщика услуг.

Доступ к внешнему приложению разрешен только тем пользователям организации {{ yandex-cloud }}, которые явно [добавлены](../operations/applications/saml-create.md#users-and-groups) в соответствующее SAML-приложение или входят в [группы пользователей](./groups.md), явно добавленные в это SAML-приложение.

{% include [saml-app-admin-role](../../_includes/organization/saml-app-admin-role.md) %}

### Схема взаимодействия сторон по стандарту SAML {#saml-scheme}

В базовом представлении аутентификация пользователя с использованием механизма единого входа по стандарту SAML происходит по следующей схеме:

1. На странице аутентификации внешнего приложения (поставщика услуг) пользователь {{ yandex-cloud }} выбирает аутентификацию с помощью единого входа.
1. Поставщик услуг направляет SAML-запрос в {{ org-name }} (поставщик удостоверений) и перенаправляет пользователя на URL входа {{ org-name }}.
1. Пользователь аутентифицируется в {{ org-name }}, используя свои учетные данные.
1. Если в {{ org-name }} существует SAML-приложение, соответствующее данному внешнему приложению, аутентифицировавшийся пользователь [добавлен](../operations/applications/saml-create.md#users-and-groups) в это SAML-приложение, а полученный SAML-запрос корректен, то {{ org-name }} направляет поставщику услуг подписанный SAML-ответ, содержащий атрибуты пользователя.
1. Поставщик услуг проверяет корректность SAML-ответа и его подписи и в случае успеха предоставляет пользователю доступ к внешнему приложению.
1. При выходе пользователя из внешнего приложения поставщик услуг направляет SAML-запрос в {{ org-name }} и перенаправляет пользователя на URL выхода {{ org-name }}.

Обмен данными между сторонами по стандарту SAML происходит в формате [XML](https://ru.wikipedia.org/wiki/XML).

### Настройка на стороне поставщика удостоверений ({{ org-name }}) {#saml-idp-setup}

Для корректной работы интеграции на стороне {{ org-name }} необходимо [настроить](../operations/applications/saml-create.md#setup-idp) ряд параметров интеграции в SAML-приложении. Получите необходимые значения этих параметров у вашего поставщика услуг:

* `{{ ui-key.yacloud_org.organization.apps.SamlAppEditForm.field-sp-entity-id_snAsX }}` — уникальный идентификатор поставщика услуг (Service Provider).

    Значение должно совпадать на стороне поставщика услуг и на стороне {{ org-name }}.
* `{{ ui-key.yacloud_org.organization.apps.SamlAppEditForm.field-acs-urls_eQcJr }}` — URL-адрес, на который {{ org-name }} будет отправлять SAML-ответ.

    ACS URL должен соответствовать схеме `https`. Использовать протокол без шифрования допускается только в целях тестирования на локальном хосте (значения `http://127.0.0.1` и `http://localhost`).

    {% include [saml-app-acs-url-paragraph](../../_includes/organization/saml-app-acs-url-paragraph.md) %}

    Вы можете указать одновременно несколько URL/индексов ACS.

    {% include [saml-app-acs-url-warn](../../_includes/organization/saml-app-acs-url-warn.md) %}

* `{{ ui-key.yacloud_org.organization.apps.SamlAppEditForm.field-signature-mode_ipXQ7 }}` — элементы SAML-ответа, которые будут подписываться электронной подписью:

    {% include [saml-app-sign-mode](../../_includes/organization/saml-app-sign-mode.md) %}

#### Атрибуты пользователя и групп {#saml-attributes}

Новое SAML-приложение по умолчанию создается с определенным набором относящихся к пользователю _атрибутов_, которые будут передаваться из {{ org-name }} поставщику услуг. Этот набор включает в себя:

Имя атрибута | Значение атрибута | Передаваемое значение
--- | --- | ---
`NameID` | `SubjectClaims.preferred_username` | идентификатор пользователя
`givenname` | `SubjectClaims.given_name` | полное имя пользователя
`fullname` | `SubjectClaims.name` | имя пользователя
`surname` | `SubjectClaims.family_name` | фамилия пользователя
`emailaddress` | `SubjectClaims.email` | адрес электронной почты пользователя

После создания SAML-приложения вы можете [добавлять, изменять и удалять](../operations/applications/saml-create.md#setup-attributes) следующие атрибуты пользователя:

{% include [saml-app-assertion-list](../../_includes/organization/saml-app-assertion-list.md) %}

{% include [saml-app-nameid-assertion](../../_includes/organization/saml-app-nameid-assertion.md) %}

В дополнение к указанным выше атрибутам пользователя в SAML-ответе может быть передан атрибут групп, значением которого является список [групп](./groups.md), в которые входит пользователь. Для этого атрибута вы можете задать произвольное имя и одно из значений:

{% include [saml-app-group-assertion](../../_includes/organization/saml-app-group-assertion.md) %}

{% note info %}

Если на стороне {{ org-name }} для атрибута пользователя не задано значение, в SAML-ответе такой атрибут будет отсутствовать.

{% endnote %}

### Настройка на стороне поставщика услуг (внешнее приложение) {#saml-sp-setup}

Для корректной работы интеграции на стороне поставщика услуг также необходимо настроить ряд параметров интеграции. В зависимости от возможностей вашего поставщика услуг вы можете [выполнить эти настройки](../operations/applications/saml-create.md#setup-sp) как вручную, так и автоматически, загрузив XML-файл с метаданными или указав URL с метаданными.

Ссылка на скачивание XML-файла с метаданными и URL с метаданными доступны на странице с информацией о SAML-приложении в [интерфейсе {{ cloud-center }}]({{ link-org-cloud-center }}/apps). Там же доступны значения параметров интеграции для настройки вручную:

{% include [saml-app-sp-parameter-list](../../_includes/organization/saml-app-sp-parameter-list.md) %}

Кроме того, на стороне поставщика услуг должны быть настроены и корректно обрабатываться атрибуты пользователя, настроенные на стороне {{ org-name }}.

#### Сертификат ключа проверки электронной подписи {#saml-certificate}

В дополнение к настройке указанных выше параметров в конфигурацию поставщика услуг необходимо также добавить сертификат, с помощью которого поставщик услуг сможет верифицировать электронную подпись, которой {{ org-name }} подписывает SAML-ответы.

{% include [saml-app-cert-intro-phrase](../../_includes/organization/saml-app-cert-intro-phrase.md) %}

При автоматической настройке с помощью файла или URL с метаданными устанавливать сертификат вручную не требуется: метаданные уже содержат нужный сертификат, и он устанавливается автоматически.

В любой момент вы можете [выпускать](../operations/applications/saml-update.md#update-cert) новые сертификаты ключа проверки электронной подписи для SAML-приложения и активировать их.

{% include [saml-app-cert-update-warn](../../_includes/organization/saml-app-cert-update-warn.md) %}

Дополнительно на стороне поставщика услуг необходимо указать, какие данные в SAML-ответах поставщика удостоверений будут подписываться:
* только передаваемые атрибуты пользователя;
* весь SAML-ответ целиком;
* целиком весь SAML-ответ и (отдельно) передаваемые атрибуты.

Заданный режим подписи на стороне поставщика услуг должен соответствовать режиму подписи, заданному на стороне {{ org-name }}.

## OIDC-приложения {#oidc}

В {{ org-name }} вы можете [создавать](../operations/applications/oidc-create.md) OIDC-приложения, которые позволяют настроить единый вход по стандарту OpenID Connect (OIDC) на стороне {{ org-name }}, а также предоставляют необходимые значения для настройки интеграции на стороне поставщика услуг.

Доступ к внешнему приложению разрешен только тем пользователям организации {{ yandex-cloud }}, которые явно [добавлены](../operations/applications/oidc-create.md#users-and-groups) в соответствующее OIDC-приложение или входят в [группы пользователей](./groups.md), явно добавленные в это OIDC-приложение.

{% include [oidc-app-admin-role](../../_includes/organization/oidc-app-admin-role.md) %}

Необходимым компонентом OIDC-приложения является OAuth-клиент, который создается в указанном пользователем [каталоге](../../resource-manager/concepts/resources-hierarchy.md#folder) и неразрывно связан с OIDC-приложением. OAuth-клиент создается и удаляется автоматически соответственно при создании и удалении OIDC-приложения.

### Схема взаимодействия сторон по стандарту OIDC {#oidc-scheme}

В базовом представлении аутентификация пользователя с использованием механизма единого входа по стандарту OpenID Connect происходит по следующей схеме:

1. На странице аутентификации внешнего приложения (поставщика услуг) пользователь {{ yandex-cloud }} выбирает аутентификацию с помощью единого входа.
1. Поставщик услуг направляет запрос аутентификации в {{ org-name }} (поставщик удостоверений) и перенаправляет пользователя на URL входа {{ org-name }}, указанный в поле `{{ ui-key.yacloud_org.application.overview.oauth_field_auth_endpoint }}`.
1. Пользователь аутентифицируется в {{ org-name }}, используя свои учетные данные.
1. Если в {{ org-name }} существует OIDC-приложение, соответствующее данному внешнему приложению, аутентифицировавшийся пользователь добавлен в это OIDC-приложение, а полученный запрос аутентификации корректен, то {{ org-name }} направляет поставщику услуг код авторизации и перенаправляет пользователя обратно во внешнее приложение.
1. По адресу, заданному в поле `{{ ui-key.yacloud_org.application.overview.oauth_field_token_endpoint }}`, поставщик услуг запрашивает в {{ org-name }} [ID-токен](../../iam/concepts/authorization/id-token.md) и токен доступа. В запросе указывается [секрет приложения](#oidc-secret), по которому {{ org-name }} проверяет подлинность запроса.
1. Если переданный поставщиком услуг секрет действителен, {{ org-name }} направляет поставщику услуг ID-токен и токен доступа.
1. Поставщик услуг проверяет переданный ID-токен с помощью публичного ключа, [получив](https://{{ auth-main-host }}/oauth/jwks/keys) его в {{ yandex-cloud }} по идентификатору, указанному в поле `kid` заголовка ID-токена. В случае успеха поставщик услуг предоставляет пользователю доступ к внешнему приложению.

Обмен данными между сторонами по стандарту OIDC происходит в формате [JSON](https://ru.wikipedia.org/wiki/JSON).

### Секрет OIDC-приложения {#oidc-secret}

_Секрет приложения_ генерируется пользователем на стороне OIDC-приложения в {{ org-name }} и представляет собой случайную строку определенной длины, начинающуюся с префикса `yccs__`.

Секрет приложения должен быть указан в настройках интеграции на стороне поставщика услуг и будет использоваться для проверки подлинности поступающих от поставщика услуг запросов.

Срок жизни секрета OIDC-приложения не ограничен. При этом вы в любой момент можете [сгенерировать](../operations/applications/oidc-update.md#update-secret) в приложении любое количество новых секретов, а также удалить их.

{% note warning %}

После удаления секрета в OIDC-приложении не забудьте указать новый секрет в настройках интеграции на стороне поставщика услуг.

{% endnote %}

Секреты OIDC-приложений не сохраняются на стороне {{ yandex-cloud }} и отображаются пользователю только в момент создания. После обновления или закрытия страницы браузера, на которой был сгенерирован секрет, содержимое секрета становится недоступно.

### Настройка на стороне поставщика удостоверений ({{ org-name }}) {#oidc-idp-setup}

Для корректной работы интеграции на стороне {{ org-name }} в OIDC-приложении необходимо [указать](../operations/applications/oidc-create.md#setup-idp) адрес (адреса) [Redirect URI](#oidc-redirect-uri), выбрать [набор атрибутов](#oidc-user-attributes) пользователя, которые будут передаваться поставщику услуг, а также сгенерировать [секрет приложения](#oidc-secret). Прежде чем настраивать OIDC-приложение на стороне {{ org-name }}, получите адрес (адреса) Redirect URI у вашего поставщика услуг.

#### Redirect URI {#oidc-redirect-uri}

_Redirect URI_ — адрес на стороне внешнего приложения, куда пользователь будет перенаправляться в результате успешного прохождения аутентификации в {{ org-name }}.

Redirect URI должен соответствовать схеме `https`. Использовать протокол без шифрования допускается только в целях тестирования на локальном хосте (значения `http://127.0.0.1` и `http://localhost`).

В OIDC-приложении вы можете задать одновременно несколько адресов Redirect URI.

#### Атрибуты пользователя {#oidc-attributes}

В настройках OIDC-приложения вы можете задать состав атрибутов пользователя, которые определяются выбранными в поле **{{ ui-key.yacloud_org.organization.apps.OauthAppEditForm.field-scopes_hEuar }}** значениями и будут передаваться поставщику услуг в ID-токене:

{% include [oidc-app-attribute-scopes](../../_includes/organization/oidc-app-attribute-scopes.md) %}

В новом OIDC-приложении по умолчанию выбраны все атрибуты, за исключением `groups`.

### Настройка на стороне поставщика услуг (внешнее приложение) {#oidc-sp-setup}

Для корректной работы интеграции на стороне поставщика услуг также необходимо настроить ряд параметров интеграции. В зависимости от возможностей вашего поставщика услуг вы можете [выполнить эти настройки](../operations/applications/oidc-create.md#setup-sp) как вручную, так и автоматически, указав URL с конфигурацией.

URL с конфигурацией предоставляет поставщику услуг значения всех необходимых для настройки интеграции параметров и доступен в поле **{{ ui-key.yacloud_org.application.overview.oauth_field_open_id }}** в блоке **{{ ui-key.yacloud_org.application.overview.oauth_service_section_title }}** на странице с информацией об OIDC-приложении в [интерфейсе {{ cloud-center }}]({{ link-org-cloud-center }}/apps). На этой же странице доступны значения параметров интеграции для настройки вручную:

{% include [oidc-app-sp-parameter-list](../../_includes/organization/oidc-app-sp-parameter-list.md) %}

В дополнение к указанным выше настройкам на стороне поставщика услуг также необходимо указать [секрет приложения](#oidc-secret).

#### См. также {#see-also}

* [{#T}](../operations/applications/saml-create.md)
* [{#T}](../operations/applications/saml-update.md)
* [{#T}](../operations/applications/saml-deactivate-remove.md)
* [{#T}](../operations/applications/oidc-create.md)
* [{#T}](../operations/applications/oidc-update.md)
* [{#T}](../operations/applications/oidc-deactivate-remove.md)