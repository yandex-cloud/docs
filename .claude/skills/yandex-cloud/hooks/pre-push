#!/usr/bin/env bash
# Yandex Cloud Skill - Pre-push Hook
# More thorough checks before push (max 60 seconds)

set -euo pipefail

# Allow skip
[[ "${SKIP_HOOKS:-0}" == "1" ]] && exit 0

# Timeout budget
TIMEOUT=60

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SKILL_DIR="$(dirname "$SCRIPT_DIR")"

# Run self-test with timeout
timeout ${TIMEOUT}s bash "$SKILL_DIR/scripts/self-test.sh" || {
  echo "[pre-push] Self-test failed (timeout: ${TIMEOUT}s)"
  echo "To skip: SKIP_HOOKS=1 git push ..."
  exit 1
}

exit 0
