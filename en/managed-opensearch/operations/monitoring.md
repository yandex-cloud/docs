# Monitoring the state of a {{ OS }} cluster and hosts

{% include [monitoring-introduction](../../_includes/mdb/monitoring-introduction.md) %}

New data for charts is received every {{ graph-update }}.

{% include [note-monitoring-auto-units](../../_includes/mdb/note-monitoring-auto-units.md) %}

{% include [alerts](../../_includes/mdb/alerts.md) %}

## Monitoring cluster state {#monitoring-cluster}

To view detailed information about the {{ mos-name }} cluster state:

{% list tabs group=instructions %}

- Management console {#console}

    1. In the [management console]({{ link-console-main }}), go to the folder page and select **{{ ui-key.yacloud.iam.folder.dashboard.label_managed-opensearch }}**.
    1. Click the name of the cluster you need and select the ![image](../../_assets/console-icons/display-pulse.svg) **{{ ui-key.yacloud.mdb.cluster.switch_monitoring }}** tab.

        The page displays the following charts:

        * **Health status**: Cluster health and technical condition:

            * `0` (red): Cluster is unhealthy or partially functional. At least one of the [primary shards](../concepts/scalability-and-resilience.md) is unavailable. If the cluster responds to queries, the search results will be incomplete.
            * `1` (yellow): Cluster is functional. There is no access to at least one of the replica shards. The search results in the cluster responses are complete; however, if there are more unavailable shards, cluster performance will be disrupted.
            * `2` (green): Cluster is healthy. All cluster shards are available.

        * **Active shards**: Number of active primary shards and the total number of active shards in the cluster.
        * **Other shards**: Number of inactive shards in each of the following states:

            * `Delayed unassigned`: Host assignment is delayed.
            * `Unassigned`: No host assigned.
            * `Relocating`: Moving to another host.
            * `Initializing`: Initializing.

        * **Nodes**: Number of hosts with the `DATA` [role](../concepts/host-roles.md#data).
        * **Segments**: Number of index segments per host.
        * **Pending tasks**: Number of enqueued tasks.
        * **Indexing rate**: Number of indexing operations per second, per host.
        * **Search rate**: Number of search queries per second, per host.

    {% note info %}

    {% include [monitoring-provides](../../_includes/mdb/monitoring-provides.md) %}

    {% endnote %}

{% endlist %}

## Monitoring the state of hosts {#monitoring-hosts}

To view detailed information about the state of individual {{ mos-name }} hosts:

1. In the [management console]({{ link-console-main }}), go to the folder page and select **{{ ui-key.yacloud.iam.folder.dashboard.label_managed-opensearch }}**.
1. Click the name of the cluster you need and select the ![image](../../_assets/console-icons/cube.svg) **{{ ui-key.yacloud.mdb.cluster.hosts.label_title }}** tab.
1. Select the **{{ ui-key.yacloud.mdb.cluster.hosts.switch_monitoring }}** tab.
1. Select the host from the drop-down list.

This page displays charts showing the load on an individual host in the cluster. Which charts are exactly displayed depends on the host type:

{% list tabs %}

* MANAGER

    * **Process CPU**: Processor core workload generated by the JVM {{ OS }} process.
    * **Memory usage**: Use of RAM, in bytes.
    * **JVM heap**: Use of JVM heap memory, in bytes.
    * **Disk space usage percent**: Use of disk space, in percentage.
    * **Management thread pool**: Number of cluster management requests.
    * **Generic thread pool**: Number of requests for running general operations.
    * **Thread pool queued**: Number of enqueued requests.
    * **Thread pool rejected**: Number of rejected requests.

* DATA

    * **Process CPU**: Processor core workload generated by the JVM {{ OS }} process.
    * **Memory usage**: Use of RAM, in bytes.
    * **JVM heap percent**: Use of JVM heap memory, in percentage
    * **Disk space usage percent**: Use of disk space, in percentage.
    * **Indexing rate**: Number of indexing operations per second.
    * **Search queries**: Number of search queries per second.
    * **Open file descriptors**: Number of open file descriptors.
    * **Write bytes**: Disk write rate, in bytes per second.
    * **Read bytes**: Disk read rate, in bytes per second.
    * **Write thread pool**: Requests for indexing, deleting, or updating documents.
    * **Write operations**: Number of write operations per second.
    * **Read operations**: Number of read operations per second.
    * **Query time**: Time spent to run the queries.
    * **Thread pool queued**: Number of enqueued requests.
    * **Thread pool rejected**: Number of rejected requests.
    * **Indexing time**: Time spent to index the documents.
    * **Merging time**: Time spent to merge the documents.

* DASHBOARDS

    * **Is Alive**: Status that shows the host is up and running.
    * **Requests Total**: Total number of host requests.
    * **Process CPU**: Processor core workload generated by the JVM {{ OS }} process.
    * **Memory usage**: Use of RAM, in bytes.
    * **Disk read/write bytes**: Speed of disk operations, in bytes per second.
    * **Disk IOPS**: Number of disk operations per second.
    * **Network packets**: Number of packets exchanged over the network, per second.
    * **Network bytes**: Speed of data exchange over the network, in bytes per second.

{% endlist %}

## Monitoring the state of host groups {#monitoring-host-groups}

To view detailed information about the state of a {{ mos-name }} host group:

1. In the [management console]({{ link-console-main }}), go to the folder page and select **{{ ui-key.yacloud.iam.folder.dashboard.label_managed-opensearch }}**.
1. Click the name of the cluster you need and select the ![image](../../_assets/console-icons/copy-transparent.svg) **{{ ui-key.yacloud.opensearch.cluster.node-groups.title_node-groups }}** tab.
1. Select the **{{ ui-key.yacloud.mdb.cluster.hosts.switch_monitoring }}** tab.
1. Select the host group you need from the drop-down list.

This page displays charts showing the load on the cluster's host group. Which charts are exactly displayed depends on the type of hosts in the group; this is in line with the [charts shown for individual hosts](#monitoring-hosts).


## Alert settings in {{ monitoring-full-name }} {#monitoring-integration}

{% list tabs group=instructions %}

- Management console {#console}

  1. In the [management console]({{ link-console-main }}), select the folder with the cluster you want to configure alerts for.
  1. In the list of services, select ![image](../../_assets/console-icons/display-pulse.svg) **{{ ui-key.yacloud.iam.folder.dashboard.label_monitoring }}**.
  1. Under **{{ ui-key.yacloud_monitoring.dashboard.tab.service-dashboards }}**, select:

      * **{{ mos-name }}** to configure cluster alerts.
      * **{{ mos-name }} — Dashboards** to configure alerts for hosts with the `DASHBOARDS` role.
      * **{{ mos-name }} — Data** to configure alerts for hosts with the `DATA` role.
      * **{{ mos-name }} — Manager** to configure alerts for hosts with the `MANAGER` role.

  1. In the chart you need, click ![options](../../_assets/console-icons/ellipsis.svg) and select **{{ ui-key.yacloud_monitoring.alert.button_create-alert }}**.
  1. If the chart shows multiple metrics, select a data query to generate a metric and click **{{ ui-key.yacloud_monitoring.dialog.confirm.button_continue }}**. You can learn more about the query language in the [{{ monitoring-full-name }} documentation](../../monitoring/concepts/querying.md).
  1. Set the `{{ ui-key.yacloud_monitoring.alert.status_alarm }}` and `{{ ui-key.yacloud_monitoring.alert.status_warn }}` threshold values to trigger the alert.
  1. Click **{{ ui-key.yacloud_monitoring.alert.button_create-alert }}**.

{% endlist %}

{% include [other-indicators](../../_includes/mdb/other-indicators.md) %}

The recommended thresholds are as follows:

| Metrica                                      |                Parameter             |         Formula        |              `{{ ui-key.yacloud_monitoring.alert.status_alarm }}`              |             `{{ ui-key.yacloud_monitoring.alert.status_warn }}`             |
|----------------------------------------------|:--------------------------------------:|:----------------------:|:---------------------------------:|:---------------------------------:|
| Cluster status                              |           `opensearch_status`          |     `bottom_last(1)`   |              `equal to 0`            |              `equal to 1`            |
| Number of unassigned shards                   |     `opensearch_unassigned_shards`     |      `top_last(1)`     |             `greater than 0`            |                                   |
| Number of relocated shards                    |     `opensearch_relocating_shards`     |      `top_last(1)`     |             `greater than 0`            |                                   |
| Number of initialized shards                |    `opensearch_initializing_shards`    |      `top_last(1)`     |             `greater than 0`            |                                   |
| Number of delayed assignment shards         | `opensearch_delayed_unassigned_shards` |      `top_last(1)`     |             `greater than 0`            |                                   |
| JVM heap memory used         | `opensearch_jvm_mem_heap_used_percent` |      `top_last(1)`     | Over 90% of host RAM |                                   |
| Storage space used              |   `opensearch_fs_total_used_percent`   |      `top_last(1)`     |  Over 90% of the storage size  |  Over 85% of the storage size  |
| Using the JVM long-lived object pool |   `opensearch_jvm_mem_heap_pressure`   |      `top_last(1)`     | Over 90% of host RAM | Over 75% of host RAM |
| Storage space used             | `disk.used_bytes`                      | —                      | 90% of the storage size          | 80% of the storage size          |

For the `disk.used_bytes` metric, the `{{ ui-key.yacloud_monitoring.alert.status_alarm }}` and `{{ ui-key.yacloud_monitoring.alert.status_warn }}` thresholds are only set in bytes. For example, the recommended values for a 100 GB disk are as follows:

* `{{ ui-key.yacloud_monitoring.alert.status_alarm }}`: `96,636,764,160` bytes (90%)
* `{{ ui-key.yacloud_monitoring.alert.status_warn }}`: `85,899,345,920` bytes (80%)

You can view the current storage size and RAM of the hosts in the [detailed information about the cluster](cluster-list.md#get-cluster). For a complete list of supported metrics, see the [{{ monitoring-name }} documentation](../../monitoring/metrics-ref/managed-opensearch-ref.md).


## Cluster state and status {#cluster-health-and-status}

{% include [health-and-status](../../_includes/mdb/monitoring-cluster-health-and-status.md) %}

To view a cluster's state and status:

{% list tabs group=instructions %}

- Management console {#console}

    1. In the [management console]({{ link-console-main }}), go to the folder page and select **{{ ui-key.yacloud.iam.folder.dashboard.label_managed-opensearch }}**.
    1. Hover over the indicator in the **{{ ui-key.yacloud.common.availability }}** column in the required cluster row.

- CLI {#cli}

    {% include [cli-install](../../_includes/cli-install.md) %}

    {% include [default-catalogue](../../_includes/default-catalogue.md) %}

    To find out the state and status of a cluster, get information about it:

    ```bash
    {{ yc-mdb-os }} cluster get <cluster_name_or_ID>
    ```

    The `health` parameter gives the cluster state; the `status` parameter gives the cluster status.

    You can request the cluster name and ID with a [list of clusters in the folder](cluster-list.md#list-clusters).

- API {#api}

    Use the [get](../api-ref/Cluster/get.md) REST API method for the [Cluster](../api-ref/Cluster/index.md) resource or the [ClusterService/Get](../api-ref/grpc/Cluster/get.md) gRPC API call, and provide the ID of cluster being deleted in the `clusterId` request parameter.

    The cluster health and status will be shown in the `health` and `status` parameters, respectively.

    {% include [get-cluster-id](../../_includes/managed-opensearch/get-cluster-id.md) %}

{% endlist %}

### Cluster states {#cluster-health}

{% include [monitoring-cluster-health](../../_includes/mdb/monitoring-cluster-health.md) %}

### Cluster statuses {#cluster-status}

{% include [monitoring-cluster-status](../../_includes/mdb/monitoring-cluster-status.md) %}
