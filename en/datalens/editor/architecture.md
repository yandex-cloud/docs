# ChartEditor

**ChartEditor** is an editor that enables you to create widgets for data visualization by writing JavaScript code.

[Quick start](./index.md)

ChartEditor enables data loading, parameterization, preprocessing (the `EditorEngine` runtime), after which it transmits the result to `ChartKit`— it's our library for widget rendering (charts are plotted using the built-in [HighCharts](https://www.highcharts.com/) module, and tables, texts, and metrics are generated by ChartKit itself).

The code is run on the server (`Node.js 10`), with the following exceptions: event handlers in charts and `manager` widgets (control elements in the Statistics dashboards) that run in browsers. You can't use system libraries and the node's `require` function in the scripts. However, the engine provides some auxiliary functions and its own `require` to import custom modules.

## How do tabs work {#how-tabs-works}

In the below diagram:
* Arrows show the sequence of tab execution.
* Legends on arrows show the methods used to call the tab in the next tabs.

In every tab except `Shared`, the execution result (be it an object with a configuration, links to sources, or prepared data) must be saved to a predefined `module.exports` object at the end of the script.

![order-of-operations](../../_assets/datalens/internal/editor/order-of-operations.png =600x490)

### Shared {#shared}

The tab is designed to store configs and shared data for other tabs. Unlike other tabs, this tab can only include pure JSON (don't omit double quotes!), no code can be used here.
The `Shared` content is read-only in the other tabs, you can't edit or update this content from them.

Currently, the Shared tab is only shown in the charts that are generated automatically on our side (for example, when exporting from Metrics).

Example of the contents: 

```javascripton
{
    "type": "incremental",
    "title": "RU_WEB_default",
    "graphName": "HISTORY",
    "startDate": null,
    "endDate": null,
    "period": 90,
    "confidentOnly": false
}
```

The `Shared` content is available in any other tab by calling `ChartEditor.getSharedData()`.

### Params {#params}

The tab is used for setting default widget parameters. For more information, see [Parameterization](params.md). It can be empty.

In `Params`, as in other tabs, you can use data from`Shared`.

Example of the contents: 

```javascript
module.exports = {
    scale: ['d']
};
```

The parameters can be accessed from the next tabs by `ChartEditor.getParams()`. The default parameters are overridden by arguments from the URL of the open chart. In the example above, when opening a chart with no URL parameters (`/something/chart`), `params` will include `{scale: ['d']}`. So, for `/something/chart?scale=w`, we'll have `{scale: ['w']}` (the value `w` from the URL is replaced by `d` from the tab), and for `/something/chart?scale=w&scale=i` — `{scale: ['w', 'i']}`. The last example illustrates an important fact: all the parameter values are arrays, even if the parameter is used only once in the URL.

Up-to-date parameter values are available on every further described tab by calling `ChartEditor.getParams()`.

### Urls {#urls}

This tab defines a set of data sources that you want to visualize.

```javascript
module.exports = {
    totals: '/api/some/get/request?scale=d&region=RU'
};
```

For more information on how to write a valid request for the API, see the [sources](sources/index.md) page.

### Config, Highcharts {#config-and-highcharts}

These tabs enable widget setup. Their possible content depends on the specific widget type (for example, [for charts](widgets/chart/index.md)).

```javascript
module.exports = {
    setting: 'value'
};
```

### JavaScript {#js}

The tab is responsible for data preprocessing before rendering and includes the following actions:
- Getting uploaded data from sources
- Processing the data and converting it to relevant formats (similar to the configuration, the format depends on the widget type (for example, [chart](widgets/chart/index.md)
- Writing the results to `module.exports` (similarly to other tabs), from where they are sent for rendering

Basic examples:

```javascript
const data = ChartEditor.getLoadedData(); // Get the uploaded data
const totals = data.totals; // The value is in the same key as the URL in the Urls tab
// ...
// preparing data 
// ...
module.exports = {
    graphs: [ ... ], // Lines
    categories_ms: [ ... ] // Timeline
};
````

If needed, you can use this tab's script to change the earlier specified values from the Config and Highcharts tabs, for example:

```javascript
ChartEditor.updateConfig({
    setting: 'newValue'
});

ChartEditor.updateHighchartsConfig({
    setting: 'newValue'
});
```

### Controls {#controls}

This tab is the last to run. Here, we use a declarative style to describe all the controls in the widget. Read more on a dedicated [page](controls/index.md).
